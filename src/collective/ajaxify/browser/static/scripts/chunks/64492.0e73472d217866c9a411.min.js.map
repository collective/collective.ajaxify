{"version":3,"file":"chunks/64492.0e73472d217866c9a411.min.js","mappings":"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","sources":["webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/contentbrowser/contentbrowser.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/autotoc/autotoc.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/core/i18n.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/core/i18n-wrapper.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/select2/select2.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/core/basepattern.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/datatables/datatables.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/modal/modal.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/core/utils.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/relateditems/relateditems.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/core/jquery-ext.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/checklist/checklist.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/datetime-picker/datetime-picker.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/validation/validation.js","webpack://collective.ajaxify/./node_modules/@patternslib/pat-code-editor/src/code-editor.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/inject/inject.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/depends/depends.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/base-url/base-url.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/contentloader/contentloader.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/cookietrigger/cookietrigger.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/formautofocus/formautofocus.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/formunloadalert/formunloadalert.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/livesearch/livesearch.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/markspeciallinks/markspeciallinks.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/navigationmarker/navigationmarker.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/passwordstrength/passwordstrength.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/preventdoublesubmit/preventdoublesubmit.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/manageportlets/manageportlets.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/recurrence/recurrence.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/search/search.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/structure/structure.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/structure-updater/structure-updater.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/tinymce/tinymce.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/textareamimetypeselector/textareamimetypeselector.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/toggle/toggle.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/toolbar/toolbar.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/tree/tree.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/dexterity-types-listing.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/registry.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/schemaeditor.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/contentrules.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/contentrule-elements.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/discussion.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/discussion-comments.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/controlpanels/discussion-moderation.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/patterns.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/backdrop/backdrop.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/core/mockup-parser.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/core/base.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/querystring/querystring.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/sortable/sortable.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/display-time/display-time.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/close-panel/close-panel.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/tooltip/tooltip.js","webpack://collective.ajaxify/./node_modules/@plone/mockup/src/pat/upload/upload.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/core/store.js","webpack://collective.ajaxify/./node_modules/@patternslib/patternslib/src/pat/date-picker/date-picker.js"],"sourcesContent":["import { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport plone_registry from \"@plone/registry\";\n\n// Contentbrowser pattern\n\nexport const parser = new Parser(\"contentbrowser\");\n\nparser.addArgument(\"vocabulary-url\");\nparser.addArgument(\n    \"attributes\",\n    [\n        \"UID\",\n        \"Title\",\n        \"Description\",\n        \"portal_type\",\n        \"path\",\n        \"getURL\",\n        \"getIcon\",\n        \"is_folderish\",\n        \"review_state\",\n        \"created\",\n        \"modified\",\n    ], null, true\n);\nparser.addArgument(\"width\");\nparser.addArgument(\"mode\");\nparser.addArgument(\"max-depth\");\nparser.addArgument(\"root-path\");\nparser.addArgument(\"root-url\");\nparser.addArgument(\"base-path\");\nparser.addArgument(\"context-path\");\nparser.addArgument(\"maximum-selection-size\");\nparser.addArgument(\"selectable-types\");\nparser.addArgument(\"browseable-types\");\nparser.addArgument(\"search-index\");\nparser.addArgument(\"separator\");\nparser.addArgument(\"selection\");\nparser.addArgument(\"selection-template\");\nparser.addArgument(\"favorites\");\nparser.addArgument(\"recently-used\");\nparser.addArgument(\"recently-used-key\");\nparser.addArgument(\"recently-used-max-items\");\nparser.addArgument(\"b-size\");\n\nclass Pattern extends BasePattern {\n    static name = \"contentbrowser\";\n    static trigger = \".pat-contentbrowser\";\n    static parser = parser;\n\n    async init() {\n        this.el.style.display = \"none\";\n\n        // register default components in @plone/registry\n        const SelectedItem = (await import(\"./src/SelectedItem.svelte\")).default;\n\n        plone_registry.registerComponent({\n            name: \"pat-contentbrowser.SelectedItem\",\n            component: SelectedItem,\n        });\n\n        // ensure an id on our element (TinyMCE doesn't have one)\n        let nodeId = this.el.getAttribute(\"id\");\n        if (!nodeId) {\n            nodeId = utils.generateId();\n            this.el.setAttribute(\"id\", nodeId);\n        }\n\n        const ContentBrowserApp = (await import(\"./src/App.svelte\")).default;\n\n        // create browser node\n        const contentBrowserEl = document.createElement(\"div\");\n        contentBrowserEl.classList.add(\"content-browser-wrapper\");\n        this.el.parentNode.insertBefore(contentBrowserEl, this.el);\n\n        this.component_content_browser = new ContentBrowserApp({\n            target: contentBrowserEl,\n            props: {\n                fieldId: nodeId,\n                ...this.options,\n            }\n        });\n    }\n}\n\nregistry.register(Pattern);\nexport default Pattern;\nexport { Pattern };\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"@patternslib/patternslib/src/core/utils\";\n\nexport default Base.extend({\n    name: \"autotoc\",\n    trigger: \".pat-autotoc\",\n    parser: \"mockup\",\n    defaults: {\n        section: \"section\",\n        levels: \"h1,h2,h3\",\n        IDPrefix: \"autotoc-item-\",\n        classTOCName: \"autotoc-nav\",\n        classSectionName: \"autotoc-section\",\n        classLevelPrefixName: \"autotoc-level-\",\n        classActiveName: \"active\",\n        scrollDuration: \"slow\",\n        scrollEasing: \"swing\",\n        validationDelay: 200, // Note: This is set to twice as the default delay time for validation.\n    },\n\n    tabs: [],\n\n    init: function () {\n        import(\"./autotoc.scss\");\n\n        var self = this;\n\n        self.$toc = $(\"<nav/>\").addClass(self.options.classTOCName);\n\n        if (self.options.prependTo) {\n            self.$toc.prependTo(self.options.prependTo);\n        } else if (self.options.appendTo) {\n            self.$toc.appendTo(self.options.appendTo);\n        } else {\n            self.$toc.prependTo(self.$el);\n        }\n\n        if (self.options.className) {\n            self.$el.addClass(self.options.className);\n        }\n\n        $(self.options.section, self.$el).addClass(self.options.classSectionName);\n\n        var asTabs = self.$el.hasClass(\"autotabs\");\n\n        var activeId = null;\n\n        $(self.options.levels, self.$el).each(function (i) {\n            const section = this.closest(self.options.section);\n            const $level = $(this);\n            let id = $level.prop(\"id\") ? $level.prop(\"id\") : $(section).prop(\"id\");\n\n            if (!id || $(\"#\" + id).length > 0) {\n                id = self.options.IDPrefix + self.name + \"-\" + i;\n            }\n            if (window.location.hash === \"#\" + id) {\n                activeId = id;\n            }\n            if (activeId === null && $level.hasClass(self.options.classActiveName)) {\n                activeId = id;\n            }\n            $level.data(\"navref\", id);\n            const $nav = $(\"<a/>\");\n            $nav.appendTo(self.$toc)\n                .text($level.text())\n                .attr(\"id\", id)\n                .attr(\"href\", \"#\" + id)\n                .addClass(self.options.classLevelPrefixName + self.getLevel($level))\n                .on(\"click\", function (e, options) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    if (!options) {\n                        options = {\n                            doScroll: true,\n                            skipHash: false,\n                        };\n                    }\n                    var $el = $(this);\n                    self.$toc\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    self.$el\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    $(e.target).addClass(self.options.classActiveName);\n                    $level\n                        .parents(self.options.section)\n                        .addClass(self.options.classActiveName);\n                    if (\n                        options.doScroll !== false &&\n                        self.options.scrollDuration &&\n                        $level &&\n                        !asTabs\n                    ) {\n                        $(\"body,html\").animate(\n                            {\n                                scrollTop: $level.offset().top,\n                            },\n                            self.options.scrollDuration,\n                            self.options.scrollEasing\n                        );\n                    }\n                    if (self.$el.parents(\".plone-modal\").length !== 0) {\n                        self.$el.trigger(\"resize.plone-modal.patterns\");\n                    }\n                    $(this).trigger(\"clicked\");\n                    if (!options.skipHash) {\n                        if (window.history && window.history.pushState) {\n                            window.history.pushState({}, \"\", \"#\" + $el.attr(\"id\"));\n                        }\n                    }\n                });\n            $level.data(\"autotoc-trigger-id\", id);\n\n            self.tabs.push({\n                section: section,\n                id: id,\n                nav: $nav[0],\n            });\n        });\n\n        if (activeId) {\n            $(\"a#\" + activeId).trigger(\"click\", {\n                doScroll: true,\n                skipHash: true,\n            });\n        } else {\n            self.$toc.find(\"a\").first().trigger(\"click\", {\n                doScroll: false,\n                skipHash: true,\n            });\n        }\n\n        // After DOM tree is built, initialize eventual validation\n        this.initialize_validation(self.$el);\n    },\n\n    initialize_validation: function ($el) {\n        const el = $el[0];\n\n        // Initialize only on forms\n        const form = el.closest(\"form\");\n        if (!form) {\n            return;\n        }\n\n        for (const tab of this.tabs) {\n            if (\n                tab.section.querySelectorAll(\n                    \"label.required, label .required, [required]\",\n                ).length > 0\n            ) {\n                tab.nav.classList.add(\"required\");\n            } else {\n                tab.nav.classList.remove(\"required\");\n            }\n        }\n\n        // Initialize the validation css class markings only for pat-validation forms.\n        if (!form.matches(\".pat-validation\")) {\n            return;\n        }\n\n        const debounced_validation_marker = utils.debounce(() => {\n            this.validation_marker();\n        }, this.options.validationDelay);\n\n        form.addEventListener(\"pat-update\", (e) => {\n            if (e.detail?.pattern !== \"validation\") {\n                // Nothing to do.\n                return;\n            }\n            debounced_validation_marker();\n        });\n    },\n\n    validation_marker: function () {\n        for (const tab of this.tabs) {\n            if (tab.section.querySelectorAll(\":invalid\").length > 0) {\n                tab.nav.classList.add(\"invalid\");\n            } else {\n                tab.nav.classList.remove(\"invalid\");\n            }\n        }\n    },\n\n    getLevel: function ($el) {\n        var elementLevel = 0;\n        $.each(this.options.levels.split(\",\"), function (level, levelSelector) {\n            if ($el.filter(levelSelector).length === 1) {\n                elementLevel = level + 1;\n                return false;\n            }\n        });\n        return elementLevel;\n    },\n});\n","/* i18n integration. This is forked from jarn.jsi18n\n *\n * This is a singleton.\n * Configuration is done on the body tag data-i18ncatalogurl attribute\n *     <body data-i18ncatalogurl=\"/plonejsi18n\">\n *\n *  Or, it'll default to \"/plonejsi18n\"\n */\n\nimport $ from \"jquery\";\n\nconst i18n = function () {\n    var self = this;\n    self.baseUrl = $(\"body\").attr(\"data-i18ncatalogurl\");\n    self.currentLanguage = $(\"html\").attr(\"lang\") || \"en\";\n\n    self.storage = null;\n    self.catalogs = {};\n    self.ttl = 24 * 3600 * 1000;\n\n    // Internet Explorer 8 does not know Date.now() which is used in e.g. loadCatalog, so we \"define\" it\n    if (!Date.now) {\n        Date.now = function () {\n            return new Date().valueOf();\n        };\n    }\n\n    try {\n        if (\n            \"localStorage\" in window &&\n            window.localStorage !== null &&\n            \"JSON\" in window &&\n            window.JSON !== null\n        ) {\n            self.storage = window.localStorage;\n        }\n    } catch {\n        console.log(\"Failed to set local storage\");\n    }\n\n    self.configure = function (config) {\n        for (var key in config) {\n            self[key] = config[key];\n        }\n    };\n\n    self._setCatalog = function (domain, language, catalog) {\n        if (domain in self.catalogs) {\n            self.catalogs[domain][language] = catalog;\n        } else {\n            self.catalogs[domain] = {};\n            self.catalogs[domain][language] = catalog;\n        }\n    };\n\n    self._storeCatalog = function (domain, language, catalog) {\n        var key = domain + \"-\" + language;\n        if (self.storage !== null && catalog !== null) {\n            self.storage.setItem(key, JSON.stringify(catalog));\n            self.storage.setItem(key + \"-updated\", Date.now());\n        }\n    };\n\n    self.getUrl = function (domain, language) {\n        return self.baseUrl + \"?domain=\" + domain + \"&language=\" + language;\n    };\n\n    self.loadCatalog = function (domain, language) {\n        if (language === undefined) {\n            language = self.currentLanguage;\n        }\n        if (self.storage !== null) {\n            var key = domain + \"-\" + language;\n            if (key in self.storage) {\n                if (\n                    Date.now() - parseInt(self.storage.getItem(key + \"-updated\"), 10) <\n                    self.ttl\n                ) {\n                    var catalog = JSON.parse(self.storage.getItem(key));\n                    self._setCatalog(domain, language, catalog);\n                    return;\n                }\n            }\n        }\n        if (!self.baseUrl) {\n            return;\n        }\n        $.getJSON(self.getUrl(domain, language), function (catalog) {\n            if (catalog === null) {\n                return;\n            }\n            self._setCatalog(domain, language, catalog);\n            self._storeCatalog(domain, language, catalog);\n        });\n    };\n\n    self.MessageFactory = function (domain, language) {\n        language = language || self.currentLanguage;\n        return function translate(msgid, keywords) {\n            var msgstr;\n            if (\n                domain in self.catalogs &&\n                language in self.catalogs[domain] &&\n                msgid in self.catalogs[domain][language]\n            ) {\n                msgstr = self.catalogs[domain][language][msgid];\n            } else {\n                msgstr = msgid;\n            }\n            if (keywords) {\n                var regexp, keyword;\n                for (keyword in keywords) {\n                    if (Object.prototype.hasOwnProperty.call(keywords, keyword)) {\n                        regexp = new RegExp(\"\\\\$\\\\{\" + keyword + \"\\\\}\", \"g\");\n                        msgstr = msgstr.replace(regexp, keywords[keyword]);\n                    }\n                }\n            }\n            return msgstr;\n        };\n    };\n};\n\nexport default i18n;\n","/* i18n integration.\n *\n * This is a singleton.\n * Configuration is done on the body tag data-i18ncatalogurl attribute\n *     <body data-i18ncatalogurl=\"/plonejsi18n\">\n *\n *  Or, it'll default to \"/plonejsi18n\"\n */\n\nimport I18N from \"./i18n\";\n\n// we're creating a singleton here so we can potentially\n// delay the initialization of the translate catalog\n// until after the dom is available\nlet _translation_domains = {\n    plone: null,\n    widgets: null,\n};\n\nconst translate = function (domain, msgid, keywords) {\n    if (_translation_domains[domain] === null) {\n        var i18n = new I18N();\n        i18n.loadCatalog(domain);\n        _translation_domains[domain] = i18n.MessageFactory(domain);\n    }\n    return _translation_domains[domain](msgid, keywords);\n};\n\nconst translate_widgets = function (msgid, keywords) {\n    return translate(\"widgets\", msgid, keywords);\n};\n\nconst translate_plone = function (msgid, keywords) {\n    return translate(\"plone\", msgid, keywords);\n};\n\n// backwards compatibilty: \"widgets\" domain is default factory\nexport default translate_widgets;\n\n// explicit export of translation domain factories\nexport { translate_widgets, translate_plone };\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport I18n from \"../../core/i18n\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"select2\",\n    trigger: \".pat-select2\",\n    parser: \"mockup\",\n    defaults: {\n        separator: \",\",\n        ajaxTimeout: 300,\n    },\n\n    initializeValues() {\n        // Init Selection ---------------------------------------------\n        if (this.options.initialValues) {\n            this.options.id = (term) => {\n                return term.id;\n            };\n            this.options.initSelection = ($el, callback) => {\n                const data = [];\n                const value = $el.val();\n                let seldefaults = this.options.initialValues;\n\n                // Create the initSelection value that contains the default selection,\n                // but in a javascript object\n                if (\n                    typeof this.options.initialValues === \"string\" &&\n                    this.options.initialValues !== \"\"\n                ) {\n                    // if default selection value starts with a '{', then treat the value as\n                    // a JSON object that needs to be parsed\n                    if (this.options.initialValues[0] === \"{\") {\n                        seldefaults = JSON.parse(this.options.initialValues);\n                    }\n                    // otherwise, treat the value as a list, separated by the defaults.separator value of\n                    // strings in the format \"id:text\", and convert it to an object\n                    else {\n                        seldefaults = {};\n                        const initial_values = $(\n                            this.options.initialValues.split(this.options.separator)\n                        );\n                        for (const it of initial_values) {\n                            const selection = it.split(\":\");\n                            const id = selection[0].trim();\n                            const text = selection[1].trim();\n                            seldefaults[id] = text;\n                        }\n                    }\n                }\n\n                const items = $(value.split(this.options.separator));\n                for (const it of items) {\n                    let text = it;\n                    if (seldefaults[it]) {\n                        text = seldefaults[it];\n                    }\n                    data.push({\n                        id: utils.removeHTML(it),\n                        text: utils.removeHTML(text),\n                    });\n                }\n                callback(data);\n            };\n        }\n    },\n\n    initializeTags() {\n        if (this.options.tags && typeof this.options.tags === \"string\") {\n            if (this.options.tags.substr(0, 1) === \"[\") {\n                this.options.tags = JSON.parse(this.options.tags);\n            } else {\n                this.options.tags = this.options.tags.split(this.options.separator);\n            }\n        }\n\n        if (this.options.tags && !this.options.allowNewItems) {\n            this.options.data = this.options.tags.map((value) => {\n                return { id: value, text: value };\n            });\n            this.options.multiple = true;\n            delete this.options.tags;\n        }\n    },\n\n    async initializeOrdering() {\n        if (!this.options.orderable) {\n            return;\n        }\n        const Sortable = (await import(\"sortablejs\")).default;\n        const _initializeOrdering = () => {\n            const sortable_el = this.$select2[0].querySelector(\".select2-choices\");\n            new Sortable(sortable_el, {\n                draggable: \"li\",\n                dragClass: \"select2-choice-dragging\",\n                chosenClass: \"dragging\",\n                onStart: () => this.$el.select2(\"onSortStart\"),\n                onEnd: () => this.$el.select2(\"onSortEnd\"),\n            });\n        };\n        this.$el.on(\"change\", _initializeOrdering.bind(this));\n        _initializeOrdering();\n    },\n\n    async initializeSelect2() {\n        import(\"select2/select2.css\");\n        import(\"./select2.scss\");\n        await import(\"select2\");\n        try {\n            // Don't load \"en\" which is the default where no separate language file exists.\n            if (this.options.language && this.options.language !== \"en\" && !this.options.language.startsWith(\"en\")) {\n                let lang = this.options.language.split(\"-\");\n                // Fix for country specific languages\n                lang = (lang.length > 1) ? `${lang[0]}-${lang[1]}` : lang[0];        \n                await import(`select2/select2_locale_${lang}`);\n            }\n        } catch {\n            console.warn(\"Language file could not be loaded\", this.options.language);\n        }\n\n        this.options.formatResultCssClass = (ob) => {\n            if (ob.id) {\n                return (\n                    \"select2-option-\" +\n                    ob.id.toLowerCase().replace(/[ \\:\\)\\(\\[\\]\\{\\}\\_\\+\\=\\&\\*\\%\\#]/g, \"-\")\n                );\n            }\n        };\n\n        function callback(action, e) {\n            if (action) {\n                if (this.options.debug) {\n                    console.debug(\"callback\", action, e);\n                }\n                if (typeof action === \"string\") {\n                    action = window[action];\n                }\n                return action(e);\n            } else {\n                return action;\n            }\n        }\n\n        this.$el.select2(this.options);\n        this.$el.on(\"select2-selected\", (e) => callback(this.options.onSelected, e));\n        this.$el.on(\"select2-selecting\", (e) => callback(this.options.onSelecting, e));\n        this.$el.on(\"select2-deselecting\", (e) =>\n            callback(this.options.onDeselecting, e)\n        );\n        this.$el.on(\"select2-deselected\", (e) => callback(this.options.onDeselected, e));\n        this.$select2 = this.$el.parent().find(\".select2-container\");\n        this.$el.parent().off(\"close.plone-modal.patterns\");\n        if (this.options.orderable) {\n            this.$select2.addClass(\"select2-orderable\");\n        }\n    },\n\n    opened() {\n        const isOpen = $(\".select2-dropdown-open\", this.$el.parent()).length === 1;\n        return isOpen;\n    },\n\n    async init() {\n        const i18n = new I18n();\n        this.options.language = i18n.currentLanguage;\n        this.options.allowNewItems = this.options.allowNewItems\n            ? JSON.parse(this.options.allowNewItems)\n            : true;\n\n        // TODO: Select2 respects the select fields multiple attribute.\n        //       Currently, only when multiple is set in the pattern options\n        //       the replacement to a hidden input field is done.\n        //       A collection's querystring widget has the multiple attribute\n        //       but must not be replaced with a hidden inout, otherwise robot\n        //       tests fail.\n        //if (this.el.hasAttribute(\"multiple\")) {\n        //    this.options.multiple = true;\n        //}\n\n        if (this.options.ajax || this.options.vocabularyUrl) {\n            if (this.options.vocabularyUrl) {\n                this.options.multiple =\n                    this.options.multiple === undefined ? true : this.options.multiple;\n                this.options.ajax = this.options.ajax || {};\n                this.options.ajax.url = this.options.vocabularyUrl;\n                // XXX removing the following function does'nt break tests. dead code?\n                this.options.initSelection = ($el, callback) => {\n                    const data = [];\n                    const value = $el.val();\n                    for (const val of value.split(this.options.separator)) {\n                        const _val = utils.removeHTML(val);\n                        data.push({ id: _val, text: _val });\n                    }\n                    callback(data);\n                };\n            }\n\n            let queryTerm = \"\";\n\n            const ajaxTimeout = parseInt(this.options.ajaxTimeout || 300, 10);\n            delete this.options.ajaxTimeout;\n            this.options.ajax = $.extend(\n                {\n                    quietMillis: ajaxTimeout,\n                    data: (term, page) => {\n                        queryTerm = term;\n                        return {\n                            query: term,\n                            page_limit: 10,\n                            page: page,\n                        };\n                    },\n                    results: (data) => {\n                        let results = data.results;\n                        if (this.options.vocabularyUrl) {\n                            const dataIds = [];\n                            for (const it of data.results) {\n                                dataIds.push(it.id);\n                            }\n                            results = [];\n\n                            const haveResult =\n                                queryTerm === \"\" || dataIds.includes(queryTerm);\n                            if (this.options.allowNewItems && !haveResult) {\n                                queryTerm = utils.removeHTML(queryTerm);\n                                results.push({\n                                    id: queryTerm,\n                                    text: queryTerm,\n                                });\n                            }\n\n                            for (const it of data.results) {\n                                results.push(it);\n                            }\n                        }\n                        return { results: results };\n                    },\n                },\n                this.options.ajax\n            );\n        } else if (this.options.multiple && this.$el.is(\"select\")) {\n            // Multiselects are converted to input[type=hidden] for Select2\n            // TODO: This should actually not be necessary.\n            //       This is kept for backwards compatibility but should be\n            //       re-checked and removed if possible.\n            this.$el.attr(\"multiple\", true);\n            const vals = this.$el.val() || [];\n            const options = [...this.el.querySelectorAll(\"option\")].map((it) => {\n                return { text: it.innerHTML, id: it.value };\n            });\n\n            const el = document.createElement(\"input\");\n            el.type = \"hidden\";\n            el.value = vals.join(this.options.separator);\n            el.className = this.el.getAttribute(\"class\");\n            el.name = this.el.name;\n            el.id = this.el.id;\n            this.el.after(el);\n            this.el.remove();\n            this.el = el;\n            this.$el = $(el);\n\n            this.options.data = options;\n        }\n        this.initializeValues();\n        this.initializeTags();\n        await this.initializeSelect2();\n        await this.initializeOrdering();\n    },\n});\n","/**\n * A Base pattern for creating scoped patterns.\n *\n * Each instance of a pattern has its own local scope.\n * A new instance is created for each DOM element on which a pattern applies.\n *\n * For usage, see basepattern.md\n */\nimport events from \"./events\";\nimport logging from \"./logging\";\nimport create_uuid from \"./uuid\";\n\nconst log = logging.getLogger(\"basepattern\");\n\nclass BasePattern {\n    static name; // name of pattern used in Registry.\n    static trigger; // A CSS selector to match elements that should trigger the pattern instantiation.\n    static parser; // Options parser.\n\n    // Parser options\n    parser_group_options = true;\n    parser_multiple = undefined;\n    parser_inherit = true;\n\n    constructor(el, options = {}) {\n        // Make static variables available on instance.\n        this.name = this.constructor.name;\n        this.trigger = this.constructor.trigger;\n        this.parser = this.constructor.parser;\n\n        if (!el) {\n            log.warn(`No element given to pattern ${this.name}.`);\n            return;\n        }\n        if (el.jquery) {\n            el = el[0];\n        }\n        this.el = el;\n        this.uuid = create_uuid();\n\n        // Notify pre-init\n        this.el.dispatchEvent(\n            new Event(`pre-init.${this.name}.patterns`, {\n                bubbles: true,\n                cancelable: true,\n            })\n        );\n\n        // Initialize asynchronously.\n        //\n        // 1) We need to call the concrete implementation of ``init``, but the\n        //    inheritance chain is not yet set up and ``init`` not available.\n        //\n        // 2) We want to wait for the init() to successfuly finish and fire an\n        //    event then.\n        //    But the constructer cannot not return a Promise, thus not be\n        //    asynchronous but only return itself.\n        //\n        // Both limitations are gone in next tick.\n        //\n        window.setTimeout(async () => {\n            if (typeof this.el[`pattern-${this.name}`] !== \"undefined\") {\n                // Do not reinstantiate\n                log.debug(`Not reinstatiating the pattern ${this.name}.`, this.el);\n\n                // Notify that not instantiated\n                this.el.dispatchEvent(\n                    new Event(`not-init.${this.name}.patterns`, {\n                        bubbles: true,\n                        cancelable: false,\n                    })\n                );\n                return;\n            }\n\n            // Create the options object by parsing the element and using the\n            // optional options as default.\n            this.options =\n                this.parser?.parse(\n                    this.el,\n                    options,\n                    this.parser_multiple,\n                    this.parser_inherit,\n                    this.parser_group_options\n                ) ?? options;\n\n            // Store pattern instance on element\n            this.el[`pattern-${this.name}`] = this;\n\n            // Initialize the pattern\n            await this.init();\n\n            // Notify that now ready\n            this.el.dispatchEvent(\n                new Event(`init.${this.name}.patterns`, {\n                    bubbles: true,\n                    cancelable: true,\n                })\n            );\n        }, 0);\n    }\n\n    async init() {\n        // Extend this method in your pattern.\n    }\n\n    emit_update(action = undefined, options = {}) {\n        options = {\n            pattern: this.name,\n            dom: this.el,\n            action: action,\n            ...options,\n        }\n        this.el.dispatchEvent(events.update_event(options));\n    }\n\n    /**\n     * Listen to an event on the element only once.\n     *\n     * @param {string} event_name - Name of the event to listen to.\n     * @param {function} callback - Callback to call when the event is thrown.\n     */\n    one(event_name, event_callback) {\n        events.add_event_listener(\n            this.el,\n            `${event_name}.${this.name}.patterns`,\n            `basepattern-one--${event_name}.${this.name}.patterns`,\n            event_callback,\n            {\n                once: true,\n            }\n        );\n    }\n\n    /**\n     * Destroy/remove/unload the pattern from the element.\n     */\n    destroy() {\n        delete this.el[`pattern-${this.name}`];\n    }\n}\n\nexport default BasePattern;\nexport { BasePattern };\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"datatables\",\n    trigger: \".pat-datatables\",\n    parser: \"mockup\",\n    table: null,\n\n    defaults: {\n        // Default values for attributes\n    },\n\n    async init() {\n        import(\"datatables.net-bs5/css/dataTables.bootstrap5.min.css\");\n        import(\"datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css\");\n        import(\"datatables.net-colreorder-bs5/css/colReorder.bootstrap5.min.css\");\n        import(\"datatables.net-fixedcolumns-bs5/css/fixedColumns.bootstrap5.min.css\"); // prettier-ignore\n        import(\"datatables.net-fixedheader-bs5/css/fixedHeader.bootstrap5.min.css\"); // prettier-ignore\n        import(\"datatables.net-rowreorder-bs5/css/rowReorder.bootstrap5.min.css\");\n        import(\"datatables.net-select-bs5/css/select.bootstrap5.min.css\");\n\n        await import(\"datatables.net\");\n        await import(\"datatables.net-bs5\");\n        await import(\"datatables.net-buttons\");\n        await import(\"datatables.net-buttons-bs5\");\n        await import(\"datatables.net-buttons/js/buttons.colVis\");\n        await import(\"datatables.net-buttons/js/buttons.html5\");\n        await import(\"datatables.net-buttons/js/buttons.print\");\n        await import(\"datatables.net-colreorder\");\n        await import(\"datatables.net-colreorder-bs5\");\n        await import(\"datatables.net-fixedcolumns\");\n        await import(\"datatables.net-fixedcolumns-bs5\");\n        await import(\"datatables.net-fixedheader\");\n        await import(\"datatables.net-fixedheader-bs5\");\n        await import(\"datatables.net-rowreorder\");\n        await import(\"datatables.net-rowreorder-bs5\");\n        await import(\"datatables.net-select\");\n        await import(\"datatables.net-select-bs5\");\n\n        $(this.el).DataTable(this.options);\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _ from \"underscore\";\nimport Backdrop from \"../backdrop/backdrop\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\nimport utils from \"../../core/utils\";\nimport _t from \"../../core/i18n-wrapper\";\n\nimport \"jquery-form\";\n\nexport default Base.extend({\n    name: \"plone-modal\",\n    trigger: \".pat-plone-modal\",\n    parser: \"mockup\",\n    createModal: null,\n    $model: null,\n    defaults: {\n        width: \"\",\n        height: \"\",\n        modalSizeClass: \"\",\n        margin: 0,\n        position: \"center middle\", // format: '<horizontal> <vertical>' -- allowed values: top, bottom, left, right, center, middle\n        triggers: [],\n        zIndexSelector: \".modal-wrapper,.modal-backdrop\",\n        backdrop: \"body\", // Element to initiate the Backdrop on.\n        backdropOptions: {\n            zIndex: \"1040\",\n            opacity: \"0.85\",\n            className: \"modal-backdrop\",\n            classActiveName: \"backdrop-active\",\n            closeOnEsc: true,\n            closeOnClick: true,\n        },\n        title: null,\n        titleSelector: \"h1:first\",\n        buttons: '.formControls > input[type=\"submit\"], .formControls > button',\n        content: \"#content\",\n        automaticallyAddButtonActions: true,\n        loadLinksWithinModal: true,\n        prependContent: \".portalMessage\",\n        onRender: null,\n        templateOptions: {\n            className: \"modal fade\",\n            classDialog: \"modal-dialog\",\n            classModal: \"modal-content\",\n            classHeaderName: \"modal-header\",\n            classBodyName: \"modal-body\",\n            classFooterName: \"modal-footer\",\n            classWrapperName: \"modal-wrapper\",\n            classWrapperInnerName: \"modal-wrapper-inner\",\n            classActiveName: \"show\",\n            classPrependName: \"\", // String, css class to be applied to the wrapper of the prepended content\n            classContentName: \"\", // String, class name to be applied to the content of the modal, useful for modal specific styling\n            template:\n                \"\" +\n                '<div class=\"<%= options.className %>\">' +\n                '  <div class=\"<%= options.classDialog %><% if (modalSizeClass) { %> <%= modalSizeClass %><% } %>\" role=\"dialog\" <% if (title) { %>aria-labelledby=\"modal-title\" <% } %> tabindex=\"-1\">' +\n                '    <div class=\"<%= options.classModal %>\" role=\"document\">' +\n                '      <div class=\"<%= options.classHeaderName %>\">' +\n                '        <% if (title) { %><h5 class=\"modal-title\" id=\"modal-title\" tabindex=\"0\"><%= title %></h5><% } %>' +\n                '        <button type=\"button\" class=\"btn-close modal-close\" aria-label=\"<%= closeButtonLabel %>\"></button>' +\n                \"      </div>\" +\n                '      <div class=\"<%= options.classBodyName %>\">' +\n                '        <div class=\"<%= options.classPrependName %>\"><%= prepend %></div> ' +\n                '        <div class=\"<%= options.classContentName %>\"><%= content %></div>' +\n                \"      </div>\" +\n                '      <div class=\"<%= options.classFooterName %>\"> ' +\n                \"        <% if (buttons) { %><%= buttons %><% } %>\" +\n                \"      </div>\" +\n                \"    </div>\" +\n                \"  </div>\" +\n                \"</div>\",\n        },\n        actions: {},\n        actionOptions: {\n            eventType: \"click\",\n            disableAjaxFormSubmit: false,\n            target: null,\n            ajaxUrl: null, // string, or function($el, options) that returns a string\n            modalFunction: null, // String, function name on self to call\n            isForm: false,\n            timeout: 5000,\n            displayInModal: true,\n            reloadWindowOnClose: true,\n            error: \".portalMessage.error, .alert-danger\",\n            formFieldError: \".field.error\",\n            onSuccess: null,\n            onError: null,\n            onFormError: null,\n            onTimeout: null,\n            redirectOnResponse: false,\n            redirectToUrl: function ($action, response) {\n                var reg;\n                reg = /<body.*data-view-url=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // view url as data attribute on body (Plone 5)\n                    return reg[1].split('\"')[0];\n                }\n                reg = /<body.*data-base-url=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // Base url as data attribute on body (Plone 5)\n                    return reg[1].split('\"')[0];\n                }\n                reg = /<base.*href=[\\\"'](.*)[\\\"'].*/im.exec(response);\n                if (reg && reg.length > 1) {\n                    // base tag available (Plone 4)\n                    return reg[1];\n                }\n                return \"\";\n            },\n        },\n        form: function (actions) {\n            var self = this;\n            var $modal = self.$modal;\n\n            if (self.options.automaticallyAddButtonActions) {\n                actions[self.options.buttons] = {};\n            }\n            actions.a = {};\n\n            $.each(actions, function (action, options) {\n                var actionKeys = _.union(_.keys(self.options.actionOptions), [\n                    \"templateOptions\",\n                ]);\n                var actionOptions = $.extend(\n                    true,\n                    {},\n                    self.options.actionOptions,\n                    _.pick(options, actionKeys)\n                );\n                options.templateOptions = $.extend(\n                    true,\n                    options.templateOptions,\n                    self.options.templateOptions\n                );\n\n                var patternKeys = _.union(_.keys(self.options.actionOptions), [\n                    \"actions\",\n                    \"actionOptions\",\n                ]);\n                var patternOptions = $.extend(\n                    true,\n                    _.omit(options, patternKeys),\n                    self.options\n                );\n                $(action, $(\".\" + options.templateOptions.classBodyName, $modal)).each(\n                    function () {\n                        var $action = $(this);\n                        $action.on(actionOptions.eventType, function (e) {\n                            e.stopPropagation();\n                            e.preventDefault();\n\n                            self.loading.show(false);\n\n                            // handle event on $action using a function on self\n                            if (actionOptions.modalFunction !== null) {\n                                self[actionOptions.modalFunction]();\n                                // handle event on input/button using jquery.form library\n                            } else if (\n                                $.nodeName($action[0], \"input\") ||\n                                $.nodeName($action[0], \"button\") ||\n                                options.isForm === true\n                            ) {\n                                self.options.handleFormAction.apply(self, [\n                                    $action,\n                                    actionOptions,\n                                    patternOptions,\n                                ]);\n                                // handle event on link with jQuery.ajax\n                            } else if (\n                                options.ajaxUrl !== null ||\n                                $.nodeName($action[0], \"a\")\n                            ) {\n                                self.options.handleLinkAction.apply(self, [\n                                    $action,\n                                    actionOptions,\n                                    patternOptions,\n                                ]);\n                            }\n                        });\n                    }\n                );\n            });\n        },\n        handleFormAction: function ($action, options, patternOptions) {\n            var self = this;\n\n            // pass action that was clicked when submiting form\n            var extraData = {};\n            extraData[$action.attr(\"name\")] = $action.attr(\"value\");\n\n            var $form;\n\n            if ($.nodeName($action[0], \"form\")) {\n                $form = $action;\n            } else {\n                $form = $action.parents(\"form:not(.disableAutoSubmit)\");\n            }\n\n            var url;\n            if (options.ajaxUrl !== null) {\n                if (typeof options.ajaxUrl === \"function\") {\n                    url = options.ajaxUrl.apply(self, [$action, options]);\n                } else {\n                    url = options.ajaxUrl;\n                }\n            } else {\n                url = $action.parents(\"form\").attr(\"action\");\n            }\n\n            if (options.disableAjaxFormSubmit) {\n                if ($action.attr(\"name\") && $action.attr(\"value\")) {\n                    $form.append(\n                        $(\n                            '<input type=\"hidden\" name=\"' +\n                            $action.attr(\"name\") +\n                            '\" value=\"' +\n                            $action.attr(\"value\") +\n                            '\" />'\n                        )\n                    );\n                }\n                $form.trigger(\"submit\");\n                return;\n            }\n            // We want to trigger the form submit event but NOT use the default\n            $form.on(\"submit\", function (e) {\n                e.preventDefault();\n            });\n            $form.trigger(\"submit\");\n\n            self.loading.show(false);\n            $form.ajaxSubmit({\n                timeout: options.timeout,\n                data: extraData,\n                url: url,\n                error: function (xhr, textStatus, errorStatus) {\n                    self.loading.hide();\n                    if (textStatus === \"timeout\" && options.onTimeout) {\n                        options.onTimeout.apply(self, xhr, errorStatus);\n                        // on \"error\", \"abort\", and \"parsererror\"\n                    } else if (options.onError) {\n                        if (typeof options.onError === \"string\") {\n                            window[options.onError](xhr, textStatus, errorStatus);\n                        } else {\n                            options.onError(xhr, textStatus, errorStatus);\n                        }\n                    } else {\n                        // window.alert(_t('There was an error submitting the form.'));\n                        console.log(\"error happened\", textStatus, \" do something\");\n                    }\n                    self.emit(\"formActionError\", [xhr, textStatus, errorStatus]);\n                },\n                success: function (response, state, xhr, form) {\n                    self.loading.hide();\n                    // if error is found (NOTE: check for both the portal errors\n                    // and the form field-level errors)\n                    if (\n                        $(options.error, response).length !== 0 ||\n                        $(options.formFieldError, response).length !== 0\n                    ) {\n                        if (options.onFormError) {\n                            if (typeof options.onFormError === \"string\") {\n                                window[options.onFormError](\n                                    self,\n                                    response,\n                                    state,\n                                    xhr,\n                                    form\n                                );\n                            } else {\n                                options.onFormError(self, response, state, xhr, form);\n                            }\n                        } else {\n                            self.redraw(response, patternOptions);\n                        }\n                        return;\n                    }\n\n                    if (options.redirectOnResponse === true) {\n                        if (typeof options.redirectToUrl === \"function\") {\n                            window.parent.location.href = options.redirectToUrl.apply(\n                                self,\n                                [$action, response, options]\n                            );\n                        } else {\n                            window.parent.location.href = options.redirectToUrl;\n                        }\n                        return; // cut out right here since we're changing url\n                    }\n\n                    if (options.onSuccess) {\n                        if (typeof options.onSuccess === \"string\") {\n                            window[options.onSuccess](self, response, state, xhr, form);\n                        } else {\n                            options.onSuccess(self, response, state, xhr, form);\n                        }\n                    }\n\n                    if (options.displayInModal === true) {\n                        self.redraw(response, patternOptions);\n                    } else {\n                        $action.trigger(\"destroy.plone-modal.patterns\");\n                        // also calls hide\n                        if (options.reloadWindowOnClose) {\n                            self.reloadWindow();\n                        }\n                    }\n                    self.emit(\"formActionSuccess\", [response, state, xhr, form]);\n                },\n            });\n        },\n        handleLinkAction: function ($action, options, patternOptions) {\n            var self = this;\n            var url;\n            if ($action.hasClass(\"pat-plone-modal\")) {\n                // if link is a modal pattern, do not reload the page\n                return;\n            }\n\n            // Figure out URL\n            if (options.ajaxUrl) {\n                if (typeof options.ajaxUrl === \"function\") {\n                    url = options.ajaxUrl.apply(self, [$action, options]);\n                } else {\n                    url = options.ajaxUrl;\n                }\n            } else {\n                url = $action.attr(\"href\");\n            }\n\n            // Non-ajax link (I know it says \"ajaxUrl\" ...)\n            if (options.displayInModal === false) {\n                if ($action.attr(\"target\") === \"_blank\") {\n                    window.open(url, \"_blank\");\n                    self.loading.hide();\n                } else {\n                    window.location = url;\n                }\n                return;\n            }\n\n            // ajax version\n            $.ajax({\n                url: url,\n            })\n                .fail(function (xhr, textStatus, errorStatus) {\n                    if (textStatus === \"timeout\" && options.onTimeout) {\n                        options.onTimeout(self.$modal, xhr, errorStatus);\n\n                        // on \"error\", \"abort\", and \"parsererror\"\n                    } else if (options.onError) {\n                        options.onError(xhr, textStatus, errorStatus);\n                    } else {\n                        window.alert(_t(\"There was an error loading modal.\"));\n                    }\n                    self.emit(\"linkActionError\", [xhr, textStatus, errorStatus]);\n                })\n                .done(function (response, state, xhr) {\n                    self.redraw(response, patternOptions);\n                    if (options.onSuccess) {\n                        if (typeof options.onSuccess === \"string\") {\n                            window[options.onSuccess](self, response, state, xhr);\n                        } else {\n                            options.onSuccess(self, response, state, xhr);\n                        }\n                    }\n\n                    self.emit(\"linkActionSuccess\", [response, state, xhr]);\n                })\n                .always(function () {\n                    self.loading.hide();\n                });\n        },\n        render: function (options) {\n            var self = this;\n\n            self.emit(\"before-render\");\n\n            if (!self.$raw) {\n                return;\n            }\n            var $raw = self.$raw.clone();\n\n            // Object that will be passed to the template\n            var tplObject = {\n                title: \"\",\n                prepend: \"<div />\",\n                content: \"\",\n                modalSizeClass: options.modalSizeClass,\n                buttons: '<div class=\"pattern-modal-buttons\"></div>',\n                options: options.templateOptions,\n                closeButtonLabel: _t(\"Close\"),\n            };\n\n            // setup the Title\n            if (options.title === null) {\n                var $title = $(options.titleSelector, $raw);\n                tplObject.title = $title.html();\n                $(options.titleSelector, $raw).remove();\n            } else {\n                tplObject.title = options.title;\n            }\n\n            // Grab items to to insert into the prepend area\n            if (options.prependContent) {\n                tplObject.prepend = $(\"<div />\")\n                    .append($(options.prependContent, $raw).clone())\n                    .html();\n                $(options.prependContent, $raw).remove();\n            }\n\n            // Filter out the content if there is a selector provided\n            if (options.content) {\n                tplObject.content = $(options.content, $raw).html();\n            } else {\n                tplObject.content = $raw.html();\n            }\n\n            // Render html\n            self.$modal = $(\n                _.template(self.options.templateOptions.template)(tplObject)\n            );\n            self.$modalDialog = $(\n                \"> .\" + self.options.templateOptions.classDialog,\n                self.$modal\n            );\n            self.$modalContent = $(\n                \"> .\" + self.options.templateOptions.classModal,\n                self.$modalDialog\n            );\n\n            // In most browsers, when you hit the enter key while a form element is focused\n            // the browser will trigger the form 'submit' event.  Google Chrome also does this,\n            // but not when when the default submit button is hidden with 'display: none'.\n            // The following code will work around this issue:\n            $(\"form\", self.$modal).on(\"keydown\", function (event) {\n                // ignore keys which are not enter, and ignore enter inside a textarea.\n                if (event.key !== \"Enter\" || event.target.nodeName === \"TEXTAREA\") {\n                    return;\n                }\n                event.preventDefault();\n                $(\"input[type=submit], button[type=submit], button:not(type)\", this)\n                    .eq(0)\n                    .trigger(\"click\");\n            });\n\n            // Setup buttons\n            $(options.buttons, self.$modal).each(function () {\n                var $button = $(this);\n                $button\n                    .on(\"click\", function (e) {\n                        e.stopPropagation();\n                        e.preventDefault();\n                    })\n                    .clone()\n                    .appendTo($(\".pattern-modal-buttons\", self.$modal))\n                    .off(\"click\")\n                    .on(\"click\", function (e) {\n                        e.stopPropagation();\n                        e.preventDefault();\n                        $button.trigger(\"click\");\n                    });\n                $button.hide();\n            });\n\n            self.emit(\"before-events-setup\");\n\n            // Wire up events\n            self.$modal[0]\n                .querySelectorAll(\n                    `.modal-header > .modal-close,\n                 .modal-footer > .pattern-modal-buttons > .modal-close,\n                 .modal-footer [name=\"form.buttons.Cancel\" i]`\n                )\n                .forEach((el) => {\n                    $(el)\n                        .off(\"click\")\n                        .on(\"click\", (e) => {\n                            e.stopPropagation();\n                            e.preventDefault();\n                            $(e.target).trigger(\"destroy.plone-modal.patterns\");\n                        });\n                });\n\n            // form\n            if (options.form) {\n                options.form.apply(self, [options.actions]);\n            }\n\n            self.$modal\n                .addClass(self.options.templateOptions.className)\n                .on(\"destroy.plone-modal.patterns\", function (e) {\n                    e.stopPropagation();\n                    self.hide();\n                })\n                .on(\"resize.plone-modal.patterns\", function (e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    self.positionModal();\n                })\n                .appendTo(self.$wrapperInner);\n\n            if (self.options.loadLinksWithinModal) {\n                self.$modal.on(\"click\", function (e) {\n                    e.stopPropagation();\n                    if ($.nodeName(e.target, \"a\")) {\n                        e.preventDefault();\n                        // TODO: open links inside modal\n                        // and slide modal body\n                    }\n                    self.$modal.trigger(\"modal-click\");\n                });\n            }\n            self.$modal.data(\"pattern-\" + self.name, self);\n            self.emit(\"after-render\");\n            if (options.onRender) {\n                if (typeof options.onRender === \"string\") {\n                    window[options.onRender](self);\n                } else {\n                    options.onRender(self);\n                }\n            }\n        },\n    },\n    reloadWindow: function () {\n        window.parent.location.reload();\n    },\n    init: function () {\n        import(\"./modal.scss\");\n\n        var self = this;\n        self.options.loadLinksWithinModal = $.parseJSON(\n            self.options.loadLinksWithinModal\n        );\n\n        if (self.options.backdropOptions.closeOnEsc === true) {\n            $(document).on(\"keydown\", function (e) {\n                if (self.$el.is(\".\" + self.options.templateOptions.classActiveName)) {\n                    if (e.key === \"Esc\") {\n                        // ESC key pressed\n                        self.hide();\n                    }\n                }\n            });\n        }\n\n        $(window.parent).resize(function () {\n            self.positionModal();\n        });\n\n        if (self.options.triggers) {\n            $.each(self.options.triggers, function (i, item) {\n                var e = item.substring(0, item.indexOf(\" \"));\n                var selector = item.substring(item.indexOf(\" \"), item.length);\n                $(selector || self.$el).on(e, function (e) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    self.show();\n                });\n            });\n        }\n\n        if (self.$el.is(\"a\")) {\n            if (self.$el.attr(\"href\") && !self.options.image) {\n                if (\n                    !self.options.target &&\n                    self.$el.attr(\"href\").substr(0, 1) === \"#\" &&\n                    self.$el.attr(\"href\").length > 1\n                ) {\n                    self.options.target = self.$el.attr(\"href\");\n                    self.options.content = \"\";\n                }\n                if (\n                    !self.options.ajaxUrl &&\n                    self.$el.attr(\"href\").substr(0, 1) !== \"#\"\n                ) {\n                    self.options.ajaxUrl = function () {\n                        // Resolve ``href`` attribute later, when modal is shown.\n                        return self.$el.attr(\"href\");\n                    };\n                }\n            }\n            self.$el.on(\"click\", function (e) {\n                e.stopPropagation();\n                e.preventDefault();\n                self.show();\n            });\n        }\n        self.initModal();\n    },\n\n    createAjaxModal: function () {\n        var self = this;\n        self.emit(\"before-ajax\");\n        self.loading.show();\n\n        var ajaxUrl = self.options.ajaxUrl;\n        if (typeof ajaxUrl === \"function\") {\n            ajaxUrl = ajaxUrl.apply(self, [self.options]);\n        }\n\n        self.ajaxXHR = $.ajax({\n            url: ajaxUrl,\n            type: self.options.ajaxType,\n        })\n            .done(function (response, textStatus, xhr) {\n                self.ajaxXHR = undefined;\n                self.$raw = $(\"<div />\").append($(utils.parseBodyTag(response)));\n                self.emit(\"after-ajax\", self, textStatus, xhr);\n                self._show();\n            })\n            .fail(function (xhr, textStatus, errorStatus) {\n                var options = self.options.actionOptions;\n                if (textStatus === \"timeout\" && options.onTimeout) {\n                    options.onTimeout(self.$modal, xhr, errorStatus);\n                } else if (options.onError) {\n                    options.onError(xhr, textStatus, errorStatus);\n                } else {\n                    window.alert(_t(\"There was an error loading modal.\"));\n                    self.hide();\n                }\n                self.emit(\"linkActionError\", [xhr, textStatus, errorStatus]);\n            })\n            .always(function () {\n                self.loading.hide();\n            });\n    },\n\n    createTargetModal: function () {\n        var self = this;\n        self.$raw = $(self.options.target).clone();\n        self._show();\n    },\n\n    createBasicModal: function () {\n        var self = this;\n        self.$raw = $(\"<div/>\").html(self.$el.clone());\n        self._show();\n    },\n\n    createHtmlModal: function () {\n        var self = this;\n        var $el = $(self.options.html);\n        self.$raw = $el;\n        self._show();\n    },\n\n    createImageModal: function () {\n        var self = this;\n        self.$wrapper.addClass(\"image-modal\");\n        var src = self.$el.attr(\"href\");\n        var srcset = self.$el.attr(\"data-modal-srcset\") || \"\";\n        var title = $.trim(self.$el.context.innerText) || \"Image\";\n        // XXX aria?\n        self.$raw = $(\n            \"<div><h1>\" +\n            title +\n            '</h1><div id=\"content\"><div class=\"modal-image\"><img src=\"' +\n            src +\n            '\" srcset=\"' +\n            srcset +\n            '\" /></div></div></div>'\n        );\n        self._show();\n    },\n\n    initModal: function () {\n        var self = this;\n        if (self.options.ajaxUrl) {\n            self.createModal = self.createAjaxModal;\n        } else if (self.options.target) {\n            self.createModal = self.createTargetModal;\n        } else if (self.options.html) {\n            self.createModal = self.createHtmlModal;\n        } else if (self.options.image) {\n            self.createModal = self.createImageModal;\n        } else {\n            self.createModal = self.createBasicModal;\n        }\n    },\n\n    findPosition: function (\n        horpos,\n        vertpos,\n        margin,\n        modalWidth,\n        modalHeight,\n        wrapperInnerWidth,\n        wrapperInnerHeight\n    ) {\n        var returnpos = {};\n        var absTop, absBottom, absLeft, absRight;\n        absRight = absLeft = absTop = absLeft = \"auto\";\n\n        // -- HORIZONTAL POSITION -----------------------------------------------\n        if (horpos === \"left\") {\n            absLeft = margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the left to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absLeft = \"0px\";\n            }\n            returnpos.left = absLeft;\n        } else if (horpos === \"right\") {\n            absRight = margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the right to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absRight = \"0px\";\n            }\n            returnpos.right = absRight;\n            returnpos.left = \"auto\";\n        }\n        // default, no specified location, is to center\n        else {\n            absLeft = wrapperInnerWidth / 2 - modalWidth / 2 - margin + \"px\";\n            // if the width of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the left to simply be 0\n            if (modalWidth > wrapperInnerWidth) {\n                absLeft = \"0px\";\n            }\n            returnpos.left = absLeft;\n        }\n\n        // -- VERTICAL POSITION -------------------------------------------------\n        if (vertpos === \"top\") {\n            absTop = margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the top to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absTop = \"0px\";\n            }\n            returnpos.top = absTop;\n        } else if (vertpos === \"bottom\") {\n            absBottom = margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the bottom to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absBottom = \"0px\";\n            }\n            returnpos.bottom = absBottom;\n            returnpos.top = \"auto\";\n        } else {\n            // default case, no specified location, is to center\n            absTop = wrapperInnerHeight / 2 - modalHeight / 2 - margin + \"px\";\n            // if the height of the wrapper is smaller than the modal, and thus the\n            // screen is smaller than the modal, force the top to simply be 0\n            if (modalHeight > wrapperInnerHeight) {\n                absTop = \"0px\";\n            }\n            returnpos.top = absTop;\n        }\n        return returnpos;\n    },\n\n    modalInitialized: function () {\n        var self = this;\n        return self.$modal !== null && self.$modal !== undefined;\n    },\n\n    activateFocusTrap: function () {\n        var self = this;\n        const modal_el = self.$modal[0];\n        var inputsBody = modal_el\n            .querySelector(`.${self.options.templateOptions.classBodyName}`)\n            .querySelectorAll(`select, input:not([type=\"hidden\"]), textarea, button, a`);\n        var inputsFooter = modal_el\n            .querySelector(`.${self.options.templateOptions.classFooterName}`)\n            .querySelectorAll(`select, input:not([type=\"hidden\"]), textarea, button, a`);\n        var inputs = [];\n\n        for (const el of [...inputsBody, ...inputsFooter]) {\n            if (dom.is_visible(el)) {\n                inputs.push(el);\n            }\n        }\n\n        if (inputs.length === 0) {\n            inputs = modal_el.querySelectorAll(\".modal-title\");\n        }\n        var firstInput = inputs.length !== 0 ? inputs[0] : null;\n        var lastInput = inputs.length !== 0 ? inputs[inputs.length - 1] : null;\n        var closeInput = modal_el.querySelector(\".modal-close\");\n\n        modal_el.addEventListener(\n            \"keydown\",\n            (e) => {\n                if (e.key === \"Tab\") {\n                    e.preventDefault();\n\n                    var target = e.target;\n                    var currentIndex = inputs.indexOf(target);\n                    if (currentIndex >= 0 && currentIndex < inputs.length) {\n                        var nextIndex = currentIndex + (e.shiftKey ? -1 : 1);\n                        if (nextIndex < 0 || nextIndex >= inputs.length) {\n                            closeInput.focus();\n                        } else {\n                            inputs[nextIndex].focus();\n                        }\n                    } else if (e.shiftKey && lastInput) {\n                        lastInput.focus();\n                    } else if (firstInput) {\n                        firstInput.focus();\n                    }\n                }\n            }\n        );\n        if (self.options.backdropOptions.closeOnClick === true) {\n            modal_el.addEventListener(\"click\", (e) => {\n                if (!e.target.closest(`.${self.options.templateOptions.classModal}`)) {\n                    self.hide();\n                }\n            });\n        }\n\n        if (firstInput && [\"INPUT\", \"SELECT\", \"TEXTAREA\"].includes(firstInput.nodeName)) {\n            // autofocus first element when opening a modal with a form\n            firstInput.focus();\n        }\n    },\n\n    positionModal: function () {\n        /* re-position modal at any point.\n         *\n         * Uses:\n         *  options.margin\n         *  options.width\n         *  options.height\n         *  options.position\n         */\n        var self = this;\n        // modal isn't initialized\n        if (!self.modalInitialized()) {\n            return;\n        }\n        // clear out any previously set styling\n        self.$modal.removeAttr(\"style\");\n\n        // if backdrop wrapper is set on body, then wrapper should have height of\n        // the window, so we can do scrolling of inner wrapper\n        if (self.$wrapper.parent().is(\"body\")) {\n            self.$wrapper.height($(window.parent).height());\n        }\n\n        var margin =\n            typeof self.options.margin === \"function\"\n                ? self.options.margin()\n                : self.options.margin;\n        let modalCss = {\n            position: \"absolute\",\n        };\n        if (margin !== \"0\") {\n            modalCss[\"padding\"] = margin;\n        }\n        self.$modal.css(modalCss);\n        self.$modalDialog.css({\n            // margin: \"0\",\n            // padding: \"0\",\n            width: self.options.width, // defaults to \"\", which doesn't override other css\n            height: self.options.height, // defaults to \"\", which doesn't override other css\n        });\n        self.$modalContent.css({\n            width: self.options.width, // defaults to \"\", which doesn't override other css\n        });\n\n        var posopt = self.options.position.split(\" \"),\n            horpos = posopt[0],\n            vertpos = posopt[1];\n        var modalWidth = self.$modalDialog.outerWidth(true);\n        var modalHeight = self.$modalDialog.outerHeight(true);\n        var wrapperInnerWidth = self.$wrapperInner.width();\n        var wrapperInnerHeight = self.$wrapperInner.height();\n        var pos = self.findPosition(\n            horpos,\n            vertpos,\n            margin,\n            modalWidth,\n            modalHeight,\n            wrapperInnerWidth,\n            wrapperInnerHeight\n        );\n        for (var key in pos) {\n            self.$modalDialog.css(key, pos[key]);\n        }\n    },\n\n    render: function (options) {\n        var self = this;\n        self.emit(\"render\");\n        self.options.render.apply(self, [options]);\n        self.emit(\"rendered\");\n    },\n\n    show: function () {\n        var self = this;\n        self.backdrop = self.createBackdrop();\n        self.createModal();\n    },\n\n    createBackdrop: function () {\n        var self = this,\n            backdrop = new Backdrop(\n                self.$el.parents(self.options.backdrop),\n                self.options.backdropOptions\n            ),\n            zIndex = self.options.backdropOptions.zIndex || 1041;\n\n        $(self.options.zIndexSelector).each(function () {\n            zIndex = Math.max(zIndex, parseInt($(this).css(\"zIndex\")) + 1 || 1041);\n        });\n\n        self.$wrapper = $(\"<div/>\")\n            .hide()\n            .css({\n                \"z-index\": zIndex,\n                \"overflow-y\": \"auto\",\n                \"position\": \"fixed\",\n                \"height\": \"100%\",\n                \"width\": \"100%\",\n                \"bottom\": \"0\",\n                \"left\": \"0\",\n                \"right\": \"0\",\n                \"top\": \"0\",\n            })\n            .addClass(self.options.templateOptions.classWrapperName)\n            .insertBefore(backdrop.$backdrop)\n            .on(\"click\", function (e) {\n                if (self.options.backdropOptions.closeOnClick) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    backdrop.hide();\n                }\n            });\n        backdrop.on(\"hidden\", function () {\n            if (\n                self.$modal !== undefined &&\n                self.$modal.hasClass(self.options.templateOptions.classActiveName)\n            ) {\n                self.hide();\n            }\n        });\n        self.loading = new utils.Loading({\n            backdrop: backdrop,\n        });\n        self.$wrapperInner = $(\"<div/>\")\n            .addClass(self.options.classWrapperInnerName)\n            .css({\n                position: \"absolute\",\n                bottom: \"0\",\n                left: \"0\",\n                right: \"0\",\n                top: \"0\",\n            })\n            .appendTo(self.$wrapper);\n        return backdrop;\n    },\n\n    _show: function () {\n        var self = this;\n        self.render.apply(self, [self.options]);\n        self.emit(\"show\");\n        self.backdrop.show();\n        self.$wrapper.show();\n        self.loading.hide();\n        self.$el.addClass(self.options.templateOptions.classActiveName);\n        self.$modal.addClass(self.options.templateOptions.classActiveName);\n        registry.scan(self.$modal);\n        self.positionModal();\n        $(window.parent).on(\"resize.plone-modal.patterns\", function () {\n            self.positionModal();\n        });\n        $(\"body\").addClass(\"modal-open\");\n        self.emit(\"shown\");\n        self.activateFocusTrap();\n    },\n    hide: function () {\n        var self = this;\n        if (self.ajaxXHR) {\n            self.ajaxXHR.abort();\n        }\n        self.emit(\"hide\");\n        if (self._suppressHide) {\n            if (!window.confirm(self._suppressHide)) {\n                return;\n            }\n        }\n        self.loading.hide();\n        self.$el.removeClass(self.options.templateOptions.classActiveName);\n        if (self.$modal !== undefined) {\n            self.$modal.remove();\n            self.initModal();\n        }\n        self.$wrapper.remove();\n        if ($(\".modal\", $(\"body\")).length < 1) {\n            self._suppressHide = undefined;\n            self.backdrop.hide();\n            $(\"body\").removeClass(\"modal-open\");\n            $(window.parent).off(\"resize.plone-modal.patterns\");\n        }\n        self.emit(\"hidden\");\n        self.$el.focus();\n    },\n\n    redraw: function (response, options) {\n        var self = this;\n        self.emit(\"beforeDraw\");\n        self.$modal.remove();\n        self.$raw = $(\"<div />\").append($(utils.parseBodyTag(response)));\n        self.render.apply(self, [options || self.options]);\n        self.$modal.addClass(self.options.templateOptions.classActiveName);\n        self.positionModal();\n        registry.scan(self.$modal);\n        self.emit(\"afterDraw\");\n        self.activateFocusTrap();\n    },\n});\n","import $ from \"jquery\";\nimport logging from \"@patternslib/patternslib/src/core/logging\";\n\nconst logger = logging.getLogger(\"core utils\");\n\nvar QueryHelper = function (options) {\n    /* if pattern argument provided, it can implement the interface of:\n     *    - browsing: boolean if currently browsing\n     *    - currentPath: string of current path to apply to search if browsing\n     *    - basePath: default path to provide if no subpath used\n     */\n\n    var self = this;\n    var defaults = {\n        pattern: null, // must be passed in\n        vocabularyUrl: null,\n        searchParam: \"SearchableText\", // query string param to pass to search url\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        attributes: [\"UID\", \"Title\", \"Description\", \"getURL\", \"portal_type\"],\n        batchSize: 10, // number of results to retrive\n        baseCriteria: [],\n        sort_on: \"is_folderish\",\n        sort_order: \"reverse\",\n        pathDepth: 1,\n    };\n    self.options = $.extend({}, defaults, options);\n\n    self.pattern = self.options.pattern;\n    if (self.pattern === undefined || self.pattern === null) {\n        self.pattern = {\n            browsing: false,\n            basePath: \"/\",\n        };\n    }\n\n    if (self.options.url && !self.options.vocabularyUrl) {\n        self.options.vocabularyUrl = self.options.url;\n    } else if (self.pattern.vocabularyUrl) {\n        self.options.vocabularyUrl = self.pattern.vocabularyUrl;\n    }\n    self.valid = Boolean(self.options.vocabularyUrl);\n\n    self.getBatch = function (page) {\n        return {\n            page: page ? page : 1,\n            size: self.options.batchSize,\n        };\n    };\n\n    self.getCurrentPath = function () {\n        var pattern = self.pattern;\n        var currentPath;\n        /* If currentPath is set on the QueryHelper object, use that first.\n         * Then, check on the pattern.\n         * Finally, see if it is a function and call it if it is.\n         */\n        if (self.currentPath) {\n            currentPath = self.currentPath;\n        } else {\n            currentPath = pattern.currentPath;\n        }\n        if (typeof currentPath === \"function\") {\n            currentPath = currentPath();\n        }\n        var path = currentPath;\n        if (!path) {\n            if (pattern.basePath) {\n                path = pattern.basePath;\n            } else if (pattern.options.basePath) {\n                path = pattern.options.basePath;\n            } else {\n                path = \"/\";\n            }\n        }\n        return path;\n    };\n\n    self.getCriterias = function (term, searchOptions) {\n        if (searchOptions === undefined) {\n            searchOptions = {};\n        }\n        searchOptions = $.extend(\n            {},\n            {\n                useBaseCriteria: true,\n                additionalCriterias: [],\n            },\n            searchOptions\n        );\n\n        var criterias = [];\n        if (searchOptions.useBaseCriteria) {\n            criterias = self.options.baseCriteria.slice(0);\n        }\n        if (term) {\n            term += \"*\";\n            criterias.push({\n                i: self.options.searchParam,\n                o: \"plone.app.querystring.operation.string.contains\",\n                v: term,\n            });\n        }\n        if (searchOptions.searchPath) {\n            criterias.push({\n                i: \"path\",\n                o: self.options.pathOperator,\n                v: searchOptions.searchPath + \"::\" + self.options.pathDepth,\n            });\n        } else if (self.pattern.browsing) {\n            criterias.push({\n                i: \"path\",\n                o: self.options.pathOperator,\n                v: self.getCurrentPath() + \"::\" + self.options.pathDepth,\n            });\n        }\n        criterias = criterias.concat(searchOptions.additionalCriterias);\n        return criterias;\n    };\n\n    self.getQueryData = function (term, page) {\n        var data = {\n            query: JSON.stringify({\n                criteria: self.getCriterias(term),\n                sort_on: self.options.sort_on,\n                sort_order: self.options.sort_order,\n            }),\n            attributes: JSON.stringify(self.options.attributes),\n        };\n        if (page) {\n            data.batch = JSON.stringify(self.getBatch(page));\n        }\n        return data;\n    };\n\n    self.getUrl = function () {\n        var url = self.options.vocabularyUrl;\n        if (url.indexOf(\"?\") === -1) {\n            url += \"?\";\n        } else {\n            url += \"&\";\n        }\n        return url + $.param(self.getQueryData());\n    };\n\n    self.selectAjax = function () {\n        return {\n            url: self.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: 100,\n            data: function (term, page) {\n                return self.getQueryData(term, page);\n            },\n            results: function (data, page) {\n                var more = page * 10 < data.total; // whether or not there are more results available\n                // notice we return the value of more so Select2 knows if more results can be loaded\n                return {\n                    results: data.results,\n                    more: more,\n                };\n            },\n        };\n    };\n\n    self.search = function (term, operation, value, callback, useBaseCriteria, type) {\n        if (useBaseCriteria === undefined) {\n            useBaseCriteria = true;\n        }\n        if (type === undefined) {\n            type = \"GET\";\n        }\n        var criteria = [];\n        if (useBaseCriteria) {\n            criteria = self.options.baseCriteria.slice(0);\n        }\n        criteria.push({\n            i: term,\n            o: operation,\n            v: value,\n        });\n        var data = {\n            query: JSON.stringify({\n                criteria: criteria,\n            }),\n            attributes: JSON.stringify(self.options.attributes),\n        };\n        $.ajax({\n            url: self.options.vocabularyUrl,\n            dataType: \"JSON\",\n            data: data,\n            type: type,\n            success: callback,\n        });\n    };\n\n    return self;\n};\n\nvar Loading = function (options) {\n    /*\n     * Options:\n     *   backdrop(pattern): if you want to have the progress indicator work\n     *                      seamlessly with backdrop pattern\n     *   zIndex(integer or function): to override default z-index used\n     */\n    var self = this;\n    self.className = \"spinner-border\";\n    var defaults = {\n        backdrop: null,\n        zIndex: 10005, // can be a function\n    };\n    if (!options) {\n        options = {};\n    }\n    self.options = $.extend({}, defaults, options);\n\n    self.init = function () {\n        self.$el = $(\".\" + self.className);\n        if (self.$el.length === 0) {\n            self.$el = $(\"<div><div></div></div>\");\n            self.$el.addClass(self.className).hide().appendTo(\"body\");\n        }\n    };\n\n    self.show = function (closable) {\n        self.init();\n        self.$el.show();\n        self.$el.css(\"position\", \"absolute\");\n        self.$el.css(\"top\", \"50%\");\n        self.$el.css(\"left\", \"50%\");\n        var zIndex = self.options.zIndex;\n        if (typeof zIndex === \"function\") {\n            zIndex = Math.max(zIndex(), 10005);\n        } else {\n            // go through all modals and backdrops and make sure we have a higher\n            // z-index to use\n            zIndex = 10005;\n            $(\".modal-wrapper,.-modal-backdrop\").each(function () {\n                zIndex = Math.max(zIndex, $(this).css(\"zIndex\") || 10005);\n            });\n            zIndex += 1;\n        }\n        self.$el.css(\"zIndex\", zIndex);\n\n        if (closable === undefined) {\n            closable = true;\n        }\n        if (self.options.backdrop) {\n            self.options.backdrop.closeOnClick = closable;\n            self.options.backdrop.closeOnEsc = closable;\n            self.options.backdrop.init();\n            self.options.backdrop.show();\n        }\n    };\n\n    self.hide = function () {\n        self.init();\n        self.$el.hide();\n    };\n\n    return self;\n};\n\nvar getAuthenticator = function () {\n    var $el = $('input[name=\"_authenticator\"]');\n    if ($el.length === 0) {\n        $el = $('a[href*=\"_authenticator\"]');\n        if ($el.length > 0) {\n            return $el.attr(\"href\").split(\"_authenticator=\")[1];\n        }\n        return \"\";\n    } else {\n        return $el.val();\n    }\n};\n\nvar generateId = function (prefix) {\n    if (prefix === undefined) {\n        prefix = \"id\";\n    }\n    return (\n        prefix +\n        Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1)\n    );\n};\n\nvar setId = function ($el, prefix) {\n    if (prefix === undefined) {\n        prefix = \"id\";\n    }\n    var id = $el.attr(\"id\");\n    if (id === undefined) {\n        id = generateId(prefix);\n    } else {\n        /* hopefully we don't screw anything up here... changing the id\n         * in some cases so we get a decent selector */\n        id = id.replace(/\\./g, \"-\");\n    }\n    $el.attr(\"id\", id);\n    return id;\n};\n\nvar getWindow = function () {\n    var win = window;\n    if (win.parent !== window) {\n        win = win.parent;\n    }\n    return win;\n};\n\nvar parseBodyTag = function (txt) {\n    return $(\n        /<body[^>]*>[^]*<\\/body>/im\n            .exec(txt)[0]\n            .replace(\"<body\", \"<div\")\n            .replace(\"</body>\", \"</div>\")\n    )\n        .eq(0)\n        .html();\n};\n\nvar featureSupport = {\n    /* Well tested feature support for things we use in mockup.\n     * All gathered from: http://diveintohtml5.info/everything.html\n     * Alternative to using some form of modernizr.\n     */\n    dragAndDrop: function () {\n        return \"draggable\" in document.createElement(\"span\");\n    },\n    fileApi: function () {\n        return typeof FileReader != \"undefined\";\n    },\n    history: function () {\n        return !!(window.history && window.history.pushState);\n    },\n};\n\nvar bool = function (val) {\n    if (typeof val === \"string\") {\n        val = val.trim(val).toLowerCase();\n    }\n    return [\"false\", false, \"0\", 0, \"\", undefined, null].indexOf(val) === -1;\n};\n\nvar escapeHTML = function (val) {\n    return $(\"<div/>\").text(val).html();\n};\n\nvar removeHTML = function (val) {\n    return val.replace(/<[^>]+>/gi, \"\");\n};\n\nvar storage = {\n    // Simple local storage wrapper, which doesn't break down if it's not available.\n    get: function (name) {\n        if (window.localStorage) {\n            var val = window.localStorage[name];\n            return typeof val === \"string\" ? JSON.parse(val) : undefined;\n        }\n    },\n\n    set: function (name, val) {\n        if (window.localStorage) {\n            window.localStorage[name] = JSON.stringify(val);\n        }\n    },\n};\n\nexport const ICON_CACHE = new Map();\n\n/**\n * Return a <svg> element from a icon name.\n *\n * Example:\n *     const dropdownIcon: await utils.resolveIcon('plone-settings');\n *\n * @param {String} name - The name of the icon as stored in the plone registry.\n * @returns {String} - The SVG markup for the icon.\n */\nconst resolveIcon = async function (name) {\n    // if (name === 'plone.icon.plone-rearrange'){debugger}\n    const icon_lookup_name = `plone.icon.${name}`;\n    const cache_key = icon_lookup_name;\n\n    // ATTENTION: async/await trick ahead!\n    if (!ICON_CACHE.has(cache_key)) {\n        // 1) Immediately set the asynchronous function call to _resolve_icon in the icon cache.\n        // Subsequent calls will not re-set this because the cache_key is already set.\n        ICON_CACHE.set(cache_key, _resolve_icon());\n        logger.debug(`Loading icon \"${icon_lookup_name}\"`);\n    }\n    // 2) Await the promise for resolving the icon or just return the icon itself.\n    return await ICON_CACHE.get(cache_key);\n\n    async function _resolve_icon() {\n        // Do the actual loading.\n\n        let icon = \"\";\n        const base_url = document.body.getAttribute(\"data-portal-url\");\n        if (base_url) {\n            const url = base_url + \"/@@iconresolver\";\n            if (url) {\n                try {\n                    // Fetch timeout\n                    const controller = new AbortController();\n                    // 5 second timeout:\n                    setTimeout(() => controller.abort(), 5000);\n\n                    const resp = await fetch(`${url}/${name}`, {\n                        signal: controller.signal,\n                    });\n                    icon = await resp.text();\n                } catch (e) {\n                    logger.warn(`Loading icon \"${name}\" from URL ${url} failed.`);\n                    console.warn(e);\n                }\n            }\n        }\n        if (!icon) {\n            // fallback\n            name = icon_lookup_name;\n            try {\n                import(\"../styles/icons.scss\");\n                const iconmap = await import(\"../iconmap.json\");\n                const parts = iconmap[name]?.split?.(\"/\");\n                if (parts[0].includes(\"bootstrap-icons\")) {\n                    icon = await import(`bootstrap-icons/icons/${parts[1]}`);\n                    icon = icon?.default;\n                }\n            } catch (e) {\n                // import error\n                logger.warn(`Loading icon \"${icon_lookup_name}\" failed from fallback.`);\n                console.warn(e);\n            }\n        }\n        return icon;\n    }\n};\n\nexport default {\n    bool: bool,\n    escapeHTML: escapeHTML,\n    removeHTML: removeHTML,\n    featureSupport: featureSupport,\n    generateId: generateId,\n    getAuthenticator: getAuthenticator,\n    getWindow: getWindow,\n    Loading: Loading,\n    loading: new Loading(), // provide default loader\n    parseBodyTag: parseBodyTag,\n    QueryHelper: QueryHelper,\n    resolveIcon: resolveIcon,\n    setId: setId,\n    storage: storage,\n};\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport Select2 from \"../select2/select2\";\n\nconst KEY = {\n    LEFT: 37,\n    RIGHT: 39,\n};\n\nexport default Base.extend({\n    name: \"relateditems\",\n    trigger: \".pat-relateditems\",\n    parser: \"mockup\",\n    currentPath: undefined,\n    selectedUIDs: [],\n    openAfterInit: undefined,\n    defaults: {\n        // main option\n        vocabularyUrl: null, // must be set to work\n\n        // more options\n        attributes: [\n            \"UID\",\n            \"Title\",\n            \"portal_type\",\n            \"path\",\n            \"getURL\",\n            \"getIcon\",\n            \"is_folderish\",\n            \"review_state\",\n        ], // used by utils.QueryHelper\n        basePath: \"\",\n        pageSize: 10,\n        browsing: undefined,\n        closeOnSelect: true,\n        contextPath: undefined,\n        dropdownCssClass: \"pat-relateditems-dropdown\",\n        favorites: [],\n        recentlyUsed: false,\n        recentlyUsedMaxItems: 20,\n        recentlyUsedKey: \"relateditems_recentlyused\",\n        maximumSelectionSize: -1,\n        minimumInputLength: 0,\n        mode: \"browse\", // possible values are 'auto', 'search' and 'browse'.\n        orderable: true, // mockup-patterns-select2\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        rootPath: \"/\",\n        rootUrl: \"\", // default to be relative.\n        scanSelection: false, // False, to no unnecessarily use CPU time on this.\n        selectableTypes: null, // null means everything is selectable, otherwise a list of strings to match types that are selectable\n        separator: \",\",\n        sortOn: null,\n        sortOrder: \"ascending\",\n        tokenSeparators: [\",\", \" \"],\n        upload: false,\n        uploadAllowView: undefined,\n\n        // templates\n        breadcrumbTemplateSelector: null,\n        favoriteTemplateSelector: null,\n        recentlyusedTemplateSelector: null,\n        resultTemplateSelector: null,\n        selectionTemplateSelector: null,\n        toolbarTemplateSelector: null,\n\n        // needed\n        multiple: true,\n\n        // ajax settings\n        ajaxTimeout: 500,\n    },\n\n    recentlyUsed(filterSelectable) {\n        let ret = utils.storage.get(this.options.recentlyUsedKey) || [];\n        // hard-limit to 1000 entries\n        ret = ret.slice(ret.length - 1000, ret.length);\n        if (filterSelectable) {\n            // Filter out only selectable items.\n            // This is used only to create the list of items to be displayed.\n            // the list to be stored is unfiltered and can be reused among\n            // different instances of this widget with different settings.\n            ret.filter(this.isSelectable.bind(this));\n        }\n        // max is applied AFTER filtering selectable items.\n        const max = parseInt(this.options.recentlyUsedMaxItems, 10);\n        if (max) {\n            // return the slice from the end, as we want to display newest items first.\n            ret = ret.slice(ret.length - max, ret.length);\n        }\n        return ret;\n    },\n\n    applyTemplate(tpl, item) {\n        let template;\n        if (this.options[tpl + \"TemplateSelector\"]) {\n            template = $(this.options[tpl + \"TemplateSelector\"]).html();\n        }\n        if (!template) {\n            if (this.options[tpl + \"Template\"]) {\n                template = this.options[tpl + \"Template\"];\n            } else {\n                template = this[tpl + \"Template\"];\n            }\n        }\n        // let's give all the options possible to the template generation\n        const options = $.extend(true, {}, this.options, item, {\n            browsing: this.browsing,\n            open_folder: _t(\"Open folder\"),\n            current_directory: _t(\"current directory:\"),\n            one_level_up: _t(\"Go one level up\"),\n        });\n        options._item = item;\n        return _.template(template)(options);\n    },\n\n    setAjax() {\n        const ajaxTimeout = parseInt(this.options.ajaxTimeout || 500, 10);\n\n        const ajax = {\n            url: this.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: ajaxTimeout,\n\n            data: (term, page) => {\n                const criterias = [];\n                if (term) {\n                    term = \"*\" + term + \"*\";\n                    criterias.push({\n                        i: \"SearchableText\",\n                        o: \"plone.app.querystring.operation.string.contains\",\n                        v: term,\n                    });\n                }\n\n                // We don't restrict for selectable types while browsing...\n                if (!this.browsing && this.options.selectableTypes) {\n                    criterias.push({\n                        i: \"portal_type\",\n                        o: \"plone.app.querystring.operation.selection.any\",\n                        v: this.options.selectableTypes,\n                    });\n                }\n\n                criterias.push({\n                    i: \"path\",\n                    o: this.options.pathOperator,\n                    v:\n                        this.options.rootPath +\n                        this.currentPath +\n                        (this.browsing ? \"::1\" : \"\"),\n                });\n\n                let sort_on = this.options.sortOn;\n                let sort_order = sort_on ? this.options.sortOrder : null;\n                if (this.browsing && sort_on === null) {\n                    sort_on = \"getObjPositionInParent\";\n                    sort_order = \"ascending\";\n                }\n\n                const data = {\n                    query: JSON.stringify({\n                        criteria: criterias,\n                        sort_on: sort_on,\n                        sort_order: sort_order,\n                    }),\n                    attributes: JSON.stringify(this.options.attributes),\n                    batch: JSON.stringify({\n                        page: page ? page : 1,\n                        size: this.options.pageSize,\n                    }),\n                };\n                return data;\n            },\n\n            results: (data, page) => {\n                const more = page * this.options.pageSize < data.total;\n                let results = data.results;\n\n                this.selectedUIDs = (this.$el.select2(\"data\") || []).map((el) => {\n                    // populate current selection. Reuse in formatResult\n                    return el.UID;\n                });\n\n                // Filter out items:\n                // While browsing: always include folderish items\n                // Browsing and searching: Only include selectable items which are not already selected, and all folders\n                // even if they're selected, as we need them available for browsing/selecting their children\n                results = results.filter((item) => {\n                    if (\n                        (this.browsing && item.is_folderish) ||\n                        (this.isSelectable(item) &&\n                            this.selectedUIDs.indexOf(item.UID) === -1)\n                    ) {\n                        return true;\n                    }\n                    return false;\n                });\n\n                // Extend ``data`` with a ``oneLevelUp`` item when browsing\n                const path = this.currentPath.split(\"/\");\n                if (\n                    page === 1 && // Show level up only on top.\n                    this.browsing && // only level up when browsing\n                    path.length > 1 && // do not try to level up one level under root.\n                    this.currentPath !== \"/\" // do not try to level up beyond root\n                ) {\n                    results = [\n                        {\n                            oneLevelUp: true,\n                            Title: _t(\"One level up\"),\n                            path: path.slice(0, path.length - 1).join(\"/\") || \"/\",\n                            currentPath: this.currentPath,\n                            is_folderish: true,\n                            selectable: false,\n                        },\n                    ].concat(results);\n                }\n                return {\n                    results: results,\n                    more: more,\n                };\n            },\n        };\n        this.options.ajax = ajax;\n    },\n\n    async renderToolbar() {\n        const path = this.currentPath;\n        let html;\n\n        const parts = path.split(\"/\");\n        let itemPath = \"\";\n        let itemsHtml = \"\";\n        for (const part of parts) {\n            if (part !== \"\") {\n                const item = {};\n                item.path = itemPath = `${itemPath}/${part}`;\n                item.text = part;\n                itemsHtml = itemsHtml + this.applyTemplate(\"breadcrumb\", item);\n            }\n        }\n\n        // favorites\n        let favoritesHtml = \"\";\n        for (const item of this.options.favorites) {\n            const item_copy = _.clone(item);\n            item_copy.path = item_copy.path.substr(this.options.rootPath.length) || \"/\";\n            favoritesHtml = favoritesHtml + this.applyTemplate(\"favorite\", item_copy);\n        }\n\n        let recentlyUsedHtml = \"\";\n        if (this.options.recentlyUsed) {\n            const recentlyUsed = this.recentlyUsed(true); // filter out only those items which can actually be selected\n            for (const item of recentlyUsed.reverse()) {\n                // reverse to get newest first.\n                recentlyUsedHtml =\n                    recentlyUsedHtml + this.applyTemplate(\"recentlyused\", item);\n            }\n        }\n\n        html = this.applyTemplate(\"toolbar\", {\n            items: itemsHtml,\n            favItems: favoritesHtml,\n            favText: _t(\"Favorites\"),\n            searchText: _t(\"Current path:\"),\n            searchModeText: _t(\"Search\"),\n            browseModeText: _t(\"Browse\"),\n            recentlyUsedItems: recentlyUsedHtml,\n            recentlyUsedText: _t(\"Recently Used\"),\n            icon_root: await utils.resolveIcon(\"house-fill\"),\n            icon_recently_used: await utils.resolveIcon(\"grid-fill\"),\n            icon_favorites: await utils.resolveIcon(\"star-fill\"),\n            icon_upload: await utils.resolveIcon(\"cloud-arrow-up\"),\n            upload: this.options.upload,\n            upload_text: _t(\"Upload\"),\n        });\n\n        this.$toolbar.html(html);\n\n        // unbind mouseup event from select2 to override the behavior:\n        $(\".pat-relateditems-dropdown\").off(\"mouseup\");\n        $(\".pat-relateditems-dropdown\").on(\"mouseup\", (e) => {\n            e.stopPropagation();\n        });\n\n        $(\"button.mode.search\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                this.browsing = false;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"button.mode.browse\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            if (!this.browsing) {\n                $(\"button.mode.search\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                $(\"button.mode.browse\", this.$toolbar).toggleClass(\n                    \"btn-primary btn-secondary\"\n                );\n                this.browsing = true;\n                if (this.$el.select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    this.openAfterInit = true;\n                }\n                if (!this.openAfterInit) {\n                    this.$el.select2(\"close\");\n                    this.$el.select2(\"open\");\n                }\n            } else {\n                // just open result list\n                this.$el.select2(\"close\");\n                this.$el.select2(\"open\");\n            }\n        });\n\n        $(\"a.crumb\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        $(\"a.fav\", this.$toolbar).on(\"click\", (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.browseTo($(e.currentTarget).attr(\"href\"));\n        });\n\n        if (this.options.recentlyUsed) {\n            $(\".pat-relateditems-recentlyused-select\", this.$toolbar).on(\n                \"click\",\n                (event) => {\n                    event.preventDefault();\n                    const uid = $(event.currentTarget).data(\"uid\");\n                    let item = this.recentlyUsed().filter((it) => {\n                        return it.UID === uid;\n                    });\n                    if (item.length > 0) {\n                        item = item[0];\n                    } else {\n                        return;\n                    }\n                    this.selectItem(item);\n                    if (this.options.maximumSelectionSize > 0) {\n                        const items = this.$el.select2(\"data\");\n                        if (items.length >= this.options.maximumSelectionSize) {\n                            return;\n                        }\n                    }\n                }\n            );\n        }\n\n        // upload\n        if (\n            this.options.upload &&\n            utils.featureSupport.dragAndDrop() &&\n            utils.featureSupport.fileApi()\n        ) {\n            if (this.options.uploadAllowView) {\n                // Check, if uploads are allowed in current context\n                $.ajax({\n                    url: this.options.uploadAllowView,\n                    // url: this.currentUrl() + this.options.uploadAllowView,  // not working yet\n                    dataType: \"JSON\",\n                    data: {\n                        path: this.options.rootPath + this.currentPath,\n                    },\n                    type: \"GET\",\n                    success: (result) => {\n                        this.initUploadView(!result.allowUpload);\n                    },\n                });\n            } else {\n                // just initialize upload view without checking, if uploads are allowed.\n                this.initUploadView();\n            }\n        }\n    },\n\n    async initUploadView(disabled) {\n        let Upload = await import(\"../upload/upload\");\n        Upload = Upload.default;\n\n        const upload_button = this.$toolbar[0].querySelector(\".upload button\");\n        upload_button.disabled = disabled;\n\n        const upload_el = this.$toolbar[0].querySelector(\".upload .pat-upload\");\n\n        const upload_config = {\n            success: (e, response) => {\n                const uid = response.UID;\n                if (uid) {\n                    const query = new utils.QueryHelper({\n                        vocabularyUrl: this.options.vocabularyUrl,\n                        attributes: this.options.attributes,\n                    });\n                    query.search(\n                        \"UID\",\n                        \"plone.app.querystring.operation.selection.is\",\n                        uid,\n                        (e) => {\n                            const data = this.$el.select2(\"data\");\n                            data.push.apply(data, e.results);\n                            this.$el.select2(\"data\", data, true);\n                            this.emit(\"selected\");\n                        },\n                        false\n                    );\n                }\n            },\n            uloadMultiple: true,\n            allowPathSelection: false,\n            relativePath: \"fileUpload\",\n            baseUrl: this.options.rootUrl,\n        };\n        const upload = new Upload($(upload_el), upload_config);\n\n        upload_button.addEventListener(\"show.bs.dropdown\", () => {\n            if (this.currentPath !== upload.currentPath) {\n                upload.setPath(this.currentPath);\n            }\n        });\n    },\n\n    browseTo(path) {\n        this.emit(\"before-browse\");\n        this.currentPath = path;\n        this.$el.select2(\"close\");\n        this.renderToolbar();\n        this.$el.select2(\"open\");\n        this.emit(\"after-browse\");\n    },\n\n    selectItem(item) {\n        this.emit(\"selecting\");\n        const data = $(this.el).select2(\"data\");\n        data.push(item);\n        $(this.el).select2(\"data\", data, true);\n\n        if (this.options.recentlyUsed) {\n            // add to recently added items\n            const recentlyUsed = this.recentlyUsed(); // do not filter for selectable but get all. append to that list the new item.\n            const alreadyPresent = recentlyUsed.filter((it) => {\n                return it.UID === item.UID;\n            });\n            if (alreadyPresent.length > 0) {\n                recentlyUsed.splice(recentlyUsed.indexOf(alreadyPresent[0]), 1);\n            }\n            recentlyUsed.push(item);\n            utils.storage.set(this.options.recentlyUsedKey, recentlyUsed);\n        }\n\n        this.emit(\"selected\");\n    },\n\n    deselectItem(item) {\n        this.emit(\"deselecting\");\n        const data = this.$el.select2(\"data\");\n        data.forEach((obj, i) => {\n            if (obj.UID === item.UID) {\n                data.splice(i, 1);\n            }\n        });\n        this.$el.select2(\"data\", data, true);\n        this.emit(\"deselected\");\n    },\n\n    isSelectable(item) {\n        if (item.selectable === false) {\n            return false;\n        }\n        if (this.options.selectableTypes === null) {\n            return true;\n        } else {\n            return this.options.selectableTypes.indexOf(item.portal_type) !== -1;\n        }\n    },\n\n    async init() {\n        (await import(\"bootstrap\")).Dropdown;\n        import(\"./relateditems.scss\");\n\n        // templates\n        this.breadcrumbTemplate = (await import(\"./templates/breadcrumb.xml\")).default; // prettier-ignore\n        this.favoriteTemplate = (await import(\"./templates/favorite.xml\")).default; // prettier-ignore\n        this.recentlyusedTemplate = (await import(\"./templates/recentlyused.xml\")).default; // prettier-ignore\n        this.resultTemplate = (await import(\"./templates/result.xml\")).default; // prettier-ignore\n        this.selectionTemplate = (await import(\"./templates/selection.xml\")).default; // prettier-ignore\n        this.toolbarTemplate = (await import(\"./templates/toolbar.xml\")).default; // prettier-ignore\n\n        this.browsing = this.options.mode !== \"search\";\n\n        // Remove trailing slash\n        this.options.rootPath = this.options.rootPath.replace(/\\/$/, \"\");\n        // Substract rootPath from basePath with is the relative currentPath. Has a leading slash. Or use '/'\n        this.currentPath =\n            this.options.basePath.substr(this.options.rootPath.length) || \"/\";\n\n        this.setAjax();\n\n        this.$el.wrap('<div class=\"pat-relateditems-container\" />');\n        this.$container = this.$el.parents(\".pat-relateditems-container\");\n\n        Select2.prototype.initializeValues.call(this);\n        Select2.prototype.initializeTags.call(this);\n\n        this.options.formatSelection = (item) => {\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                },\n                item\n            );\n\n            // activate petterns on the result set.\n            const $selection = $(this.applyTemplate(\"selection\", item));\n            if (this.options.scanSelection) {\n                registry.scan($selection);\n            }\n            if (this.options.maximumSelectionSize == 1) {\n                // If this related field accepts only 1 item, the breadcrumbs should\n                // reflect the location for this particular item\n                let itemPath = item.path;\n                let path_split = itemPath.split(\"/\");\n                path_split = path_split.slice(0, -1); // Remove last part of path, we always want the parent path\n                itemPath = path_split.join(\"/\");\n                this.currentPath = itemPath;\n                this.renderToolbar();\n            }\n            return $selection;\n        };\n\n        const icon_level_up = await utils.resolveIcon(\"arrow-left-circle\");\n        const icon_level_down = await utils.resolveIcon(\"arrow-right-circle\");\n\n        this.options.formatResult = (item) => {\n            item.selectable = this.isSelectable(item);\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    is_folderish: false,\n                    oneLevelUp: false,\n                    iconLevelUp: icon_level_up,\n                    iconLevelDown: icon_level_down,\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                    selectable: false,\n                },\n                item\n            );\n\n            if (this.selectedUIDs.indexOf(item.UID) !== -1) {\n                // do not allow already selected items to be selected again.\n                item.selectable = false;\n            }\n            const result = $(this.applyTemplate(\"result\", item));\n\n            $(\".pat-relateditems-result-select\", result).on(\"click\", (event) => {\n                const _el = event.currentTarget;\n                event.preventDefault();\n                // event.stopPropagation();\n                if ($(_el).is(\".selectable\")) {\n                    const $parent = $(_el).parents(\".pat-relateditems-result\");\n                    if ($parent.is(\".pat-relateditems-active\")) {\n                        $parent.removeClass(\"pat-relateditems-active\");\n                        this.deselectItem(item);\n                    } else {\n                        if (this.options.maximumSelectionSize > 0) {\n                            const items = this.$el.select2(\"data\");\n                            if (items.length >= this.options.maximumSelectionSize) {\n                                this.$el.select2(\"close\");\n                            }\n                        }\n                        this.selectItem(item);\n                        $parent.addClass(\"pat-relateditems-active\");\n                        if (this.options.closeOnSelect) {\n                            this.$el.select2(\"close\");\n                        }\n                    }\n                }\n            });\n\n            $(\".pat-relateditems-result-browse\", result).on(\"click\", (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                const path = $(event.currentTarget).data(\"path\");\n                this.browseTo(path);\n            });\n\n            return $(result);\n        };\n\n        this.options.initSelection = (element, callback) => {\n            const value = $(element).val();\n            if (value !== \"\") {\n                const ids = value.split(this.options.separator);\n                const query = new utils.QueryHelper(\n                    $.extend(true, {}, this.options, {\n                        pattern: this,\n                    })\n                );\n                query.search(\n                    \"UID\",\n                    \"plone.app.querystring.operation.list.contains\",\n                    ids,\n                    (data) => {\n                        const results = data.results.reduce((prev, item) => {\n                            prev[item.UID] = item;\n                            return prev;\n                        }, {});\n\n                        try {\n                            callback(\n                                ids\n                                    .map((uid) => results[uid])\n                                    .filter((item) => item !== undefined)\n                            );\n                        } catch {\n                            // Select2 3.5.4 throws an error in some cases in\n                            // updateSelection, ``this.selection.find(\".select2-search-choice\").remove();``\n                            // No idea why, hard to track.\n                        }\n\n                        if (this.openAfterInit) {\n                            // open after initialization\n                            this.$el.select2(\"open\");\n                            this.openAfterInit = undefined;\n                        }\n                    },\n                    false\n                );\n            }\n        };\n\n        this.options.tokenizer = (input) => {\n            if (this.options.mode === \"auto\") {\n                this.browsing = input ? false : true;\n            }\n        };\n\n        this.options.id = (item) => item.UID;\n\n        await Select2.prototype.initializeSelect2.call(this);\n        await Select2.prototype.initializeOrdering.call(this);\n\n        this.$toolbar = $('<div class=\"toolbar d-flex\" />');\n        this.$container.prepend(this.$toolbar);\n        this.$el.on(\"select2-selecting\", (event) => {\n            if (!this.isSelectable(event.choice)) {\n                event.preventDefault();\n            }\n        });\n        this.renderToolbar();\n        this.$el.on(\"select2-loaded\", () => {\n            let yMax = window.innerHeight || document.documentElement.clientHeight;\n            const relitem_rect = this.el.parentElement.getBoundingClientRect();\n            const element = $(\n                \"#select2-drop.pat-relateditems-dropdown.select2-drop-active .select2-results\"\n            )[0];\n            const rect = element.getBoundingClientRect();\n            const maxHeight = ((relitem_rect.top > rect.top) ? relitem_rect.top : yMax - rect.top) - 18;\n            $(element).css(\"max-height\", `${maxHeight}px`);\n        });\n\n        $(document).on(\"keyup\", this.$el, (event) => {\n            const isOpen = Select2.prototype.opened.call(this);\n            if (!isOpen) {\n                return;\n            }\n\n            if (event.which === KEY.LEFT || event.which === KEY.RIGHT) {\n                event.stopPropagation();\n\n                const selectorContext =\n                    event.which === KEY.LEFT\n                        ? \".pat-relateditems-result.one-level-up\"\n                        : \".select2-highlighted\";\n\n                const browsableItemSelector = \".pat-relateditems-result-browse\";\n                const browsableItem = $(browsableItemSelector, selectorContext);\n\n                if (browsableItem.length !== 1) {\n                    return;\n                }\n\n                const path = browsableItem.data(\"path\");\n\n                this.browseTo(path);\n            }\n        });\n    },\n});\n","/**\n * @license\n * Patterns @VERSION@ jquery-ext - various jQuery extensions\n *\n * Copyright 2011 Humberto Sermeño\n */\n\nimport $ from \"jquery\";\n\nvar methods = {\n    init: function (options) {\n        var settings = {\n            time: 3 /* time it will wait before moving to \"timeout\" after a move event */,\n            initialTime: 8 /* time it will wait before first adding the \"timeout\" class */,\n            exceptionAreas: [] /* IDs of elements that, if the mouse is over them, will reset the timer */,\n        };\n        return this.each(function () {\n            var $this = $(this),\n                data = $this.data(\"timeout\");\n\n            if (!data) {\n                if (options) {\n                    $.extend(settings, options);\n                }\n                $this.data(\"timeout\", {\n                    lastEvent: new Date(),\n                    trueTime: settings.time,\n                    time: settings.initialTime,\n                    untouched: true,\n                    inExceptionArea: false,\n                });\n\n                $this.on(\"mouseover.timeout\", methods.mouseMoved);\n                $this.on(\"mouseenter.timeout\", methods.mouseMoved);\n\n                $(settings.exceptionAreas).each(function () {\n                    $this\n                        .find(this)\n                        .live(\n                            \"mouseover.timeout\",\n                            { parent: $this },\n                            methods.enteredException\n                        )\n                        .live(\n                            \"mouseleave.timeout\",\n                            { parent: $this },\n                            methods.leftException\n                        );\n                });\n\n                if (settings.initialTime > 0) $this.timeout(\"startTimer\");\n                else $this.addClass(\"timeout\");\n            }\n        });\n    },\n\n    enteredException: function (event) {\n        var data = event.data.parent.data(\"timeout\");\n        data.inExceptionArea = true;\n        event.data.parent.data(\"timeout\", data);\n        event.data.parent.trigger(\"mouseover\");\n    },\n\n    leftException: function (event) {\n        var data = event.data.parent.data(\"timeout\");\n        data.inExceptionArea = false;\n        event.data.parent.data(\"timeout\", data);\n    },\n\n    destroy: function () {\n        return this.each(function () {\n            var $this = $(this),\n                data = $this.data(\"timeout\");\n\n            $(window).off(\".timeout\");\n            data.timeout.remove();\n            $this.removeData(\"timeout\");\n        });\n    },\n\n    mouseMoved: function () {\n        var $this = $(this),\n            data = $this.data(\"timeout\");\n\n        if ($this.hasClass(\"timeout\")) {\n            $this.removeClass(\"timeout\");\n            $this.timeout(\"startTimer\");\n        } else if (data.untouched) {\n            data.untouched = false;\n            data.time = data.trueTime;\n        }\n\n        data.lastEvent = new Date();\n        $this.data(\"timeout\", data);\n    },\n\n    startTimer: function () {\n        var $this = $(this),\n            data = $this.data(\"timeout\");\n        var fn = function () {\n            var data = $this.data(\"timeout\");\n            if (data && data.lastEvent) {\n                if (data.inExceptionArea) {\n                    setTimeout(fn, Math.floor(data.time * 1000));\n                } else {\n                    var now = new Date();\n                    var diff = Math.floor(data.time * 1000) - (now - data.lastEvent);\n                    if (diff > 0) {\n                        // the timeout has not ocurred, so set the timeout again\n                        setTimeout(fn, diff + 100);\n                    } else {\n                        // timeout ocurred, so set the class\n                        $this.addClass(\"timeout\");\n                    }\n                }\n            }\n        };\n\n        setTimeout(fn, Math.floor(data.time * 1000));\n    },\n};\n\n$.fn.timeout = function (method) {\n    if (methods[method]) {\n        return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));\n    } else if (typeof method === \"object\" || !method) {\n        return methods.init.apply(this, arguments);\n    } else {\n        $.error(\"Method \" + method + \" does not exist on jQuery.timeout\");\n    }\n};\n\n// Custom jQuery selector to find elements with scrollbars\n$.extend($.expr[\":\"], {\n    scrollable: function (element) {\n        var vertically_scrollable, horizontally_scrollable;\n        if (\n            $(element).css(\"overflow\") === \"scroll\" ||\n            $(element).css(\"overflowX\") === \"scroll\" ||\n            $(element).css(\"overflowY\") === \"scroll\"\n        )\n            return true;\n\n        vertically_scrollable =\n            element.clientHeight < element.scrollHeight &&\n            ($.inArray($(element).css(\"overflowY\"), [\"scroll\", \"auto\"]) !== -1 ||\n                $.inArray($(element).css(\"overflow\"), [\"scroll\", \"auto\"]) !== -1);\n\n        if (vertically_scrollable) return true;\n\n        horizontally_scrollable =\n            element.clientWidth < element.scrollWidth &&\n            ($.inArray($(element).css(\"overflowX\"), [\"scroll\", \"auto\"]) !== -1 ||\n                $.inArray($(element).css(\"overflow\"), [\"scroll\", \"auto\"]) !== -1);\n        return horizontally_scrollable;\n    },\n});\n\n// Make Visible in scroll\n$.fn.makeVisibleInScroll = function (parent_id) {\n    var absoluteParent = null;\n    if (typeof parent_id === \"string\") {\n        absoluteParent = $(\"#\" + parent_id);\n    } else if (parent_id) {\n        absoluteParent = $(parent_id);\n    }\n\n    return this.each(function () {\n        var $this = $(this),\n            parent;\n        if (!absoluteParent) {\n            parent = $this.parents(\":scrollable\");\n            if (parent.length > 0) {\n                parent = $(parent[0]);\n            } else {\n                parent = $(window);\n            }\n        } else {\n            parent = absoluteParent;\n        }\n\n        var elemTop = $this.position().top;\n        var elemBottom = $this.height() + elemTop;\n\n        var viewTop = parent.scrollTop();\n        var viewBottom = parent.height() + viewTop;\n\n        if (elemTop < viewTop) {\n            parent.scrollTop(elemTop);\n        } else if (elemBottom > viewBottom - parent.height() / 2) {\n            parent.scrollTop(elemTop - (parent.height() - $this.height()) / 2);\n        }\n    });\n};\n\n//Work around warning for jQuery 3.x:\n//JQMIGRATE: jQuery.fn.offset() requires an element connected to a document\n$.fn.safeOffset = function () {\n    var docElem,\n        elem = this[0],\n        origin = { top: 0, left: 0 };\n\n    if (!elem || !elem.nodeType) {\n        return origin;\n    }\n\n    docElem = (elem.ownerDocument || document).documentElement;\n    if (!$.contains(docElem, elem)) {\n        return origin;\n    }\n\n    return $.fn.offset.apply(this, arguments);\n};\n\n//Make absolute location\n$.fn.setPositionAbsolute = function (element, offsettop, offsetleft) {\n    return this.each(function () {\n        // set absolute location for based on the element passed\n        // dynamically since every browser has different settings\n        var $this = $(this);\n        var thiswidth = $(this).width();\n        var pos = element.safeOffset();\n        var width = element.width();\n        var height = element.height();\n        var setleft = pos.left + width - thiswidth + offsetleft;\n        var settop = pos.top + height + offsettop;\n        $this.css({\n            \"z-index\": 1,\n            \"position\": \"absolute\",\n            \"marginLeft\": 0,\n            \"marginTop\": 0,\n            \"left\": setleft + \"px\",\n            \"top\": settop + \"px\",\n            \"width\": thiswidth,\n        });\n        $this.remove().appendTo(\"body\").show();\n    });\n};\n\n$.fn.positionAncestor = function (selector) {\n    var left = 0;\n    var top = 0;\n    this.each(function () {\n        // check if current element has an ancestor matching a selector\n        // and that ancestor is positioned\n        var $ancestor = $(this).closest(selector);\n        if ($ancestor.length && $ancestor.css(\"position\") !== \"static\") {\n            var $child = $(this);\n            var childMarginEdgeLeft =\n                $child.safeOffset().left - parseInt($child.css(\"marginLeft\"), 10);\n            var childMarginEdgeTop =\n                $child.safeOffset().top - parseInt($child.css(\"marginTop\"), 10);\n            var ancestorPaddingEdgeLeft =\n                $ancestor.safeOffset().left +\n                parseInt($ancestor.css(\"borderLeftWidth\"), 10);\n            var ancestorPaddingEdgeTop =\n                $ancestor.safeOffset().top +\n                parseInt($ancestor.css(\"borderTopWidth\"), 10);\n            left = childMarginEdgeLeft - ancestorPaddingEdgeLeft;\n            top = childMarginEdgeTop - ancestorPaddingEdgeTop;\n            // we have found the ancestor and computed the position\n            // stop iterating\n            return false;\n        }\n    });\n    return {\n        left: left,\n        top: top,\n    };\n};\n\n$.fn.findInclusive = function (selector) {\n    return this.find(\"*\").addBack().filter(selector);\n};\n\n$.fn.slideIn = function (speed, easing, callback) {\n    return this.animate({ width: \"show\" }, speed, easing, callback);\n};\n\n$.fn.slideOut = function (speed, easing, callback) {\n    return this.animate({ width: \"hide\" }, speed, easing, callback);\n};\n\n// case-insensitive :contains\n$.expr[\":\"].Contains = function (a, i, m) {\n    return $(a).text().toUpperCase().indexOf(m[3].toUpperCase()) >= 0;\n};\n\n$.fn.scopedFind = function (selector) {\n    /*  If the selector starts with an object id do a global search,\n     *  otherwise do a local search.\n     */\n    if (selector.indexOf(\"#\") === 0) {\n        return $(selector);\n    } else {\n        return this.find(selector);\n    }\n};\n\nexport default undefined;\n","import Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport utils from \"../../core/utils\";\nimport \"../../core/jquery-ext\";\n\nexport const parser = new Parser(\"checklist\");\nparser.addArgument(\"select\", \".select-all\");\nparser.addArgument(\"deselect\", \".deselect-all\");\nparser.addArgument(\"toggle\", \".toggle-all\");\n\nexport default Base.extend({\n    name: \"checklist\",\n    trigger: \".pat-checklist\",\n    jquery_plugin: true,\n    all_selects: [],\n    all_deselects: [],\n    all_toggles: [],\n    all_checkboxes: [],\n    all_radios: [],\n\n    init() {\n        this.options = parser.parse(this.el, this.options, false);\n        this.$el.on(\"patterns-injected\", this._init.bind(this));\n\n        this.change_handler = utils.debounce(() => {\n            this.change_buttons_and_toggles();\n            this.change_checked();\n        }, 50);\n\n        this._init();\n    },\n\n    _init() {\n        this.all_checkboxes = this.el.querySelectorAll(`input[type=checkbox]`);\n        this.all_radios = this.el.querySelectorAll(\"input[type=radio]\");\n\n        this.all_selects = dom.find_scoped(this.el, this.options.select);\n        for (const btn of this.all_selects) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--select-all--click\",\n                this.select_all.bind(this)\n            );\n        }\n\n        this.all_deselects = dom.find_scoped(this.el, this.options.deselect);\n        for (const btn of this.all_deselects) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--deselect-all--click\",\n                this.deselect_all.bind(this)\n            );\n        }\n\n        this.all_toggles = dom.find_scoped(this.el, this.options.toggle);\n        for (const btn of this.all_toggles) {\n            events.add_event_listener(\n                btn,\n                \"click\",\n                \"pat-checklist--toggle-all--click\",\n                this.toggle_all.bind(this)\n            );\n        }\n\n        // update select/deselect button status\n        this.change_buttons_and_toggles();\n        this.change_checked();\n        events.add_event_listener(\n            this.el,\n            \"change\",\n            \"pat-checklist--change-handler--change\",\n            this.change_handler.bind(this)\n        );\n    },\n\n    destroy() {\n        for (const it of this.all_selects) {\n            events.remove_event_listener(it, \"pat-checklist--select-all--click\");\n        }\n        for (const it of this.all_deselects) {\n            events.remove_event_listener(it, \"pat-checklist--deselect-all--click\");\n        }\n        for (const it of this.all_toggles) {\n            events.remove_event_listener(it, \"pat-checklist--toggle-all--click\");\n        }\n        events.remove_event_listener(this.el, \"pat-checklist--change-handler--change\");\n        this.$el.off(\"patterns_injected\");\n    },\n\n    find_siblings(el, sel) {\n        // Looks for the closest elements within the `el` tree that match the\n        // `sel` selector\n        let res;\n        let parent = el.parentNode;\n        while (parent) {\n            res = parent.querySelectorAll(`${sel}:not(${this.options.toggle})`);\n            if (res.length || parent === this.el) {\n                // return if results were found or we reached the pattern top\n                return res;\n            }\n            parent = parent.parentNode;\n        }\n    },\n\n    find_checkboxes(ref_el, sel) {\n        let chkbxs = [];\n        if (this.options.select.indexOf(\"#\") === 0) {\n            chkbxs = this.el.querySelectorAll(sel);\n        } else {\n            chkbxs = this.find_siblings(ref_el, sel);\n        }\n        return chkbxs;\n    },\n\n    change_buttons_and_toggles() {\n        let chkbxs;\n        for (const btn of this.all_selects) {\n            chkbxs = this.find_checkboxes(btn, \"input[type=checkbox]\");\n            btn.disabled = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === true);\n        }\n        for (const btn of this.all_deselects) {\n            chkbxs = this.find_checkboxes(btn, \"input[type=checkbox]\");\n            btn.disabled = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === false);\n        }\n        for (const tgl of this.all_toggles) {\n            chkbxs = this.find_checkboxes(tgl, \"input[type=checkbox]\");\n            tgl.checked = [...chkbxs]\n                .map((el) => el.matches(\":checked\"))\n                .every((it) => it === true);\n        }\n    },\n\n    select_all(e) {\n        e.preventDefault();\n        const chkbxs = this.find_checkboxes(\n            e.target,\n            \"input[type=checkbox]:not(:checked)\"\n        );\n        for (const box of chkbxs) {\n            box.checked = true;\n            box.dispatchEvent(events.change_event());\n            box.dispatchEvent(events.input_event());\n        }\n    },\n\n    deselect_all(e) {\n        e.preventDefault();\n        const chkbxs = this.find_checkboxes(e.target, \"input[type=checkbox]:checked\");\n        for (const box of chkbxs) {\n            box.checked = false;\n            box.dispatchEvent(events.change_event());\n            box.dispatchEvent(events.input_event());\n        }\n    },\n\n    toggle_all(e) {\n        e.preventDefault();\n        const checked = e.target.checked;\n        const chkbxs = this.find_checkboxes(e.target, \"input[type=checkbox]\");\n        for (const box of chkbxs) {\n            box.checked = checked;\n            box.dispatchEvent(events.change_event());\n            box.dispatchEvent(events.input_event());\n        }\n    },\n\n    change_checked() {\n        for (const it of [...this.all_checkboxes, ...this.all_radios]) {\n            for (const label of it.labels) {\n                label.classList.remove(\"checked\", \"unchecked\");\n                label.classList.add(it.checked ? \"checked\" : \"unchecked\");\n            }\n        }\n\n        for (const fieldset of dom.querySelectorAllAndMe(this.el, \"fieldset\")) {\n            if (\n                fieldset.querySelectorAll(\n                    `input[type=checkbox]:checked:not(${this.options.toggle}), input[type=radio]:checked`\n                ).length\n            ) {\n                fieldset.classList.remove(\"unchecked\");\n                fieldset.classList.add(\"checked\");\n            } else {\n                fieldset.classList.remove(\"checked\");\n                fieldset.classList.add(\"unchecked\");\n            }\n        }\n    },\n});\n","/* pat-datetime-picker  - Polyfill for input type=datetime-local */\nimport Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport utils from \"../../core/utils\";\nimport dom from \"../../core/dom\";\n\nexport const parser = new Parser(\"datetime-picker\");\nparser.addArgument(\"format\", \"YYYY-MM-DD\");\nparser.addArgument(\"week-numbers\", [], [\"show\", \"hide\"]);\nparser.addArgument(\"i18n\"); // URL pointing to JSON resource with i18n values\nparser.addArgument(\"today\", \"Today\");\nparser.addArgument(\"clear\", \"Clear\");\nparser.addArgument(\"first-day\", 0);\n\nexport default Base.extend({\n    name: \"datetime-picker\",\n    trigger: \".pat-datetime-picker\",\n    parser: parser,\n    el_date: null,\n    el_time: null,\n\n    async init() {\n        const el = this.el;\n        this.options = parser.parse(this.el, this.options);\n\n        if (utils.checkInputSupport(\"datetime-local\", \"invalid date\")) {\n            return;\n        }\n\n        if (window.__patternslib_import_styles) {\n            import(\"./_datetime-picker.scss\");\n        }\n        const DatePicker = (await import(\"../date-picker/date-picker\")).default;\n\n        const value = this.el.value.split(\"T\");\n        const date_value = value[0] || \"\";\n        const time_value = value[1] || \"\";\n\n        const el_wrapper = document.createElement(\"div\");\n        el_wrapper.setAttribute(\"class\", \"pat-datetime-picker__wrapper\");\n\n        dom.hide(el);\n\n        // let the buttons be of type button otherwise they are submit buttons\n        const html_btn_now = `\n            <button type=\"button\" class=\"_btn _now\" title=\"${this.options.today}\">\n                <span class=\"_icon\"/>\n                <span class=\"_text\">${this.options.today}</span>\n            </button>`;\n        const html_btn_clear = `\n            <button type=\"button\" class=\"_btn _clear\" title=\"${this.options.clear}\">\n                <span class=\"_icon\"/>\n                <span class=\"_text\">${this.options.clear}</span>\n            </button>`;\n\n        el_wrapper.innerHTML = `\n            <input type=\"date\" placeholder=\"YYYY-MM-DD\" value=\"${date_value}\" />\n            <input type=\"time\" placeholder=\"hh:mm\" value=\"${time_value}\" />\n            ${this.options.today ? html_btn_now : \"\"}\n            ${this.options.clear ? html_btn_clear : \"\"}\n        `;\n\n        this.el_time = el_wrapper.querySelector(\"input[type=time]\");\n        this.el_time.addEventListener(\"change\", () => this.update());\n\n        this.el_date = el_wrapper.querySelector(\"input[type=date]\");\n        this.el_date.addEventListener(\"change\", () => {\n            if (!this.el_time.value) {\n                // Set time on date change, if time was empty.\n                this.el_time.value = this.isotime();\n            }\n            this.update();\n        });\n\n        const date_options = {\n            behavior: \"native\",\n            format: this.options.format,\n            weekNumbers: this.options.weekNumbers,\n            firstDay: this.options.firstDay,\n        };\n        await DatePicker.init(this.el_date, date_options);\n\n        if (this.options.today) {\n            const btn_now = el_wrapper.querySelector(\"._btn._now\");\n            btn_now.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                this.el_date.value = this.isodate();\n                this.el_time.value = this.isotime();\n                this.update();\n            });\n        }\n\n        if (this.options.clear) {\n            const btn_clear = el_wrapper.querySelector(\"._btn._clear\");\n            btn_clear.addEventListener(\"click\", (e) => {\n                e.preventDefault();\n                this.el_date.value = \"\";\n                this.el_time.value = \"\";\n                this.update();\n            });\n        }\n\n        // TODO: timezone\n        el.parentNode.insertBefore(el_wrapper, el);\n    },\n\n    update() {\n        if (this.el_date.value && this.el_time.value) {\n            this.el.value = `${this.el_date.value}T${this.el_time.value}`;\n        } else {\n            this.el.value = \"\";\n        }\n        this.el.dispatchEvent(new Event(\"change\", { bubbles: true, cancelable: true }));\n    },\n\n    isodate() {\n        const now = new Date();\n        return now.toISOString().substr(0, 10);\n    },\n\n    isotime() {\n        const now = new Date();\n        return now.toTimeString().substr(0, 5);\n    },\n});\n","// Patterns validate - Form vlidation\nimport \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport { BasePattern } from \"../../core/basepattern\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport logging from \"../../core/logging\";\nimport utils from \"../../core/utils\";\nimport registry from \"../../core/registry\";\n\nconst logger = logging.getLogger(\"pat-validation\");\n\n\nexport const parser = new Parser(\"validation\");\nparser.addArgument(\"disable-selector\", \"[type=submit], button:not([type=button])\"); // Elements which must be disabled if there are errors\nparser.addArgument(\"message-date\", \"\"); // \"This value must be a valid date\"\nparser.addArgument(\"message-datetime\", \"\"); // \"This value must be a valid date and time\"\nparser.addArgument(\"message-email\", \"\"); // \"This value must be a valid email address\"\nparser.addArgument(\"message-max\", \"\"); // \"This value must be less than or equal to %{count}\"\nparser.addArgument(\"message-min\", \"\"); // \"This value must be greater than or equal to %{count}\"\nparser.addArgument(\"message-number\", \"\"); // \"This value must be a number\"\nparser.addArgument(\"message-required\", \"\"); // \"This field is required\"\nparser.addArgument(\"message-equality\", \"is not equal to %{attribute}.\");\nparser.addArgument(\"not-after\", null);\nparser.addArgument(\"not-before\", null);\nparser.addArgument(\"equality\", null);\nparser.addArgument(\"delay\", 100); // Delay before validation is done to avoid validating while typing.\n\n// Aliases\nparser.addAlias(\"message-integer\", \"message-number\");\n\nconst KEY_ERROR_EL = \"__patternslib__input__error__el\";\nconst KEY_ERROR_MSG = \"__patternslib__input__error__msg\";\n\nclass Pattern extends BasePattern {\n    static name = \"validation\";\n    static trigger = \"form.pat-validation\";\n    static parser = parser;\n\n    init() {\n        events.add_event_listener(\n            this.el,\n            \"submit\",\n            `pat-validation--submit--validator`,\n            (e) => {\n                // On submit, check all.\n                // Immediate, non-debounced check with submit. Otherwise submit\n                // is not cancelable.\n                for (const input of this.inputs) {\n                    logger.debug(\"Checking input for submit\", input, e);\n                    this.check_input({ input: input, event: e });\n                }\n            },\n            // Make sure this event handler is run early, in the capturing\n            // phase in order to be able to cancel later non-capturing submit\n            // events.\n            { capture: true }\n        );\n\n        this.initialize_inputs();\n        $(this.el).on(\"pat-update\", () => {\n            this.initialize_inputs();\n        });\n\n        // Set ``novalidate`` attribute to disable the browser's validation\n        // bubbles but not disable the validation API.\n        this.el.setAttribute(\"novalidate\", \"\");\n    }\n\n    initialize_inputs() {\n        this.inputs = [\n            ...this.el.querySelectorAll(\"input[name], select[name], textarea[name]\"),\n        ];\n        this.disabled_elements = [\n            ...this.el.querySelectorAll(this.options.disableSelector),\n        ];\n\n        for (const [cnt, input] of this.inputs.entries()) {\n            // Cancelable debouncer.\n            const debouncer = utils.debounce((e) => {\n                logger.debug(\"Checking input for event\", input, e);\n                this.check_input({ input: input, event: e });\n            }, this.options.delay);\n\n            events.add_event_listener(\n                input,\n                \"input\",\n                `pat-validation--input-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n            events.add_event_listener(\n                input,\n                \"change\",\n                `pat-validation--change-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n            events.add_event_listener(\n                input,\n                \"blur\",\n                `pat-validation--blur-${input.name}--${cnt}--validator`,\n                (e) => debouncer(e)\n            );\n        }\n    }\n\n    check_input({ input, event, stop = false }) {\n        if (input.disabled) {\n            // No need to check disabled inputs.\n            return;\n        }\n\n        // In any case, clear the custom validity first.\n        this.set_error({ input: input, msg: \"\", skip_event: true });\n        const validity_state = input.validity;\n\n        if (event?.submitter?.hasAttribute(\"formnovalidate\")) {\n            // Do not check when a button with ``formnovalidate`` was used.\n            return;\n        }\n\n        logger.debug(`validity_state: `, validity_state);\n\n        const input_options = parser.parse(input);\n\n        if (validity_state.valid) {\n            // Custom error cases or no invalid state.\n\n            if (\n                input_options.equality &&\n                this.el.querySelector(`[name=${input_options.equality}]`)?.value !==\n                    input.value\n            ) {\n                const message =\n                    input_options.message.equality ||\n                    `The value is not equal to %{attribute}`;\n                this.set_error({\n                    input: input,\n                    msg: message,\n                    attribute: input_options.equality,\n                });\n            } else if (input_options.not.after || input_options.not.before) {\n                const msg = input_options.message.date || input_options.message.datetime;\n                const msg_default_not_before = \"The date must be after %{attribute}\";\n                const msg_default_not_after = \"The date must be before %{attribute}\";\n\n                let not_after;\n                let not_after_el;\n                if (input_options.not.after) {\n                    if (utils.is_iso_date_time(input_options.not.after, true)) {\n                        not_after = new Date(input_options.not.after);\n                    } else {\n                        // Handle value as selector\n                        not_after_el = document.querySelector(input_options.not.after);\n                        not_after = not_after_el?.value\n                            ? new Date(not_after_el?.value)\n                            : undefined;\n                    }\n\n                    // Use null if no valid date.\n                    not_after = isNaN(not_after) ? null : not_after;\n                }\n\n                let not_before;\n                let not_before_el;\n                if (input_options.not.before) {\n                    if (utils.is_iso_date_time(input_options.not.before, true)) {\n                        not_before = new Date(input_options.not.before);\n                    } else {\n                        // Handle value as selector\n                        not_before_el = document.querySelector(input_options.not.before);\n                        not_before = not_before_el?.value\n                            ? new Date(not_before_el?.value)\n                            : undefined;\n                    }\n\n                    // Use null if no valid date.\n                    not_before = isNaN(not_before) ? null : not_before;\n                }\n\n                if (\n                    input.value &&\n                    utils.is_iso_date_time(input.value, true) &&\n                    !isNaN(new Date(input.value))\n                ) {\n                    // That's 1 valid date!\n                    const date = new Date(input.value);\n\n                    if (not_after && date > not_after) {\n                        let msg_attr;\n                        // Try to construct a meaningfull error message\n                        if (!not_after_el && input_options.not.after) {\n                            // fixed date case\n                            msg_attr = input_options.not.after;\n                        } else {\n                            // Get the label + other text content within the\n                            // label and replace all whitespace and newlines\n                            // with a single space.\n                            msg_attr = not_after_el?.labels?.[0]?.textContent.replace(\n                                /\\s\\s+/g, // replace all whitespace\n                                \" \" // with a single space\n                            );\n                            msg_attr = msg_attr || not_after_el.name;\n                        }\n                        this.set_error({\n                            input: input,\n                            msg: msg || msg_default_not_after,\n                            attribute: msg_attr.trim(),\n                        });\n                    } else if (not_before && date < not_before) {\n                        let msg_attr;\n                        // Try to construct a meaningfull error message\n                        if (!not_before_el && input_options.not.before) {\n                            // fixed date case\n                            msg_attr = input_options.not.before;\n                        } else {\n                            // Get the label + other text content within the\n                            // label and replace all whitespace and newlines\n                            // with a single space.\n                            msg_attr = not_before_el?.labels?.[0]?.textContent.replace(\n                                /\\s\\s+/g, // replace all whitespace\n                                \" \" // with a single space\n                            );\n                            msg_attr = msg_attr || not_before_el.name;\n                        }\n                        this.set_error({\n                            input: input,\n                            msg: msg || msg_default_not_before,\n                            attribute: msg_attr.trim(),\n                        });\n                    }\n                }\n\n                // always check the other input to clear/set errors\n                // do not re-check when stop is set to avoid infinite loops\n                if (!stop && not_after_el) {\n                    logger.debug(\"Check `not-after` input.\", not_after_el);\n                    this.check_input({ input: not_after_el, stop: true });\n                }\n                if (!stop && not_before_el) {\n                    logger.debug(\"Check `no-before` input.\", not_after_el);\n                    this.check_input({ input: not_before_el, stop: true });\n                }\n            }\n\n            if (!validity_state.customError) {\n                // No error to handle. Return.\n                this.remove_error(input, true);\n                return;\n            }\n        } else {\n            // Default error cases with custom messages.\n\n            if (validity_state.valueMissing && input_options.message.required) {\n                this.set_error({ input: input, msg: input_options.message.required });\n            } else if (validity_state.rangeUnderflow && input_options.message.min) {\n                this.set_error({\n                    input: input,\n                    msg: input_options.message.min,\n                    min: input.getAttribute(\"min\"),\n                });\n            } else if (validity_state.rangeOverflow && input_options.message.max) {\n                this.set_error({\n                    input: input,\n                    msg: input_options.message.max,\n                    max: input.getAttribute(\"max\"),\n                });\n            } else if (\n                (validity_state.badInput || validity_state.stepMismatch) &&\n                input.type === \"number\" &&\n                input_options.message.number\n            ) {\n                this.set_error({ input: input, msg: input_options.message.number });\n            } else if (\n                validity_state.typeMismatch &&\n                input.type === \"email\" &&\n                input_options.message.email\n            ) {\n                this.set_error({ input: input, msg: input_options.message.email });\n            } else if (\n                validity_state.rangeUnderflow &&\n                input.type === \"date\" &&\n                input_options.message.date\n            ) {\n                this.set_error({ input: input, msg: input_options.message.date });\n            } else if (\n                validity_state.rangeOverflow &&\n                input.type === \"date\" &&\n                input_options.message.date\n            ) {\n                this.set_error({ input: input, msg: input_options.message.date });\n            } else if (\n                validity_state.rangeUnderflow &&\n                input.type === \"datetime\" &&\n                input_options.message.datetime\n            ) {\n                this.set_error({ input: input, msg: input_options.message.datetime });\n            } else if (\n                validity_state.rangeOverflow &&\n                input.type === \"datetime\" &&\n                input_options.message.datetime\n            ) {\n                this.set_error({ input: input, msg: input_options.message.datetime });\n            } else {\n                // Still an error, but without customized messages.\n                // Call `emit_update` separately\n                this.emit_update(\"invalid\");\n            }\n\n        }\n\n        if (event?.type === \"submit\") {\n            // Do not submit in error case and prevent other handlers to take action.\n            event.preventDefault();\n            event.stopPropagation();\n            event.stopImmediatePropagation();\n        }\n        this.set_error_message(input);\n    }\n\n    set_error({ input, msg, attribute = null, min = null, max = null, skip_event = false }) {\n        // Replace some variables, as like validate.js\n        if (attribute) {\n            msg = msg.replace(/%{attribute}/g, attribute);\n        }\n        if (min) {\n            msg = msg.replace(/%{count}/g, min);\n        }\n        if (max) {\n            msg = msg.replace(/%{count}/g, max);\n        }\n        msg = msg.replace(/%{value}/g, JSON.stringify(input.value));\n\n        input.setCustomValidity(msg);\n        // Store the error message on the input.\n        // Hidden inputs do not participate in validation but we need this\n        // (e.g. styled date input).\n        input[KEY_ERROR_MSG] = msg;\n\n        if (!skip_event) {\n            this.emit_update(\"invalid\");\n        }\n    }\n\n    remove_error(input, all_of_group = false, skip_event = false) {\n        // Remove error message and related referencesfrom input.\n\n        let inputs = [input];\n        if (all_of_group) {\n            // Get all inputs with the same name - e.g. radio buttons, checkboxes.\n            inputs = this.inputs.filter((it) => it.name === input.name);\n        }\n        for (const it of inputs) {\n            const error_node = it[KEY_ERROR_EL];\n            it[KEY_ERROR_EL] = null;\n            error_node?.remove();\n        }\n\n        // disable selector\n        if (this.el.checkValidity()) {\n            for (const it of this.disabled_elements) {\n                if (it.disabled) {\n                    it.removeAttribute(\"disabled\");\n                    it.classList.remove(\"disabled\");\n                }\n            }\n        }\n\n        if (!skip_event) {\n            this.emit_update(\"valid\");\n        }\n    }\n\n    set_error_message(input) {\n        // First, remove the old error message.\n        this.remove_error(input, false, true);\n\n        // Do not set a error message for a input group like radio buttons or\n        // checkboxes where one has already been set.\n        const inputs = this.inputs.filter((it) => it.name === input.name);\n        if (inputs.length > 1 && inputs.some((it) => !!it[KEY_ERROR_EL])) {\n            // error message for input group already set.\n            return;\n        }\n\n        // Create the validation error DOM node from the template\n        const validation_message = input.validationMessage || input[KEY_ERROR_MSG];\n        const error_node = dom.create_from_string(\n            this.error_template(validation_message)\n        ).firstChild;\n\n        let fieldset;\n        if (input.type === \"radio\" || input.type === \"checkbox\") {\n            fieldset = input.closest(\"fieldset.pat-checklist\");\n        }\n        if (fieldset) {\n            fieldset.append(error_node);\n        } else {\n            input.after(error_node);\n        }\n        input[KEY_ERROR_EL] = error_node;\n\n        let did_disable = false;\n        for (const it of this.disabled_elements) {\n            // Disable for melements if they are not already disabled and which\n            // do not have set the `formnovalidate` attribute, e.g.\n            // `<button formnovalidate>cancel</button>`.\n            if (!it.disabled && !it.formNoValidate) {\n                did_disable = true;\n                it.setAttribute(\"disabled\", \"disabled\");\n                it.classList.add(\"disabled\");\n                logger.debug(\"Disable element\", it);\n            }\n        }\n\n        // Do an initial check of the whole form when a form element (e.g. the\n        // submit button) was disabled. We want to show the user all possible\n        // errors at once and after the submit button is disabled there is no\n        // way to check the whole form at once. ... well we also do not want to\n        // check the whole form when one input was changed....\n        if (did_disable) {\n            logger.debug(\"Checking whole form after element was disabled.\");\n            for (const _input of this.inputs.filter((it) => it !== input)) {\n                this.check_input({ input: _input, stop: true });\n            }\n        }\n    }\n\n    error_template(message) {\n        // Template for the validation message\n        return `<em class=\"validation warning message\">${message}</em>`;\n    }\n}\n\nregistry.register(Pattern);\n\nexport default Pattern;\nexport { Pattern };\n","import { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport events from \"@patternslib/patternslib/src/core/events\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\nexport const parser = new Parser(\"code-editor\");\nparser.addArgument(\"language\", null); // programming language to use.\nparser.addArgument(\"linenumbers\", false);\nparser.addArgument(\"theme\", \"dark\"); // dark or light or any other theme variant.\n\n// CodeJar options\nparser.addArgument(\"tab\", \"    \"); // The tab-string. \"\\t\" for real tabs.\nparser.addArgument(\"indent-on\", \"{$\");\nparser.addArgument(\"spellcheck\", false);\nparser.addArgument(\"catch-tab\", true);\nparser.addArgument(\"preserve-ident\", true);\nparser.addArgument(\"add-closing\", true);\nparser.addArgument(\"history\", true);\n\nconst language_mapping = {\n    atom: \"xml\",\n    html: \"xml\",\n    plist: \"xml\",\n    rss: \"xml\",\n    svg: \"xml\",\n    wsf: \"xml\",\n    xhtml: \"xml\",\n    xjb: \"xml\",\n    xsd: \"xml\",\n    xsl: \"xml\",\n};\n\nclass Pattern extends BasePattern {\n    static name = \"code-editor\";\n    static trigger = \".pat-code-editor\";\n    static parser = parser;\n\n    async init() {\n        const CodeJar = (await import(\"codejar\")).CodeJar;\n        const hljs = (await import(\"highlight.js/lib/core\")).default;\n        let el = this.el;\n\n        // Set and load the theme.\n        let theme;\n        if (this.options.theme === \"light\") {\n            theme = \"stackoverflow-light\";\n        } else if (this.options.theme === \"dark\" || this.options.theme === \"okaidia\") {\n            theme = \"stackoverflow-dark\";\n        } else {\n            theme = this.options.theme;\n        }\n\n        // Need to await the style import, otherwise theme might not be applied.\n        await import(`highlight.js/styles/${theme}.css`);\n        if (window.__patternslib_import_styles) {\n            await import(\"./_code-editor.scss\");\n        }\n\n        // Custom hightlighting function, as of:\n        // https://github.com/antonmedv/codejar/blob/master/index.html\n        const highlight = (editor) => {\n            // highlight.js does not trim old tags,\n            // let's do it by this hack.\n            editor.textContent = editor.textContent;\n            hljs.highlightElement(editor);\n        };\n        let highlight_wrapper = highlight;\n\n        // Optional line numbers.\n        if (this.options.linenumbers) {\n            const linenumbers = (await import(\"codejar/linenumbers\")).withLineNumbers;\n            highlight_wrapper = linenumbers(highlight, {\n                class: `codejar-linenumbers ${theme}`,\n            });\n        }\n\n        // Import and register the language.\n        let language = [...el.classList].filter((it) => it.startsWith(\"language-\"))[0];\n        language = language ? language.replace(\"language-\", \"\") : this.options.language;\n        language = language || \"plaintext\";\n        const hljs_language = (\n            await import(\n                `highlight.js/lib/languages/${language_mapping[language] || language}`\n            )\n        ).default;\n        hljs.registerLanguage(language, hljs_language);\n\n        // Create a editor element in case of an input element.\n        if ([\"textarea\", \"input\"].includes(this.el.nodeName.toLowerCase())) {\n            const pre_el = document.createElement(\"pre\");\n            pre_el.innerHTML = `<code contenteditable></code>`;\n            el = pre_el.querySelector(\"code\");\n            el.textContent = this.el.value; // value is already unescaped.\n            this.el.parentNode.insertBefore(pre_el, this.el);\n            this.el.setAttribute(\"hidden\", \"\");\n        }\n\n        // Add some classes to the editor element.\n        el.classList.add(\n            \"code-editor\",\n            `theme-${this.options.theme}`,\n            `language-${language}`\n        );\n\n        // Allow spaces within quotes to be added as tab argument.\n        // Replace escaped tab character with real tab.\n        const tab = this.options.tab\n            .replace(/'/g, \"\") // Allow spaces within quotes\n            .replace(/\"/g, \"\")\n            .replace(/\\\\t/g, \"\\t\"); // Replace double escaped tab character\n\n        // Create the editor.\n        const config = {\n            tab: tab,\n            indentOn: new RegExp(this.options.indentOn),\n            spellcheck: this.options.spellcheck,\n            catchTab: this.options.catchTab,\n            preserveIdent: this.options.preserveIdent,\n            addClosing: this.options.addClosing,\n            history: this.options.history,\n        };\n        this.codeeditor = CodeJar(el, highlight_wrapper, config);\n\n        // Update the input element.\n        if (el !== this.el) {\n            // Update <textarea> or <input>, if one of these were the\n            // initializing elements.\n            this.codeeditor.onUpdate((code) => {\n                this.el.value = code.trim();\n                this.el.dispatchEvent(events.input_event());\n            });\n        }\n    }\n}\n\nregistry.register(Pattern);\n\nexport default Pattern;\nexport { Pattern };\n","import \"../../core/polyfills\"; // SubmitEvent.submitter for Safari < 15.4 and jsDOM\nimport $ from \"jquery\";\nimport ajax from \"../ajax/ajax\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport registry from \"../../core/registry\";\nimport create_uuid from \"../../core/uuid\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"pat.inject\");\n//log.setLevel(logging.Level.DEBUG);\n\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\n\nexport const parser = new Parser(\"inject\");\nparser.addArgument(\"default-selector\");\nparser.addArgument(\"target\");\nparser.addArgument(\"data-type\", \"html\");\nparser.addArgument(\"next-href\");\nparser.addArgument(\"source\");\nparser.addArgument(\"trigger\", \"default\", [\n    \"default\",\n    \"autoload\",\n    \"autoload-visible\",\n    \"idle\",\n]);\nparser.addArgument(\"delay\"); // only used in autoload\nparser.addArgument(\"browser-cache\", \"no-cache\", [\"cache\", \"no-cache\"]); // Cache ajax requests. Pass to pat-ajax.\nparser.addArgument(\"confirm\", \"class\", [\"never\", \"always\", \"form-data\", \"class\"]);\nparser.addArgument(\"confirm-message\", \"Are you sure you want to leave this page?\");\nparser.addArgument(\"loading-class\", \"injecting\"); // Add a class to the target while content is still loading.\nparser.addArgument(\"executing-class\", \"executing\"); // Add a class to the element while content is still loading.\nparser.addArgument(\"executed-class\", \"executed\"); // Add a class to the element when content is loaded.\nparser.addArgument(\"class\"); // Add a class to the injected content.\nparser.addArgument(\"history\", \"none\", [\"none\", \"record\"]);\nparser.addArgument(\"push-marker\");\nparser.addArgument(\"scroll\");\n\n// Note: this should not be here but the parser would bail on unknown\n// parameters and expand/collapsible need to pass the url to us.\nparser.addArgument(\"url\");\n\nconst inject = {\n    name: \"inject\",\n    trigger: \"a.pat-inject, form.pat-inject, .pat-subform.pat-inject\",\n    parser: parser,\n\n    async init($el, opts) {\n        // We need to wait a tick. Modern BasePattern based patterns like\n        // pat-validation do always wait a tick before initializing. The\n        // patterns registry always initializes pat-validation first but since\n        // it is waiting a tick the event handlers are registerd after the ones\n        // from pat-inject. Waiting a tick in pat-inject solves this -\n        // pat-validation's event handlers are initialized first.\n        await utils.timeout(1);\n\n        const el = utils.jqToNode($el);\n\n        const cfgs = this.extractConfig($el, opts);\n        if (cfgs.some((e) => e.history === \"record\") && !(\"pushState\" in history)) {\n            // if the injection shall add a history entry and HTML5 pushState\n            // is missing, then don't initialize the injection.\n            log.warn(\"HTML5 pushState is missing, aborting\");\n            return $el;\n        }\n        $el.data(\"pat-inject\", cfgs);\n\n        if (cfgs[0].nextHref && cfgs[0].nextHref.indexOf(\"#\") === 0) {\n            // In case the next href is an anchor, and it already\n            // exists in the page, we do not activate the injection\n            // but instead just change the anchors href.\n\n            // Note: This is used in only one project for linked fullcalendars,\n            // it's sanity is wonky and we should probably solve it differently.\n            if (el.nodeName === \"A\" && $(cfgs[0].nextHref).length > 0) {\n                log.debug(\n                    \"Skipping as next href is anchor, which already exists\",\n                    cfgs[0].nextHref\n                );\n                // TODO: reconsider how the injection enters exhausted state\n                el.setAttribute(\n                    \"href\",\n                    (window.location.href.split(\"#\")[0] || \"\") + cfgs[0].nextHref\n                );\n                return $el;\n            }\n        }\n        if (cfgs[0].pushMarker) {\n            $(\"body\").on(\"push\", (event, data) => {\n                log.debug(\"received push message: \" + data);\n                if (data == cfgs[0].pushMarker) {\n                    log.debug(\"re-injecting \" + data);\n                    this.onTrigger({ currentTarget: el });\n                }\n            });\n        }\n        if (cfgs[0].idleTrigger) {\n            this._initIdleTrigger($el, cfgs[0].idleTrigger);\n        } else {\n            switch (cfgs[0].trigger) {\n                case \"default\":\n                    for (const cfg of cfgs) {\n                        if (cfg.delay) {\n                            cfg.processDelay = cfg.delay;\n                        }\n                    }\n                    // setup event handlers\n                    if (el?.nodeName === \"FORM\") {\n                        log.debug(\"Initializing form with injection on\", el);\n                        events.add_event_listener(\n                            el,\n                            \"submit\",\n                            \"pat-inject--form-submit\",\n                            (e) => {\n                                if (\n                                    e.submitter?.matches(\n                                        \"[type=submit], button:not([type=button]), [type=image]\"\n                                    )\n                                ) {\n                                    // make sure the submitting button is sent\n                                    // with the form\n                                    ajax.onClickSubmit(e);\n                                }\n                                this.onTrigger(e);\n                            }\n                        );\n                    } else if (el?.matches(\".pat-subform\")) {\n                        log.debug(\"Initializing subform with injection\");\n                    } else {\n                        $el.on(\"click.pat-inject\", this.onTrigger.bind(this));\n                    }\n                    break;\n                case \"autoload\":\n                    if (!cfgs[0].delay) {\n                        this.onTrigger({ currentTarget: el });\n                    } else {\n                        // generate UUID\n                        const uuid = create_uuid();\n                        el.setAttribute(\"data-pat-inject-uuid\", uuid);\n\n                        // function to trigger the autoload and mark as triggered\n                        const delayed_trigger = (uuid_) => {\n                            // Check if the element has been removed from the dom\n                            const still_there = document.querySelector(\n                                `[data-pat-inject-uuid=\"${uuid_}\"]`\n                            );\n                            if (!still_there) {\n                                return false;\n                            }\n\n                            $el.data(\"pat-inject-autoloaded\", true);\n                            this.onTrigger({ currentTarget: el });\n                            // Cleanup again.\n                            still_there.removeAttribute(\"data-pat-inject-uuid\");\n                            return true;\n                        };\n                        window.setTimeout(\n                            delayed_trigger.bind(null, uuid),\n                            cfgs[0].delay\n                        );\n                    }\n                    break;\n                case \"autoload-visible\":\n                    this._initAutoloadVisible($el, cfgs);\n                    break;\n                case \"idle\":\n                    this._initIdleTrigger($el, cfgs[0].delay);\n                    break;\n            }\n        }\n\n        log.debug(\"initialised:\", el);\n        return $el;\n    },\n\n    destroy($el) {\n        $el.off(\".pat-inject\");\n        $el.data(\"pat-inject\", null);\n        return $el;\n    },\n\n    onTrigger(e) {\n        /* Injection has been triggered, either via form submission or a\n         * link has been clicked.\n         */\n\n        // Prevent the original event from doing it's work.\n        // We want an AJAX request instead.\n        e.preventDefault && e.preventDefault();\n\n        const el = e.currentTarget;\n        const $el = $(el);\n        let cfgs = $el.data(\"pat-inject\");\n        if (el.nodeName === \"FORM\" && e.type === \"submit\") {\n            const form = el;\n            const submitter = e.submitter;\n\n            // Do not submit invalid forms, if validation is active.\n            // Works with native form validation and with pat-validation.\n            if (\n                !submitter?.matches(\"[formnovalidate]\") &&\n                !form.matches(\"[novalidate]\") &&\n                form.matches(\":invalid\")\n            ) {\n                log.debug(\"Form is invalid, aborting\");\n                return;\n            }\n\n            const formaction = submitter?.getAttribute(\"formaction\");\n            if (formaction) {\n                const opts = {\n                    url: formaction,\n                };\n\n                // Support custom data-pat-inject on formaction buttons.\n                const cfg_node = submitter.closest(\"[data-pat-inject]\");\n                cfgs = this.extractConfig($(cfg_node), opts);\n            }\n\n            // store the params of the form in the config, to be used by history\n            for (const cfg of cfgs) {\n                cfg.params = $.param($el.serializeArray());\n            }\n        }\n\n        $el.trigger(\"patterns-inject-triggered\");\n        this.execute(cfgs, $el);\n    },\n\n    submitSubform($sub) {\n        /* This method is called from pat-subform\n         */\n        const $el = $($sub[0].closest(\"form\"));\n        const cfgs = $sub.data(\"pat-inject\");\n\n        // store the params of the subform in the config, to be used by history\n        for (const cfg of cfgs) {\n            cfg.params = $.param($sub.serializeArray());\n        }\n\n        try {\n            $el.trigger(\"patterns-inject-triggered\");\n        } catch (e) {\n            log.error(\"patterns-inject-triggered\", e);\n        }\n        this.execute(cfgs, $el);\n    },\n\n    extractConfig($el, options = {}) {\n        const el = utils.jqToNode($el);\n        options = Object.assign({}, options); // copy\n\n        const cfgs = parser.parse($el, options, true);\n        for (const cfg of cfgs) {\n            cfg.$context = $el;\n            // options and cfg have priority, fall back to href/action\n            cfg.url =\n                options.url ||\n                cfg.url ||\n                el?.getAttribute(\"href\") ||\n                el?.getAttribute(\"action\") ||\n                el?.closest(\"form\")?.getAttribute(\"action\") ||\n                \"\";\n\n            // separate selector from url\n            const urlparts = cfg.url.split(\"#\");\n            cfg.url = urlparts[0];\n\n            if (urlparts.length > 2) {\n                log.warn(\"Ignoring additional source ids:\", urlparts.slice(2));\n            }\n\n            if (!cfg.defaultSelector) {\n                // if no selector, check for selector as part of original url\n                cfg.defaultSelector = (urlparts[1] && \"#\" + urlparts[1]) || \"body\";\n            }\n            if (cfg.delay) {\n                try {\n                    cfg.delay = utils.parseTime(cfg.delay);\n                } catch {\n                    log.warn(\"Invalid delay value: \", cfg.delay);\n                    cfg.delay = null;\n                }\n            }\n            cfg.processDelay = 0;\n        }\n        return cfgs;\n    },\n\n    elementIsDirty(m) {\n        /* Check whether the passed in form element contains a value.\n         */\n        const data = $.map(m.find(\":input:not(select)\"), (i) => {\n            const val = $(i).val();\n            return Boolean(val) && val !== $(i).attr(\"placeholder\");\n        });\n        return $.inArray(true, data) !== -1;\n    },\n\n    askForConfirmation(cfgs) {\n        /* If configured to do so, show a confirmation dialog to the user.\n         * This is done before attempting to perform injection.\n         */\n        let should_confirm = false;\n        let message;\n\n        for (const cfg of cfgs) {\n            let _confirm = false;\n            if (cfg.confirm == \"always\") {\n                _confirm = true;\n            } else if (\n                cfg.confirm === \"form-data\" &&\n                cfg.target &&\n                cfg.target !== \"none\"\n            ) {\n                _confirm = this.elementIsDirty(cfg.$target);\n            } else if (cfg.confirm === \"class\" && cfg.target && cfg.target !== \"none\") {\n                _confirm = cfg.$target.hasClass(\"is-dirty\");\n            }\n            if (_confirm) {\n                should_confirm = true;\n                message = cfg.confirmMessage;\n            }\n        }\n        if (should_confirm) {\n            if (!window.confirm(message)) {\n                return false;\n            }\n        }\n        return true;\n    },\n\n    ensureTarget(cfg) {\n        /* Make sure that a target element exists and that it's assigned to\n         * cfg.$target.\n         */\n        // make sure target exist\n        if (cfg.target === \"none\") {\n            // special case, we don't want to inject anything\n            return true;\n        }\n        cfg.$target =\n            cfg.$target || (cfg.target === \"self\" ? cfg.$context : $(cfg.target));\n        if (cfg.$target.length === 0) {\n            if (!cfg.target) {\n                log.error(\"Need target selector\", cfg);\n                return false;\n            }\n            cfg.$target = this.createTarget(cfg.target);\n            cfg.$created_target = cfg.$target;\n        }\n        return true;\n    },\n\n    verifySingleConfig(url, cfg) {\n        /* Verify one of potentially multiple configs (i.e. argument lists).\n         *\n         * Extract modifiers such as ::element or ::after.\n         * Ensure that a target element exists.\n         */\n        if (cfg.url !== url) {\n            // in case of multi-injection, all injections need to use\n            // the same url\n            log.error(\"Unsupported different urls for multi-inject\");\n            return false;\n        }\n        // defaults\n        cfg.source = cfg.source || cfg.defaultSelector;\n        cfg.target = cfg.target || cfg.defaultSelector;\n\n        if (!this.extractModifiers(cfg)) {\n            return false;\n        }\n        if (!this.ensureTarget(cfg)) {\n            return false;\n        }\n        this.listenForFormReset(cfg);\n        return true;\n    },\n\n    verifyConfig(cfgs) {\n        /* Verify and post-process all the configurations.\n         * Each \"config\" is an arguments list separated by the &&\n         * combination operator.\n         *\n         * In case of multi-injection, only one URL is allowed, which\n         * should be specified in the first config (i.e. arguments list).\n         *\n         * Verification for each cfg in the array needs to succeed.\n         */\n        return cfgs.every((cfg) => this.verifySingleConfig(cfgs[0].url, cfg));\n    },\n\n    listenForFormReset(cfg) {\n        /* if pat-inject is used to populate target in some form and when\n         * Cancel button is pressed (this triggers reset event on the\n         * form) you would expect to populate with initial placeholder\n         */\n        if (cfg.target === \"none\") {\n            // Special case, we don't want to display any return value.\n            return;\n        }\n        const $form = cfg.$target.parents(\"form\");\n        if ($form.length !== 0 && cfg.$target.data(\"initial-value\") === undefined) {\n            cfg.$target.data(\"initial-value\", cfg.$target.html());\n            $form.on(\"reset\", () => {\n                cfg.$target.html(cfg.$target.data(\"initial-value\"));\n            });\n        }\n    },\n\n    extractModifiers(cfg) {\n        /* The user can add modifiers to the source and target arguments.\n         * Modifiers such as ::element, ::before and ::after.\n         * We identifiy and extract these modifiers here.\n         */\n        const source_re = /^(.*?)(::element)?$/;\n        const target_re = /^(.*?)(::element)?(::after|::before)?$/;\n        const source_match = source_re.exec(cfg.source);\n        const target_match = target_re.exec(cfg.target);\n\n        cfg.source = source_match[1];\n        cfg.sourceMod = source_match[2] ? \"element\" : \"content\";\n        cfg.target = target_match[1];\n        const targetMod = target_match[2] ? \"element\" : \"content\";\n        const targetPosition = (target_match[3] || \"::\").slice(2); // position relative to target\n\n        if (cfg.loadingClass) {\n            cfg.loadingClass += \" \" + cfg.loadingClass + \"-\" + targetMod;\n            if (targetPosition && cfg.loadingClass) {\n                cfg.loadingClass += \" \" + cfg.loadingClass + \"-\" + targetPosition;\n            }\n        }\n        cfg.action = targetMod + targetPosition;\n        // Once we start detecting illegal combinations, we'll\n        // return false in case of error\n        return true;\n    },\n\n    createTarget(selector) {\n        /* create a target that matches the selector\n         *\n         * Note: so far we only support #target and create a div with that id\n         * appended to the body.\n         */\n        if (selector.slice(0, 1) !== \"#\") {\n            log.error(\"only id supported for non-existing target\");\n            return null;\n        }\n        const $target = $(\"<div />\").attr({ id: selector.slice(1) });\n        $(\"body\").append($target);\n        return $target;\n    },\n\n    _performInjection(target, $el, $sources, cfg, trigger, $title) {\n        /* Called after the XHR has succeeded and we have a new $sources\n         * element to inject.\n         */\n        const wrapper = document.createElement(\"template\");\n        if ($sources.length > 0) {\n            const method = cfg.sourceMod === \"content\" ? \"innerHTML\" : \"outerHTML\";\n            // There might be multiple sources, so we need to loop over them.\n            // Access them with \"innerHTML\" or \"outerHTML\" depending on the sourceMod.\n            const sources_string = [...$sources].map(source => source[method]).join(\"\\n\");\n            wrapper.innerHTML = sources_string;\n\n            for (const img of wrapper.content.querySelectorAll(\"img\")) {\n                events.add_event_listener(\n                    img,\n                    \"load\",\n                    \"inject_img_load\",\n                    (e) => {\n                        $(e.currentTarget).trigger(\"pat-inject-content-loaded\");\n                    },\n                    { once: true }\n                );\n            }\n        }\n\n        // Copy, because after insertion wrapper.children is empty.\n        const source_nodes = [...wrapper.content.childNodes];\n\n        // Now the injection actually happens.\n        if (this._inject(trigger, source_nodes, target, cfg)) {\n            // Update history\n            this._update_history(cfg, trigger, $title);\n            // Post-injection\n            this._afterInjection($el, cfg.$created_target || $(source_nodes), cfg);\n        }\n    },\n\n    _update_history(cfg, trigger, $title) {\n        // History support. if subform is submitted, append form params\n        if (cfg.history !== \"record\" || !history?.pushState) {\n            return;\n        }\n        let url = cfg.url;\n        if (cfg.params) {\n            const glue = url.indexOf(\"?\") > -1 ? \"&\" : \"?\";\n            url = `${url}${glue}${cfg.params}`;\n        }\n        history.pushState({ url: url }, \"\", url);\n        // Also inject title element if we have one\n        if ($title?.length) {\n            const title_el = document.querySelector(\"title\");\n            if (title_el) {\n                this._inject(trigger, $title, title_el, {\n                    action: \"element\",\n                });\n            }\n        }\n    },\n\n    _afterInjection($el, $injected, cfg) {\n        /* Set a class on the injected elements and fire the\n         * patterns-injected event.\n         */\n        const el = utils.jqToNode($el);\n        $injected\n            .filter((idx, el_) => {\n                return el_.nodeType !== TEXT_NODE;\n            })\n            .data(\"pat-injected\", { origin: cfg.url });\n\n        if ($injected.length === 1 && $injected[0].nodeType == TEXT_NODE) {\n            // Only one element injected, and it was a text node.\n            // So we trigger \"patterns-injected\" on the parent.\n            // The event handler should check whether the\n            // injected element and the triggered element are\n            // the same.\n            $injected.parent().trigger(\"patterns-injected\", [cfg, el, $injected[0]]);\n        } else {\n            $injected.each((idx, el_) => {\n                // patterns-injected event will be triggered for each injected (non-text) element.\n                if (el_.nodeType !== TEXT_NODE) {\n                    $(el_)\n                        .addClass(cfg[\"class\"])\n                        .trigger(\"patterns-injected\", [cfg, el, el_]);\n                }\n            });\n        }\n\n        if (cfg.scroll && cfg.scroll !== \"none\") {\n            // Get the scroll target for\n            // 1) finding the scroll container\n            // 2) getting the element to scroll to (if not \"top\")\n            const scroll_target = [\"top\", \"target\"].includes(cfg.scroll)\n                ? cfg.$target[0]\n                : dom.querySelectorAllAndMe($injected[0], cfg.scroll);\n\n            const scroll_container = dom.find_scroll_container(\n                scroll_target,\n                null,\n                window\n            );\n\n            if (cfg.scroll === \"top\") {\n                dom.scroll_to_top(scroll_container);\n            } else if (scroll_target) {\n                dom.scroll_to_element(scroll_target, scroll_container);\n            }\n        }\n\n        el.dispatchEvent(\n            new Event(\"pat-inject-success\", { bubbles: true, cancelable: true })\n        );\n    },\n\n    async _onInjectSuccess($el, cfgs, ev) {\n        let data = ev?.jqxhr?.responseText;\n        if (!data) {\n            log.warn(\"No response content, aborting\", ev);\n            return;\n        }\n        if (cfgs[0].source === \"none\") {\n            // Special case, we want to call something, but we don't want to inject anything\n            data = \"\";\n        }\n        const sources$ = await this.callTypeHandler(cfgs[0].dataType, \"sources\", $el, [\n            cfgs,\n            data,\n            ev,\n        ]);\n        /* pick the title source for dedicated handling later\n          Title - if present - is always appended at the end. */\n        let $title;\n        if (\n            sources$ &&\n            sources$[sources$.length - 1] &&\n            sources$[sources$.length - 1][0] &&\n            sources$[sources$.length - 1][0].nodeName === \"TITLE\"\n        ) {\n            $title = sources$[sources$.length - 1];\n        }\n        cfgs.forEach((cfg, idx1) => {\n            const perform_inject = () => {\n                if (cfg.target !== \"none\") {\n                    for (const target of cfg.$target) {\n                        this._performInjection(\n                            target,\n                            $el,\n                            sources$[idx1],\n                            cfg,\n                            ev.target,\n                            $title\n                        );\n                    }\n                }\n            };\n            if (cfg.processDelay) {\n                setTimeout(() => perform_inject(), cfg.processDelay);\n            } else {\n                perform_inject();\n            }\n        });\n        if (cfgs[0].nextHref && $el.is(\"a\")) {\n            // In case next-href is specified the anchor's href will\n            // be set to it after the injection is triggered.\n            $el.attr({ href: cfgs[0].nextHref.replace(/&amp;/g, \"&\") });\n            this.destroy($el);\n        }\n        $el.off(\"pat-ajax-success.pat-inject\");\n        $el.off(\"pat-ajax-error.pat-inject\");\n    },\n\n    async _onInjectError($el, cfgs, event) {\n        let explanation = \"\";\n        const status = event.jqxhr.status;\n        const timestamp = new Date();\n        if (status % 100 == 4) {\n            explanation =\n                \"Sorry! We couldn't find the page to load. Please make a screenshot and send it to support. Thank you!\";\n        } else if (status % 100 == 5) {\n            explanation =\n                \"I am very sorry! There was an error at the server. Please make a screenshot and contact support. Thank you!\";\n        } else if (status == 0) {\n            explanation =\n                \"It seems, the server is down. Please make a screenshot and contact support. Thank you!\";\n        }\n\n        let error_page;\n        let error_page_fragment;\n        const url_params = new URLSearchParams(window.location.search);\n        if (url_params.get(\"pat-inject-errorhandler.off\") === null) {\n            // Prepare a error page to be injected into the document.\n\n            // Try to get a suitable error message from pre-configured error pages.\n            const error_page_url = document\n                ?.querySelector(`meta[name^=pat-inject-status-${status}]`)\n                ?.getAttribute(\"content\", false);\n            error_page_fragment = error_page_url?.split(\"#\")[1];\n            error_page_fragment = error_page_fragment ? `#${error_page_fragment}` : null;\n\n            if (error_page_fragment) {\n                error_page = document.createElement(\"html\");\n                error_page.innerHTML = event.jqxhr.responseText;\n                error_page = error_page.querySelector(error_page_fragment);\n            }\n\n            if (!error_page && error_page_url) {\n                try {\n                    const error_page_response = await fetch(error_page_url, {\n                        method: \"GET\",\n                    });\n                    error_page = document.createElement(\"html\");\n                    error_page.innerHTML = await error_page_response.text();\n                    error_page = error_page.querySelector(error_page_fragment || \"body\");\n                } catch {\n                    // fall back to standard error message and ignore.\n                }\n            }\n        }\n\n        // clean up\n        for (const cfg of cfgs) {\n            if (\"$created_target\" in cfg) {\n                cfg.$created_target.remove();\n            }\n            cfg.$target.removeClass(cfg.loadingClass);\n            $el.removeClass(cfg.executingClass);\n        }\n        $el.off(\"pat-ajax-success.pat-inject\");\n        $el.off(\"pat-ajax-error.pat-inject\");\n\n        if (error_page) {\n            const error_zone = document.querySelector(error_page_fragment || \"body\");\n            error_zone.innerHTML = error_page.innerHTML;\n            registry.scan(error_zone); // initialize any patterns in error page\n        } else {\n            const msg_attr = `${explanation} Status is ${status} ${event.jqxhr.statusText}, time was ${timestamp}. You can click to close this.`;\n            $(\"body\").attr(\"data-error-message\", msg_attr);\n            $(\"body\").on(\"click\", () => {\n                $(\"body\").removeAttr(\"data-error-message\");\n                window.location.href = window.location.href; // reload\n            });\n        }\n    },\n\n    execute(cfgs, $el) {\n        /* Actually execute the injection.\n         *\n         * Either by making an ajax request or by spoofing an ajax\n         * request when the content is readily available in the current page.\n         */\n        const el = utils.jqToNode($el);\n        // get a kinda deep copy, we scribble on it\n        cfgs = cfgs.map((cfg) => $.extend({}, cfg));\n        if (!this.verifyConfig(cfgs)) {\n            return;\n        }\n        if (!this.askForConfirmation(cfgs)) {\n            return;\n        }\n        if ($el.data(\"pat-inject-triggered\")) {\n            // Prevent double triggers;\n            return;\n        }\n        $el.data(\"pat-inject-triggered\", true);\n\n        for (const cfg of cfgs) {\n            // Add a execute class on the pat-inject element.\n            if (cfg?.executingClass) {\n                el.classList.add(cfg.executingClass);\n            }\n            // Add a loading class to the target.\n            // Can be used for loading-spinners.\n            if (cfg?.loadingClass && cfg?.target !== \"none\") {\n                cfg.$target.addClass(cfg.loadingClass);\n            }\n        }\n\n        $el.on(\"pat-ajax-success.pat-inject\", async (e) => {\n            this._onInjectSuccess($el, cfgs, e);\n\n            // Wait for the next tick to ensure that the close-panel listener\n            // is called before this one, even for non-async local injects.\n            await utils.timeout(1);\n            // Remove the close-panel event listener.\n            events.remove_event_listener(el, \"pat-inject--close-panel\");\n            // Only close the panel if a close-panel event was catched previously.\n            if (do_close_panel) {\n                do_close_panel = false;\n                // Re-trigger close-panel event if it was caught while injection was in progress.\n                el.dispatchEvent(\n                    new Event(\"close-panel\", { bubbles: true, cancelable: true })\n                );\n            }\n        });\n        $el.on(\"pat-ajax-error.pat-inject\", this._onInjectError.bind(this, $el, cfgs));\n        $el.on(\"pat-ajax-success.pat-inject pat-ajax-error.pat-inject\", () =>\n            $el.removeData(\"pat-inject-triggered\")\n        );\n\n        // Prevent closing the panel while injection is in progress.\n        let do_close_panel = false;\n        events.add_event_listener(el, \"close-panel\", \"pat-inject--close-panel\", (e) => {\n            e.stopPropagation();\n            e.stopImmediatePropagation();\n            do_close_panel = true;\n        });\n\n        if (cfgs[0].url.length) {\n            ajax.request($el, {\n                \"url\": cfgs[0].url,\n                \"browser-cache\": cfgs[0].browserCache,\n            });\n        } else {\n            // If there is no url specified, then content is being fetched\n            // from the same page.\n            // No need to do an ajax request for this, so we spoof the ajax\n            // event.\n            $el.trigger({\n                type: \"pat-ajax-success\",\n                jqxhr: {\n                    responseText: $(\"body\").html(),\n                },\n            });\n        }\n    },\n\n    _inject(trigger, source_nodes, target, cfg) {\n        if (cfg.source === \"none\") {\n            // Special case. Clear the target after ajax call.\n            target.replaceWith(\"\");\n            return true;\n        }\n        if (source_nodes.length === 0) {\n            log.warn(\"Aborting injection, source not found:\", source_nodes);\n            $(trigger).trigger(\"pat-inject-missingSource\", {\n                url: cfg.url,\n                selector: cfg.source,\n            });\n            return false;\n        }\n        if (cfg.target === \"none\") {\n            // Special case. Don't do anything, we don't want any result\n            return true;\n        }\n        if (!target) {\n            log.warn(\"Aborting injection, target not found:\", target);\n            $(trigger).trigger(\"pat-inject-missingTarget\", {\n                selector: cfg.target,\n            });\n            return false;\n        }\n\n        // cfg.action to DOM method mapping\n        const method = {\n            content: \"replaceChildren\",\n            contentafter: \"append\",\n            contentbefore: \"prepend\",\n            element: \"replaceWith\",\n            elementafter: \"after\",\n            elementbefore: \"before\",\n        }[cfg.action];\n\n        // Inject the content HERE!\n        target[method](...source_nodes);\n\n        return true;\n    },\n\n    _sourcesFromHtml(html, url, sources) {\n        const $html = this._parseRawHtml(html, url);\n        return sources.map((source) => {\n            if (source === \"body\") {\n                source = \"#__original_body\";\n            }\n            if (source === \"none\") {\n                return $(\"<!-- -->\");\n            }\n            const $source = $html.find(source);\n\n            if ($source.length === 0) {\n                if (source != \"title\") {\n                    log.warn(\"No source elements for selector:\", source, $html);\n                }\n            }\n\n            $source.find('a[href^=\"#\"]').each((idx, el_) => {\n                const href = el_.getAttribute(\"href\");\n                if (href.indexOf(\"#{1}\") !== -1) {\n                    // We ignore hrefs containing #{1} because they're not\n                    // valid and only applicable in the context of\n                    // pat-clone.\n                    return;\n                }\n                // Skip in-document links pointing to an id that is inside\n                // this fragment.\n                if (href.length === 1) {\n                    // Special case for top-of-page links\n                    el_.href = url;\n                } else if (!$source.find(href).length) {\n                    el_.href = url + href;\n                }\n            });\n            return $source;\n        });\n    },\n\n    _rebaseAttrs: {\n        a: \"href\",\n        form: \"action\",\n        img: \"src\",\n        object: \"data\",\n        source: \"src\",\n        video: \"src\",\n    },\n\n    _rebaseOptions: {\n        \"calendar\": [\"url\", \"event-sources\"],\n        \"collapsible\": [\"load-content\"],\n        \"date-picker\": [\"i18n\"],\n        \"datetime-picker\": [\"i18n\"],\n        \"inject\": [\"url\"],\n    },\n\n    _rebaseURL(base, url) {\n        if (url.indexOf(\"://\") !== -1 || url[0] === \"/\" || url.indexOf(\"data:\") === 0) {\n            return url;\n        }\n        base = new URL(base, window.location).href; // If base is relative make it absolute.\n        return base.slice(0, base.lastIndexOf(\"/\") + 1) + url;\n    },\n\n    _rebaseHTML(base, html) {\n        if (html === \"\") {\n            // Special case, source is none\n            return \"\";\n        }\n\n        // Parse the html string into a DOM tree.\n        const page = document.createElement(\"div\");\n        page.innerHTML = html;\n\n        // Create efficient selector for any tag with it's corresponding\n        // attribute from _rebaseAttrs. Note: the current data structure allows\n        // only for one attribute to be rebased per tag.\n        const rebase_selector = Object.entries(this._rebaseAttrs)\n            .map(([tag, attr]) => `${tag}[${attr}]`)\n            .join(\", \");\n        for (const el_ of page.querySelectorAll(rebase_selector)) {\n            const attr = this._rebaseAttrs[el_.nodeName.toLowerCase()];\n            let value = el_.getAttribute(attr);\n\n            if (\n                value &&\n                value.slice(0, 2) !== \"@@\" &&\n                value[0] !== \"#\" &&\n                value.slice(0, 7) !== \"mailto:\" &&\n                value.slice(0, 4) !== \"tel:\" &&\n                value.slice(0, 4) !== \"fax:\" &&\n                value.slice(0, 7) !== \"callto:\" &&\n                value.slice(0, 10) !== \"ts3server:\" &&\n                value.slice(0, 6) !== \"teams:\" &&\n                value.slice(0, 11) !== \"javascript:\"\n            ) {\n                value = this._rebaseURL(base, value);\n                el_.setAttribute(attr, value);\n            }\n        }\n\n        for (const [pattern_name, opts] of Object.entries(this._rebaseOptions)) {\n            for (const el_ of dom.querySelectorAllAndMe(\n                page,\n                `[data-pat-${pattern_name}]`\n            )) {\n                const pattern = registry.patterns?.[pattern_name];\n                const pattern_parser = pattern?.parser;\n                if (!pattern_parser) {\n                    continue;\n                }\n                // parse: no default options, possibly multiple configs, no grouping.\n                const options = pattern_parser.parse(el_, {}, true, false, false);\n                let changed = false;\n                for (const config of options) {\n                    for (const opt of opts) {\n                        const val = config[opt];\n                        if (!val) {\n                            continue;\n                        }\n                        changed = true;\n                        if (Array.isArray(val)) {\n                            config[opt] = val.map((it) => this._rebaseURL(base, it));\n                        } else {\n                            config[opt] = this._rebaseURL(base, val);\n                        }\n                    }\n                }\n                if (changed) {\n                    el_.setAttribute(\n                        `data-pat-${pattern_name}`,\n                        JSON.stringify(options.length === 1 ? options[0] : options)\n                    );\n                }\n            }\n        }\n\n        return page.innerHTML.trim();\n    },\n\n    _parseRawHtml(html, url = \"\") {\n        // remove script tags and head and replace body by a div\n        const title = html.match(/\\<title\\>(.*)\\<\\/title\\>/);\n        let clean_html = html\n            .replace(/<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi, \"\")\n            .replace(/<head\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/head>/gi, \"\")\n            .replace(/<html([^>]*?)>/gi, \"\")\n            .replace(/<\\/html([^>]*?)>/gi, \"\")\n            .replace(/<body([^>]*?)>/gi, '<div id=\"__original_body\">')\n            .replace(/<\\/body([^>]*?)>/gi, \"</div>\");\n\n        if (title && title.length == 2) {\n            clean_html = title[0] + clean_html;\n        }\n        try {\n            clean_html = this._rebaseHTML(url, clean_html);\n        } catch (e) {\n            log.error(\"Error rebasing urls\", e);\n        }\n        const $html = $(\"<div/>\").html(clean_html);\n        if ($html.children().length === 0) {\n            log.warn(\"Parsing html resulted in empty jquery object:\", clean_html);\n        }\n        return $html;\n    },\n\n    _initAutoloadVisible($el, cfgs) {\n        if ($el.data(\"pat-inject-autoloaded\")) {\n            // ignore executed autoloads\n            return false;\n        }\n\n        const el = utils.jqToNode($el);\n\n        // delay: default is 200ms to allow scrolling over and past autoload-visible elements without loading them.\n        const delay = cfgs[0].delay || 200;\n        log.debug(`Delay time: ${delay}`);\n\n        // function to trigger the autoload and mark as triggered\n        const trigger = (event) => {\n            if ($el.data(\"pat-inject-autoloaded\")) {\n                log.debug(`autoload-visible trigger skipped ${el}`);\n                return false;\n            }\n            $el.data(\"pat-inject-autoloaded\", true);\n            this.onTrigger({ currentTarget: el });\n            event && event.preventDefault();\n            log.debug(`autoload-visible trigger run ${el}`);\n            return true;\n        };\n\n        // Config see: https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n        const intersection_observer_config = {\n            threshold: 0, // If even one pixel is visible, the callback will be run.\n            root: null, // Root is browser viewport. If the element is visible to the user, the callback will be run.\n            margin: \"0px\", // No margins. The element is not preloaded.\n        };\n\n        let timeout_id = null;\n        const observer = new IntersectionObserver((entries) => {\n            for (const entry of entries) {\n                if (entry.isIntersecting) {\n                    // Run the callback after 200ms to prevent loading all\n                    // visible elements when scrolling over.\n                    timeout_id = window.setTimeout(() => {\n                        observer.disconnect(); // Stop observing loaded elements.\n                        trigger();\n                    }, delay);\n                    log.debug(`autoload-visible intersecting ${el}`);\n                } else {\n                    window.clearTimeout(timeout_id);\n                    log.debug(`autoload-visible not intersecting ${el}`);\n                }\n            }\n        }, intersection_observer_config);\n        observer.observe(el);\n    },\n\n    _initIdleTrigger($el, delay) {\n        // TODO: handle item removed from DOM\n        const timeout = parseInt(delay, 10);\n        let timer;\n\n        const el = utils.jqToNode($el);\n\n        const onTimeout = () => {\n            this.onTrigger({ currentTarget: el });\n            unsub();\n            clearTimeout(timer);\n        };\n\n        const onInteraction = utils.debounce(() => {\n            if (!document.body.contains(el)) {\n                unsub();\n                return;\n            }\n            clearTimeout(timer);\n            timer = setTimeout(onTimeout, timeout);\n        }, timeout);\n\n        const unsub = () => {\n            for (const event of [\"scroll\", \"resize\"]) {\n                window.removeEventListener(event, onInteraction);\n            }\n            for (const event of [\n                \"click\",\n                \"keypress\",\n                \"keyup\",\n                \"mousemove\",\n                \"touchstart\",\n                \"touchend\",\n            ]) {\n                document.removeEventListener(event, onInteraction);\n            }\n        };\n\n        onInteraction();\n\n        for (const event of [\"scroll\", \"resize\"]) {\n            window.addEventListener(event, onInteraction);\n        }\n        for (const event of [\n            \"click\",\n            \"keypress\",\n            \"keyup\",\n            \"mousemove\",\n            \"touchstart\",\n            \"touchend\",\n        ]) {\n            document.addEventListener(event, onInteraction);\n        }\n    },\n\n    registerTypeHandler(type, handler) {\n        this.handlers[type] = handler;\n    },\n\n    async callTypeHandler(type, fn, context, params) {\n        type = type || \"html\";\n        if (this.handlers[type] && $.isFunction(this.handlers[type][fn])) {\n            return await this.handlers[type][fn].bind(this)(...params);\n        } else {\n            return null;\n        }\n    },\n\n    handlers: {\n        html: {\n            sources(cfgs, data) {\n                const sources = cfgs.map((cfg) => cfg.source);\n                sources.push(\"title\");\n                const result = this._sourcesFromHtml(data, cfgs[0].url, sources);\n                return result;\n            },\n        },\n    },\n};\n\n$(document).on(\"patterns-injected.inject\", async (ev, cfg, trigger, injected) => {\n    /* Listen for the patterns-injected event.\n     *\n     * Remove the \"loading-class\" classes from all injection targets and\n     * then scan the injected content for new patterns.\n     */\n    if (cfg?.skipPatInjectHandler) {\n        // Allow skipping this handler but still have other handlers in other\n        // patterns listen to ``patterns-injected``.\n        return;\n    }\n    if (cfg) {\n        cfg.$target.removeClass(cfg.loadingClass);\n        // Remove the executing class, add the executed class to the element with pat.inject on it.\n        $(trigger).removeClass(cfg.executingClass).addClass(cfg.executedClass);\n    }\n    if (injected.nodeType !== TEXT_NODE && injected.nodeType !== COMMENT_NODE) {\n        registry.scan(injected, null, { type: \"injection\", element: trigger });\n        $(injected).trigger(\"patterns-injected-scanned\");\n\n        await utils.timeout(10); // Wait a bit before dispatching next event.\n        injected.dispatchEvent(\n            new CustomEvent(\"patterns-injected-delayed\", {\n                bubbles: true,\n                cancelable: true,\n                detail: {\n                    injected: injected,\n                },\n            })\n        );\n    }\n});\n\n$(window).on(\"popstate\", (event) => {\n    // popstate also triggers on traditional anchors\n    if (!event.originalEvent.state && \"replaceState\" in history) {\n        try {\n            history.replaceState(\"anchor\", \"\", document.location.href);\n        } catch (e) {\n            log.debug(e);\n        }\n        return;\n    }\n    // Not only change the URL, also reload the page.\n    window.location.reload();\n});\n\n// this entry ensures that the initally loaded page can be reached with\n// the back button\nif (\"replaceState\" in history) {\n    try {\n        history.replaceState(\"pageload\", \"\", document.location.href);\n    } catch (e) {\n        log.debug(e);\n    }\n}\n\nregistry.register(inject);\nexport default inject;\n","import $ from \"jquery\";\nimport { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport events from \"../../core/events\";\nimport dom from \"../../core/dom\";\nimport logging from \"../../core/logging\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"depends\");\n\nexport const parser = new Parser(\"depends\");\nparser.addArgument(\"condition\");\nparser.addArgument(\"action\", \"show\", [\"show\", \"enable\", \"both\"]);\nparser.addArgument(\"transition\", \"none\", [\"none\", \"css\", \"fade\", \"slide\"]);\nparser.addArgument(\"effect-duration\", \"fast\");\nparser.addArgument(\"effect-easing\", \"swing\");\n\n\n// A custom input event which differs from the one in `core/events` in that it\n// accepts a `detail` object to pass arbitrary information around.\n// TODO: The events in `core/events` should be refactored to accept a `detail`\n// object.\nconst input_event = (detail = {}) => {\n    return new CustomEvent(\"input\", {\n        bubbles: true,\n        cancelable: false,\n        detail: detail,\n    });\n};\n\n\nclass Pattern extends BasePattern {\n    static name = \"depends\";\n    static trigger = \".pat-depends\";\n    static parser = parser;\n\n    async init() {\n        this.$el = $(this.el);\n        const DependsHandler = (await import(\"../../lib/dependshandler\")).default; // prettier-ignore\n\n        try {\n            this.handler = new DependsHandler(this.el, this.options.condition);\n        } catch (e) {\n            log.error(\"Invalid condition: \" + e.message, this.el);\n            return;\n        }\n\n        // Initialize\n        this.set_state();\n\n        for (const input of this.handler.getAllInputs()) {\n            // Note: One input can be a dependency for multiple other dependent\n            // elements. Therefore we need to bind the events not uniquely and\n            // add a uuid to the event bindings id.\n\n            events.add_event_listener(\n                input,\n                \"input\",\n                `pat-depends--input--${this.uuid}`,\n                (e) => {\n                    if (e?.detail?.pattern_uuid === this.uuid) {\n                        // Ignore input events invoked from this pattern\n                        // instance to avoid infinite loops.\n                        return;\n                    }\n                    this.set_state();\n                }\n            );\n\n            if (input.form) {\n                events.add_event_listener(\n                    input.form,\n                    \"reset\",\n                    `pat-depends--reset--${this.uuid}`,\n                    async () => {\n                        // TODO: note sure, what this timeout is for.\n                        await utils.timeout(50);\n                        this.set_state.bind(this);\n                    }\n                );\n            }\n        }\n    }\n\n    update_modal() {\n        const modal = this.el.closest(\".pat-modal\");\n\n        // If we're in a modal, make sure that it gets resized.\n        if (modal) {\n            $(document).trigger(\"pat-update\", { pattern: \"depends\" });\n        }\n    }\n\n    enable() {\n        const inputs = dom.find_inputs(this.el);\n        for (const input of inputs) {\n            if (input.disabled === false) {\n                // Do not re-enable an already enabled input.\n                continue;\n            }\n\n            // Now, enable the input element.\n            input.disabled = false;\n\n            if (input === this.el) {\n                // Do not re-trigger this pattern on it's own element to avoid\n                // infinite loops.\n                continue;\n            }\n\n            if (dom.is_button(input)) {\n                // Do not trigger the input event on buttons as they do not\n                // support it.\n                continue;\n            }\n\n            // Trigger the input after enabling so that any other bound\n            // actions can react on that.\n            input.dispatchEvent(input_event({ pattern_uuid: this.uuid }));\n        }\n\n        // Restore the original click behavior for anchor elements.\n        if (this.el.tagName === \"A\") {\n            events.remove_event_listener(this.el, \"pat-depends--click\");\n        }\n\n        // Remove the disabled class from the element.\n        this.el.classList.remove(\"disabled\");\n\n        // Trigger the pat-update event to notify other patterns about enabling.\n        this.$el.trigger(\"pat-update\", {\n            pattern: \"depends\",\n            action: \"attribute-changed\",\n            dom: this.el,\n            enabled: true,\n        });\n    }\n\n    disable() {\n        const inputs = dom.find_inputs(this.el);\n        for (const input of inputs) {\n            if (input.disabled === true) {\n                // Do not re-disable an already disabled input.\n                continue;\n            }\n\n            // Now, disable the input element.\n            input.disabled = true;\n\n            if (input === this.el) {\n                // Do not re-trigger this pattern on it's own element to avoid\n                // infinite loops.\n                continue;\n            }\n\n            if (dom.is_button(input)) {\n                // Do not trigger the input event on buttons as they do not\n                // support it.\n                continue;\n            }\n\n            // Trigger the input after disabling so that any other bound\n            // actions can react on that.\n            input.dispatchEvent(input_event({ pattern_uuid: this.uuid }));\n        }\n\n        // Prevent the default click behavior for anchor elements.\n        if (this.el.tagName === \"A\") {\n            events.add_event_listener(this.el, \"click\", \"pat-depends--click\", (e) =>\n                e.preventDefault()\n            );\n        }\n\n        // Add the disabled class to the element.\n        this.el.classList.add(\"disabled\");\n\n        // Trigger the pat-update event to notify other patterns about disabling.\n        this.$el.trigger(\"pat-update\", {\n            pattern: \"depends\",\n            action: \"attribute-changed\",\n            dom: this.el,\n            enabled: false,\n        });\n    }\n\n    set_state() {\n        const state = this.handler.evaluate();\n        switch (this.options.action) {\n            case \"show\":\n                utils.hideOrShow(this.el, state, this.options, this.name);\n                this.update_modal();\n                break;\n            case \"enable\":\n                if (state) {\n                    this.enable();\n                } else {\n                    this.disable();\n                }\n                break;\n            case \"both\":\n                utils.hideOrShow(this.el, state, this.options, this.name);\n                this.update_modal();\n                if (state) {\n                    this.enable();\n                } else {\n                    this.disable();\n                }\n                break;\n        }\n    }\n}\n\n// Register Pattern class in the global pattern registry\nregistry.register(Pattern);\n\n// Make it available\nexport default Pattern;\n","// Set the base URL based on the current location, listening on navigation changes.\nimport { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport events from \"@patternslib/patternslib/src/core/events\";\n\nclass Pattern extends BasePattern {\n    static name = \"pat-base-url\";\n    static trigger = \"body\";\n\n    init() {\n        events.add_event_listener(\n            window.navigation,\n            \"navigate\",\n            \"thet-base-url--set\",\n            this.set_base_url.bind(this)\n        );\n    }\n\n    set_base_url() {\n        let url = window.location.href;\n\n        // Split the following words from the URL as we want to get the\n        // contents absolute URL.\n        const split_words = [\n            // NOTE: order matters.\n            \"/@@\", // also catches @@folder_contents and @@edit\n            \"/++\", // traversal urls.\n            \"/folder_contents\",\n            \"/edit\",\n            \"/view\",\n            \"#\",\n            \"?\",\n        ];\n\n        // Split all split words out of url\n        url = split_words.reduce((url_, split_) => url_.split(split_)[0], url);\n        // Remove the trailing slash\n        if (url[url.length -1] === \"/\") {\n            url = url.substring(0, url.length - 1)\n        }\n\n        // Set the contents absolute URL on `data-base-url`.\n        document.body.dataset.baseUrl = url;\n    }\n}\n\nregistry.register(Pattern);\nexport default Pattern;\nexport { Pattern };\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"../../core/utils\";\nimport _ from \"underscore\";\n\nconst log = logger.getLogger(\"pat-contentloader\");\n\nexport default Base.extend({\n    name: \"contentloader\",\n    trigger: \".pat-contentloader\",\n    parser: \"mockup\",\n    defaults: {\n        url: null,\n        content: null,\n        trigger: \"click\",\n        target: null,\n        template: null,\n        dataType: \"html\",\n    },\n    init: function () {\n        var that = this;\n        if (that.options.url === \"el\" && that.$el[0].tagName === \"A\") {\n            that.options.url = that.$el.attr(\"href\");\n        }\n        that.$el.removeClass(\"loading-content\");\n        that.$el.removeClass(\"content-load-error\");\n        if (that.options.trigger === \"immediate\") {\n            that._load();\n        } else {\n            that.$el.on(that.options.trigger, function (e) {\n                e.preventDefault();\n                that._load();\n            });\n        }\n    },\n    _load: function () {\n        var that = this;\n        that.$el.addClass(\"loading-content\");\n        if (that.options.url) {\n            that.loadRemote();\n        } else {\n            that.loadLocal();\n        }\n    },\n    loadRemote: function () {\n        var that = this;\n        $.ajax({\n            url: that.options.url,\n            dataType: that.options.dataType,\n            success: function (data) {\n                var $el;\n                if (that.options.dataType === \"html\") {\n                    if (data.indexOf(\"<html\") !== -1) {\n                        data = utils.parseBodyTag(data);\n                    }\n                    $el = $(\"<div>\" + data + \"</div>\"); // jQuery starts to search at the first child element.\n                } else if (that.options.dataType.indexOf(\"json\") !== -1) {\n                    // must have template defined with json\n                    if (data.constructor === Array && data.length === 1) {\n                        // normalize json if it makes sense since some json returns as array with one item\n                        data = data[0];\n                    }\n                    try {\n                        $el = $(_.template(that.options.template)(data));\n                    } catch {\n                        that.$el.removeClass(\"loading-content\");\n                        that.$el.addClass(\"content-load-error\");\n                        log.warn(\n                            \"error rendering template. pat-contentloader will not work\"\n                        );\n                        return;\n                    }\n                }\n                if (that.options.content !== null) {\n                    $el = $el.find(that.options.content);\n                }\n                that.loadLocal($el);\n            },\n            error: function () {\n                that.$el.removeClass(\"loading-content\");\n                that.$el.addClass(\"content-load-error\");\n            },\n        });\n    },\n    loadLocal: function ($content) {\n        var that = this;\n        if (!$content && that.options.content === null) {\n            that.$el.removeClass(\"loading-content\");\n            that.$el.addClass(\"content-load-error\");\n            log.warn(\"No selector configured\");\n            return;\n        }\n        var $target = that.$el;\n        if (that.options.target !== null) {\n            $target = $(that.options.target);\n            if ($target.length === 0) {\n                that.$el.removeClass(\"loading-content\");\n                that.$el.addClass(\"content-load-error\");\n                log.warn(\"No target nodes found\");\n                return;\n            }\n        }\n\n        if (!$content) {\n            $content = $(that.options.content).clone();\n        }\n        if ($content.length) {\n            $content.show();\n            $target.replaceWith($content);\n            registry.scan($content);\n        } else {\n            // empty target node instead of removing it.\n            // allows for subsequent content loader calls to work sucessfully.\n            $target.empty();\n        }\n\n        that.$el.removeClass(\"loading-content\");\n        that.emit(\"loading-done\");\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\n\nexport default Base.extend({\n    name: \"cookietrigger\",\n    trigger: \".pat-cookietrigger\",\n    parser: \"mockup\",\n\n    isCookiesEnabled: function () {\n        /* Test whether cookies are enabled by attempting to set a cookie\n         * and then change its value set test cookie.\n         */\n        var c = \"areYourCookiesEnabled=0\";\n        document.cookie = c;\n        var dc = document.cookie;\n        // cookie not set?  fail\n        if (dc.indexOf(c) === -1) {\n            return 0;\n        }\n        // change test cookie\n        c = \"areYourCookiesEnabled=1\";\n        document.cookie = c;\n        dc = document.cookie;\n        // cookie not changed?  fail\n        if (dc.indexOf(c) === -1) {\n            return 0;\n        }\n        // delete cookie\n        document.cookie = \"areYourCookiesEnabled=; expires=Thu, 01-Jan-70 00:00:01 GMT\";\n        return 1;\n    },\n\n    showIfCookiesDisabled: function () {\n        /* Show the element on which this pattern is defined if cookies are\n         * disabled.\n         */\n        if (this.isCookiesEnabled()) {\n            dom.hide(this.el);\n        } else {\n            dom.show(this.el);\n        }\n    },\n\n    init: function () {\n        this.showIfCookiesDisabled();\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"formautofocus\",\n    trigger: \".pat-formautofocus\",\n    parser: \"mockup\",\n    defaults: {\n        condition: \"div.error\",\n        target: \"div.error :input:not(.formTabs):visible:first\",\n        always: \":input:not(.formTabs):visible:first\",\n    },\n    init() {\n        if ($(this.options.condition, this.$el).length !== 0) {\n            $(this.options.target, this.$el).focus();\n        } else {\n            $(this.options.always, this.$el).focus();\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\n\nexport default Base.extend({\n    name: \"formunloadalert\",\n    trigger: \".pat-formunloadalert\",\n    parser: \"mockup\",\n    _changed: false, // Stores a listing of raised changes by their key\n    _suppressed: false, // whether or not warning should be suppressed\n    defaults: {\n        message: _t(\"Discard changes? If you click OK, any changes you have made will be lost.\"), // prettier-ignore\n        // events on which to check for changes\n        changingEvents: \"change keyup paste\",\n        // fields on which to check for changes\n        changingFields: \"input,select,textarea,fileupload\",\n    },\n    init() {\n        var self = this;\n        // if this is not a form just return\n        if (!self.$el.is(\"form\")) {\n            return;\n        }\n\n        $(self.options.changingFields, self.$el).on(self.options.changingEvents, () => {\n            self._changed = true;\n        });\n\n        var $modal = self.$el.parents(\".plone-modal\");\n        if ($modal.length !== 0) {\n            $modal.on(\"hide\", function (e) {\n                var modal = $modal.data(\"patternPloneModal\");\n                if (modal) {\n                    modal._suppressHide = self._handleUnload.call(self, e);\n                }\n            });\n        } else {\n            $(window).on(\"beforeunload\", (e) => {\n                return self._handleUnload(e);\n            });\n        }\n\n        self.$el.on(\"submit\", () => {\n            self._suppressed = true;\n        });\n    },\n    _handleUnload(e) {\n        var self = this;\n        if (self._suppressed) {\n            self._suppressed = false;\n            return undefined;\n        }\n        if (self._changed) {\n            var msg = self.options.message;\n            self._handleMsg(e, msg);\n            $(window).trigger(\"messageset\");\n            return msg;\n        }\n    },\n    _handleMsg(e, msg) {\n        (e || window.event).returnValue = msg;\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\n\nexport default Base.extend({\n    name: \"livesearch\",\n    trigger: \".pat-livesearch\",\n    parser: \"mockup\",\n    timeout: null,\n    active: false,\n    results: null,\n    selectedItem: -1,\n    resultsClass: \"livesearch-results list-group d-none\",\n    defaults: {\n        ajaxUrl: null,\n        defaultSortOn: \"\",\n        perPage: 7,\n        quietMillis: 350,\n        timeoutHide: 200,\n        minimumInputLength: 4,\n        inputSelector: 'input[type=\"text\"]',\n        itemTemplate:\n            '<li class=\"search-result <%- state %> list-group-item list-group-item-action\">' +\n            '<a class=\"text-reset text-decoration-none\" href=\"<%- url %>\">' +\n            '<div class=\"row\">' +\n            '<div class=\"col info\">' +\n            '<div class=\"heading\"><%- title %></div>' +\n            '<div class=\"description\"><%- description %></div>' +\n            \"</div>\" +\n            \"<% if (img_tag) { %> \" +\n            '<div class=\"col img\">' +\n            \"<%= img_tag %>\" +\n            \"</div>\" +\n            \"<% } %> \" +\n            \"</div>\" +\n            \"</a>\" +\n            \"</li>\",\n    },\n    doSearch: function (page) {\n        var self = this;\n        self.active = true;\n        self.render();\n        self.$el.addClass(\"searching\");\n        var query = self.$el.serialize();\n        if (page === undefined) {\n            page = 1;\n        }\n        var sort_on = (function () {\n            var parameters = location.search,\n                sorton_position = parameters.indexOf(\"sort_on\");\n            if (sorton_position === -1) {\n                // return default sort\n                var $searchResults = $(\"#search-results\");\n                if ($searchResults.length > 0) {\n                    return $searchResults.attr(\"data-default-sort\");\n                }\n                return self.options.defaultSortOn;\n            }\n            // cut string before sort_on parameter\n            var sort_on = parameters.substring(sorton_position);\n            // cut other parameters\n            sort_on = sort_on.split(\"&\")[0];\n            // get just the value\n            sort_on = sort_on.split(\"=\")[1];\n            return sort_on;\n        })();\n\n        $.ajax({\n            url:\n                self.options.ajaxUrl +\n                \"?\" +\n                query +\n                \"&page=\" +\n                page +\n                \"&perPage=\" +\n                self.options.perPage +\n                \"&sort_on=\" +\n                sort_on,\n            dataType: \"json\",\n        })\n            .done(function (data) {\n                self.results = data;\n                self.page = page;\n                // maybe odd here.. but we're checking to see if the user\n                // has typed while a search was being performed. Perhap another search if so\n                if (query !== self.$el.serialize()) {\n                    self.doSearch();\n                }\n            })\n            .fail(function () {\n                self.results = {\n                    items: [\n                        {\n                            url: \"\",\n                            title: _t(\"Error\"),\n                            description: _t(\"There was an error searching…\"),\n                            state: \"error\",\n                            error: false,\n                        },\n                    ],\n                    total: 1,\n                };\n                self.page = 1;\n            })\n            .always(function () {\n                self.active = false;\n                self.selectedItem = -1;\n                self.$el.removeClass(\"searching\");\n                self.render();\n            });\n    },\n    render: function () {\n        var self = this;\n        self.$results.empty();\n\n        /* find a status message */\n\n        if (self.active) {\n            self.$results.append(\n                $('<li class=\"searching list-group-item\">' + _t(\"searching…\") + \"</li>\")\n            );\n        } else if (self.results === null) {\n            // no results gathered yet\n            self.$results.append(\n                $(\n                    '<li class=\"no-results no-search list-group-item\">' +\n                        _t(\"enter search phrase\") +\n                        \"</li>\"\n                )\n            );\n        } else if (self.results.total === 0) {\n            self.$results.append(\n                $(\n                    '<li class=\"no-results list-group-item\">' +\n                        _t(\"no results found\") +\n                        \"</li>\"\n                )\n            );\n        } else {\n            self.$results.append(\n                $(\n                    '<li class=\"results-summary list-group-item\">' +\n                        _t(\"found\") +\n                        \" \" +\n                        self.results.total +\n                        \" \" +\n                        _t(\"results\") +\n                        \"</li>\"\n                )\n            );\n        }\n\n        if (self.results !== null) {\n            var template = _.template(self.options.itemTemplate);\n            _.each(self.results.items, function (item, index) {\n                var $el = $(template($.extend({ _t: _t }, item)));\n                $el.attr(\"data-url\", item.url).on(\"click\", function () {\n                    if (!item.error) {\n                        window.location = item.url;\n                    }\n                });\n                if (index === self.selectedItem) {\n                    $el.addClass(\"active\");\n                }\n                self.$results.append($el);\n            });\n            var nav = {};\n            if (self.page > 1) {\n                var $prev = $(\n                    '<a href=\"#\" class=\"prev position-absolute ps-3 start-0\">' +\n                        _t(\"Previous\") +\n                        \"</a>\"\n                );\n                $prev.on(\"click\", function (e) {\n                    self.disableHiding = true;\n                    e.preventDefault();\n                    self.doSearch(self.page - 1);\n                });\n                nav.prev = $prev;\n            }\n            if (self.page * self.options.perPage < self.results.total) {\n                var $next = $(\n                    '<a href=\"#\" class=\"next position-absolute pe-3 end-0\">' +\n                        _t(\"Next\") +\n                        \"</a>\"\n                );\n                $next.on(\"click\", function (e) {\n                    self.disableHiding = true;\n                    e.preventDefault();\n                    self.doSearch(self.page + 1);\n                });\n                nav.next = $next;\n            }\n            if (nav.next || nav.prev) {\n                var $li = $(\n                    '<li class=\"list-group-item load-more d-flex justify-content-center\"><span class=\"page\">' +\n                        self.page +\n                        \"</span></li>\"\n                );\n                if (nav.prev) {\n                    $li.prepend(nav.prev);\n                }\n                if (nav.next) {\n                    $li.append(nav.next);\n                }\n                self.$results.append($li);\n            }\n        }\n        self.show();\n    },\n    show: function () {\n        /* we are positioning directly below the\n         input box, same width */\n        var self = this;\n\n        self.$results[0].classList.remove(\"d-none\");\n        self.$el[0].classList.add(\"livesearch-active\");\n    },\n    hide: function () {\n        this.$el[0].classList.remove(\"livesearch-active\");\n        this.$results[0].classList.add(\"d-none\");\n    },\n    init: function () {\n        // import(\"./livesearch.scss\");\n\n        var self = this;\n\n        self.$input = self.$el.find(self.options.inputSelector);\n        self.$input\n            .off(\"focusout\")\n            .on(\"focusout\", function () {\n                /* we put this in a timer so click events still\n           get trigger on search results */\n                setTimeout(function () {\n                    /* hack, look above, to handle dealing with clicks\n             unfocusing element */\n                    if (!self.disableHiding) {\n                        self.hide();\n                    } else {\n                        self.disableHiding = false;\n                        // and refocus elemtn\n                        self.$input.focus();\n                    }\n                }, self.options.timeoutHide);\n            })\n            .off(\"focusin\")\n            .on(\"focusin\", function () {\n                if (!self.onceFocused) {\n                    /* Case: field already filled out but no reasons\n             present yet, do ajax search and grab some results */\n                    self.onceFocused = true;\n                    if (self.$input.val().length >= self.options.minimumInputLength) {\n                        self.doSearch();\n                    }\n                } else if (!dom.is_visible(self.$results[0])) {\n                    self.render();\n                }\n            })\n            .attr(\"autocomplete\", \"off\")\n            .off(\"keyup\")\n            .on(\"keyup\", function (e) {\n                var code = e.keyCode || e.which;\n                // first off, we're capturing esc presses\n                if (code === 27) {\n                    self.$input.val(\"\");\n                    self.hide();\n                    return;\n                }\n                // then, we're capturing up, down and enter key presses\n                if (\n                    self.results &&\n                    self.results.items &&\n                    self.results.items.length > 0\n                ) {\n                    if (code === 13) {\n                        /* enter key, check to see if there is a selected item */\n                        if (self.selectedItem !== -1) {\n                            window.location = self.results.items[self.selectedItem].url;\n                        }\n                        return;\n                    } else if (code === 38) {\n                        /* up key */\n                        if (self.selectedItem !== -1) {\n                            self.selectedItem -= 1;\n                            self.render();\n                        }\n                        return;\n                    } else if (code === 40) {\n                        /* down key */\n                        if (self.selectedItem < self.results.items.length) {\n                            self.selectedItem += 1;\n                            self.render();\n                        }\n                        return;\n                    }\n                }\n\n                /* then, we handle timeouts for doing ajax search */\n                if (self.timeout !== null) {\n                    clearTimeout(self.timeout);\n                    self.timeout = null;\n                }\n                if (self.active) {\n                    return;\n                }\n                if (self.$input.val().length >= self.options.minimumInputLength) {\n                    self.timeout = setTimeout(function () {\n                        self.doSearch();\n                    }, self.options.quietMillis);\n                } else {\n                    self.results = null;\n                    self.render();\n                }\n            });\n        $(\"#sorting-options a\").on(\"click\", function (e) {\n            e.preventDefault();\n            self.onceFocused = false;\n        });\n\n        /* create result dom */\n        self.$results = $('<ul class=\"' + self.resultsClass + '\"></ul>').insertAfter(\n            self.$el\n        );\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport dom from \"@patternslib/patternslib/src/core/dom\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"markspeciallinks\",\n    trigger: \".pat-markspeciallinks\",\n    parser: \"mockup\",\n\n    defaults: {\n        external_links_open_new_window: false,\n        mark_special_links: true,\n    },\n\n    protocol_icon_map: {\n        // For a list of supported default protocol hander, see:\n        // https://developer.mozilla.org/en-US/docs/Web/API/Navigator/registerProtocolHandler#permitted_schemes\n        https: \"link-45deg\",\n        http: \"link-45deg\",\n        ftp: \"cloud-download\", // deprecated\n        callto: \"telephone\", // non-standard for skype\n        bitcoin: \"credit-card\", // no bitcoin icon yet\n        geo: \"geo-alt\",\n        im: \"chat\",\n        irc: \"chat\",\n        ircs: \"chat\",\n        magnet: \"link-45deg\",\n        mailto: \"envelope\",\n        mms: \"chat\",\n        news: \"newspaper\",\n        nntp: \"newspaper\",\n        openpgp4fpr: \"key\",\n        sip: \"telephone\",\n        sms: \"chat\",\n        smsto: \"chat\",\n        ssh: \"lock\",\n        tel: \"telephone\",\n        urn: \"link-45deg\",\n        webcal: \"calendar\",\n        wtai: \"telephone\",\n        xmpp: \"chat\",\n    },\n\n    async init() {\n        // first make external links open in a new window, afterwards do the\n        // normal plone link wrapping in only the content area\n\n        let open_new_window = false;\n        if (typeof this.options.external_links_open_new_window === \"string\") {\n            open_new_window =\n                this.options.external_links_open_new_window.toLowerCase() === \"true\";\n        } else if (typeof this.options.external_links_open_new_window === \"boolean\") {\n            open_new_window = this.options.external_links_open_new_window;\n        }\n\n        let mark_special_links = false;\n        if (typeof this.options.mark_special_links === \"string\") {\n            mark_special_links =\n                this.options.mark_special_links.toLowerCase() === \"true\";\n        } else if (typeof this.options.mark_special_links === \"boolean\") {\n            mark_special_links = this.options.mark_special_links;\n        }\n\n        if (mark_special_links) {\n            import(\"./markspeciallinks.scss\");\n        }\n\n        // All links with an http href (without the link-plain class), not within this site,\n        // and no img children should be wrapped in a link-external span\n        const url = window.location.protocol + \"//\" + window.location.host;\n        const links = this.el.querySelectorAll(\n            `a[href]:not(.link-plain):not([href^=\"${url}\"]):not([href^=\"#\"])`\n        );\n        //:not(:has(img))\n        for (const link of links) {\n            let link_url;\n            try {\n                link_url = new URL(link.getAttribute(\"href\"));\n            } catch {\n                // Not a valid URL.\n                // Ignore and continue.\n                continue;\n            }\n\n            if (open_new_window && link_url.protocol.startsWith(\"http\")) {\n                link.setAttribute(\"target\", \"_blank\");\n                link.setAttribute(\"rel\", \"noopener\");\n            }\n\n            if (mark_special_links) {\n                const icon_name =\n                    this.protocol_icon_map[link_url.protocol.split(\":\")[0]];\n                if (icon_name) {\n                    const icon = await utils.resolveIcon(icon_name);\n                    const icon_el = dom.create_from_string(icon);\n                    icon_el.querySelector(\"svg\").classList.add(\"markspeciallinks__icon\");\n                    link.parentNode.insertBefore(icon_el, link);\n                }\n            }\n        }\n    },\n});\n","import { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport events from \"@patternslib/patternslib/src/core/events\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\nexport const parser = new Parser(\"navigationmarker\");\nparser.addArgument(\"portal-url\", undefined);\nparser.addArgument(\"parent-selector\", undefined);\n\nclass Pattern extends BasePattern {\n    static name = \"navigationmarker\";\n    static trigger = \".pat-navigationmarker\";\n    static parser = parser;\n\n    async init() {\n        this.portal_url = this.options.portalUrl || document.body.dataset.portalUrl;\n\n        events.add_event_listener(\n            window.navigation,\n            \"navigate\",\n            \"pat-navigationmarker--history-changed\",\n            () => {\n                this.scan_navigation();\n            }\n        );\n\n        this.scan_navigation();\n    }\n\n    scan_navigation() {\n        const href =\n            //document.querySelector('head link[rel=\"canonical\"]')?.href ||\n            window.location.href;\n\n        const anchors = this.el.querySelectorAll(\"a\");\n\n        for (const anchor of anchors) {\n\n            //const parent = anchor.parentElement;\n            const parent = this.options.parentSelector ? anchor.closest(this.options.parentSelector) : anchor.parentElement;\n            const navlink = anchor.href.replace(\"/view\", \"\");\n\n            // We can exit early, if the navlink is not part of the current URL.\n            if (href.indexOf(navlink) === -1) {\n                this.clear(parent);\n                this.clear(anchor);\n                continue;\n            }\n\n            //// BBB\n            //// check the input-openers within the path\n            //const check = parent.querySelector(\":scope > input\");\n            //if (check) {\n            //    check.checked = true;\n            //}\n\n            // set \"inPath\" to all nav items which are within the current path\n            // check if parts of navlink are in canonical url parts\n            //\n            const href_parts = href.split(\"/\");\n            const nav_parts = navlink.split(\"/\");\n            let inPath = false;\n\n            // The last part of the URL must match.\n            const nav_compare = nav_parts[nav_parts.length - 1];\n            const href_compare = href_parts[nav_parts.length - 1];\n            if (nav_compare === href_compare) {\n                inPath = true;\n            }\n\n            // Avoid marking \"Home\" with \"inPath\", when not actually there\n            if (navlink === this.portal_url && href !== this.portal_url) {\n                inPath = false;\n            }\n\n            // Set the class\n            if (inPath) {\n                // inPath is set along with current | TODO: OR NOT, verify.\n                parent.classList.add(\"inPath\");\n                if (parent.tagName === \"DETAILS\") {\n                    parent.open = true;\n                }\n\n            }\n\n            // set \"current\" to the current selected nav item, if it is in the navigation structure.\n            if (href === navlink) {\n                parent.classList.add(\"current\");\n                anchor.classList.add(\"current\");\n            }\n        }\n\n        this.el.dispatchEvent(events.generic_event(`${this.name}.scanned`));\n    }\n\n    clear(element) {\n        // Clear all classes\n        if (element.classList.contains(\"inPath\")) {\n            element.classList.remove(\"inPath\");\n        }\n        if (element.classList.contains(\"current\")) {\n            element.classList.remove(\"current\");\n        }\n        if (element.tagName === \"DETAILS\") {\n            element.open = false;\n        }\n    }\n}\n\n// Register Pattern class in the global pattern registry\nregistry.register(Pattern);\n\n// Make it available\nexport default Pattern;\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nfunction loadScript(src) {\n    var s,\n        i,\n        head,\n        scripts = document.getElementsByTagName(\"script\");\n\n    // Check script element doesn't already exist\n    for (i = 0; i < scripts.length; i++) {\n        if (scripts[i].src.indexOf(src) !== -1) {\n            return;\n        }\n    }\n\n    // If not, add it to page\n    s = document.createElement(\"script\");\n    s.type = \"text/javascript\";\n    s.async = true;\n    s.src = src;\n    // use head tag to find a place to insert the script node\n    head = document.getElementsByTagName(\"head\")[0];\n    head.insertBefore(s, head.firstChild);\n}\nfunction htmlToElement(html) {\n    var htmltmp = document.createElement(\"div\");\n    html = html.trim(); // Never return a text node of whitespace as the result\n    htmltmp.innerHTML = html;\n    return htmltmp.firstElementChild;\n}\n\nexport default Base.extend({\n    name: \"passwordstrength\",\n    trigger: \".pat-passwordstrength\",\n    parser: \"mockup\",\n    defaults: {\n        zxcvbn: \"//cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js\",\n    },\n    init: function () {\n        var self = this,\n            pwfield = this.el,\n            pwmeterContainer = htmlToElement(\n                '<div class=\"progress my-3\"><div class=\"progress-bar\" role=\"progressbar\" aria-valuemin=\"0\" aria-valuemax=\"100\" aria-valuenow=\"0\"></div></div>'\n            ),\n            pwmeter = pwmeterContainer.firstChild,\n            indicators = {\n                0: \"bg-transparent\",\n                1: \"bg-danger\",\n                2: \"bg-warning\",\n                3: \"bg-warning\",\n                4: \"bg-success\",\n            };\n        function setLevel() {\n            var score = 0;\n\n            if (pwfield.value.length > 0) {\n                // Run zxcvbn, supplying the value of any other widgets in the form\n                score = Math.max(\n                    1,\n                    window.zxcvbn(\n                        pwfield.value,\n                        [].map\n                            .call(\n                                (pwfield.form || { elements: [] }).elements,\n                                function (inp) {\n                                    if (inp === pwfield) {\n                                        return null;\n                                    }\n                                    return inp.value || null;\n                                }\n                            )\n                            .filter(function (x) {\n                                return x;\n                            })\n                    ).score\n                );\n            }\n            var wclass = \"\";\n            if (score != 0) {\n                wclass = \" w-\" + 25 * score;\n            }\n            pwmeter.className = \"progress-bar\" + wclass + \" \" + indicators[score];\n            pwmeter.setAttribute(\"aria-valuenow\", 25 * score);\n        }\n\n        pwfield.parentNode.insertBefore(pwmeterContainer, pwfield.nextSibling);\n        // set up key strokes to change the meter\n        pwfield.onkeyup = function () {\n            setLevel();\n        };\n        // init zxcvbn\n        if (typeof window.zxcvbn !== \"function\") {\n            // No zxcvbn yet, try and load it\n            loadScript(self.options.zxcvbn);\n        }\n        // initial pwmeter setting\n        setLevel();\n    },\n});\n","import $ from \"jquery\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"preventdoublesubmit\",\n    trigger: \".pat-preventdoublesubmit\",\n    parser: \"mockup\",\n    defaults: {\n        message: _t(\"You already clicked the submit button. Do you really want to submit this form again?\"), // prettier-ignore\n        guardClassName: \"submitting\",\n        optOutClassName: \"allowMultiSubmit\",\n    },\n    init() {\n        var self = this;\n\n        // if this is not a form just return\n        if (!self.$el.is(\"form\")) {\n            return;\n        }\n\n        $(\":submit\", self.$el).on(\"click\", function () {\n            // mark the button as clicked\n            $(\":submit\").removeAttr(\"clicked\");\n            $(this).attr(\"clicked\", \"clicked\");\n\n            // if submitting and no opt-out guardClassName is found\n            // pop up confirmation dialog\n            if (\n                $(this).hasClass(self.options.guardClassName) &&\n                !$(this).hasClass(self.options.optOutClassName)\n            ) {\n                return self._confirm.call(self);\n            }\n\n            $(this).addClass(self.options.guardClassName);\n        });\n    },\n\n    _confirm() {\n        return window.confirm(this.options.message);\n    },\n});\n","import $ from \"jquery\";\nimport Modal from \"../modal/modal\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport utils from \"../../core/utils\";\nimport _t from \"../../core/i18n-wrapper\";\n\nconst log = logger.getLogger(\"pat-manage-portlets\");\n\nexport default Base.extend({\n    name: \"manage-portlets\",\n    trigger: \".pat-manage-portlets\",\n    parser: \"mockup\",\n    messageTimeout: 0,\n    submitTimeout: 0,\n    switchTimeout: 0,\n    isModal: false,\n    dirty: false,\n    init: async function () {\n        (await import(\"jquery-form\")).default;\n        var that = this;\n        var $modal = that.$el.parents(\".plone-modal\");\n        if ($modal.length === 1) {\n            this.isModal = true;\n            /* want to do something on exit from modal now */\n            var modal = $modal.data(\"pattern-plone-modal\");\n            modal.on(\"hide\", function () {\n                if (that.dirty) {\n                    window.location.reload();\n                }\n            });\n            that.loading = modal.loading;\n        } else {\n            that.loading = utils.loading;\n        }\n        that.bind();\n    },\n    bind: function () {\n        var that = this;\n        that.setupAddDropdown();\n        that.setupSwitchPortletManager();\n        that.setupSavePortletsSettings();\n        that.setupPortletEdit();\n        if (that.isModal) {\n            /* if we're in a modal, it's possible we have a link to\n            parent case, bind the link so we can reload modal */\n            $(\".portlets-link-to-parent\")\n                .off(\"click\")\n                .on(\"click\", function (e) {\n                    that.loading.show();\n                    var $el = $(this);\n                    e.preventDefault();\n                    $.ajax({\n                        url: $el.attr(\"href\"),\n                        data: {\n                            ajax_load: 1,\n                        },\n                    }).done(function (html) {\n                        var $body = $(utils.parseBodyTag(html));\n                        var $modal = $el.parents(\".plone-modal-body\");\n                        $modal.empty();\n                        var $content = $(\"#content\", $body);\n                        var $h1 = $(\"h1\", $content);\n                        $(\".plone-modal-header\", $modal.parent())\n                            .find(\"h2\")\n                            .html($h1.html());\n                        $h1.remove();\n                        $modal.append($content);\n                        that.rebind($(\".pat-manage-portlets\", $content), true);\n                        that.loading.hide();\n                    });\n                });\n        }\n    },\n    rebind: function ($el, suppress) {\n        log.info(\"rebind\");\n        if ($.contains(document, this.$el[0])) {\n            // $el is not detached, replace it\n            this.$el.replaceWith($el);\n        }\n        this.$el = $el;\n        this.bind();\n        if (!suppress) {\n            this.statusMessage();\n        }\n        this.dirty = true;\n    },\n    statusMessage: function (msg) {\n        if (msg === undefined) {\n            msg = _t(\"Portlet changes saved\");\n        }\n        var that = this;\n\n        var $message = $(\"#portlet-message\");\n        if ($message.length === 0) {\n            $message = $(\n                '<div class=\"alert alert-info\" role=\"alert\" id=\"portlet-message\" style=\"opacity: 0\"></div>'\n            );\n            if (that.isModal) {\n                $(\".plone-modal-body:visible\").prepend($message);\n            } else {\n                $(\"#content-core\").prepend($message);\n            }\n        }\n        $message.html('<strong class=\"mr-1\">' + _t(\"Info\") + \"</strong>\" + msg);\n        clearTimeout(that.messageTimeout);\n        $message.fadeTo(500, 1);\n        that.messageTimeout = window.setTimeout(function () {\n            $message.fadeTo(500, 0.6);\n        }, 3000);\n    },\n    showEditPortlet: function (url) {\n        log.info(\"show edit portlet in modal\");\n        var that = this;\n        var $a = $(\"<a/>\");\n        $(\"body\").append($a);\n        var pattern = new Modal($a, {\n            ajaxUrl: url,\n            actionOptions: {\n                displayInModal: false,\n                reloadWindowOnClose: false,\n                isForm: true,\n                onSuccess: function (modal, html) {\n                    pattern.hide();\n                    var $body = $(utils.parseBodyTag(html));\n                    that.rebind($(\"#\" + that.$el.attr(\"id\"), $body).eq(0));\n                    that.statusMessage(_t(\"Portlet added\"));\n                },\n            },\n        });\n        pattern.on(\"after-render\", function () {\n            var $el = $(\"#\" + that.$el.attr(\"id\"), pattern.$raw);\n            /* this is a check that the add form doesn't just automatically\n            create the portlet without an actual form.\n            If element is found here, we can short circuit and\n            continue on. */\n            if ($el.length === 1) {\n                /* hacky, trying to prevent modal parts from flickering here */\n                $el = $el.clone();\n                pattern.on(\"shown\", function () {\n                    pattern.hide();\n                });\n                that.rebind($el);\n                that.statusMessage(_t(\"Portlet added\"));\n            }\n        });\n        pattern.show();\n    },\n    setupPortletEdit: function () {\n        var that = this;\n        $(\".managedPortlet .portletHeader > a\", that.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            that.showEditPortlet($(this).attr(\"href\"));\n        });\n    },\n    setupAddDropdown: function () {\n        var that = this;\n        $(\".add-portlet\", that.$el).on(\"change\", function (e) {\n            e.preventDefault();\n            var $select = $(this);\n            var $form = $select.parents(\"form\");\n            var contextUrl = $select.attr(\"data-context-url\");\n            var url =\n                contextUrl +\n                $select.val() +\n                \"?_authenticator=\" +\n                $('[name=\"_authenticator\"]').val() +\n                \"&referer=\" +\n                $('[name=\"referer\"]', $form).val();\n            that.showEditPortlet(url);\n        });\n    },\n    setupSavePortletsSettings: function () {\n        var that = this;\n        $(\".portlets-settings, form.portlet-action\", that.$el).ajaxForm({\n            beforeSubmit: function () {\n                that.loading.show();\n            },\n            success: function (html) {\n                that.loading.hide();\n                log.info(\"form submit\");\n                var $body = $(utils.parseBodyTag(html));\n                that.rebind($(\"#\" + that.$el.attr(\"id\"), $body).eq(0));\n            },\n        });\n        // Block/unblock inherited portlets (parent, group and content type portlets)\n        $(\".portlets-settings select\", that.$el).on(\"change\", function () {\n            log.info(\"select change\");\n            clearTimeout(that.submitTimeout);\n            that.submitTimeout = window.setTimeout(function () {\n                $(\".portlets-settings\", that.$el).trigger(\"submit\");\n            }, 100);\n        });\n    },\n    setupSwitchPortletManager: function () {\n        var that = this;\n        $(\"#main-container\").on(\"change\", \".switch-portlet-manager\", function (e) {\n            e.stopImmediatePropagation();\n            log.info(\"switch portlet manager\");\n            var url_ = $(this).val();\n            clearTimeout(that.switchTimeout);\n            that.switchTimeout = window.setTimeout(function () {\n                that._reloadPortletManager(url_);\n            }, 100);\n        });\n        // Handle back/forward browser buttons\n        $(window).on(\"popstate\", function (e) {\n            e.stopImmediatePropagation();\n            if (e && e.state === undefined) {\n                var url_ = window.location.href;\n                log.info(\"redirecting to: \" + url_);\n                that._reloadPortletManager(url_, true);\n            }\n        });\n    },\n    _reloadPortletManager: function (url_, is_popstate) {\n        var that = this;\n        that.loading.show();\n        $.get(url_, { ajax_load: 1 }).done(function (html) {\n            var $html = $(utils.parseBodyTag(html));\n            var $content = (\"#content\", $html);\n            $(\"#content\").html($content);\n            that.rebind($(\".pat-manage-portlets\", $content), true);\n            if (!is_popstate) {\n                window.history.pushState(null, null, url_);\n            } else {\n                window.history.replaceState(null, null, url_);\n            }\n            that.loading.hide();\n        });\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport DisplayTemplate from \"./templates/display.xml\";\nimport FormTemplate from \"./templates/form.xml\";\nimport OccurrenceTemplate from \"./templates/occurrence.xml\";\nimport Modal from \"../modal/modal\";\nimport utils from \"../../core/utils\";\n\n// Formatting function (mostly) from jQueryTools dateinput\nvar Re = /d{1,4}|m{1,4}|yy(?:yy)?|\"[^\"]*\"|'[^']*'/g;\n\nfunction zeropad(val, len) {\n    val = val.toString();\n    len = len || 2;\n    while (val.length < len) {\n        val = \"0\" + val;\n    }\n    return val;\n}\n\nfunction format(date, fmt, conf) {\n    var d = date.getDate(),\n        D = date.getDay(),\n        m = date.getMonth(),\n        y = date.getFullYear(),\n        flags = {\n            d: d,\n            dd: zeropad(d),\n            ddd: conf.localization.shortWeekdays[D],\n            dddd: conf.localization.weekdays[D],\n            m: m + 1,\n            mm: zeropad(m + 1),\n            mmm: conf.localization.shortMonths[m],\n            mmmm: conf.localization.months[m],\n            yy: String(y).slice(2),\n            yyyy: y,\n        };\n\n    var result = fmt.replace(Re, function ($0) {\n        return Object.prototype.hasOwnProperty.call(flags, $0)\n            ? flags[$0]\n            : $0.slice(1, $0.length - 1);\n    });\n\n    return result;\n}\n\nfunction widgetSaveToRfc5545(form, RDATE, EXDATE, conf, tz) {\n    var value = form.find(\"select[name=rirtemplate]\").val();\n    var rtemplate = conf.rtemplate[value];\n    var result = \"RRULE:\" + rtemplate.rrule;\n    var human = conf.localization.rtemplate[value];\n    var interval, month, year, occurrences, day;\n    var weekdays, i18nweekdays, input, monthlyType, index;\n    var yearlyType, rangeType;\n\n    for (const field_id of rtemplate.fields) {\n        const field = form.find(`#${field_id}`);\n\n        switch (field.attr(\"id\")) {\n            case \"ridailyinterval\":\n                interval = field.find(\"input[name=ridailyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.dailyInterval2}`;\n                break;\n\n            case \"riweeklyinterval\":\n                interval = field.find(\"input[name=riweeklyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.weeklyInterval2}`;\n                break;\n\n            case \"riweeklyweekdays\":\n                weekdays = [];\n                i18nweekdays = [];\n                for (let j = 0; j < conf.weekdays.length; j++) {\n                    input = field.find(`input[name=riweeklyweekdays${j}]`);\n                    if (input.is(\":checked\")) {\n                        weekdays.push(conf.weekdays[j]);\n                        i18nweekdays.push(conf.localization.weekdays[j]);\n                    }\n                }\n                if (weekdays.length > 0) {\n                    result += `;BYDAY=${weekdays.join(\",\")}`;\n                    human += ` ${\n                        conf.localization.weeklyWeekdaysHuman\n                    } ${i18nweekdays.join(\",\")}`;\n                }\n                break;\n\n            case \"rimonthlyinterval\":\n                interval = field.find(\"input[name=rimonthlyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.monthlyInterval2}`;\n                break;\n\n            case \"rimonthlyoptions\":\n                monthlyType = $(\"input[name=rimonthlytype]:checked\", form).val();\n                if (monthlyType === \"DAYOFMONTH\") {\n                    day = $(\"select[name=rimonthlydayofmonthday]\", form).val();\n                    result += `;BYMONTHDAY=${day}`;\n                    human += `, ${conf.localization.monthlyDayOfMonth1Human} ${day} ${conf.localization.monthlyDayOfMonth2}`;\n                } else if (monthlyType === \"WEEKDAYOFMONTH\") {\n                    index = $(\"select[name=rimonthlyweekdayofmonthindex]\", form).val();\n                    day =\n                        conf.weekdays[\n                            $(\"select[name=rimonthlyweekdayofmonth]\", form).val()\n                        ];\n                    if ([\"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\"].includes(day)) {\n                        result += `;BYDAY=${index}${day}`;\n                        human += `, ${conf.localization.monthlyWeekdayOfMonth1Human} `;\n                        human += `${\n                            conf.localization.orderIndexes[\n                                conf.orderIndexes.indexOf(index)\n                            ]\n                        } ${conf.localization.monthlyWeekdayOfMonth2} `;\n                        human += `${\n                            conf.localization.weekdays[conf.weekdays.indexOf(day)]\n                        } ${conf.localization.monthlyDayOfMonth2}`;\n                    }\n                }\n                break;\n\n            case \"riyearlyinterval\":\n                interval = field.find(\"input[name=riyearlyinterval]\").val();\n                if (interval !== \"1\") {\n                    result += `;INTERVAL=${interval}`;\n                }\n                human = `${interval} ${conf.localization.yearlyInterval2}`;\n                break;\n\n            case \"riyearlyoptions\":\n                yearlyType = $(\"input[name=riyearlyType]:checked\", form).val();\n                month = \"\";\n\n                if (yearlyType === \"DAYOFMONTH\") {\n                    month = $(\"select[name=riyearlydayofmonthmonth]\", form).val();\n                    day = $(\"select[name=riyearlydayofmonthday]\", form).val();\n                    result += `;BYMONTH=${month};BYMONTHDAY=${day}`;\n                    human += `, ${conf.localization.yearlyDayOfMonth1Human} ${\n                        conf.localization.months[month - 1]\n                    } ${day}`;\n                } else if (yearlyType === \"WEEKDAYOFMONTH\") {\n                    index = $(\"select[name=riyearlyweekdayofmonthindex]\", form).val();\n                    day =\n                        conf.weekdays[\n                            $(\"select[name=riyearlyweekdayofmonthday]\", form).val()\n                        ];\n                    month = $(\"select[name=riyearlyweekdayofmonthmonth]\", form).val();\n                    result += `;BYMONTH=${month}`;\n                    if ([\"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\", \"SU\"].includes(day)) {\n                        result += `;BYDAY=${index}${day}`;\n                        human += \", \" + conf.localization.yearlyWeekdayOfMonth1Human;\n                        human +=\n                            \" \" +\n                            conf.localization.orderIndexes[\n                                $.inArray(index, conf.orderIndexes)\n                            ];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth2;\n                        human +=\n                            \" \" +\n                            conf.localization.weekdays[$.inArray(day, conf.weekdays)];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth3;\n                        human += \" \" + conf.localization.months[month - 1];\n                        human += \" \" + conf.localization.yearlyWeekdayOfMonth4;\n                    }\n                }\n                break;\n\n            case \"rirangeoptions\":\n                rangeType = form.find(\"input[name=rirangetype]:checked\").val();\n                if (rangeType === \"BYOCCURRENCES\") {\n                    occurrences = form\n                        .find(\"input[name=rirangebyoccurrencesvalue]\")\n                        .val();\n                    result += `;COUNT=${occurrences}`;\n                    human += `, ${conf.localization.rangeByOccurrences1Human} ${occurrences} ${conf.localization.rangeByOccurrences2}`;\n                } else if (rangeType === \"BYENDDATE\") {\n                    let date = form.find(\"input[name=rirangebyenddatecalendar]\").val();\n                    if (date === \"\") {\n                        const today = new Date();\n                        date = `${today.getFullYear()}-${(today.getMonth() + 1)\n                            .toString()\n                            .padStart(2, \"0\")}-${today.getDate()}`;\n                    }\n                    result += `;UNTIL=${date.replaceAll(\"-\", \"\")}T000000${\n                        tz === true ? \"Z\" : \"\"\n                    }`;\n                    human += `, ${conf.localization.rangeByEndDateHuman} `;\n                    var date_parts = date.split(\"-\");\n                    human += format(\n                        new Date(date_parts[0], date_parts[1] - 1, date_parts[2]),\n                        conf.localization.longDateFormat,\n                        conf\n                    );\n                }\n                break;\n        }\n    }\n\n    if (RDATE.length) {\n        RDATE.sort();\n        let tmp_dates = [];\n        let tmp_human = [];\n\n        // make sure our additional RDATE dates have the same start time\n        // XXX: not used, remove if superfluous\n        //const rdate_time = start_date\n        //    ? `T${start_date.getHours()}:${start_date.getMinutes()}:00`\n        //    : \"T00:00:00\";\n\n        for (let rdate of RDATE) {\n            if (rdate !== \"\") {\n                // RDATE values are \"YYYY-MM-DD\"\n                // by adding \"T000000\" the recurrence sequence generator of\n                // plone.event.recurrence adds the current start time correctly\n                rdate += rdate.length === 10 ? \"T000000\" : \"\";\n                rdate += tz ? \"Z\" : \"\";\n                tmp_dates.push(rdate);\n\n                // human readable RDATE\n                year = parseInt(rdate.substring(0, 4), 10);\n                month = parseInt(rdate.substring(5, 7), 10) - 1;\n                day = parseInt(rdate.substring(8, 10), 10);\n                tmp_human.push(\n                    format(\n                        new Date(year, month, day),\n                        conf.localization.longDateFormat,\n                        conf\n                    )\n                );\n            }\n        }\n        if (tmp_dates.length) {\n            result += `\\nRDATE:${tmp_dates.join(\",\")}`;\n            human += `${conf.localization.including} ${tmp_human.join(\"; \")}`;\n        }\n    }\n\n    if (EXDATE.length) {\n        EXDATE.sort();\n        let tmp_dates = [];\n        let tmp_human = [];\n        for (let exdate of EXDATE) {\n            if (exdate !== \"\") {\n                // EXDATE values are \"YYYYMMDDTHHMMZ\"\n                tmp_dates.push(exdate);\n\n                // human readable EXDATE\n                year = parseInt(exdate.substring(0, 4), 10);\n                month = parseInt(exdate.substring(4, 6), 10) - 1;\n                day = parseInt(exdate.substring(6, 8), 10);\n                tmp_human.push(\n                    format(\n                        new Date(year, month, day),\n                        conf.localization.longDateFormat,\n                        conf\n                    )\n                );\n            }\n        }\n        if (tmp_dates.length) {\n            result += `\\nEXDATE:${tmp_dates.join(\",\")}`;\n            human += `${conf.localization.except} ${tmp_human.join(\"; \")}`;\n        }\n    }\n\n    return { result: result, description: human };\n}\n\nfunction parseLine(icalline) {\n    var result = {};\n    var pos = icalline.indexOf(\":\");\n    var property = icalline.substring(0, pos);\n    result.value = icalline.substring(pos + 1);\n\n    if (property.indexOf(\";\") !== -1) {\n        pos = property.indexOf(\";\");\n        result.parameters = property.substring(pos + 1);\n        result.property = property.substring(0, pos);\n    } else {\n        result.parameters = null;\n        result.property = property;\n    }\n    return result;\n}\n\nfunction cleanDates(dates) {\n    // Get rid of timezones\n    // TODO: We could parse dates and range here, maybe?\n    var result = [];\n\n    for (const date of dates.split(\",\")) {\n        if (date.indexOf(\"Z\") !== -1) {\n            result.push(date.substring(0, 15));\n        } else {\n            result.push(date);\n        }\n    }\n    return result;\n}\n\nfunction parseIcal(icaldata) {\n    var lines = [];\n    var result = {\n        RRULE: \"\",\n        RDATE: [],\n        EXDATE: [],\n    };\n    var line = null;\n    var nextline;\n\n    lines = icaldata.split(\"\\n\");\n    lines.reverse();\n    while (line !== \"\") {\n        if (lines.length > 0) {\n            nextline = lines.pop();\n            if (nextline.charAt(0) === \" \" || nextline.charAt(0) === \"\\t\") {\n                // Line continuation:\n                line = line + nextline;\n                continue;\n            }\n        } else {\n            nextline = \"\";\n        }\n\n        // New line; the current one is finished, add it to the result.\n        if (line !== null) {\n            line = parseLine(line);\n            // We ignore properties for now\n            if (line.property === \"RDATE\" || line.property === \"EXDATE\") {\n                result[line.property] = cleanDates(line.value);\n            } else {\n                result[line.property] = line.value;\n            }\n        }\n\n        line = nextline;\n    }\n    return result;\n}\n\nfunction widgetLoadFromRfc5545(form, conf, icaldata, force) {\n    var unsupportedFeatures = [];\n    var matches, rtemplate, d, input, index;\n    var selectors, field, radiobutton;\n    var freq, interval, byday, bymonth, bymonthday, count, until;\n    var day, month, year, weekday;\n\n    if (icaldata.RRULE === undefined) {\n        unsupportedFeatures.push(conf.localization.noRule);\n        if (!force) {\n            return -1; // Fail!\n        }\n    } else {\n        matches = /FREQ=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            freq = matches[1];\n        } else {\n            freq = \"DAILY\";\n        }\n\n        matches = /INTERVAL=([0-9]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            interval = matches[1];\n        } else {\n            interval = \"1\";\n        }\n\n        matches = /BYDAY=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            byday = matches[1];\n        } else {\n            byday = \"\";\n        }\n\n        matches = /BYMONTHDAY=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            bymonthday = matches[1].split(\",\");\n        } else {\n            bymonthday = null;\n        }\n\n        matches = /BYMONTH=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            bymonth = matches[1].split(\",\");\n        } else {\n            bymonth = null;\n        }\n\n        matches = /COUNT=([0-9]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            count = matches[1];\n        } else {\n            count = null;\n        }\n\n        matches = /UNTIL=([0-9T]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            until = matches[1];\n        } else {\n            until = null;\n        }\n\n        matches = /BYSETPOS=([^;]+);?/.exec(icaldata.RRULE);\n        if (matches) {\n            unsupportedFeatures.push(conf.localization.bysetpos);\n        }\n\n        // Find the best rule:\n        if (Object.prototype.hasOwnProperty.call(conf.rtemplate, freq.toLowerCase())) {\n            rtemplate = conf.rtemplate[freq.toLowerCase()];\n        } else {\n            for (freq of conf.rtemplate) {\n                /* fallback to first available template if no match above*/\n                rtemplate = conf.rtemplate[freq];\n                break;\n            }\n            unsupportedFeatures.push(conf.localization.noTemplateMatch);\n        }\n\n        // set rirtemplate selector to computed value\n        form.find(\"select[name='rirtemplate']\").val(freq.toLowerCase());\n\n        for (const field_id of rtemplate.fields) {\n            field = form.find(`#${field_id}`);\n            switch (field.attr(\"id\")) {\n                case \"ridailyinterval\":\n                    field.find(\"input[name=ridailyinterval]\").val(interval);\n                    break;\n\n                case \"riweeklyinterval\":\n                    field.find(\"input[name=riweeklyinterval]\").val(interval);\n                    break;\n\n                case \"riweeklyweekdays\":\n                    if (byday.length === 0) break;\n                    byday = byday.split(\",\");\n                    for (d = 0; d < conf.weekdays.length; d++) {\n                        input = field.find(`input[name=\"riweeklyweekdays${d}\"]`);\n                        if (input.length === 0) continue;\n                        day = conf.weekdays[d];\n                        input.attr(\"checked\", byday.includes(day));\n                    }\n                    break;\n\n                case \"rimonthlyinterval\":\n                    field.find(\"input[name=rimonthlyinterval]\").val(interval);\n                    break;\n\n                case \"rimonthlyoptions\":\n                    var monthlyType = \"DAYOFMONTH\"; // Default to using BYMONTHDAY\n\n                    if (bymonthday) {\n                        monthlyType = \"DAYOFMONTH\";\n                        if (bymonthday.length > 1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            // Just keep the first\n                            bymonthday = bymonthday[0];\n                        }\n                        field\n                            .find(\"select[name=rimonthlydayofmonthday]\")\n                            .val(bymonthday);\n                    }\n\n                    if (byday) {\n                        monthlyType = \"WEEKDAYOFMONTH\";\n\n                        if (byday.indexOf(\",\") !== -1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            byday = byday.split(\",\")[0];\n                        }\n                        index = byday.slice(0, -2);\n                        if (index.charAt(0) !== \"+\" && index.charAt(0) !== \"-\") {\n                            index = \"+\" + index;\n                        }\n                        weekday = byday.slice(-2);\n                        field\n                            .find(\"select[name=rimonthlyweekdayofmonthindex]\")\n                            .val(index);\n                        const day_index = conf.weekdays.indexOf(weekday);\n                        field.find(\"select[name=rimonthlyweekdayofmonth]\").val(day_index);\n                    }\n\n                    selectors = field.find(\"input[name=rimonthlytype]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\n                            \"checked\",\n                            radiobutton.value === monthlyType\n                        );\n                    }\n                    break;\n\n                case \"riyearlyinterval\":\n                    field.find(\"input[name=riyearlyinterval]\").val(interval);\n                    break;\n\n                case \"riyearlyoptions\":\n                    var yearlyType = \"DAYOFMONTH\"; // Default to using BYMONTHDAY\n\n                    if (bymonthday) {\n                        yearlyType = \"DAYOFMONTH\";\n                        if (bymonthday.length > 1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            bymonthday = bymonthday[0];\n                        }\n                        field.find(\"select[name=riyearlydayofmonthmonth]\").val(bymonth);\n                        field.find(\"select[name=riyearlydayofmonthday]\").val(bymonthday);\n                    }\n\n                    if (byday) {\n                        yearlyType = \"WEEKDAYOFMONTH\";\n\n                        if (byday.indexOf(\",\") !== -1) {\n                            // No support for multiple days in one month\n                            unsupportedFeatures.push(\n                                conf.localization.multipleDayOfMonth\n                            );\n                            byday = byday.split(\",\")[0];\n                        }\n                        index = byday.slice(0, -2);\n                        if (index.charAt(0) !== \"+\" && index.charAt(0) !== \"-\") {\n                            index = \"+\" + index;\n                        }\n                        weekday = byday.slice(-2);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthindex]\")\n                            .val(index);\n\n                        const weekday_index = conf.weekdays.indexOf(weekday);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthday]\")\n                            .val(weekday_index);\n                        field\n                            .find(\"select[name=riyearlyweekdayofmonthmonth]\")\n                            .val(bymonth);\n                    }\n\n                    selectors = field.find(\"input[name=riyearlyType]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\"checked\", radiobutton.value === yearlyType);\n                    }\n                    break;\n\n                case \"rirangeoptions\":\n                    // default value per configuration\n                    var rangeType = conf.hasRepeatForeverButton ? \"NOENDDATE\" : \"BYOCCURRENCES\";\n\n                    if (count) {\n                        rangeType = \"BYOCCURRENCES\";\n                        field.find(\"input[name=rirangebyoccurrencesvalue]\").val(count);\n                    }\n\n                    if (until) {\n                        rangeType = \"BYENDDATE\";\n                        input = field.find(\"input[name=rirangebyenddatecalendar]\");\n                        year = until.slice(0, 4);\n                        month = until.slice(4, 6);\n                        day = until.slice(6, 8);\n                        input.val(`${year}-${month}-${day}`);\n                    }\n\n                    selectors = field.find(\"input[name=rirangetype]\");\n                    for (index = 0; index < selectors.length; index++) {\n                        radiobutton = selectors[index];\n                        $(radiobutton).attr(\"checked\", radiobutton.value === rangeType);\n                    }\n                    break;\n            }\n        }\n    }\n\n    var messagearea = form.find(\"#messagearea\");\n    if (unsupportedFeatures.length !== 0) {\n        messagearea.text(\n            conf.localization.unsupportedFeatures + \" \" + unsupportedFeatures.join(\"; \")\n        );\n        messagearea.show();\n        return 1;\n    } else {\n        messagearea.text(\"\");\n        messagearea.hide();\n        return 0;\n    }\n}\n\nconst RecurrenceInput = function (conf, textarea) {\n    var self = this;\n    var $textarea = $(textarea);\n\n    // initalize parsed icaldata\n    if (textarea.innerHTML) {\n        textarea[\"ical\"] = parseIcal(textarea.innerHTML);\n    } else {\n        textarea[\"ical\"] = {\n            RRULE: \"\",\n            RDATE: [],\n            EXDATE: [],\n        };\n    }\n\n    // Extend conf with non-configurable data used by templates.\n    var orderedWeekdays = [];\n    var now_date = new Date().toISOString().substring(0, 10);\n    var index;\n\n    for (let i = 0; i < 7; i++) {\n        index = i + conf.firstDay;\n        if (index > 6) {\n            index = index - 7;\n        }\n        orderedWeekdays.push(index);\n    }\n\n    conf = {\n        ...conf,\n        orderIndexes: [\"+1\", \"+2\", \"+3\", \"+4\", \"-1\"],\n        weekdays: [\"SU\", \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\"],\n        orderedWeekdays: orderedWeekdays,\n    };\n\n    // The recurrence type dropdown should show certain fields depending\n    // on selection:\n    function displayFields(selector) {\n        // First hide all the fields\n        self.$modalForm.find(\".rifield\").hide();\n        // Then show the ones that should be shown.\n        var value = selector.val();\n        if (value) {\n            for (const rtField of conf.rtemplate[value].fields) {\n                self.$modalForm.find(`#${rtField}`).show();\n            }\n        }\n    }\n\n    function occurrenceExclude(event) {\n        event.preventDefault();\n        textarea[\"ical\"].EXDATE.push(this.attributes.date.value);\n        var $this = $(this);\n        $this.addClass(\"exdate\");\n        $this.parent().parent().addClass(\"exdate\");\n        $this.off(\"click\").on(\"click\", occurrenceInclude);\n    }\n\n    function occurrenceInclude(event) {\n        event.preventDefault();\n        textarea[\"ical\"].EXDATE.splice(\n            $.inArray(this.attributes.date.value, textarea[\"ical\"].EXDATE),\n            1\n        );\n        var $this = $(this);\n        $this.removeClass(\"exdate\");\n        $this.parent().parent().removeClass(\"exdate\");\n        $this.off(\"click\").on(\"click\", occurrenceExclude);\n    }\n\n    function occurrenceDelete(event) {\n        event.preventDefault();\n        textarea[\"ical\"].RDATE.splice(\n            $.inArray(this.attributes.date.value, textarea[\"ical\"].RDATE),\n            1\n        );\n        $(this)\n            .parent()\n            .parent()\n            .hide(\"slow\", function () {\n                $(this).remove();\n            });\n    }\n\n    function occurrenceAdd(event) {\n        event.preventDefault();\n        var datevalue = self.$modalForm.find(\".riaddoccurrence input#adddate\").val();\n        var date_parts = datevalue.split(\"-\");\n        datevalue += datevalue.length === 10 ? \"T000000\" : \"\";\n        var errorarea = self.$modalForm.find(\".riaddoccurrence div.alert\");\n        errorarea.text(\"\");\n        errorarea.hide();\n\n        // Add date only if it is not already in RDATE\n        if (!textarea[\"ical\"].RDATE.includes(datevalue)) {\n            textarea[\"ical\"].RDATE.push(datevalue);\n            var $newdate =\n                $(`<div class=\"d-flex justify-content-between occurrence rdate\">\n                <span class=\"rdate\">\n                    ${format(\n                        new Date(date_parts[0], date_parts[1] - 1, date_parts[2]),\n                        conf.localization.longDateFormat,\n                        conf\n                    )},\n                    <span class=\"rlabel\">${conf.localization.additionalDate}</span>\n                </span>\n                <span class=\"action\">\n                    <a date=\"${datevalue}\" href=\"#\" class=\"btn btn-sm btn-secondary rdate\" >\n                        ${conf.icons.remove}\n                    </a>\n                </span>\n                </div>`);\n            $newdate.hide();\n            self.$modalForm.find(\"div.rioccurrences\").prepend($newdate);\n            $newdate.slideDown();\n            $newdate.find(\"a.rdate\").on(\"click\", occurrenceDelete);\n        } else {\n            errorarea.text(conf.localization.alreadyAdded).show();\n        }\n    }\n\n    // element is where to find the tag in question. Can be the form\n    // or the display widget. Defaults to the self.$modalForm.\n    function loadOccurrences(startdate, rfc5545, start, readonly) {\n        var element, occurrenceDiv;\n\n        if (!readonly) {\n            element = self.$modalForm;\n        } else {\n            element = self.display;\n        }\n\n        occurrenceDiv = element.find(\".rioccurrences\");\n        occurrenceDiv.hide();\n\n        const year = startdate.getFullYear();\n        const month = startdate.getMonth() + 1;\n        const day = startdate.getDate();\n\n        var data = {\n            year: year,\n            month: month, // Sending January as 0? I think not.\n            day: day,\n            rrule: rfc5545,\n            format: conf.localization.longDateFormat,\n            start: start,\n        };\n\n        $.ajax({\n            url: conf.ajaxURL,\n            async: false, // Can't be tested if it's asynchronous, annoyingly.\n            type: \"post\",\n            dataType: \"json\",\n            contentType: conf.ajaxContentType,\n            cache: false,\n            data: data,\n            success: function (resp) {\n                var result;\n\n                resp.readOnly = readonly;\n                resp.localization = conf.localization;\n                resp.icons = conf.icons;\n\n                // Format dates:\n                var date, y, m, d;\n                for (let occurrence of resp.occurrences) {\n                    date = occurrence.date;\n                    y = parseInt(date.substring(0, 4), 10);\n                    m = parseInt(date.substring(4, 6), 10) - 1; // jan=0\n                    d = parseInt(date.substring(6, 8), 10);\n                    occurrence.date = `${y}-${zeropad(m+1)}-${zeropad(d)}T000000`;\n                    occurrence.formattedDate = format(\n                        new Date(y, m, d),\n                        conf.localization.longDateFormat,\n                        conf\n                    );\n                }\n\n                result = _.template(OccurrenceTemplate)(resp);\n                occurrenceDiv.replaceWith(result);\n\n                // Add the batch actions:\n                element.find(\".rioccurrences .batching a\").on(\"click\", function (event) {\n                    event.stopPropagation();\n                    event.preventDefault();\n                    loadOccurrences(\n                        startdate,\n                        rfc5545,\n                        this.attributes.start.value,\n                        readonly\n                    );\n                });\n\n                // Add the delete/undelete actions:\n                if (!readonly) {\n                    element\n                        .find(\".rioccurrences .action a.rrule\")\n                        .on(\"click\", occurrenceExclude);\n                    element\n                        .find(\".rioccurrences .action a.exdate\")\n                        .on(\"click\", occurrenceInclude);\n                    element\n                        .find(\".rioccurrences .action a.rdate\")\n                        .on(\"click\", occurrenceDelete);\n                }\n                // Show the new div\n                occurrenceDiv.show();\n            },\n            error: function (jqXHR, textStatus) {\n                alert(textStatus);\n            },\n        });\n    }\n\n    function getField(field) {\n        // See if it is a field already\n        var realField = $(field);\n        if (!realField.length) {\n            // Otherwise, we assume it's an id:\n            realField = $(\"#\" + field);\n        }\n        if (!realField.length) {\n            // Still not? Then it's a name.\n            realField = $(\"input[name='\" + field + \"']\");\n        }\n        return realField;\n    }\n    function findStartDate() {\n        var startdate = null;\n        var startField, startFieldYear, startFieldMonth, startFieldDay;\n\n        // Find the default byday and bymonthday from the start date, if any:\n        if (conf.startField) {\n            startField = getField(conf.startField);\n            if (!startField.length) {\n                // Field not found\n                return null;\n            }\n            startdate = startField.val();\n            if (startdate === \"\") {\n                // Probably not an input at all. Try to see if it contains a date\n                startdate = startField.text();\n            }\n\n            if (typeof startdate === \"string\") {\n                // convert human readable, non ISO8601 dates, like\n                // '2014-04-24 19:00', where the 'T' separator is missing.\n                startdate = startdate.replace(\" \", \"T\");\n            }\n\n            startdate = new Date(startdate);\n        } else if (conf.startFieldYear && conf.startFieldMonth && conf.startFieldDay) {\n            startFieldYear = getField(conf.startFieldYear);\n            startFieldMonth = getField(conf.startFieldMonth);\n            startFieldDay = getField(conf.startFieldDay);\n            if (\n                !startFieldYear.length &&\n                !startFieldMonth.length &&\n                !startFieldDay.length\n            ) {\n                // Field not found\n                return null;\n            }\n            startdate = new Date(\n                startFieldYear.val(),\n                startFieldMonth.val() - 1,\n                startFieldDay.val()\n            );\n        }\n        if (startdate === null) {\n            return null;\n        }\n        // We have some sort of startdate:\n        if (isNaN(startdate)) {\n            return null;\n        }\n        return startdate;\n    }\n    function findEndDate() {\n        var endField, enddate;\n\n        endField = self.$modalForm.find(\"input[name=rirangebyenddatecalendar]\");\n        enddate = endField.val();\n        enddate = new Date(enddate);\n\n        // if the end date is incorrect or the field is left empty\n        if (isNaN(enddate) || endField.val() === \"\") {\n            return null;\n        }\n        return enddate;\n    }\n    function findIntField(fieldName) {\n        var field, num;\n\n        field = self.$modalForm.find(\"input[name=\" + fieldName + \"]\");\n\n        num = field.val();\n\n        // if it's not a number or the field is left empty\n        if (isNaN(num) || num.toString().indexOf(\".\") !== -1 || field.val() === \"\") {\n            return null;\n        }\n        return num;\n    }\n\n    // Loading (populating) display and form widget with\n    // passed RFC5545 string (data)\n    function loadData(form) {\n        widgetLoadFromRfc5545(form, conf, textarea[\"ical\"], true);\n\n        const startdate = findStartDate();\n\n        if (startdate !== null) {\n            // If the date is a real date, set the defaults in the form\n            document.querySelector(\"select[name=rimonthlydayofmonthday]\").value =\n                startdate.getDate();\n            const dayindex =\n                conf.orderIndexes[Math.floor((startdate.getDate() - 1) / 7)];\n            const day = conf.weekdays[startdate.getDay()];\n            document.querySelector(\"select[name=rimonthlyweekdayofmonthindex]\").value =\n                dayindex;\n            document.querySelector(\"select[name=rimonthlyweekdayofmonth]\").value = day;\n\n            document.querySelector(\"select[name=riyearlydayofmonthmonth]\").value =\n                startdate.getMonth() + 1;\n            document.querySelector(\"select[name=riyearlydayofmonthday]\").value =\n                startdate.getDate();\n            document.querySelector(\"select[name=riyearlyweekdayofmonthindex]\").value =\n                dayindex;\n            document.querySelector(\"select[name=riyearlyweekdayofmonthday]\").value = day;\n            document.querySelector(\"select[name=riyearlyweekdayofmonthmonth]\").value =\n                startdate.getMonth() + 1;\n\n            // Now when we have a start date, we can also do an ajax call to calculate occurrences:\n            var rfc5545 =\n                textarea.innerHTML ||\n                widgetSaveToRfc5545(\n                    form,\n                    textarea[\"ical\"].RDATE,\n                    textarea[\"ical\"].EXDATE,\n                    conf,\n                    false\n                ).result;\n\n            loadOccurrences(startdate, rfc5545, 0, false);\n\n            // Show the add and refresh buttons:\n            document.querySelector(\"div.rioccurrencesactions\").style.display = \"block\";\n        } else {\n            // No EXDATE/RDATE support\n            document.querySelector(\"div.rioccurrencesactions\").style.display = \"none\";\n        }\n\n        displayFields(form.find(\"select[name=rirtemplate]\"));\n    }\n\n    function recurrenceOn(form) {\n        var RFC5545 = widgetSaveToRfc5545(\n            form,\n            textarea[\"ical\"].RDATE,\n            textarea[\"ical\"].EXDATE,\n            conf,\n            false\n        );\n        var label = self.display.find(\"label[class=ridisplay-label]\");\n        label.text(conf.localization.displayActivate + \" \" + RFC5545.description);\n        textarea[\"ical\"] = parseIcal(RFC5545.result);\n        textarea.innerHTML = RFC5545.result;\n        $textarea.trigger(\"change\");\n        var startdate = findStartDate();\n        if (startdate !== null) {\n            loadOccurrences(startdate, RFC5545.result, 0, true);\n        }\n        self.display.find('a[name=\"riedit\"]').text(conf.localization.edit_rules);\n        self.display.find('a[name=\"ridelete\"]').show();\n    }\n\n    function recurrenceOff() {\n        var label = self.display.find(\"label[class=ridisplay-label]\");\n        label.text(conf.localization.displayUnactivate);\n        // reset ical object\n        textarea[\"ical\"] = {\n            RRULE: \"\",\n            RDATE: [],\n            EXDATE: [],\n        };\n        textarea.innerHTML = \"\";\n        $textarea.trigger(\"change\"); // Clear the textarea.\n        self.display.find(\".rioccurrences\").hide();\n        self.display.find('a[name=\"riedit\"]').text(conf.localization.add_rules);\n        self.display.find('a[name=\"ridelete\"]').hide();\n    }\n\n    function checkFields(form) {\n        var startDate, endDate, num, messagearea;\n        startDate = findStartDate();\n\n        // Hide any error message from before\n        messagearea = self.$modalForm.find(\"#messagearea\");\n        messagearea.text(\"\");\n        messagearea.hide();\n\n        // Hide add field errors\n        self.$modalForm.find(\".riaddoccurrence div.alert\").text(\"\").hide();\n\n        // Repeats Daily\n        if (self.$modalForm.find(\"#ridailyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"ridailyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n        }\n\n        // Repeats Weekly\n        if (self.$modalForm.find(\"#riweeklyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"riweeklyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n        }\n\n        // Repeats Monthly\n        if (self.$modalForm.find(\"#rimonthlyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"rimonthlyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n\n            // Check repeat on\n            if (self.$modalForm.find(\"#rimonthlyoptions input:checked\").length === 0) {\n                messagearea.text(conf.localization.noRepeatOn).show();\n                return false;\n            }\n        }\n\n        // Repeats Yearly\n        if (self.$modalForm.find(\"#riyearlyinterval\").css(\"display\") === \"block\") {\n            // Check repeat every field\n            num = findIntField(\"riyearlyinterval\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noRepeatEvery).show();\n                return false;\n            }\n\n            // Check repeat on\n            if (self.$modalForm.find(\"#riyearlyoptions input:checked\").length === 0) {\n                messagearea.text(conf.localization.noRepeatOn).show();\n                return false;\n            }\n        }\n\n        // End recurrence fields\n\n        // If after N occurences is selected, check its value\n        if (\n            self.$modalForm.find('input[value=\"BYOCCURRENCES\"]:visible:checked').length >\n            0\n        ) {\n            num = findIntField(\"rirangebyoccurrencesvalue\", form);\n            if (!num || num < 1 || num > 1000) {\n                messagearea.text(conf.localization.noEndAfterNOccurrences).show();\n                return false;\n            }\n        }\n\n        // If end date is selected, check its value\n        if (\n            self.$modalForm.find('input[value=\"BYENDDATE\"]:visible:checked').length > 0\n        ) {\n            endDate = findEndDate(form);\n            if (!endDate) {\n                // if endDate is null that means the field is empty\n                messagearea.text(conf.localization.noEndDate).show();\n                return false;\n            } else if (endDate < startDate) {\n                // the end date cannot be before start date\n                messagearea.text(conf.localization.pastEndDate).show();\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    function save(event) {\n        event.preventDefault();\n        // if no field errors, process the request\n        if (checkFields(self.$modalForm)) {\n            // close modal\n            self.modal.hide();\n            recurrenceOn(self.$modalForm);\n            self.$modalForm = null;\n        }\n    }\n\n    function cancel(event) {\n        event.preventDefault();\n        // close modal\n        self.modal.hide();\n        self.$modalForm = null;\n    }\n\n    function updateOccurrences() {\n        var startDate;\n        startDate = findStartDate();\n\n        // if no field errors, process the request\n        if (checkFields(form)) {\n            loadOccurrences(\n                startDate,\n                widgetSaveToRfc5545(\n                    self.$modalForm,\n                    textarea[\"ical\"].RDATE,\n                    textarea[\"ical\"].EXDATE,\n                    conf,\n                    false\n                ).result,\n                0,\n                false\n            );\n        }\n    }\n\n    function initModalForm() {\n        var enddate = self.$modalForm.find(\"input[name=rirangebyenddatecalendar]\");\n        if (!enddate.val()) {\n            var start_date = findStartDate();\n            start_date.setDate(start_date.getDate() + 1);\n            enddate.val(start_date.toISOString().substring(0, 10));\n        }\n\n        self.$modalForm.find(\"input#addaction\").on(\"click\", occurrenceAdd);\n\n        // When selecting template, update what fieldsets are visible and the occurrences.\n        self.$modalForm.find('select[name=\"rirtemplate\"]').on(\"change\", function () {\n            displayFields($(this));\n            updateOccurrences();\n        });\n\n        // Update the selected dates section\n        self.$modalForm\n            .find(\n                `\n                input:radio,\n                input:checkbox,\n                .riweeklyweekday > input,\n                input[name=ridailyinterval],\n                input[name=riweeklyinterval],\n                input[name=rimonthlyinterval],\n                input[name=riyearlyinterval],\n                input[name=rirangebyoccurrencesvalue],\n                input[name=rirangebyenddatecalendar],\n                #rimonthlyoptions select,\n                #riyearlyoptions select,\n                #riyearlyinterval select`\n            )\n            .on(\"change\", function () {\n                // Update only if the occurances are shown\n                if (self.$modalForm.find(\".rioccurrencesactions:visible\").length !== 0) {\n                    updateOccurrences();\n                }\n            });\n\n        // initialize occurrence adddate value\n        self.$modalForm.find(\"div.riaddoccurrence input#adddate\").val(now_date);\n\n        /*\n        Save and cancel methods:\n        */\n        self.$modalForm.find(\".ricancelbutton\").on(\"click\", cancel);\n        self.$modalForm.find(\".risavebutton\").on(\"click\", save);\n    }\n\n    /*\n      Load the templates\n    */\n\n    self.display = $(_.template(DisplayTemplate)(conf));\n    var form = $(_.template(FormTemplate)(conf));\n\n    form.appendTo(\"body\");\n    form.hide();\n\n    // Make an modal and hide it\n    self.modal = new Modal(form, {\n        content: \"div.riform\",\n        buttons: \".ributtons > button\",\n        modalSizeClass: \"modal-lg\",\n        backdropOptions: {\n            opacity: \"0.5\",\n        },\n    });\n\n    if (textarea.innerHTML) {\n        var result = widgetLoadFromRfc5545(form, conf, textarea[\"ical\"], false);\n        if (result === -1) {\n            var label = self.display.find(\"label[class=ridisplay-label]\");\n            label.text(conf.localization.noRule);\n        } else {\n            recurrenceOn(form);\n        }\n    }\n\n    /*\n      Do all the GUI stuff:\n    */\n\n    // When you click \"Delete...\", the recurrence rules should be cleared.\n    self.display.find('a[name=\"ridelete\"]').on(\"click\", function (e) {\n        e.preventDefault();\n        recurrenceOff();\n    });\n\n    // Show form modal when you click on the \"Edit...\" link\n    self.display.find('a[name=\"riedit\"]').on(\"click\", function (e) {\n        // Load the form to set up the right fields to show, etc.\n        e.preventDefault();\n        self.modal.show();\n        self.$modalForm = $(\"form\", self.modal.$modalContent);\n        loadData(self.$modalForm);\n        initModalForm();\n    });\n};\n\nexport default Base.extend({\n    name: \"recurrence\",\n    trigger: \".pat-recurrence\",\n    parser: \"mockup\",\n    defaults: {\n        localization: {\n            displayUnactivate: \"Does not repeat\",\n            displayActivate: \"Repeats every\",\n            add_rules: \"Add\",\n            edit_rules: \"Edit\",\n            delete_rules: \"Delete\",\n            add: \"Add\",\n            refresh: \"Refresh\",\n\n            title: \"Repeat\",\n            preview: \"Selected dates\",\n            addDate: \"Add date\",\n\n            recurrenceType: \"Repeats:\",\n\n            dailyInterval1: \"Repeat every:\",\n            dailyInterval2: \"days\",\n\n            weeklyInterval1: \"Repeat every:\",\n            weeklyInterval2: \"week(s)\",\n            weeklyWeekdays: \"Repeat on:\",\n            weeklyWeekdaysHuman: \"on:\",\n\n            monthlyInterval1: \"Repeat every:\",\n            monthlyInterval2: \"month(s)\",\n            monthlyDayOfMonth1: \"Day\",\n            monthlyDayOfMonth1Human: \"on day\",\n            monthlyDayOfMonth2: \"of the month\",\n            monthlyDayOfMonth3: \"month(s)\",\n            monthlyWeekdayOfMonth1: \"The\",\n            monthlyWeekdayOfMonth1Human: \"on the\",\n            monthlyWeekdayOfMonth2: \"\",\n            monthlyWeekdayOfMonth3: \"of the month\",\n            monthlyRepeatOn: \"Repeat on:\",\n\n            yearlyInterval1: \"Repeat every:\",\n            yearlyInterval2: \"year(s)\",\n            yearlyDayOfMonth1: \"Every\",\n            yearlyDayOfMonth1Human: \"on\",\n            yearlyDayOfMonth2: \"\",\n            yearlyDayOfMonth3: \"\",\n            yearlyWeekdayOfMonth1: \"The\",\n            yearlyWeekdayOfMonth1Human: \"on the\",\n            yearlyWeekdayOfMonth2: \"\",\n            yearlyWeekdayOfMonth3: \"of\",\n            yearlyWeekdayOfMonth4: \"\",\n            yearlyRepeatOn: \"Repeat on:\",\n\n            range: \"End recurrence:\",\n            rangeNoEnd: \"Never\",\n            rangeByOccurrences1: \"After\",\n            rangeByOccurrences1Human: \"ends after\",\n            rangeByOccurrences2: \"occurrence(s)\",\n            rangeByEndDate: \"On\",\n            rangeByEndDateHuman: \"ends on\",\n\n            including: \", and also\",\n            except: \", except for\",\n\n            cancel: \"Cancel\",\n            save: \"Save\",\n\n            recurrenceStart: \"Start of the recurrence\",\n            additionalDate: \"Additional date\",\n            include: \"Include\",\n            exclude: \"Exclude\",\n            remove: \"Remove\",\n\n            orderIndexes: [\"first\", \"second\", \"third\", \"fourth\", \"last\"],\n            months: [\n                \"January\",\n                \"February\",\n                \"March\",\n                \"April\",\n                \"May\",\n                \"June\",\n                \"July\",\n                \"August\",\n                \"September\",\n                \"October\",\n                \"November\",\n                \"December\",\n            ],\n            shortMonths: [\n                \"Jan\",\n                \"Feb\",\n                \"Mar\",\n                \"Apr\",\n                \"May\",\n                \"Jun\",\n                \"Jul\",\n                \"Aug\",\n                \"Sep\",\n                \"Oct\",\n                \"Nov\",\n                \"Dec\",\n            ],\n            weekdays: [\n                \"Sunday\",\n                \"Monday\",\n                \"Tuesday\",\n                \"Wednesday\",\n                \"Thursday\",\n                \"Friday\",\n                \"Saturday\",\n            ],\n            shortWeekdays: [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"],\n\n            longDateFormat: \"mmmm dd, yyyy\",\n            shortDateFormat: \"mm/dd/yyyy\",\n\n            unsupportedFeatures:\n                \"Warning: This event uses recurrence features not \" +\n                \"supported by this widget. Saving the recurrence \" +\n                \"may change the recurrence in unintended ways:\",\n            noTemplateMatch: \"No matching recurrence template\",\n            multipleDayOfMonth:\n                \"This widget does not support multiple days in monthly or yearly recurrence\",\n            bysetpos: \"BYSETPOS is not supported\",\n            noRule: \"No RRULE in RRULE data\",\n            noRepeatEvery: 'Error: The \"Repeat every\"-field must be between 1 and 1000',\n            noEndDate: \"Error: End date is not set. Please set a correct value\",\n            noRepeatOn: 'Error: \"Repeat on\"-value must be selected',\n            pastEndDate: \"Error: End date cannot be before start date\",\n            noEndAfterNOccurrences:\n                'Error: The \"After N occurrences\"-field must be between 1 and 1000',\n            alreadyAdded: \"This date was already added\",\n\n            rtemplate: {\n                daily: \"Daily\",\n                mondayfriday: \"Monday and Friday\",\n                weekdays: \"Weekday\",\n                weekly: \"Weekly\",\n                monthly: \"Monthly\",\n                yearly: \"Yearly\",\n            },\n        },\n\n        readOnly: false,\n        firstDay: 0,\n\n        // \"REMOTE\" FIELD\n        startField: null,\n        startFieldYear: null,\n        startFieldMonth: null,\n        startFieldDay: null,\n        ajaxURL: null,\n        ajaxContentType: \"application/json; charset=utf8\",\n        ributtonExtraClass: \"\",\n\n        // INPUT CONFIGURATION\n        hasRepeatForeverButton: true,\n\n        // JQUERY TEMPLATE NAMES\n        template: {\n            form: \"#jquery-recurrenceinput-form-tmpl\",\n            display: \"#jquery-recurrenceinput-display-tmpl\",\n        },\n\n        // RECURRENCE TEMPLATES\n        rtemplate: {\n            daily: {\n                rrule: \"FREQ=DAILY\",\n                fields: [\"ridailyinterval\", \"rirangeoptions\"],\n            },\n            mondayfriday: {\n                rrule: \"FREQ=WEEKLY;BYDAY=MO,FR\",\n                fields: [\"rirangeoptions\"],\n            },\n            weekdays: {\n                rrule: \"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR\",\n                fields: [\"rirangeoptions\"],\n            },\n            weekly: {\n                rrule: \"FREQ=WEEKLY\",\n                fields: [\"riweeklyinterval\", \"riweeklyweekdays\", \"rirangeoptions\"],\n            },\n            monthly: {\n                rrule: \"FREQ=MONTHLY\",\n                fields: [\"rimonthlyinterval\", \"rimonthlyoptions\", \"rirangeoptions\"],\n            },\n            yearly: {\n                rrule: \"FREQ=YEARLY\",\n                fields: [\"riyearlyinterval\", \"riyearlyoptions\", \"rirangeoptions\"],\n            },\n        },\n    },\n\n    load_icons: async function () {\n        return {\n            reload: await utils.resolveIcon(\"arrow-clockwise\"),\n            remove: await utils.resolveIcon(\"trash\"),\n            exclude: await utils.resolveIcon(\"calendar-x\"),\n            include: await utils.resolveIcon(\"plus-circle\"),\n        };\n    },\n\n    init: async function () {\n        // tmpl BEFORE recurrenceinput\n        import(\"./recurrence.scss\");\n\n        this.el.classList.add(\"recurrence-widget\");\n        var icons = await this.load_icons();\n\n        var config = {\n            ...this.options,\n            ...this.options.configuration,\n            icons: icons,\n        };\n\n        // our recurrenceinput widget instance\n        var recurrenceinput = new RecurrenceInput(config, this.el);\n        // hide textarea and place display widget after textarea\n        this.$el.after(recurrenceinput.display);\n\n        // hide the textarea\n        this.el.style.display = \"none\";\n    },\n});\n","// Plone extended search.\nimport $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"search\",\n    trigger: \".pat-search\",\n    init: function () {\n        var loading = new utils.Loading();\n\n        var $filter = $(\"#search-filter\");\n        var $filterBtn = $(\"#search-filter-toggle\", $filter);\n        var $advSearchInput = $(\"#advanced-search-input\");\n        var $ctSelectAll = $(\"#pt_toggle\");\n        var $selectAllContainer = $(\".search-type-options\");\n        var $sortingContainer = $(\"#sorting-options\");\n\n        /* handle history */\n        if (window.history && window.history.pushState) {\n            $(window).on(\"popstate\", function () {\n                /* we're just going to cheat and reload the page so\n                   we aren't keep moving around state here..\n                   Here, I'm lazy, we're not using react here... */\n                window.location = window.location.href;\n            });\n        }\n\n        var pushHistory = function () {\n            if (window.history && window.history.pushState) {\n                var url =\n                    window.location.origin +\n                    window.location.pathname +\n                    \"?\" +\n                    $(\"#searchform\").serialize();\n                window.history.pushState(null, null, url);\n            }\n        };\n\n        var timeout = 0;\n        var search = function () {\n            loading.show();\n            pushHistory();\n            $.ajax({\n                url: window.location.origin + window.location.pathname + \"?ajax_load=1\",\n                data: $(\"#searchform\").serialize(),\n            }).done(function (html) {\n                var $html = $(html);\n                $(\"#search-results\").replaceWith($(\"#search-results\", $html));\n                $(\"#search-term\").replaceWith($(\"#search-term\", $html));\n                $(\"#results-count\").replaceWith($(\"#results-count\", $html));\n                loading.hide();\n            });\n        };\n        var searchDelayed = function () {\n            clearTimeout(timeout);\n            timeout = setTimeout(search, 200);\n        };\n\n        var setBatchStart = function (b_start) {\n            $(\"#search-batch-start\").attr(\"value\", b_start);\n        };\n\n        // for sorme reason the backend always flag with active class the sorting options\n        var updateSortingState = function ($el) {\n            $(\"a\", $sortingContainer).removeClass(\"active\");\n            $el.addClass(\"active\");\n        };\n        var default_sort = $(\"#search-results\").attr(\"data-default-sort\");\n        updateSortingState($(\"a[data-sort=\" + default_sort + \"]\"));\n\n        /* sorting */\n        $(\"a\", $sortingContainer).on(\"click\", function (e) {\n            e.preventDefault();\n            updateSortingState($(this));\n            var sort = $(this).attr(\"data-sort\");\n            var order = $(this).attr(\"data-order\");\n            if (sort) {\n                $('[name=\"sort_on\"]').attr(\"value\", sort);\n                if (order && order == \"reverse\") {\n                    $('[name=\"sort_order\"]').attr(\"value\", \"reverse\");\n                } else {\n                    $('[name=\"sort_order\"]').attr(\"value\", \"\");\n                }\n            } else {\n                $('[name=\"sort_on\"]').attr(\"value\", \"\");\n                $('[name=\"sort_order\"]').attr(\"value\", \"\");\n            }\n            search();\n        });\n\n        /* form submission */\n        $(\".searchPage\").on(\"submit\", function (e) {\n            e.preventDefault();\n            setBatchStart(\"0\");\n            search();\n        });\n\n        /* filters */\n        $filterBtn.on(\"click\", function (e) {\n            e.preventDefault();\n            $filter.toggleClass(\"activated\");\n            if ($filter.hasClass(\"activated\")) {\n                $advSearchInput.attr(\"value\", \"True\");\n            } else {\n                $advSearchInput.attr(\"value\", \"False\");\n            }\n        });\n\n        $ctSelectAll.on(\"change\", function () {\n            if ($ctSelectAll[0].checked) {\n                $(\"input\", $selectAllContainer).each(function () {\n                    this.checked = true;\n                });\n            } else {\n                $(\"input\", $selectAllContainer).each(function () {\n                    this.checked = false;\n                });\n            }\n        });\n\n        $(\"input\", $filter).on(\"change\", function () {\n            setBatchStart(\"0\");\n            searchDelayed();\n        });\n\n        /* pagination */\n        $(\"#searchform\").on(\"click\", \".pagination a\", function (e) {\n            var urlParams = new URLSearchParams($(e.currentTarget).attr(\"href\")),\n                b_start = urlParams.get(\"b_start:int\");\n            if (!b_start) {\n                // not plone pagination\n                return;\n            }\n            e.preventDefault();\n            setBatchStart(b_start);\n            search();\n        });\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"structure\",\n    trigger: \".pat-structure\",\n    parser: \"mockup\",\n    defaults: {\n        // for implementing history changes\n        // Example: {base: 'http://mysite.com', appended: '/folder_contents'}\n        urlStructure: null,\n        vocabularyUrl: null,\n        indexOptionsUrl: null, // for querystring widget\n        contextInfoUrl: null, // for add new dropdown and other info\n        setDefaultPageUrl: null,\n        menuOptions: null, // default action menu options per item.\n        backdropSelector: \".plone-modal\", // Element upon which to apply backdrops used for popovers\n\n        activeColumnsCookie: \"activeColumns\",\n\n        attributes: [\n            \"CreationDate\",\n            \"EffectiveDate\",\n            \"ExpirationDate\",\n            \"exclude_from_nav\",\n            \"getIcon\",\n            \"getMimeIcon\",\n            \"getObjSize\",\n            \"getURL\",\n            \"id\",\n            \"is_folderish\",\n            \"last_comment_date\",\n            \"ModificationDate\",\n            \"path\",\n            \"portal_type\",\n            \"review_state\",\n            \"Subject\",\n            \"Title\",\n            \"total_comments\",\n            \"UID\",\n        ],\n\n        activeColumns: [\"ModificationDate\", \"EffectiveDate\", \"review_state\"],\n\n        availableColumns: {\n            id: \"ID\",\n            ModificationDate: \"Last modified\",\n            EffectiveDate: \"Published\",\n            ExpirationDate: \"Expiration\",\n            CreationDate: \"Created\",\n            review_state: \"Review state\",\n            Subject: \"Tags\",\n            portal_type: \"Type\",\n            is_folderish: \"Folder\",\n            exclude_from_nav: \"Excluded from navigation\",\n            getObjSize: \"Object Size\",\n            last_comment_date: \"Last comment date\",\n            total_comments: \"Total comments\",\n        },\n\n        typeToViewAction: {\n            File: \"/view\",\n            Image: \"/view\",\n            Blob: \"/view\",\n        },\n\n        defaultPageTypes: [\"Document\", \"Event\", \"News Item\", \"Collection\"],\n\n        language: \"en\",\n        dateFormat: {\n            dateStyle: \"medium\",\n            timeStyle: \"medium\",\n        },\n        rearrange: {\n            properties: {\n                id: \"ID\",\n                sortable_title: \"Title\",\n                // icon: \"plone-rearrange\",\n            },\n            url: \"/rearrange\",\n        },\n        moveUrl: null,\n\n        buttons: [\n            {\n                tooltip: \"Cut\",\n                url: \"/cut\",\n                icon: \"plone-cut\",\n            },\n            {\n                tooltip: \"Copy\",\n                url: \"/copy\",\n                icon: \"plone-copy\",\n            },\n            {\n                tooltip: \"Paste\",\n                url: \"/paste\",\n                icon: \"plone-paste\",\n            },\n            {\n                tooltip: \"Delete\",\n                url: \"/delete\",\n                context: \"danger\",\n                icon: \"plone-delete\",\n            },\n            {\n                tooltip: \"Workflow\",\n                url: \"/workflow\",\n                icon: \"plone-lock\",\n            },\n            {\n                tooltip: \"Tags\",\n                url: \"/tags\",\n                icon: \"tags\",\n            },\n            {\n                tooltip: \"Properties\",\n                url: \"/properties\",\n                icon: \"plone-edit\",\n            },\n            {\n                tooltip: \"Rename\",\n                url: \"/rename\",\n                icon: \"plone-rename\",\n            },\n        ],\n\n        datatables_options: {},\n\n        upload: {\n            uploadMultiple: true,\n            showTitle: true,\n        },\n    },\n\n    async init() {\n        import(\"./structure.scss\");\n        (await import(\"bootstrap\")).Dropdown;\n\n        // backbone paginator, loaded by app-view expects Backbone and\n        // Underscore to be in global namespace.\n        const _ = (await import(\"underscore\")).default;\n        const Backbone = (await import(\"backbone\")).default;\n        window._ = _;\n        window.Backbone = Backbone;\n\n        const AppView = (await import(\"./js/views/app\")).default;\n\n        this.browsing = true; // so all queries will be correct with QueryHelper\n        this.options.collectionUrl = this.options.vocabularyUrl;\n        this.options.pattern = this;\n        this.options.language =\n            document.querySelector(\"html\").getAttribute(\"lang\") || \"en\";\n\n        // the ``attributes`` options key is not compatible with backbone,\n        // but queryHelper that will be constructed by the default\n        // ResultCollection will expect this to be passed into it.\n        this.options.queryHelperAttributes = this.options.attributes;\n        delete this.options.attributes;\n\n        const view = new AppView(this.options);\n        await view.render();\n        this.$el.append(view.$el);\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"structureupdater\",\n    trigger: \".template-folder_contents\",\n    parser: \"mockup\",\n    defaults: {\n        titleSelector: \"\",\n        descriptionSelector: \"\",\n    },\n\n    init: function () {\n        $(\"body\").on(\"context-info-loaded\", (e, data) => {\n            if (this.options.titleSelector) {\n                $(this.options.titleSelector, this.$el).html(\n                    (data.object && data.object.Title) || \"&nbsp;\"\n                );\n            }\n            if (this.options.descriptionSelector) {\n                $(this.options.descriptionSelector, this.$el).html(\n                    (data.object && data.object.Description) || \"&nbsp;\"\n                );\n            }\n        });\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\n\nexport default Base.extend({\n    name: \"tinymce\",\n    trigger: \".pat-tinymce\",\n    parser: \"mockup\",\n    defaults: {\n        upload: {\n            uploadMultiple: false,\n            maxFiles: 1,\n            showTitle: false,\n        },\n        contentBrowser: {\n            // UID attribute is required here since we're working with related items\n            attributes: [\n                \"UID\",\n                \"Title\",\n                \"Description\",\n                \"portal_type\",\n                \"path\",\n                \"getURL\",\n                \"getIcon\",\n                \"is_folderish\",\n                \"review_state\",\n            ],\n            batchSize: 20,\n            basePath: \"/\",\n            vocabularyUrl: null,\n            width: \"95%\",\n            // maxSelectionSize: 1,\n            placeholder: _t(\"Search for item on site...\"),\n        },\n        text: {\n            insertBtn: _t(\"Insert\"), // so this can be configurable for different languages\n            cancelBtn: _t(\"Cancel\"),\n            insertHeading: _t(\"Insert link\"),\n            title: _t(\"Title\"),\n            internal: _t(\"Internal\"),\n            external: _t(\"External\"),\n            externalText: _t(\"External URL (can be relative within this site or absolute if it starts with http:// or https://)\"), // prettier-ignore\n            email: _t(\"Email Address\"),\n            anchor: _t(\"Anchor\"),\n            anchorLabel: _t(\"Select an anchor\"),\n            target: _t(\"Target\"),\n            subject: _t(\"Email Subject (optional)\"),\n            image: _t(\"Image\"),\n            imageAlign: _t(\"Align\"),\n            enableImageZoom: _t(\"Enable image zoom\"),\n            scale: _t(\"Size\"),\n            alt: _t(\"Alternative Text\"),\n            insertImageHelp: _t(\"Specify an image. It can be on this site already (Internal Image), an image you upload (Upload), or from an external site (External Image).\"), // prettier-ignore\n            internalImage: _t(\"Internal Image\"),\n            externalImage: _t(\"External Image\"),\n            externalImageText: _t(\"External Image URL (can be relative within this site or absolute if it starts with http:// or https://)\"), // prettier-ignore\n            upload: _t(\"Upload\"),\n            insertLinkHelp: _t(\"Specify the object to link to. It can be on this site already (Internal), an object you upload (Upload), from an external site (External), an email address (Email), or an anchor on this page (Anchor).\"), // prettier-ignore\n            captionFromDescription: _t(\"Show Image Caption from Image Description\"),\n            caption: _t(\"Image Caption\"),\n        },\n        // URL generation options\n        loadingBaseUrl: \"++plone++static/tinybase\",\n        prependToUrl: \"\",\n        appendToUrl: \"\",\n        linkAttribute: \"path\", // attribute to get link value from data\n        prependToScalePart: \"/imagescale/\",\n        appendToScalePart: \"\",\n        appendToOriginalScalePart: \"\",\n        // defaultScale: \"large\",\n        defaultSrcset: \"medium\",\n        imageCaptioningEnabled: true,\n        imageClasses: {\n            \"image-inline\": _t(\"Inline\"),\n            \"image-right\": _t(\"Right\"),\n            \"image-left\": _t(\"Left\"),\n        },\n        targetList: [\n            { text: _t(\"Open in this window / frame\"), value: \"\" },\n            { text: _t(\"Open in new window\"), value: \"_blank\" },\n            { text: _t(\"Open in parent window / frame\"), value: \"_parent\" },\n            {\n                text: _t(\"Open in top frame (replaces all frames)\"),\n                value: \"_top\",\n            },\n        ],\n        imageTypes: [\"Image\"],\n        folderTypes: [\"Folder\", \"Plone Site\"],\n        tiny: {\n            //content_css:\n            //    \"/base/node_modules/tinymce-builded/js/tinymce/skins/lightgray/content.min.css\",\n            theme: \"silver\",\n            plugins: [\n                \"advlist\",\n                \"autolink\",\n                \"lists\",\n                \"charmap\",\n                \"print\",\n                \"preview\",\n                \"anchor\",\n                \"searchreplace\",\n                \"visualblocks\",\n                \"code\",\n                \"fullscreen\",\n                \"insertdatetime\",\n                \"media\",\n                \"table\",\n                \"contextmenu\",\n                \"paste\",\n                \"plonelink\",\n                \"ploneimage\",\n            ],\n            menubar: \"edit table format tools view insert\",\n            toolbar:\n                \"undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage\",\n            //'autoresize_max_height': 900,\n            height: 400,\n        },\n        inline: false,\n    },\n    init: async function () {\n        const implementation = (await import(\"./tinymce--implementation\")).default;\n        this.instance = new implementation(this.el, this.options);\n        await this.instance.init();\n    },\n    destroy: function () {\n        this.instance.destroy();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport \"../tinymce/tinymce\";\n\nexport default Base.extend({\n    name: \"textareamimetypeselector\",\n    trigger: \".pat-textareamimetypeselector\",\n    parser: \"mockup\",\n    current_widgets: [],\n    defaults: {\n        textareaName: \"\",\n        widgets: {\n            \"text/html\": { pattern: \"tinymce\", patternOptions: {} },\n        },\n    },\n\n    async init() {\n        this.el.addEventListener(\"input\", async (e) => await this.init_textareas(e.target.value));\n        await this.init_textareas(this.el.value);\n    },\n\n    async init_textareas(mimetype) {\n        const pattern_config = this.options.widgets[mimetype];\n\n        // there might be more than one textareas with the same name\n        // set up all of them with the same pattern options.\n        // the pattern itself must take care of an unique identifier!\n        const textareas = document.querySelectorAll(\n            `textarea[name=\"${this.options.textareaName}\"]`\n        );\n\n        // First, destroy current\n        this.current_widgets.forEach((wdgt) => {\n            // The pattern must implement the destroy method.\n            wdgt.destroy();\n        });\n        // and clean\n        this.current_widgets = [];\n\n        // Then, setup new\n        if (pattern_config && textareas.length) {\n            textareas.forEach(async (area) => {\n                this.current_widgets.push(\n                    await new registry.patterns[pattern_config.pattern](\n                        area,\n                        pattern_config.patternOptions || {}\n                    )\n                );\n            });\n        }\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\n\nconst log = logger.getLogger(\"pat-toggle\");\n\nexport default Base.extend({\n    name: \"toggle\",\n    trigger: \".pat-toggle\",\n    parser: \"mockup\",\n    defaults: {\n        attribute: \"class\",\n        event: \"click\",\n        targetScope: \"global\",\n    },\n    init: function () {\n        var self = this;\n\n        if (!self.options.target) {\n            self.$target = self.$el;\n        } else if (self.options.targetScope === \"global\") {\n            self.$target = $(self.options.target);\n        } else {\n            //self.$target = self.$el[self.options.menu](self.options.target);\n            self.$target = self.$el\n                .parents(self.options.targetScope)\n                .first()\n                .find(self.options.target);\n        }\n\n        if (!self.$target || self.$target.length === 0) {\n            log.error(`No target found for \"${self.options.target}\".`);\n        }\n\n        self.on(self.options.event, function (e) {\n            e.stopPropagation();\n            e.preventDefault();\n            self.toggle();\n        });\n    },\n    isMarked: function () {\n        var self = this;\n        var marked = false;\n\n        for (var i = 0; i < this.$target.length; i = i + 1) {\n            if (self.options.attribute === \"class\") {\n                if (this.$target.eq(i).hasClass(this.options.value)) {\n                    marked = true;\n                } else {\n                    marked = false;\n                    break;\n                }\n            } else {\n                if (\n                    this.$target.eq(i).attr(this.options.attribute) ===\n                    this.options.value\n                ) {\n                    marked = true;\n                } else {\n                    marked = false;\n                    break;\n                }\n            }\n        }\n        return marked;\n    },\n    toggle: function () {\n        var self = this;\n        if (self.isMarked()) {\n            self.remove();\n        } else {\n            self.add();\n        }\n    },\n    remove: function () {\n        var self = this;\n        self.emit(\"remove-attr\");\n        if (self.options.attribute === \"class\") {\n            self.$target.removeClass(self.options.value);\n        } else {\n            self.$target.removeAttr(self.options.attribute);\n        }\n        self.emit(\"attr-removed\");\n    },\n    add: function () {\n        var self = this;\n        self.emit(\"add-attr\");\n        if (self.options.attribute === \"class\") {\n            self.$target.addClass(self.options.value);\n        } else {\n            self.$target.attr(self.options.attribute, self.options.value);\n        }\n        self.emit(\"added-attr\");\n    },\n});\n","import $ from \"jquery\";\nimport { BasePattern } from \"@patternslib/patternslib/src/core/basepattern\";\nimport events from \"@patternslib/patternslib/src/core/events\";\nimport logging from \"@patternslib/patternslib/src/core/logging\";\nimport Parser from \"@patternslib/patternslib/src/core/parser\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport utils from \"@patternslib/patternslib/src/core/utils\";\nimport Cookies from \"js-cookie\";\n\nconst log = logging.getLogger(\"pat-toolbar\");\n\nexport const parser = new Parser(\"toolbar\");\nparser.addArgument(\"render-view\", \"@@render-toolbar\");\n\nclass Pattern extends BasePattern {\n    static name = \"toolbar\";\n    static trigger = \".pat-toolbar\";\n    static parser = parser;\n\n    parser_group_options = false;\n\n    previous_toolbar_url = null;\n\n    async init() {\n        if (window.__patternslib_import_styles) {\n            //import(\"./toolbar.scss\");\n        }\n\n        // Reload the toolbar on history change.\n        events.add_event_listener(\n            window.navigation,\n            \"navigate\",\n            \"pat-toolbar--history-changed\",\n            async () => {\n                // Wait a tick to let other Patterns set the `data-base-url`.\n                await utils.timeout(1);\n                await this.reload_toolbar();\n            }\n        );\n\n        const $el = $(this.el);\n\n        // unpin toolbar and save state\n        $el.on(\"click\", \".toolbar-collapse\", () => {\n            document.body.classList.remove(\"plone-toolbar-left-expanded\");\n            Cookies.set(\"plone-toolbar\", JSON.stringify({ expanded: false }), {\n                path: \"/\",\n            });\n        });\n\n        // pin toolbar and save state\n        $el.on(\"click\", \".toolbar-expand\", () => {\n            document.body.classList.add(\"plone-toolbar-left-expanded\");\n            Cookies.set(\"plone-toolbar\", JSON.stringify({ expanded: true }), {\n                path: \"/\",\n            });\n        });\n\n        this.el.classList.add(\"initialized\");\n    }\n\n    async reload_toolbar() {\n        const render_view = this.options[\"render-view\"];\n        let url = document.body.dataset.baseUrl;\n        // Ensure a trailing slash in the URL.\n        url = url[url.length - 1] === \"/\" ? url : `${url}/`\n        url = `${url}${render_view}`;\n\n        if (this.previous_toolbar_url === url) {\n            // no need to reload same url\n            log.debug(\"No URL change, no reload.\");\n            return;\n        }\n\n        // fetch toolbar\n        log.debug(\"Reload toolbar on: \", url);\n        const response = await fetch(url);\n        const data = await response.text();\n\n        this.previous_toolbar_url = url;\n\n        // Find toolbar nodes\n        const div = document.createElement(\"div\");\n        div.innerHTML = data;\n        const main_toolbar = div.querySelector(\"#edit-zone .plone-toolbar-main\");\n        const personal_tools = div.querySelector(\"#edit-zone #collapse-personaltools\");\n\n        // setup modals\n        registry.scan(main_toolbar);\n        registry.scan(personal_tools);\n        document.querySelector(\".plone-toolbar-main\")?.replaceWith(main_toolbar);\n        document.querySelector(\"#collapse-personaltools\")?.replaceWith(personal_tools);\n        log.debug(\"Re-scanned.\");\n\n        // Notify others that the toolbar has been reloaded.\n        this.el.dispatchEvent(events.generic_event(\"pat-toolbar--reloaded\"));\n        log.debug(\"Event pat-toolbar--reloaded dispatched.\");\n    }\n}\nregistry.register(Pattern);\nexport default Pattern;\nexport { Pattern };\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"tree\",\n    trigger: \".pat-tree\",\n    parser: \"mockup\",\n    defaults: {\n        dragAndDrop: false,\n        autoOpen: false,\n        selectable: true,\n        keyboardSupport: true,\n        onLoad: null,\n    },\n\n    async init() {\n        import(\"jqtree/jqtree.css\");\n        import(\"./tree.scss\");\n        await import(\"jqtree\");\n\n        var self = this;\n        /* convert all bool options */\n        for (var optionKey in self.options) {\n            var def = self.defaults[optionKey];\n            if (def !== undefined && typeof def === \"boolean\") {\n                self.options[optionKey] = utils.bool(self.options[optionKey]);\n            }\n        }\n\n        if (self.options.onCanMoveTo === undefined) {\n            self.options.onCanMoveTo = function (moved, target, position) {\n                /* if not using folder option, just allow, otherwise, only allow if folder */\n                if (position === \"inside\") {\n                    return target.folder === undefined || target.folder === true;\n                }\n                return true;\n            };\n        }\n\n        if (self.options.data && typeof self.options.data === \"string\") {\n            self.options.data = $.parseJSON(self.options.data);\n        }\n        if (self.options.onLoad !== null) {\n            // delay generating tree...\n            var options = $.extend({}, self.options);\n\n            $.getJSON(options.dataUrl, function (data) {\n                options.data = data;\n                delete options.dataUrl;\n                self.tree = self.$el.tree(options);\n                self.options.onLoad(self);\n            }).fail(function (response) {  // eslint-disable-line no-unused-vars\n                console.log(\"failed to load json data\");\n            });\n        } else {\n            self.tree = self.$el.tree(self.options);\n        }\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"dexterity-types-listing\",\n    trigger: \"form[action$='dexterity-types']\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (\n            await import(\"./dexterity-types-listing--implementation\")\n        ).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"registry\",\n    trigger: \".pat-registry\",\n    parser: \"mockup\",\n    init: async function () {\n        const implementation = (await import(\"./registry--implementation.js\")).default;\n        const reg = new implementation(this.el);\n        reg.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"schemaeditor\",\n    trigger: \".pat-schemaeditor\",\n    parser: \"mockup\",\n    init: async function () {\n        const implementation = (await import(\"./schemaeditor--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"contentrules\",\n    trigger: \"form[name='ruleSettings']\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./contentrules--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"contentrules-elements\",\n    trigger: \"pat-contentrules-elements\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./contentrule-elements--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion\",\n    trigger: \"form#DiscussionSettingsEditForm\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion--implementation\")).default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion-comments\",\n    trigger: \".pat-discussion\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion-comments--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","import Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"discussion-moderation\",\n    trigger: \"#fieldset-moderate-comments\",\n\n    async init() {\n        // Async import implementation to reduce bundle size for controlpanels\n        const implementation = (await import(\"./discussion-moderation--implementation\"))\n            .default;\n        const instance = new implementation(this.el);\n        instance.init();\n    },\n});\n","/* Patterns bundle configuration.\n * All imports here will go into the compiled bundle.\n */\n\n// Core\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\n// Patternslib patterns\nimport \"@patternslib/patternslib/src/pat/checklist/checklist\";\nimport \"@patternslib/patternslib/src/pat/date-picker/date-picker\";\nimport \"@patternslib/patternslib/src/pat/datetime-picker/datetime-picker\";\nimport \"@patternslib/patternslib/src/pat/display-time/display-time\";\nimport { Pattern as ValidationPattern } from \"@patternslib/patternslib/src/pat/validation/validation\"; // Also loads the Pattern itself.\nimport { parser as tooltip_parser } from \"@patternslib/patternslib/src/pat/tooltip/tooltip\";\nimport \"@patternslib/pat-code-editor/src/code-editor\";\nimport \"@patternslib/patternslib/src/pat/inject/inject\";\nimport \"@patternslib/patternslib/src/pat/depends/depends\";\n\n// Import all used patterns for the bundle to be generated\nimport \"./pat/autotoc/autotoc\";\nimport \"./pat/backdrop/backdrop\";\nimport \"./pat/base-url/base-url\";\nimport \"./pat/contentloader/contentloader\";\nimport \"./pat/contentbrowser/contentbrowser\";\nimport \"./pat/cookietrigger/cookietrigger\";\nimport \"./pat/datatables/datatables\";\nimport \"./pat/formautofocus/formautofocus\";\nimport \"./pat/formunloadalert/formunloadalert\";\nimport \"./pat/livesearch/livesearch\";\nimport \"./pat/markspeciallinks/markspeciallinks\";\nimport \"./pat/modal/modal\";\nimport \"./pat/navigationmarker/navigationmarker\";\nimport \"./pat/passwordstrength/passwordstrength\";\nimport \"./pat/preventdoublesubmit/preventdoublesubmit\";\nimport \"./pat/manageportlets/manageportlets.js\";\nimport \"./pat/querystring/querystring\";\nimport \"./pat/recurrence/recurrence\";\nimport \"./pat/relateditems/relateditems\";\nimport \"./pat/search/search\";\nimport \"./pat/select2/select2\";\nimport \"./pat/sortable/sortable\";\nimport \"./pat/structure/structure\";\nimport \"./pat/structure-updater/structure-updater\";\nimport \"./pat/textareamimetypeselector/textareamimetypeselector\";\nimport \"./pat/tinymce/tinymce\";\nimport \"./pat/toggle/toggle\";\nimport \"./pat/toolbar/toolbar\";\nimport \"./pat/tree/tree\";\nimport \"./pat/upload/upload\";\n\n// REMOVE obsolete patterns\n//import \"./pat/texteditor/texteditor\";\n\n// Controlpanels\nimport \"./pat/controlpanels/dexterity-types-listing\";\nimport \"./pat/controlpanels/registry\";\nimport \"./pat/controlpanels/schemaeditor\";\nimport \"./pat/controlpanels/contentrules\";\nimport \"./pat/controlpanels/contentrule-elements\";\nimport \"./pat/controlpanels/discussion\";\nimport \"./pat/controlpanels/discussion-comments\";\nimport \"./pat/controlpanels/discussion-moderation\";\n\n// Change default value for pat-tooltip trigger\ntooltip_parser.parameters.trigger.value = \"hover\";\n\n// Change validation error template to be BS compatible\nValidationPattern.prototype.error_template = (message) =>\n    `<em class=\"invalid-feedback\">${message}</em>`;\n\n// Import pattern styles in JavaScript\nwindow.__patternslib_import_styles = true;\n\nregistry.init();\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"backdrop\",\n    trigger: \".pat-backdrop\",\n    parser: \"mockup\",\n    defaults: {\n        zIndex: null,\n        opacity: 0.8,\n        className: \"plone-backdrop\",\n        classActiveName: \"plone-backdrop-active\",\n        closeOnEsc: true,\n        closeOnClick: true,\n    },\n    init: function () {\n        var self = this;\n        self.$backdrop = $(\"> .\" + self.options.className, self.$el);\n        if (self.$backdrop.length === 0) {\n            self.$backdrop = $(\"<div/>\")\n                .hide()\n                .appendTo(self.$el)\n                .addClass(self.options.className);\n            if (self.options.zIndex !== null) {\n                self.$backdrop.css(\"z-index\", self.options.zIndex);\n            }\n        }\n        if (self.options.closeOnEsc === true) {\n            // eslint-disable-next-line no-unused-vars\n            $(document).on(\"keydown\", function (e, data) {\n                if (self.$el.is(\".\" + self.options.classActiveName)) {\n                    if (e.keyCode === 27) {\n                        // ESC key pressed\n                        self.hide();\n                    }\n                }\n            });\n        }\n        if (self.options.closeOnClick === true) {\n            self.$backdrop.on(\"click\", function () {\n                if (self.$el.is(\".\" + self.options.classActiveName)) {\n                    self.hide();\n                }\n            });\n        }\n    },\n    show: function () {\n        var self = this;\n        if (!self.$el.hasClass(self.options.classActiveName)) {\n            self.emit(\"show\");\n            self.$backdrop.css(\"opacity\", \"0\").show();\n            self.$el.addClass(self.options.classActiveName);\n            self.$backdrop.animate({ opacity: self.options.opacity }, 500);\n            self.emit(\"shown\");\n        }\n    },\n    hide: function () {\n        var self = this;\n        if (self.$el.hasClass(self.options.classActiveName)) {\n            self.emit(\"hide\");\n            self.$backdrop.animate({ opacity: \"0\" }, 500).hide();\n            self.$el.removeClass(self.options.classActiveName);\n            self.emit(\"hidden\");\n        }\n    },\n});\n","import $ from \"jquery\";\n\nvar parser = {\n    getOptions($el, patternName, options) {\n        /* This is the Mockup parser. An alternative parser for Patternslib\n         * patterns.\n         *\n         * NOTE: Use of the Mockup parser is discouraged and is added here for\n         * legacy support for the Plone Mockup project.\n         *\n         * It parses a DOM element for pattern configuration options.\n         */\n        options = options || {};\n        // get options from parent element first, stop if element tag name is 'body'\n        if ($el.length !== 0 && !$.nodeName($el[0], \"body\")) {\n            options = this.getOptions($el.parent(), patternName, options);\n        }\n        // collect all options from element\n        let elOptions = {};\n        if ($el.length !== 0) {\n            elOptions = $el.data(\"pat-\" + patternName);\n            if (elOptions) {\n                // parse options if string\n                if (typeof elOptions === \"string\") {\n                    const tmpOptions = {};\n                    $.each(elOptions.split(\";\"), function (i, item) {\n                        item = item.split(\":\");\n                        item.reverse();\n                        let key = item.pop();\n                        key = key.replace(/^\\s+|\\s+$/g, \"\"); // trim\n                        item.reverse();\n                        let value = item.join(\":\");\n                        value = value.replace(/^\\s+|\\s+$/g, \"\"); // trim\n                        tmpOptions[key] = value;\n                    });\n                    elOptions = tmpOptions;\n                }\n            }\n        }\n        return $.extend(true, {}, options, elOptions);\n    },\n};\n\nexport default parser;\n","/**\n * A Base pattern for creating scoped patterns. It's similar to Backbone's\n * Model class. The advantage of this approach is that each instance of a\n * pattern has its own local scope (closure).\n *\n * A new instance is created for each DOM element on which a pattern applies.\n *\n * You can assign values, such as $el, to `this` for an instance and they\n * will remain unique to that instance.\n *\n * Older Patternslib patterns on the other hand have a single global scope for\n * all DOM elements.\n */\nimport $ from \"jquery\";\nimport Registry from \"./registry\";\nimport logging from \"./logging\";\nimport mockupParser from \"./mockup-parser\";\n\nconst log = logging.getLogger(\"Patternslib Base\");\n\nconst initBasePattern = function ($el, options, trigger) {\n    if (!$el.jquery) {\n        $el = $($el);\n    }\n    const name = this.prototype.name;\n    const plog = logging.getLogger(`pat.${name}`);\n    let pattern = $el.data(`pattern-${name}`);\n    if (pattern === undefined && Registry.patterns[name]) {\n        try {\n            // Immediately set the pattern instance to the temporary value\n            // ``initializing`` before the async Base constructor is setting\n            // the value later.\n            // This prevents re-init the pattern on this element on multiple\n            // initialization calls..\n            $el.data(`pattern-${name}`, \"initializing\");\n            options =\n                this.prototype.parser === \"mockup\"\n                    ? mockupParser.getOptions($el, name, options)\n                    : options;\n            pattern = new Registry.patterns[name]($el, options, trigger);\n        } catch (e) {\n            plog.error(`Failed while initializing ${name} pattern.`, e);\n        }\n    }\n    return pattern;\n};\n\nconst Base = async function ($el, options, trigger) {\n    if (($el?.jquery && $el.length === 0) || !$el) {\n        log.warn(\"No element given to pattern.\");\n        return;\n    }\n    if (!$el.jquery) {\n        $el = $($el);\n    }\n    this.$el = $el;\n    this.el = $el[0];\n    this.options = $.extend(true, {}, this.defaults || {}, options || {});\n\n    this.emit(\"pre-init\");\n\n    await this.init($el, options, trigger);\n\n    // Store pattern instance on element\n    this.$el.data(`pattern-${this.name}`, this);\n    this.el[`pattern-${this.name}`] = this;\n\n    this.emit(\"init\");\n};\n\nBase.prototype = {\n    constructor: Base,\n    on(eventName, eventCallback) {\n        this.$el.on(`${eventName}.${this.name}.patterns`, eventCallback);\n    },\n    one(eventName, eventCallback) {\n        this.$el.one(`${eventName}.${this.name}.patterns`, eventCallback);\n    },\n    emit(eventName, args) {\n        // args should be a list\n        if (args === undefined) {\n            args = [];\n        }\n        this.$el.trigger(`${eventName}.${this.name}.patterns`, args);\n    },\n};\n\nBase.extend = function (patternProps) {\n    /* Helper function to correctly set up the prototype chain for new patterns.\n     */\n    const parent = this;\n    let child;\n\n    // Check that the required configuration properties are given.\n    if (!patternProps) {\n        throw new Error(\n            \"Pattern configuration properties required when calling Base.extend\"\n        );\n    }\n\n    // The constructor function for the new subclass is either defined by you\n    // (the \"constructor\" property in your `extend` definition), or defaulted\n    // by us to simply call the parent's constructor.\n    if (Object.hasOwnProperty.call(patternProps, \"constructor\")) {\n        child = patternProps.constructor;\n    } else {\n        child = function () {\n            parent.apply(this, arguments);\n        };\n    }\n\n    // Allow patterns to be extended indefinitely\n    child.extend = Base.extend;\n\n    // Static properties required by the Patternslib registry\n    child.init = initBasePattern;\n    child.jquery_plugin = true;\n    child.trigger = patternProps.trigger;\n    child.parser = patternProps?.parser || null;\n\n    // Set the prototype chain to inherit from `parent`, without calling\n    // `parent`'s constructor function.\n    var Surrogate = function () {\n        this.constructor = child;\n    };\n    Surrogate.prototype = parent.prototype;\n    child.prototype = new Surrogate();\n\n    // Add pattern's configuration properties (instance properties) to the subclass,\n    $.extend(true, child.prototype, patternProps);\n\n    // Set a convenience property in case the parent's prototype is needed\n    // later.\n    child.__super__ = parent.prototype;\n\n    // Register the pattern in the Patternslib registry.\n    if (!patternProps.name) {\n        log.warn(\"This pattern without a name attribute will not be registered!\");\n    } else if (!patternProps.trigger) {\n        log.warn(\n            `The pattern ${patternProps.name} does not have a trigger attribute, it will not be registered.`\n        );\n    } else if (patternProps.autoregister !== false) {\n        Registry.register(child, patternProps.name);\n    }\n    return child;\n};\n\nexport default Base;\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport { Pattern as ContentbrowserPattern } from \"../contentbrowser/contentbrowser\";\n\nvar Criteria = function () {\n    this.init.apply(this, arguments);\n};\nCriteria.prototype = {\n    defaults: {\n        indexWidth: \"20em\",\n        remove: \"\",\n        classBetweenDtName: \"querystring-criteria-betweendt\",\n        classWrapperName: \"querystring-criteria-wrapper\",\n        classIndexName: \"querystring-criteria-index\",\n        classOperatorName: \"querystring-criteria-operator\",\n        classValueName: \"querystring-criteria-value\",\n        classRemoveName: \"querystring-criteria-remove\",\n        classResultsName: \"querystring-criteria-results\",\n        classClearName: \"querystring-criteria-clear\",\n        classDepthName: \"querystring-criteria-depth\",\n    },\n    init: function (\n        $el,\n        app,\n        options,\n        indexes,\n        index,\n        operator,\n        value,\n        baseUrl,\n        patternDateOptions,\n        patternAjaxSelectOptions,\n        patternRelateditemsOptions\n    ) {\n        var self = this;\n        self.app = app;\n\n        self.options = {\n            ...self.defaults,\n            ...options,\n        };\n        self.indexes = indexes;\n        self.indexGroups = {};\n        self.baseUrl = baseUrl;\n        self.advanced = false;\n        self.initial = value;\n        // create wrapper criteria and append it to DOM\n        self.$wrapper = $(\"<div/>\")\n            .addClass(self.options.classWrapperName)\n            .appendTo($el);\n\n        // Sub widgets options\n        self.patternDateOptions = patternDateOptions || {};\n        self.patternAjaxSelectOptions = patternAjaxSelectOptions || {};\n        self.patternRelateditemsOptions = patternRelateditemsOptions || {};\n        // Defaults\n        self.patternAjaxSelectOptions = {\n            width: \"250px\",\n            ...self.patternAjaxSelectOptions,\n        };\n        self.patternRelateditemsOptions = {\n            vocabularyUrl:\n                self.baseUrl +\n                \"@@getVocabulary?name=plone.app.vocabularies.Catalog&field=relatedItems\",\n            width: \"20rem\",\n            ...self.patternRelateditemsOptions,\n        };\n        // Force set\n        self.patternRelateditemsOptions[\"maximumSelectionSize\"] = 1;\n\n        // Remove button\n        self.$remove = $(\"<div>\" + self.options.remove + \"</div>\")\n            .addClass(self.options.classRemoveName)\n            .appendTo(self.$wrapper)\n            .on(\"click\", function (e) {\n                e.stopPropagation();\n                self.remove();\n            });\n\n        // Index selection\n        self.$index = $(\"<select><option></option></select>\").attr(\n            \"placeholder\",\n            _t(\"Select criteria\")\n        );\n\n        // list of indexes\n        for (const value in self.indexes) {\n            let options = self.indexes[value];\n            if (options.enabled) {\n                if (!self.indexGroups[options.group]) {\n                    self.indexGroups[options.group] = $(\"<optgroup/>\")\n                        .attr(\"label\", options.group)\n                        .appendTo(self.$index);\n                }\n                self.indexGroups[options.group].append(\n                    $(\"<option/>\").attr(\"value\", value).html(options.title)\n                );\n            }\n        }\n\n        // attach index select to DOM\n        self.$wrapper.append(\n            $(\"<div/>\").addClass(self.options.classIndexName).append(self.$index)\n        );\n\n        // add blink (select2)\n        self.$index.patternSelect2({\n            width: self.options.indexWidth,\n            placeholder: _t(\"Select criteria\"),\n        });\n        self.$index.on(\"change\", function (e) {\n            self.removeValue();\n            self.createOperator(e.val);\n            self.createClear();\n            self.trigger(\"index-changed\");\n        });\n\n        if (typeof index !== \"undefined\") {\n            self.$index.val(index);\n            self.createOperator(index, operator, value);\n            self.createClear();\n        }\n\n        self.trigger(\"create-criteria\");\n    },\n    appendOperators: function (index) {\n        var self = this;\n\n        self.$operator = $(\"<select/>\");\n\n        if (self.indexes[index]) {\n            _.each(self.indexes[index].operations, function (value) {\n                var options = self.indexes[index].operators[value];\n                $(\"<option/>\")\n                    .attr(\"value\", value)\n                    .html(options.title)\n                    .appendTo(self.$operator);\n            });\n        }\n\n        // attach operators select to DOM\n        self.$wrapper.append(\n            $(\"<div/>\").addClass(self.options.classOperatorName).append(self.$operator)\n        );\n\n        // add blink (select2)\n        self.$operator.patternSelect2({ width: \"10em\" });\n        self.$operator.on(\"change\", function () {\n            self.createValue(index);\n            self.createClear();\n            self.trigger(\"operator-changed\");\n        });\n    },\n    convertPathOperators: function (oval) {\n        var self = this;\n\n        if (self.advanced) {\n            return oval;\n        }\n        //This allows us to use the same query operation for multiple dropdown options.\n        oval = oval.replace(\"advanced\", \"relativePath\").replace(\"path\", \"relativePath\");\n        return oval;\n    },\n    createPathOperators: function () {\n        var self = this;\n\n        if (self.advanced) {\n            self.resetPathOperators();\n            return;\n        }\n        var newOperator = \"plone.app.querystring.operation.string.advanced\";\n\n        if (typeof self.indexes.path.operators[newOperator] === \"undefined\") {\n            self.indexes.path.operations.push(newOperator);\n            self.indexes.path.operators[newOperator] = {\n                title: \"Advanced\",\n                widget: \"AdvancedPathWidget\",\n                description: \"Enter a custom path string\",\n                operation: \"plone.app.querystring.queryparser._relativePath\",\n            };\n        }\n\n        for (const key in self.indexes.path.operators) {\n            var options = self.indexes.path.operators[key];\n            if (key.indexOf(\"absolute\") > 0) {\n                options.title = \"Custom\";\n            } else if (key.indexOf(\"relative\") > 0) {\n                options.title = \"Parent (../)\";\n            } else if (key.indexOf(\"advanced\") > 0) {\n                options.title = \"Advanced Mode\";\n            } else {\n                options.title = \"Current (./)\";\n                options.widget = \"RelativePathWidget\";\n            }\n        };\n    },\n    resetPathOperators: function () {\n        var self = this;\n        for (const key in self.indexes.path.operators) {\n            var options = self.indexes.path.operators[key];\n            if (key.indexOf(\"absolute\") > 0) {\n                options.title = \"Absolute Path\";\n            } else if (key.indexOf(\"relative\") > 0) {\n                options.title = \"Relative Path\";\n            } else if (key.indexOf(\"advanced\") > 0) {\n                options.title = \"Simple Mode\";\n            } else {\n                options.title = \"Navigation Path\";\n                options.widget = \"ReferenceWidget\";\n            }\n        };\n\n        return;\n    },\n    createOperator: function (index, operator, value) {\n        var self = this;\n\n        self.removeOperator();\n        self.createPathOperators();\n\n        // We must test if we have a \"simple\" path or an \"advanced\" one and change the widgets accordingly\n        if (\n            index === \"path\" &&\n            value &&\n            value !== \".::1\" &&\n            value !== \"..::1\" &&\n            !value.match(/^[0-9a-f\\-]{32,36}::-?[0-9]+$/)\n        ) {\n            self.advanced = true;\n            self.resetPathOperators();\n        }\n\n        self.appendOperators(index);\n\n        if (typeof operator === \"undefined\") {\n            operator = self.$operator.val();\n        }\n\n        self.$operator.val(operator);\n        self.createValue(index, value);\n\n        self.trigger(\"create-operator\");\n    },\n    createValue: function (index, value) {\n        var self = this,\n            widget = self.indexes[index].operators[self.$operator.val()].widget,\n            $wrapper = $(\"<div/>\")\n                .addClass(self.options.classValueName)\n                .appendTo(self.$wrapper);\n\n        self.removeValue();\n\n        var createDepthSelect = function (selected) {\n            // remove previous depth-select-box items\n            $wrapper.remove(\".depth-select-box\");\n            var select =\n                \"<div class='depth-select-box'>\" +\n                \"<label for='depth-select'>Depth</label>\" +\n                \"<select name='depth-select' class='\" +\n                self.options.classDepthName +\n                \"'>\" +\n                \"<option value='-1' selected='selected'>Unlimited</option>\";\n\n            for (var i = 0; i <= 10; i += 1) {\n                select += \"<option value=\" + i + \" \";\n                if (\"\" + i === selected) {\n                    select += \"selected='selected' \";\n                }\n                select += \">\" + i + \"</option>\";\n            }\n            select += \"</select>\" + \"</div>\";\n\n            return $(select).on(\"change\", function () {\n                self.trigger(\"depth-changed\");\n            });\n        };\n\n        if (widget === \"StringWidget\") {\n            self.$value = $('<input type=\"text\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"DateWidget\") {\n            self.$value = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"DateRangeWidget\") {\n            var startwrap = $(\"<span/>\").appendTo($wrapper);\n            var val1 = \"\";\n            var val2 = \"\";\n\n            if (value) {\n                val1 = value[0] ? value[0] : \"\";\n                val2 = value[1] ? value[1] : \"\";\n            }\n\n            var startdt = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .addClass(self.options.classValueName + \"-\" + widget + \"-start\")\n                .val(val1)\n                .appendTo(startwrap)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            $wrapper.append(\n                $(\"<span/>\").html(_t(\"to\")).addClass(self.options.classBetweenDtName)\n            );\n            var endwrap = $(\"<span/>\").appendTo($wrapper);\n            var enddt = $('<input type=\"date\"/>')\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .addClass(self.options.classValueName + \"-\" + widget + \"-end\")\n                .val(val2)\n                .appendTo(endwrap)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            self.$value = [startdt, enddt];\n        } else if (widget === \"RelativeDateWidget\") {\n            self.$value = $('<input type=\"text\"/>')\n                .after($(\"<span/>\").html(_t(\"days\")))\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .val(value)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n        } else if (widget === \"AdvancedPathWidget\") {\n            if (self.advanced) {\n                self.advanced = false;\n            } else {\n                self.advanced = true;\n            }\n            self.createPathOperators();\n            self.removeOperator();\n            self.appendOperators(index);\n            self.createValue(index);\n        } else if (widget === \"RelativePathWidget\") {\n            if (self.advanced) {\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(value)\n                    .on(\"change\", function () {\n                        self.trigger(\"value-changed\");\n                    });\n            } else {\n                var pathAndDepth = [\".\", \"1\"];\n                if (typeof value !== \"undefined\" && value.indexOf(\"::\") != -1) {\n                    pathAndDepth = value.split(\"::\");\n                    if (pathAndDepth[0] === \".\") {\n                        self.$operator.val(\n                            \"plone.app.querystring.operation.string.path\"\n                        );\n                    } else {\n                        self.$operator.val(\n                            \"plone.app.querystring.operation.string.relativePath\"\n                        );\n                    }\n                } else if (\n                    self.$operator.val() ===\n                    \"plone.app.querystring.operation.string.relativePath\"\n                ) {\n                    pathAndDepth = [\"..\", \"1\"];\n                }\n\n                self.$value = $('<input type=\"hidden\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(pathAndDepth[0]);\n                self.$value.after(createDepthSelect(pathAndDepth[1]));\n            }\n        } else if (widget === \"ReferenceWidget\") {\n            if (self.advanced) {\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .val(value)\n                    .appendTo($wrapper)\n                    .on(\"change\", function () {\n                        self.trigger(\"value-changed\");\n                    });\n            } else {\n                pathAndDepth = [\"\", \"-1\"];\n                if (typeof value !== \"undefined\") {\n                    pathAndDepth = value.split(\"::\");\n                }\n                self.$value = $('<input type=\"text\"/>')\n                    .addClass(self.options.classValueName + \"-\" + widget)\n                    .appendTo($wrapper)\n                    .val(pathAndDepth[0])\n                const pat = new ContentbrowserPattern(self.$value[0], self.patternRelateditemsOptions);\n                pat.el.addEventListener(\"change\", () => {\n                    self.trigger(\"value-changed\");\n                })\n                self.$value.after(createDepthSelect(pathAndDepth[1]));\n            }\n        } else if (widget === \"MultipleSelectionWidget\") {\n            self.$value = $(\"<select/>\")\n                .prop(\"multiple\", true)\n                .addClass(self.options.classValueName + \"-\" + widget)\n                .appendTo($wrapper)\n                .on(\"change\", function () {\n                    self.trigger(\"value-changed\");\n                });\n            if (self.indexes[index]) {\n                for (const value in self.indexes[index].values) {\n                    const options = self.indexes[index].values[value];\n                    $(\"<option/>\")\n                        .attr(\"value\", value)\n                        .html(options.title)\n                        .appendTo(self.$value);\n                };\n            }\n            self.$value.patternSelect2(self.patternAjaxSelectOptions);\n        }\n\n        if (typeof value !== \"undefined\" && typeof self.$value !== \"undefined\") {\n            if (Array.isArray(self.$value)) {\n                $.each(value, function (i, v) {\n                    self.$value[i].val(v);\n                });\n            } else {\n                var trimmedValue = value;\n                if (typeof value === \"string\" && widget !== \"RelativePathWidget\") {\n                    trimmedValue = value.replace(/::-?[0-9]+/, \"\");\n                }\n                self.$value.val(trimmedValue);\n            }\n        }\n\n        self.trigger(\"create-value\");\n    },\n    createClear: function () {\n        var self = this;\n        self.removeClear();\n        self.$clear = $(\"<div/>\")\n            .addClass(self.options.classClearName)\n            .appendTo(self.$wrapper);\n    },\n    remove: function () {\n        var self = this;\n        self.trigger(\"remove\");\n        self.$remove.remove();\n        self.$index.parent().remove();\n        self.removeOperator();\n        self.removeValue();\n        self.removeClear();\n        self.$wrapper.remove();\n    },\n    removeClear: function () {\n        var self = this;\n        self.trigger(\"remove-clear\");\n        if (self.$clear) {\n            self.$clear.remove();\n        }\n    },\n    removeOperator: function () {\n        var self = this;\n        self.trigger(\"remove-operator\");\n        if (self.$operator) {\n            self.$operator.parent().remove();\n        }\n    },\n    removeValue: function () {\n        var self = this;\n        self.trigger(\"remove-value\");\n        if (self.$value) {\n            if (Array.isArray(self.$value)) {\n                // date ranges have 2 values\n                self.$value[0].parents(\".querystring-criteria-value\").remove();\n            } else {\n                self.$value.parents(\".querystring-criteria-value\").remove();\n            }\n        }\n    },\n    // builds the parameters to go into the http querystring for requesting\n    // results from the query builder\n    buildQueryPart: function () {\n        var self = this;\n\n        // index\n        var ival = self.$index.val();\n        if (ival === \"\") {\n            // no index selected, no query\n            return \"\";\n        }\n        var istr = \"query.i:records=\" + ival;\n\n        // operator\n        if (typeof self.$operator === \"undefined\") {\n            // no operator, no query\n            return \"\";\n        }\n        var oval = self.$operator.val();\n\n        if (ival === \"path\") {\n            if (oval.indexOf(\"advanced\") > 0) {\n                return \"\";\n            }\n            oval = self.convertPathOperators(oval);\n        }\n\n        var ostr = \"query.o:records=\" + oval;\n\n        // value(s)\n        var vstrbase = \"query.v:records=\",\n            vstrlistbase = \"query.v:records:list=\",\n            vstr = [];\n        if (typeof self.$value === \"undefined\") {\n            vstr.push(vstrbase);\n        } else if (Array.isArray(self.$value)) {\n            // handles only datepickers from the 'between' operator right now\n            $.each(self.$value, function () {\n                vstr.push(vstrlistbase + $(this).val());\n            });\n        } else if (Array.isArray(self.$value.val())) {\n            // handles multible values\n            $.each(self.$value.val(), function (i, v) {\n                vstr.push(vstrlistbase + v);\n            });\n        } else {\n            var str = vstrbase + self.$value.val();\n            if (ival === \"path\" && self.$value.val() !== \"\") {\n                str += self.getDepthString();\n            } else if (typeof self.initial !== \"undefined\") {\n                str = vstrbase + self.initial;\n                //Sometimes the RelatedItemsWidget won't be loaded by this point.\n                //This only should happen on the initial page load.\n                delete self.initial;\n            }\n            vstr.push(str);\n        }\n\n        return istr + \"&\" + ostr + \"&\" + vstr.join(\"&\");\n    },\n    getJSONListStr: function () {\n        var self = this;\n\n        // index\n        var ival = self.$index.val();\n        if (ival === \"\") {\n            // no index selected, no query\n            return \"\";\n        }\n\n        // operator\n        if (typeof self.$operator === \"undefined\") {\n            // no operator, no query\n            return \"\";\n        }\n        var oval = self.$operator.val();\n\n        if (ival === \"path\") {\n            if (oval.indexOf(\"advanced\") > 0) {\n                //The advanced function is just a placeholder,\n                //We don't want to send an actual query\n                return \"\";\n            }\n            oval = self.convertPathOperators(oval);\n        }\n        // value(s)\n        var varr = [];\n        if (Array.isArray(self.$value)) {\n            // handles only datepickers from the 'between' operator right now\n            $.each(self.$value, function () {\n                varr.push($(this).val());\n            });\n        } else if (typeof self.$value !== \"undefined\") {\n            var value = self.$value.val();\n            if (ival === \"path\" && value) {\n                var depth = self.getDepthString();\n                if (depth) {\n                    value += depth;\n                }\n            }\n            varr.push(value);\n        }\n        var vval;\n        if (varr.length > 1) {\n            vval = '[\"' + varr.join('\",\"') + '\"]';\n        } else if (varr.length === 1) {\n            vval = JSON.stringify(varr[0]);\n        } else {\n            vval = '\"\"';\n        }\n\n        if (typeof self.indexes[ival].operators[oval] === \"undefined\") {\n            return;\n        }\n\n        return '{\"i\":\"' + ival + '\", \"o\":\"' + oval + '\", \"v\":' + vval + \"}\";\n    },\n    getDepthString: function () {\n        var self = this,\n            out = \"\",\n            depth = $(\".\" + self.options.classDepthName).val();\n\n        if (depth !== \"\" && typeof depth !== \"undefined\") {\n            out += \"::\" + depth;\n        }\n        return out;\n    },\n    trigger: function (name) {\n        this.$wrapper.trigger(name + \"-criteria.querystring.patterns\", [this]);\n    },\n    on: function (name, callback) {\n        this.$wrapper.on(name + \"-criteria.querystring.patterns\", callback);\n    },\n};\n\nexport default Base.extend({\n    name: \"querystring\",\n    trigger: \".pat-querystring\",\n    parser: \"mockup\",\n    defaults: {\n        indexes: [],\n        classWrapperName: \"querystring-wrapper\",\n        criteria: {},\n        indexOptionsUrl: null,\n        previewURL: \"portal_factory/@@querybuilder_html_results\", // base url to use to request preview information from\n        previewCountURL: \"portal_factory/@@querybuildernumberofresults\",\n        patternDateOptions: {},\n        patternAjaxSelectOptions: {},\n        patternRelateditemsOptions: {},\n        classSortLabelName: \"querystring-sort-label\",\n        classSortReverseName: \"querystring-sortreverse\",\n        classSortReverseLabelName: \"querystring-sortreverse-label\",\n        classPreviewCountWrapperName: \"querystring-previewcount-wrapper\",\n        classPreviewResultsWrapperName: \"querystring-previewresults-wrapper\",\n        classPreviewWrapperName: \"querystring-preview-wrapper\",\n        classPreviewName: \"querystring-preview\",\n        classPreviewTitleName: \"querystring-preview-title\",\n        classPreviewDescriptionName: \"querystring-preview-description\",\n        classSortWrapperName: \"querystring-sort-wrapper\",\n        showPreviews: true,\n    },\n    init: async function () {\n        await import(\"../select2/select2\");\n\n        import(\"./querystring.scss\");\n\n        var self = this;\n\n        // hide input element\n        self.$el.hide();\n\n        // create wrapper for out criteria\n        self.$wrapper = $(\"<div/>\");\n        self.$el.after(self.$wrapper);\n\n        // initialization can be detailed if by ajax\n        self.initialized = false;\n\n        // get remove icon for criterias\n        self.options.criteria.remove = await utils.resolveIcon(\"x-circle\");\n\n        if (self.options.indexOptionsUrl) {\n            try {\n                const response = await fetch(self.options.indexOptionsUrl);\n                const data = await response.json();\n                self.options.indexes = data.indexes;\n                self.options[\"sortable_indexes\"] = data[\"sortable_indexes\"];\n                self._init();\n            } catch {\n                // XXX handle this...\n            }\n        }\n    },\n    _init: function () {\n        var self = this;\n        self.$criteriaWrapper = $(\"<div/>\")\n            .addClass(self.options.classWrapperName)\n            .appendTo(self.$wrapper);\n\n        self.$sortWrapper = $(\"<div/>\")\n            .addClass(self.options.classSortWrapperName)\n            .appendTo(self.$wrapper);\n\n        if (self.options.showPreviews === \"false\") {\n            self.options.showPreviews = false;\n        }\n        if (self.options.showPreviews) {\n            self.$previewWrapper = $(\"<div/>\")\n                .addClass(self.options.classPreviewWrapperName)\n                .appendTo(self.$wrapper);\n\n            // preview title and description\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewTitleName)\n                .html(_t(\"Preview\"))\n                .appendTo(self.$previewWrapper);\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewDescriptionName)\n                .html(_t(\"Preview of at most 10 items\"))\n                .appendTo(self.$previewWrapper);\n        }\n\n        self.criterias = [];\n\n        // create populated criterias\n        if (self.el.value) {\n            for (const item of JSON.parse(self.el.value)) {\n                self.createCriteria(item.i, item.o, item.v);\n            }\n        }\n\n        // add empty criteria which enables users to create new cr\n        self.createCriteria();\n\n        // add sort/order fields\n        self.createSort();\n\n        // add criteria preview pane to see results from criteria query\n        if (self.options.showPreviews) {\n            self.refreshPreviewEvent();\n        }\n        self.$el.trigger(\"initialized\");\n        self.initialized = true;\n    },\n    createCriteria: function (index, operator, value) {\n        var self = this,\n            baseUrl = self.options.indexOptionsUrl.replace(/(@@.*)/g, \"\"),\n            criteria = new Criteria(\n                self.$criteriaWrapper,\n                self,\n                self.options.criteria,\n                self.options.indexes,\n                index,\n                operator,\n                value,\n                baseUrl,\n                self.options.patternDateOptions,\n                self.options.patternAjaxSelectOptions,\n                self.options.patternRelateditemsOptions\n            );\n\n        criteria.on(\"remove\", function () {\n            if (self.criterias[self.criterias.length - 1] === criteria) {\n                self.createCriteria();\n            }\n        });\n\n        criteria.on(\"index-changed\", function () {\n            if (self.criterias[self.criterias.length - 1] === criteria) {\n                self.createCriteria();\n            }\n        });\n\n        //This prevents multiple requests from going off after making a single change\n        var _doupdates = function () {\n            self.refreshPreviewEvent();\n            self.updateValue();\n        };\n        var _updateTimeout = -1;\n        var doupdates = function () {\n            clearTimeout(_updateTimeout);\n            _updateTimeout = setTimeout(_doupdates, 100);\n        };\n\n        criteria.on(\"remove\", function (e, criteria) {\n            if (self.criterias.indexOf(criteria) !== -1) {\n                self.criterias.splice(self.criterias.indexOf(criteria), 1);\n            }\n            doupdates(e, criteria);\n        });\n        criteria.on(\"remove-clear\", doupdates);\n        criteria.on(\"remove-operator\", doupdates);\n        criteria.on(\"remove-value\", doupdates);\n        criteria.on(\"index-changed\", doupdates);\n        criteria.on(\"operator-changed\", doupdates);\n        criteria.on(\"create-criteria\", doupdates);\n        criteria.on(\"create-operator\", doupdates);\n        criteria.on(\"create-value\", doupdates);\n        criteria.on(\"value-changed\", doupdates);\n        criteria.on(\"depth-changed\", doupdates);\n\n        self.criterias.push(criteria);\n    },\n    createSort: function () {\n        var self = this;\n\n        // elements that may exist already on the page\n        // XXX do this in a way so it'll work with other forms will work\n        // as long as they provide sort_on and sort_reversed fields in z3c form\n        var existingSortOn = $('[id$=\"-sort_on\"]').filter('[id^=\"formfield-\"]');\n        var existingSortOrder = $('[id*=\"-sort_reversed\"]').filter('[id^=\"formfield-\"]');\n\n        $(\"<span/>\")\n            .addClass(self.options.classSortLabelName)\n            .html(_t(\"Sort on\"))\n            .appendTo(self.$sortWrapper);\n        self.$sortOn = $(\"<select/>\")\n            .attr(\"name\", \"sort_on\")\n            .appendTo(self.$sortWrapper)\n            .on(\"change\", function () {\n                self.refreshPreviewEvent();\n                $('[id$=\"sort_on\"]', existingSortOn).val($(this).val());\n            });\n\n        self.$sortOn.append($('<option value=\"\">' + _t(\"No sorting\") + \"</option>\")); // default no sorting\n        for (var key in self.options[\"sortable_indexes\"]) {\n            self.$sortOn.append(\n                $(\"<option/>\").attr(\"value\", key).html(self.options.indexes[key].title)\n            );\n        }\n        self.$sortOn.patternSelect2({ width: \"150px\" });\n\n        self.$sortOrder = $('<input type=\"checkbox\" />')\n            .attr(\"name\", \"sort_reversed:boolean\")\n            .on(\"change\", function () {\n                self.refreshPreviewEvent();\n                if ($(this).prop(\"checked\")) {\n                    $('input[type=\"checkbox\"]', existingSortOrder).prop(\"checked\", true);\n                } else {\n                    $('input[type=\"checkbox\"]', existingSortOrder).prop(\n                        \"checked\",\n                        false\n                    );\n                }\n            });\n\n        $(\"<span/>\")\n            .addClass(self.options.classSortReverseName)\n            .appendTo(self.$sortWrapper)\n            .append(self.$sortOrder)\n            .append(\n                $(\"<span/>\")\n                    .html(_t(\"Reversed Order\"))\n                    .addClass(self.options.classSortReverseLabelName)\n            );\n\n        // if the form already contains the sort fields, hide them! Their values\n        // will be synced back and forth between the querystring's form elements\n        if (existingSortOn.length >= 1 && existingSortOrder.length >= 1) {\n            var reversed = $('input[type=\"checkbox\"]', existingSortOrder).prop(\n                \"checked\"\n            );\n            var sortOn = $('[id$=\"-sort_on\"]', existingSortOn).val();\n            if (reversed) {\n                self.$sortOrder.prop(\"checked\", true);\n            }\n            self.$sortOn.val(sortOn);\n            $(existingSortOn).hide();\n            $(existingSortOrder).hide();\n        }\n    },\n    refreshPreviewEvent: function () {\n        var self = this;\n\n        if (!self.options.showPreviews) {\n            return; // cut out of this if there are no previews available\n        }\n\n        if (typeof self._previewXhr !== \"undefined\") {\n            self._previewXhr.abort();\n        }\n\n        if (typeof self.$previewPane !== \"undefined\") {\n            self.$previewPane.remove();\n        }\n\n        var query = [];\n        for (const criteria of self.criterias) {\n            var querypart = criteria.buildQueryPart();\n            if (querypart !== \"\") {\n                query.push(querypart);\n            }\n        };\n\n        self.$previewPane = $(\"<div/>\")\n            .addClass(self.options.classPreviewName)\n            .appendTo(self.$previewWrapper);\n\n        if (query.length <= 0) {\n            $(\"<div/>\")\n                .addClass(self.options.classPreviewCountWrapperName)\n                .html(\"No results to preview\")\n                .prependTo(self.$previewPane);\n            return; // no query means nothing to send out requests for\n        }\n\n        query.push(\"sort_on=\" + self.$sortOn.val());\n        if (self.$sortOrder.prop(\"checked\")) {\n            query.push(\"sort_order=reverse\");\n        }\n\n        self._previewXhr = $.ajax({\n            url: self.options.previewURL + \"?\" + query.join(\"&\"),\n            success: (data) => {\n                $(\"<div/>\")\n                    .addClass(self.options.classPreviewResultsWrapperName)\n                    .html(utils.parseBodyTag(data))\n                    .appendTo(self.$previewPane);\n            },\n        });\n    },\n    updateValue: function () {\n        // updating the original input with json data in the form:\n        // [\n        //    {i:'index', o:'operator', v:'value'}\n        // ]\n\n        var self = this;\n\n        var criteriastrs = [];\n        for (const criteria of self.criterias) {\n            var jsonstr = criteria.getJSONListStr();\n            if (jsonstr !== \"\") {\n                criteriastrs.push(jsonstr);\n            }\n        }\n        var val = \"[\" + criteriastrs.join(\",\") + \"]\";\n        self.$el.val(val);\n        self.$el.trigger(\"change\");\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"sortable\",\n    trigger: \".pat-sortable\",\n    parser: \"mockup\",\n    defaults: {\n        selector: \"li\",\n        dragClass: \"item-dragging\",\n        cloneClass: \"dragging\",\n        drop: undefined, // callback function or name of global function\n    },\n    init: async function () {\n        let Sortable = await import(\"sortablejs\");\n        Sortable = Sortable.default;\n        this.sortable = new Sortable(this.$el[0], {\n            animation: 150,\n            draggable: this.options.selector,\n            chosenClass: this.options.dragClass,\n            dragClass: this.options.cloneClass,\n            onEnd: function (e) {\n                var cb = this.options.drop;\n                if (!cb) {\n                    return;\n                }\n                if (typeof cb === \"string\") {\n                    cb = window[this.options.drop];\n                }\n                cb($(e.item), e.newIndex - e.oldIndex);\n            }.bind(this),\n        });\n    },\n    disableSort: function () {\n        this.sortable.option(\"sort\", false);\n    },\n    enableSort: function () {\n        this.sortable.option(\"sort\", true);\n    },\n});\n","import Base from \"../../core/base\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport logging from \"../../core/logging\";\nimport utils from \"../../core/utils\";\n\n// Lazy loading modules.\nlet Moment;\n\nconst log = logging.getLogger(\"pat-display-time\");\n\nexport const parser = new Parser(\"display-time\");\n// input datetime options\nparser.add_argument(\"format\", \"\");\nparser.add_argument(\"locale\", null);\nparser.add_argument(\"strict\", false);\n// output options\nparser.add_argument(\"from-now\", false);\nparser.add_argument(\"no-suffix\", false);\nparser.add_argument(\"output-format\", null);\n\nexport default Base.extend({\n    name: \"display-time\",\n    trigger: \".pat-display-time\",\n\n    async init() {\n        Moment = (await import(\"moment\")).default;\n\n        this.options = parser.parse(this.el, this.options);\n\n        let lang = this.options.locale || dom.acquire_attribute(this.el, \"lang\") || \"en\";\n        // we don't support any country-specific language variants, always use first 2 letters\n        lang = lang.substr(0, 2).toLowerCase();\n        try {\n            await import(`moment/locale/${lang}.js`);\n            Moment.locale(lang);\n            this.lang = lang;\n        } catch {\n            Moment.locale(\"en\");\n            this.lang = \"en\";\n        }\n        log.debug(`Moment.js language used: ${lang}.`);\n        this.format();\n    },\n\n    format() {\n        const datetime = this.el.getAttribute(\"datetime\");\n        let out = \"\";\n        if (datetime) {\n            const date = Moment(datetime, this.options.format, this.options.strict);\n            out = date;\n            if (this.options.fromNow === true) {\n                if (utils.is_iso_date(datetime)) {\n                    // date-only case.\n                    const rtf = new Intl.RelativeTimeFormat(this.lang, {\n                        numeric: \"auto\",\n                    });\n                    const date_diff = utils.date_diff(date.toDate(), new Date());\n                    out = date.calendar(null, {\n                        // when the date is closer, specify custom values\n                        lastWeek: `[${rtf.format(date_diff, \"day\")}]`, // translates to \"x days ago\"\n                        lastDay: `[${rtf.format(-1, \"day\")}]`, // translates to \"yesterday\"\n                        sameDay: `[${rtf.format(0, \"day\")}]`, // translates to \"today\"\n                        nextDay: `[${rtf.format(1, \"day\")}]`, // translates to \"tomorrow\"\n                        nextWeek: \"dddd\", // translates to week day name\n                        // otherwise, just use Intl.RelativeTimeFormat.\n                        sameElse: () => {\n                            return `[${rtf.format(date_diff, \"day\")}]`;\n                        },\n                    });\n                } else {\n                    // datetime case.\n                    out = date.fromNow(this.options.noSuffix);\n                }\n            } else if (this.options.outputFormat) {\n                out = date.format(this.options.outputFormat);\n            }\n        }\n        this.el.textContent = out;\n    },\n});\n","import Base from \"../../core/base\";\nimport events from \"../../core/events\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"close-panel\",\n    trigger: \".close-panel\",\n\n    init() {\n        // Close panel support for dialog panels\n        // Other modals are handled in pat-modal.\n        const dialog_panel = this.el.closest(\"dialog\");\n        if (dialog_panel) {\n            events.add_event_listener(\n                dialog_panel,\n                \"close-panel\",\n                \"close-panel--dialog\",\n                () => {\n                    dialog_panel.close();\n                }\n            );\n        }\n\n        this.el.addEventListener(\"click\", async (e) => {\n            await utils.timeout(0); // Wait for other patterns, like pat-validation.\n\n            if (\n                e.target.matches(\":not([formnovalidate])\") &&\n                e.target.matches(\"[type=submit], button:not([type=button])\") &&\n                this.el.closest(\"form\")?.checkValidity() === false\n            ) {\n                // Prevent closing an invalid form when submitting.\n                return;\n            }\n\n            this.el.dispatchEvent(\n                new Event(\"close-panel\", { bubbles: true, cancelable: true })\n            );\n        });\n    },\n});\n","import $ from \"jquery\";\nimport { BasePattern } from \"../../core/basepattern\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport events from \"../../core/events\";\nimport registry from \"../../core/registry\";\nimport utils from \"../../core/utils\";\n\n// Initialize close-panel functionality.\nimport \"../close-panel/close-panel\";\n\nconst log = logging.getLogger(\"pat-tooltip\");\n\nexport const parser = new Parser(\"tooltip\");\nconst all_positions = [\n    \"tl\",\n    \"tm\",\n    \"tr\",\n    \"rt\",\n    \"rm\",\n    \"rb\",\n    \"br\",\n    \"bm\",\n    \"bl\",\n    \"lb\",\n    \"lm\",\n    \"lt\",\n];\nparser.addArgument(\"position-list\", [], all_positions, true);\nparser.addArgument(\"position-policy\", \"auto\", [\"auto\", \"force\"]);\nparser.addArgument(\"trigger\", \"click\", [\"click\", \"hover\", \"none\"]);\nparser.addArgument(\"source\", \"title\", [\"ajax\", \"content\", \"title\"]);\nparser.addArgument(\"ajax-data-type\", \"html\", [\"html\", \"markdown\"]);\nparser.addArgument(\"closing\", \"auto\", [\"auto\", \"sticky\", \"close-button\"]);\nparser.addArgument(\"delay\");\nparser.addArgument(\"mark-inactive\", true);\nparser.addArgument(\"class\");\nparser.addArgument(\"target\", \"body\");\nparser.addArgument(\"arrow-padding\", null);\nparser.addArgument(\"url\", null);\n\n// Tippy Lifecycle-hooks\n// See: https://tippyjs.bootcss.com/lifecycle-hooks/\n// onCreate\n// onTrigger\n// onShow\n// onMount\n// onShown\n// onUntrigger\n// onHide\n// onHidden\n//\n// onBeforeUpdate\n// onAfterUpdate\n// onDestroy\n\nclass Pattern extends BasePattern {\n    static name = \"tooltip\";\n    static trigger = \".pat-tooltip, .pat-tooltip-ng\";\n    static parser = parser;\n\n    tippy = null;\n\n    active_class = \"tooltip-active-hover\";\n    inactive_class = \"tooltip-inactive\";\n\n    async init() {\n        const el = this.el;\n\n        if (window.__patternslib_import_styles) {\n            import(\"tippy.js/dist/tippy.css\");\n        }\n        const Tippy = (await import(\"tippy.js\")).default;\n        this.tippy_options = this.parseOptionsForTippy(this.options);\n\n        const defaultProps = {\n            animation: false,\n            arrow: true,\n            //'delay': [0, 1800],\n            //'duration': [325, 275],\n            hideOnClick: this.options.closing === \"close-button\" ? false : true,\n            ignoreAttributes: true,\n            interactive: true,\n            onHide: this._onHide.bind(this),\n            onShow: this._onShow.bind(this),\n            trigger: \"click\",\n        };\n\n        Tippy.setDefaultProps(defaultProps);\n        this.tippy = new Tippy(el, this.tippy_options);\n\n        if (this.options.source === \"title\") {\n            // Remove ``title`` attribute when source is set to ``title`` to\n            // disable the browser's built-in tooltip feature\n            el.removeAttribute(\"title\");\n        }\n\n        if (this.options.trigger === \"click\" && this.options.source === \"ajax\") {\n            // prevent default action for \"click\" and \"mouseenter click\"\n            events.add_event_listener(\n                el,\n                \"click\",\n                \"pat-tooltip--click-prevent-default\",\n                (event) => {\n                    event.preventDefault();\n                    event.stopPropagation();\n                }\n            );\n        }\n\n        if (this.options.trigger === \"click\") {\n            this.active_class = \"tooltip-active-click\";\n        }\n        if (this.options.markInactive) {\n            // Initially mark as inactive\n            el.classList.add(this.inactive_class);\n        }\n    }\n\n    show() {\n        // Show this tooltip\n        this.tippy.show();\n    }\n\n    async hide() {\n        // Hide this tooltip\n        await utils.timeout(1); // wait a tick for event being processed by other handlers.\n        this.tippy.hide();\n    }\n\n    destroy() {\n        // Remove this tooltip\n        super.destroy(); // Unregister\n        this.tippy.destroy();\n    }\n\n    parseOptionsForTippy(opts) {\n        const placement = (pos) => {\n            // note that Cornelis needs the positioning to be the placement of the thingy on the bubble\n            // tippy though refers to positioning as the placement of the bubble relatively to the reference element\n            // so we invert the meaning below. It's intentional.\n            const primary = (pos0) =>\n                ({\n                    t: \"bottom\",\n                    r: \"left\",\n                    b: \"top\",\n                    l: \"right\",\n                }[pos0]);\n\n            const secondary = (pos1) =>\n                ({\n                    l: \"-start\",\n                    r: \"-end\",\n                    m: \"\",\n                    t: \"-start\",\n                    b: \"-end\",\n                }[pos1]);\n\n            return `${primary(pos[0])}${secondary(pos[1])}`;\n        };\n\n        const tippy_options = { popperOptions: { modifiers: [] } };\n\n        if (opts.arrowPadding !== null) {\n            tippy_options.popperOptions.modifiers.push({\n                name: \"arrow\",\n                options: {\n                    padding: parseInt(opts.arrowPadding, 10),\n                },\n            });\n        }\n\n        const parsers = {\n            position: () => {\n                if (!opts.position?.list?.length) {\n                    return;\n                }\n                tippy_options.placement = placement(opts.position.list[0]); // main position\n\n                const flip_options = {\n                    name: \"flip\",\n                    enabled: true,\n                };\n\n                if (opts.position.policy === \"force\") {\n                    flip_options.enabled = false;\n                } else if (opts.position.length > 1) {\n                    const fallbacks = opts.position.list.slice(1).map(placement);\n                    flip_options.fallbackPlacements = fallbacks;\n                }\n\n                tippy_options.popperOptions.modifiers.push(flip_options);\n            },\n\n            trigger() {\n                if (opts.trigger === \"hover\") {\n                    tippy_options.trigger = \"mouseenter focus\";\n                } else if (opts.trigger === \"none\") {\n                    tippy_options.trigger = \"manual\";\n                    tippy_options.hideOnClick = false;\n                }\n            },\n\n            source: () => {\n                let content;\n                if (opts.source === \"title\") {\n                    // Tooltip content from title attribute\n                    content = this.el.getAttribute(\"title\");\n                } else if (opts.source === \"content\") {\n                    // Tooltip content from trigger childs.\n                    content = this.el.innerHTML;\n                    tippy_options.allowHTML = true;\n                } else if (opts.source === \"ajax\") {\n                    // Tooltiop content from AJAX request.\n                    content = document.createElement(\"progress\");\n                    tippy_options.allowHTML = true;\n                }\n                tippy_options.content = content;\n            },\n\n            delay() {\n                if (opts.delay) {\n                    tippy_options.delay = [utils.parseTime(opts.delay), 0];\n                }\n            },\n\n            target: () => {\n                if (!opts.target) {\n                    return;\n                }\n                if (opts.target === \"parent\") {\n                    tippy_options.appendTo = \"parent\";\n                } else if (opts.target === \"body\") {\n                    tippy_options.appendTo = document.body;\n                } else {\n                    tippy_options.appendTo = document.querySelector(opts.target);\n                }\n            },\n        };\n\n        for (let arg in opts) {\n            switch (arg) {\n                case \"ajax-data-type\":\n                    arg = \"ajaxDataType\";\n                    break;\n                case \"mark-inactive\":\n                    arg = \"markInactive\";\n                    break;\n            }\n            parsers[arg] && parsers[arg](arg);\n        }\n\n        return tippy_options;\n    }\n\n    _initialize_content() {\n        // Initialize any other patterns.\n        registry.scan(this.tippy.popper);\n    }\n\n    async _onShow() {\n        const tippy_classes = [];\n\n        // Group DOM manipulations\n\n        if (this.options.class) {\n            tippy_classes.push(...this.options.class.split(\" \"));\n        }\n\n        // Add a generic non-tippy related class to identify the tooltip container\n        tippy_classes.push(\"tooltip-container\");\n\n        if (this.options.closing === \"close-button\") {\n            // First, remove previously automatically added close buttons.\n            // Otherwise we would end up adding another close button with every\n            // click on it.\n            for (const close_button of this.tippy.popper.querySelectorAll(\n                \".pat-tooltip--close-button\"\n            )) {\n                close_button.remove();\n            }\n\n            const close_button = document.createElement(\"button\");\n            close_button.setAttribute(\"class\", \"close-panel pat-tooltip--close-button\");\n            const content = this.tippy.popper.querySelector(\".tippy-content\");\n            content.parentNode.insertBefore(close_button, content);\n        }\n\n        // Store reference to method for closing panels on the tooltip element instance.\n        events.add_event_listener(\n            this.tippy.popper,\n            \"close-panel\",\n            \"pat-tooltip--close-panel\",\n            () => this.hide()\n        );\n\n        this.tippy.popper.classList.add(...tippy_classes);\n\n        if (this.options.markInactive) {\n            this.el.classList.remove(this.inactive_class);\n            this.el.classList.add(this.active_class);\n        }\n\n        if (this.options.closing !== \"auto\" && this.options.trigger === \"hover\") {\n            // no auto-close when hovering when closing mode is \"sticky\" or \"close-button\".\n            this.tippy.setProps({ trigger: \"click\" });\n        }\n\n        if (this.options.source === \"ajax\") {\n            await this._get_content();\n        }\n\n        // Notify parent patterns about injected content.\n        // Do not call pat-inject's handler, because all necessary\n        // initialization after injection is done here.\n        $(this.tippy.popper).trigger(\"patterns-injected\", [\n            { skipPatInjectHandler: true },\n            this.el,\n            this.tippy.popper,\n        ]);\n\n        this._initialize_content();\n    }\n\n    _onHide() {\n        if (this.options.markInactive) {\n            this.el.classList.remove(this.active_class);\n            this.el.classList.add(this.inactive_class);\n        }\n\n        if (this.options.closing !== \"auto\" && this.options.trigger === \"hover\") {\n            // re-set hover behavior\n            this.tippy.setProps({ trigger: \"mouseenter focus\" });\n        }\n\n        if (this.options.source === \"ajax\") {\n            this.tippy.setContent(document.createElement(\"progress\"));\n        }\n    }\n\n    async _get_content(url = this.options.url) {\n        let selector;\n        ({ url, selector } = this.get_url_parts(url || this.el.getAttribute(\"href\")));\n        let content;\n        if (url) {\n            // Tooltip from remote page.\n            const handler = this.data_type_handlers[this.options.ajaxDataType];\n            try {\n                // TODO: use pat-inject, once it supports async\n                const response = await fetch(url, {\n                    headers: {\n                        Accept: \"text/html,application/xhtml+xml,application/xml\",\n                    },\n                });\n                const text = await response.text();\n                content = await handler(text, url, selector);\n            } catch {\n                log.error(\"Error on ajax request. ${e}\");\n            }\n        } else if (selector) {\n            // Tooltip content from current DOM tree.\n            content = document.querySelector(selector);\n            content = content?.innerHTML || undefined;\n        }\n        if (content) {\n            this.tippy.setContent(content);\n            await utils.timeout(1); // Wait a tick before forceUpdate. Might fail due to unset popperInstance.\n            this.tippy.popperInstance.forceUpdate(); // re-position tippy after content is known.\n        }\n    }\n\n    async get_content(url = this.options.url) {\n        // API method: _get_content + _initialize_content\n        await this._get_content(url);\n        this._initialize_content();\n    }\n\n    get_url_parts(href) {\n        // Return the URL and a CSS ID selector.\n        let url, selector, query;\n        if (!href) {\n            return { url, selector };\n        }\n        [url, selector] = href.split(\"#\");\n        if (selector) {\n            selector = `#${selector}`;\n            [selector, query] = selector.split(\"?\");\n        }\n        if (query) {\n            url = `${url}?${query}`;\n        }\n        return { url, selector };\n    }\n\n    static data_type_handlers = {\n        html(text, url, selector) {\n            let tmp = document.createElement(\"div\");\n            tmp.innerHTML = text;\n            if (selector) {\n                tmp = tmp.querySelector(selector);\n            }\n            return tmp?.innerHTML || \"\";\n        },\n\n        async markdown(text, url, selector) {\n            const Markdown = registry.patterns.markdown;\n            if (!Markdown) {\n                return text;\n            }\n\n            const instance = new Markdown($(\"<div/>\"));\n            await events.await_pattern_init(instance);\n\n            const cfg = { url };\n            if (selector) {\n                cfg.source = selector;\n            }\n\n            const ret = await instance.renderForInjection(cfg, text);\n            return ret[0];\n        },\n    };\n\n    static register_type_handler(type, handler) {\n        Pattern.data_type_handlers[type] = handler;\n    }\n\n    constructor(...args) {\n        super(...args);\n\n        this.register_type_handler = this.constructor.register_type_handler;\n        this.data_type_handlers = this.constructor.data_type_handlers;\n    }\n}\n\nregistry.register(Pattern);\nexport default Pattern;\nexport { Pattern };\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport logger from \"@patternslib/patternslib/src/core/logging\";\nimport utils from \"../../core/utils\";\n\nconst log = logger.getLogger(\"pat-upload\");\n\nlet Dropzone;\n\nexport default Base.extend({\n    name: \"upload\",\n    trigger: \".pat-upload\",\n    parser: \"mockup\",\n    defaults: {\n        showTitle: true,\n        url: null, // XXX MUST provide url to submit to OR be in a form\n        className: \"upload\",\n        wrap: false,\n        wrapperTemplate: '<div class=\"upload-wrapper\"/>',\n        fileaddedClassName: \"dropping\",\n        useTus: false,\n        container: \"\",\n        ajaxUpload: true,\n\n        paramName: \"file\",\n        addRemoveLinks: false,\n        autoCleanResults: true,\n        previewsContainer: \".previews\",\n        previewTemplate: null,\n        maxFiles: null,\n        maxFilesize: 99999999, // let's not have a max by default...\n\n        allowPathSelection: undefined,\n        relatedItems: {\n            // UID attribute is required here since we're working with related items\n            attributes: [\n                \"UID\",\n                \"Title\",\n                \"Description\",\n                \"getURL\",\n                \"portal_type\",\n                \"path\",\n                \"ModificationDate\",\n            ],\n            batchSize: 20,\n            basePath: \"/\",\n            vocabularyUrl: null,\n            width: 500,\n            maximumSelectionSize: 1,\n            selectableTypes: [\"Folder\"],\n        },\n    },\n\n    init: async function () {\n        import(\"dropzone/dist/dropzone.css\");\n        import(\"./upload.scss\");\n        Dropzone = (await import(\"dropzone\")).default;\n        /* we do not want this plugin to auto discover */\n        Dropzone.autoDiscover = false;\n\n        const UploadTemplate = (await import(\"./templates/upload.xml\")).default;\n\n        var self = this;\n\n        if (self.$el.find(\".upload-area\").length) {\n            log.info(\"Found already a dropzone on element, skipping!\");\n            return;\n        }\n\n        if (typeof self.options.allowPathSelection === \"undefined\") {\n            // Set allowPathSelection to true, if we can use path based urls.\n            self.options.allowPathSelection =\n                self.options.baseUrl && self.options.relativePath;\n        }\n\n        // TODO: find a way to make this work in firefox (and IE)\n        $(document).on(\"paste\", function (e) {\n            var oe = e.originalEvent;\n            var items = oe.clipboardData.items;\n            if (items) {\n                for (var i = 0; i < items.length; i++) {\n                    if (items[i].type.indexOf(\"image\") !== -1) {\n                        var blob = items[i].getAsFile();\n                        self.dropzone.addFile(blob);\n                    }\n                }\n            }\n        });\n        // values that will change current processing\n        self.currentPath = self.options.currentPath;\n        self.currentFile = 0;\n\n        let template = _.template(UploadTemplate)({\n            _t: _t,\n            allowPathSelection: self.options.allowPathSelection,\n        });\n        self.$el.addClass(self.options.className);\n        self.$el.append(template);\n\n        self.$progress = $(\".progress-bar-success\", self.$el);\n\n        if (!self.options.showTitle) {\n            self.$el.find(\"h2.title\").hide();\n        }\n\n        if (!self.options.ajaxUpload) {\n            // no ajax upload, drop the fallback\n            $(\".fallback\", this.$el).remove();\n            if (this.$el.hasClass(\".upload-container\")) {\n                this.$el.addClass(\"no-ajax-upload\");\n            } else {\n                this.$el.closest(\".upload-container\").addClass(\"no-ajax-upload\");\n            }\n        }\n\n        if (self.options.wrap) {\n            self.$el.wrap(self.options.wrapperTemplate);\n            self.$el = self.$el.parent();\n        }\n\n        if (self.options.allowPathSelection) {\n            // only use related items if we can generate path based urls and if it's not turned off.\n            self.$pathInput = $('input[name=\"location\"]', self.$el);\n            self.relatedItems = await self.setupRelatedItems(self.$pathInput);\n        } else {\n            $('input[name=\"location\"]', self.$el).parent().remove();\n            self.relatedItems = null;\n        }\n\n        self.$dropzone = $(\".upload-area\", self.$el);\n\n        $(\"div.browse-select button.browse\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if (\n                !self.options.maxFiles ||\n                self.dropzone.files.length < self.options.maxFiles\n            ) {\n                self.dropzone.hiddenFileInput.click();\n            }\n        });\n\n        var dzoneOptions = await this.getDzoneOptions();\n\n        try {\n            // if init of Dropzone fails it says nothing and\n            // it fails silently. Using this block we make sure\n            // that if you break it w/ some weird or missing option\n            // you can get a proper log of it\n            //\n            self.dropzone = new Dropzone(self.$dropzone[0], dzoneOptions);\n        } catch (e) {\n            if (window.DEBUG) {\n                // log it!\n                console.log(e);\n            }\n            throw e;\n        }\n\n        self.dropzone.on(\"maxfilesreached\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"addedfile\", function (/* file */) {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"removedfile\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"success\", function (e, response) {\n            // Trigger event 'uploadAllCompleted' and pass the server's reponse and\n            // the path uid. This event can be listened to by patterns using the\n            // upload pattern, e.g. the TinyMCE pattern's link plugin.\n            var data;\n            try {\n                data = $.parseJSON(response);\n            } catch {\n                data = response;\n            }\n            self.$el.trigger(\"uploadAllCompleted\", {\n                data: data,\n                path_uid: self.$pathInput ? self.$pathInput.val() : null,\n            });\n        });\n\n        if (self.options.autoCleanResults) {\n            self.dropzone.on(\"complete\", function (file) {\n                if (file.status === Dropzone.SUCCESS) {\n                    setTimeout(function () {\n                        $(file.previewElement).fadeOut();\n                    }, 3000);\n                }\n            });\n        }\n\n        self.dropzone.on(\"complete\", function (file) {\n            if (file.status === Dropzone.SUCCESS && self.dropzone.files.length === 1) {\n                self.showHideControls();\n            }\n        });\n\n        self.dropzone.on(\"error\", function (file, response, xmlhr) {\n            if (typeof xmlhr !== \"undefined\" && xmlhr.status !== 403) {\n                // If error other than 403, just print a generic message\n                $(\".dz-error-message span\", file.previewElement).html(\n                    _t(\"The file transfer failed\")\n                );\n            }\n        });\n\n        self.dropzone.on(\"totaluploadprogress\", function (pct) {\n            // need to caclulate total pct here in reality since we're manually\n            // processing each file one at a time.\n            pct =\n                (((self.currentFile - 1) * 100 + pct) /\n                    (self.dropzone.files.length * 100)) *\n                100;\n            self.$progress.attr(\"aria-valuenow\", pct).css(\"width\", pct + \"%\");\n        });\n\n        $(\".upload-all\", self.$el).on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            self.processUpload({\n                finished: function () {\n                    self.$progress.attr(\"aria-valuenow\", 0).css(\"width\", \"0%\");\n                },\n            });\n        });\n        if (self.options.clipboardfile) {\n            self.dropzone.addFile(self.options.clipboardfile);\n        }\n    },\n\n    showHideControls: function () {\n        /* we do this delayed because this can be called multiple times\n         AND we need to do this hide/show AFTER dropzone is done with\n         all it's own events. This is NASTY but the only way we can\n         enforce some numFiles with dropzone! */\n        var self = this;\n        if (self._showHideTimeout) {\n            clearTimeout(self._showHideTimeout);\n        }\n        self._showHideTimeout = setTimeout(function () {\n            self._showHideControls();\n        }, 50);\n    },\n\n    _showHideControls: function () {\n        var self = this;\n        var $controls = $(\".controls\", self.$el);\n        var $browse = $(\".browse-select\", self.$el);\n        var $input = $(\".dz-hidden-input\");\n\n        if (self.options.maxFiles) {\n            if (self.dropzone.files.length < self.options.maxFiles) {\n                $browse.show();\n                $input.prop(\"disabled\", false);\n            } else {\n                $browse.hide();\n                $input.prop(\"disabled\", true);\n            }\n        }\n        if (self.dropzone.files.length > 0) {\n            $controls.fadeIn(\"slow\");\n            var file = self.dropzone.files[0];\n            $(\".dz-error-message span\", file.previewElement).html(\"\");\n        } else {\n            $controls.fadeOut(\"slow\");\n        }\n    },\n\n    pathJoin: function () {\n        var parts = [];\n        _.each(arguments, function (part) {\n            if (!part) {\n                return;\n            }\n            if (part[0] === \"/\") {\n                part = part.substring(1);\n            }\n            if (part[part.length - 1] === \"/\") {\n                part = part.substring(0, part.length - 1);\n            }\n            parts.push(part);\n        });\n        return parts.join(\"/\");\n    },\n\n    getUrl: function () {\n        var self = this;\n        var url = self.options.url;\n        if (!url) {\n            if (self.options.baseUrl && self.options.relativePath) {\n                url = self.options.baseUrl;\n                if (url[url.length - 1] !== \"/\") {\n                    url = url + \"/\";\n                }\n                url = url + self.pathJoin(self.currentPath, self.options.relativePath);\n            } else {\n                var $form = self.$el.parents(\"form\");\n                if ($form.length > 0) {\n                    url = $form.attr(\"action\");\n                } else {\n                    url = window.location.href;\n                }\n            }\n        }\n        return url;\n    },\n\n    getDzoneOptions: async function () {\n        let PreviewTemplate = await import(\"./templates/preview.xml\");\n        PreviewTemplate = PreviewTemplate.default;\n\n        var self = this;\n\n        // This pattern REQUIRE dropzone to be clickable\n        self.options.clickable = true;\n\n        var options = $.extend({}, self.options);\n        options.url = self.getUrl();\n\n        options.headers = {\n            \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n        };\n\n        // XXX force to only upload one to the server at a time,\n        // right now we don't support multiple for backends\n        options.uploadMultiple = false;\n\n        delete options.wrap;\n        delete options.wrapperTemplate;\n        delete options.resultTemplate;\n        delete options.autoCleanResults;\n        delete options.fileaddedClassName;\n        delete options.useTus;\n\n        if (self.options.previewsContainer) {\n            /*\n             * if they have a select but it's not an id, let's make an id selector\n             * so we can target the correct container. dropzone is weird here...\n             */\n            var $preview = self.$el.find(self.options.previewsContainer);\n            if ($preview.length > 0) {\n                options.previewsContainer = $preview[0];\n            }\n        }\n\n        // XXX: do we need to allow this?\n        options.autoProcessQueue = false;\n        // options.addRemoveLinks = true;  // we show them in the template\n        options.previewTemplate = PreviewTemplate;\n\n        // if our element is a form we should force some values\n        // https://github.com/enyo/dropzone/wiki/Combine-normal-form-with-Dropzone\n        return options;\n    },\n\n    processUpload: function (options) {\n        if (!options) {\n            options = {};\n        }\n\n        var self = this,\n            processing = false,\n            useTus = self.options.useTus,\n            fileaddedClassName = self.options.fileaddedClassName,\n            finished = options.finished;\n\n        self.currentFile = 0;\n\n        function process() {\n            processing = true;\n            if (self.dropzone.files.length === 0) {\n                processing = false;\n            }\n\n            var file = self.dropzone.files[0];\n            if (processing && file.status === Dropzone.ERROR) {\n                // Put the file back as \"queued\" for retrying\n                file.status = Dropzone.QUEUED;\n                processing = false;\n            }\n\n            if (!processing) {\n                self.$el.removeClass(fileaddedClassName);\n                if (finished !== undefined && typeof finished === \"function\") {\n                    finished();\n                }\n                return;\n            }\n\n            if ([Dropzone.SUCCESS, Dropzone.CANCELED].indexOf(file.status) !== -1) {\n                // remove it\n                self.dropzone.removeFile(file);\n                process();\n            } else if (file.status !== Dropzone.UPLOADING) {\n                // start processing file\n                if (useTus && window.tus) {\n                    // use tus upload if installed\n                    self.handleTusUpload(file);\n                } else {\n                    // otherwise, just use dropzone to process\n                    self.currentFile += 1;\n                    self.dropzone.processFile(file);\n                }\n                setTimeout(process, 100);\n            } else {\n                // currently processing\n                setTimeout(process, 100);\n            }\n        }\n        process();\n    },\n\n    handleTusUpload: function (file) {\n        /* this needs fixing... */\n        var self = this,\n            chunkSize = 1024 * 1024 * 5; // 5mb chunk size\n\n        file.status = Dropzone.UPLOADING;\n\n        window.tus\n            .upload(file, {\n                endpoint: self.dropzone.options.url,\n                headers: {\n                    \"FILENAME\": file.name,\n                    \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n                },\n                chunkSize: chunkSize,\n            })\n            .fail(function () {\n                if (window.DEBUG) {\n                    console.alert(_t(\"Error uploading with TUS resumable uploads\"));\n                }\n                file.status = Dropzone.ERROR;\n            })\n            .progress(function (e, bytesUploaded, bytesTotal) {\n                var percentage = (bytesUploaded / bytesTotal) * 100;\n                self.$progress\n                    .attr(\"aria-valuenow\", percentage)\n                    .css(\"width\", percentage + \"%\");\n                self.$progress.html(\n                    _t(\"uploading...\") +\n                        \"<br />\" +\n                        self.formatBytes(bytesUploaded) +\n                        \" / \" +\n                        self.formatBytes(bytesTotal)\n                );\n            })\n            .done(function (url, file) {\n                file.status = Dropzone.SUCCESS;\n                self.dropzone.emit(\"success\", file);\n                self.dropzone.emit(\"complete\", file);\n            });\n    },\n\n    formatBytes: function (bytes) {\n        var kb = Math.round(bytes / 1024);\n        if (kb < 1024) {\n            return kb + \" KiB\";\n        }\n        var mb = Math.round(kb / 1024);\n        if (mb < 1024) {\n            return mb + \" MB\";\n        }\n        return Math.round(mb / 1024) + \" GB\";\n    },\n\n    setPath: function (path) {\n        var self = this;\n        self.currentPath = path;\n        self.options.url = null;\n        self.options.url = self.dropzone.options.url = self.getUrl();\n    },\n\n    setupRelatedItems: async function ($input) {\n        const RelatedItems = (await import(\"../relateditems/relateditems\")).default;\n\n        var self = this;\n        var options = self.options.relatedItems;\n        options.upload = false; // ensure that related items upload is off.\n        if (self.options.initialFolder) {\n            $input.attr(\"value\", self.options.initialFolder);\n        }\n        var ri = new RelatedItems($input, options);\n        ri.$el.on(\"change\", function () {\n            var result = $(this).select2(\"data\");\n            var path = null;\n            if (result.length > 0) {\n                path = result[0].path;\n            }\n            self.setPath(path);\n        });\n        return ri;\n    },\n});\n","/**\n * Patterns store - store pattern state locally in the browser\n *\n * Copyright 2008-2012 Simplon B.V.\n * Copyright 2011 Humberto Sermeño\n * Copyright 2011 Florian Friesdorf\n */\nimport logging from \"./logging\";\n\nconst log = logging.getLogger(\"Patternslib Store\");\n\nfunction Storage(backend, prefix) {\n    this.prefix = prefix;\n    this.backend = backend;\n}\n\nStorage.prototype._key = function Storage_key(name) {\n    return this.prefix + \":\" + name;\n};\n\nStorage.prototype._allKeys = function Storage_allKeys() {\n    var keys = [],\n        prefix = this.prefix + \":\",\n        prefix_length = prefix.length,\n        key,\n        i;\n\n    for (i = 0; i < this.backend.length; i++) {\n        key = this.backend.key(i);\n        if (key.slice(0, prefix_length) === prefix) keys.push(key);\n    }\n    return keys;\n};\n\nStorage.prototype.get = function Storage_get(name) {\n    var key = this._key(name),\n        value = this.backend.getItem(key);\n    if (value !== null) {\n        try {\n            value = JSON.parse(value);\n        } catch {\n            log.warn(`Cannot parse storage value for key ${key}`);\n            return;\n        }\n    }\n    return value;\n};\n\nStorage.prototype.set = function Storage_set(name, value) {\n    var key = this._key(name);\n    return this.backend.setItem(key, JSON.stringify(value));\n};\n\nStorage.prototype.remove = function Storage_remove(name) {\n    var key = this._key(name);\n    return this.backend.removeItem(key);\n};\n\nStorage.prototype.clear = function Storage_clear() {\n    var keys = this._allKeys();\n    for (var i = 0; i < keys.length; i++) this.backend.removeItem(keys[i]);\n};\n\nStorage.prototype.all = function Storage_all() {\n    var keys = this._allKeys(),\n        prefix_length = this.prefix.length + 1,\n        lk,\n        data = {};\n\n    for (var i = 0; i < keys.length; i++) {\n        lk = keys[i].slice(prefix_length);\n        data[lk] = JSON.parse(this.backend.getItem(keys[i]));\n    }\n    return data;\n};\n\nfunction ValueStorage(store, name) {\n    this.store = store;\n    this.name = name;\n}\n\nValueStorage.prototype.get = function ValueStorage_get() {\n    return this.store.get(this.name);\n};\n\nValueStorage.prototype.set = function ValueStorage_get(value) {\n    return this.store.set(this.name, value);\n};\n\nValueStorage.prototype.remove = function ValueStorage_remove() {\n    return this.store.remove(this.name);\n};\n\nvar store = {\n    supported: false,\n\n    local: function (name) {\n        return new Storage(window.localStorage, name);\n    },\n\n    session: function (name) {\n        return new Storage(window.sessionStorage, name);\n    },\n\n    ValueStorage: ValueStorage,\n\n    // Update storage options for a given element.\n    updateOptions: function store_updateOptions(trigger, options) {\n        if (options.store !== \"none\") {\n            if (!trigger.id) {\n                log.warn(\"state persistance requested, but element has no id\");\n                options.store = \"none\";\n            } else if (!store.supported) {\n                log.warn(\n                    \"state persistance requested, but browser does not support webstorage\"\n                );\n                options.store = \"none\";\n            }\n        }\n        return options;\n    },\n};\n\n// Perform the test separately since this may throw a SecurityError as\n// reported in #326\ntry {\n    store.supported = typeof window.sessionStorage !== \"undefined\";\n} catch {\n    // just ignore.\n}\n\nexport default store;\n","/* pat-date-picker  - Polyfill for input type=date */\nimport $ from \"jquery\";\nimport Base from \"../../core/base\";\nimport logging from \"../../core/logging\";\nimport Parser from \"../../core/parser\";\nimport dom from \"../../core/dom\";\nimport events from \"../../core/events\";\nimport store from \"../../core/store\";\nimport utils from \"../../core/utils\";\n\nconst log = logging.getLogger(\"date-picker\");\n\nexport const parser = new Parser(\"date-picker\");\nparser.addArgument(\"behavior\", \"styled\", [\"native\", \"styled\"]);\nparser.addArgument(\"week-numbers\", [], [\"show\", \"hide\"]);\nparser.addArgument(\"i18n\"); // URL pointing to JSON resource with i18n values\nparser.addArgument(\"first-day\", 0);\nparser.addArgument(\"after\");\nparser.addArgument(\"offset-days\", 0);\n\nparser.add_argument(\"output-format\", null);\nparser.add_argument(\"locale\", null);\n\nparser.addAlias(\"behaviour\", \"behavior\");\n\n/* JSON format for i18n\n * { \"previousMonth\": \"Previous Month\",\n *   \"nextMonth\"    : \"Next Month\",\n *   \"months\"       : [\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\n *   \"weekdays\"     : [\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"],\n *   \"weekdaysShort\": [\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"]\n * } */\n\nexport const storage = store.session(\"pat-date-picker\");\n\n\nexport default Base.extend({\n    name: \"date-picker\",\n    trigger: \".pat-date-picker\",\n    parser: parser,\n    format: \"YYYY-MM-DD\",\n\n    async init() {\n        const el = this.el;\n        const disabled = this.el.disabled;\n\n        //TODO: make parser with options extend missing options.\n        //this.options = parser.parse(el, opts);\n        this.options = $.extend(parser.parse(el), this.options);\n\n        if (!disabled && this.options.after) {\n            // Set the date depending on another date which must be ``offset-days``\n            // BEFORE this date. Only set it, if the other date is AFTER this\n            // date.\n            const befores = document.querySelectorAll(this.options.after);\n            for (const b_el of befores) {\n                b_el.addEventListener(\"change\", (e) => {\n                    let b_date = e.target.value; // the \"before-date\"\n                    b_date = b_date ? new Date(b_date) : null;\n                    if (!b_date) {\n                        return;\n                    }\n                    let a_date = this.el.value; // the \"after-date\"\n                    a_date = a_date ? new Date(a_date) : null;\n                    if (!a_date || a_date < b_date) {\n                        const offset = this.options.offsetDays || 0;\n                        b_date.setDate(b_date.getDate() + offset);\n                        this.el.value = b_date.toISOString().substring(0, 10);\n                        this.dispatch_change_event();\n                    }\n                });\n            }\n        }\n\n        let display_el;\n        if (this.options.behavior === \"styled\") {\n            dom.hide(el); // hide input, but keep active (e.g. for validation)\n\n            display_el = document.createElement(\"time\");\n            display_el.setAttribute(\"class\", \"output-field\");\n            display_el.setAttribute(\"datetime\", el.value);\n            if (disabled) {\n                display_el.classList.add(\"disabled\");\n            }\n            el.insertAdjacentElement(\"beforebegin\", display_el);\n\n            // Disable click on label, as this invokes a click on the invisible\n            // input field which opens the calendar in Firefox and masks a\n            // click on display_el on Chrome.\n            const label = display_el.closest(\"label\");\n            if (label) {\n                events.add_event_listener(\n                    label,\n                    \"click\",\n                    \"pat-date-picker--label\",\n                    (e) => {\n                        e.preventDefault();\n                    }\n                );\n            }\n\n            let pat_display_time;\n            if (this.options.outputFormat) {\n                const PatDisplayTime = (await import(\"../display-time/display-time\")).default; // prettier-ignore\n                const display_time_config = { format: this.format };\n                if (this.options.outputFormat) {\n                    display_time_config[\"output-format\"] = this.options.outputFormat;\n                }\n                if (this.options.locale) {\n                    display_time_config.locale = this.options.locale;\n                }\n                pat_display_time = new PatDisplayTime(display_el, display_time_config);\n            } else if (this.el.value) {\n                display_el.textContent = el.value;\n            }\n\n            // Add the additional elements \"clear button\" and placeholder to\n            // the `<time>` element.\n            const _add_additional = () => {\n                this.add_clear_button(display_el);\n                if (!this.el.value && this.el.placeholder) {\n                    display_el.innerHTML = `<span class=\"placeholder\">${this.el.placeholder}</span>`;\n                }\n            };\n            if (pat_display_time) {\n                // Add the additional elements after display time has\n                // eventually cleared the contents or done any other changes.\n                $(display_el).on(\"init.display-time.patterns\", () => {\n                    _add_additional();\n                });\n            } else {\n                // If no `pat-display-time` was used, add immediately.\n                _add_additional();\n            }\n\n            this.el.addEventListener(\"change\", () => {\n                display_el.setAttribute(\"datetime\", this.el.value);\n                if (pat_display_time && this.el.value) {\n                    pat_display_time.format();\n                } else {\n                    //} else if (this.el.value) {\n                    display_el.textContent = this.el.value;\n                }\n                _add_additional();\n            });\n\n            if (disabled) {\n                // nothing else to do here...\n                return;\n            }\n        } else if (disabled) {\n            return;\n        } else if (utils.checkInputSupport(\"date\", \"invalid date\")) {\n            // behavior native with native support.\n            return;\n        } else if (el.getAttribute(\"type\") === \"date\") {\n            // behavior native but no native support.\n            // Fallback JS date picker with a text input field.\n            el.setAttribute(\"type\", \"text\");\n        }\n\n        if (window.__patternslib_import_styles) {\n            import(\"./_date-picker.scss\");\n        }\n        const Pikaday = (await import(\"pikaday\")).default;\n\n        const config = {\n            field: el,\n            trigger: display_el || el,\n            format: this.format,\n            firstDay: this.options.firstDay,\n            showWeekNumber: this.options.weekNumbers === \"show\",\n            onSelect: () => this.dispatch_change_event(),\n            onClose: () => {\n                if (this.options.behavior === \"styled\" && !this.el.value) {\n                    // blur the input field so that pat-validate can kick in when\n                    // nothing was selected.\n                    el.dispatchEvent(events.blur_event());\n                }\n            },\n        };\n\n        if (el.getAttribute(\"min\")) {\n            config.minDate = new Date(el.getAttribute(\"min\"));\n        }\n        if (el.getAttribute(\"max\")) {\n            config.maxDate = new Date(el.getAttribute(\"max\"));\n        }\n\n        if (this.options.i18n) {\n            let i18n = storage.get(this.options.i18n);\n            if (!i18n) {\n                try {\n                    const response = await fetch(this.options.i18n);\n                    i18n = await response.json();\n                    storage.set(this.options.i18n, i18n);\n                } catch {\n                    log.error(`date-picker could not load i18n for ${this.options.i18n}`);\n                }\n            }\n            if (i18n) {\n                config.i18n = i18n;\n            }\n        }\n        this.pikaday = new Pikaday(config);\n    },\n\n    add_clear_button(el_append_to) {\n        if (!this.el.disabled && !this.el.required && this.el.value) {\n            // Add clear button\n            const clear_button = document.createElement(\"span\");\n            clear_button.setAttribute(\"class\", \"cancel-button\");\n            clear_button.addEventListener(\"click\", (e) => {\n                e.stopPropagation();\n                this.el.value = null;\n                this.dispatch_change_event();\n            });\n            el_append_to.appendChild(clear_button);\n        }\n    },\n\n    dispatch_change_event() {\n        const event = new Event(\"change\", {\n            bubbles: true,\n            cancelable: true,\n        });\n        // Set ``firedBy` to prevent pikaday to call it's own handler and land\n        // in an infinite loop.\n        event.firedBy = this.pikaday;\n        this.el.dispatchEvent(event);\n\n        // Also trigger input-change\n        $(this.el).trigger(\"input-change\");\n        $(this.el.form).trigger(\"input-change\");\n    },\n});\n"],"names":["parser","Parser","addArgument","Pattern","BasePattern","static","init","this","el","style","display","SelectedItem","default","plone_registry","name","component","nodeId","getAttribute","utils","generateId","setAttribute","ContentBrowserApp","contentBrowserEl","document","createElement","classList","add","parentNode","insertBefore","component_content_browser","target","props","fieldId","options","registry","register","Base","extend","trigger","defaults","section","levels","IDPrefix","classTOCName","classSectionName","classLevelPrefixName","classActiveName","scrollDuration","scrollEasing","validationDelay","tabs","self","$toc","$","addClass","prependTo","appendTo","$el","className","asTabs","hasClass","activeId","each","i","closest","$level","id","prop","length","window","location","hash","data","$nav","text","attr","getLevel","on","e","stopPropagation","preventDefault","doScroll","skipHash","children","removeClass","parents","animate","scrollTop","offset","top","history","pushState","push","nav","find","first","initialize_validation","form","tab","querySelectorAll","remove","matches","debounced_validation_marker","debounce","validation_marker","addEventListener","detail","pattern","elementLevel","split","level","levelSelector","filter","baseUrl","currentLanguage","storage","catalogs","ttl","Date","now","valueOf","localStorage","JSON","console","log","configure","config","key","_setCatalog","domain","language","catalog","_storeCatalog","setItem","stringify","getUrl","loadCatalog","undefined","parseInt","getItem","parse","MessageFactory","msgid","keywords","msgstr","regexp","keyword","Object","prototype","hasOwnProperty","call","RegExp","replace","_translation_domains","plone","widgets","translate","i18n","I18N","translate_plone","separator","ajaxTimeout","initializeValues","initialValues","term","initSelection","callback","value","val","seldefaults","initial_values","it","selection","trim","items","removeHTML","initializeTags","tags","substr","allowNewItems","map","multiple","initializeOrdering","orderable","Sortable","_initializeOrdering","sortable_el","$select2","querySelector","draggable","dragClass","chosenClass","onStart","select2","onEnd","bind","initializeSelect2","startsWith","lang","warn","action","debug","formatResultCssClass","ob","toLowerCase","onSelected","onSelecting","onDeselecting","onDeselected","parent","off","opened","I18n","ajax","vocabularyUrl","url","_val","queryTerm","quietMillis","page","query","page_limit","results","dataIds","haveResult","includes","is","vals","innerHTML","type","join","after","logging","getLogger","parser_group_options","parser_multiple","parser_inherit","constructor","jquery","uuid","create_uuid","dispatchEvent","Event","bubbles","cancelable","setTimeout","async","emit_update","dom","events","update_event","one","event_name","event_callback","add_event_listener","once","destroy","table","DataTable","createModal","$model","width","height","modalSizeClass","margin","position","triggers","zIndexSelector","backdrop","backdropOptions","zIndex","opacity","closeOnEsc","closeOnClick","title","titleSelector","buttons","content","automaticallyAddButtonActions","loadLinksWithinModal","prependContent","onRender","templateOptions","classDialog","classModal","classHeaderName","classBodyName","classFooterName","classWrapperName","classWrapperInnerName","classPrependName","classContentName","template","actions","actionOptions","eventType","disableAjaxFormSubmit","ajaxUrl","modalFunction","isForm","timeout","displayInModal","reloadWindowOnClose","error","formFieldError","onSuccess","onError","onFormError","onTimeout","redirectOnResponse","redirectToUrl","$action","response","reg","exec","$modal","a","actionKeys","_","patternKeys","patternOptions","loading","show","handleFormAction","apply","handleLinkAction","$form","extraData","append","ajaxSubmit","xhr","textStatus","errorStatus","hide","emit","success","state","redraw","reloadWindow","href","fail","alert","_t","done","always","open","render","$raw","clone","tplObject","prepend","closeButtonLabel","$title","html","$modalDialog","$modalContent","event","nodeName","eq","$button","forEach","positionModal","$wrapperInner","reload","resize","item","substring","indexOf","selector","image","initModal","createAjaxModal","ajaxXHR","ajaxType","parseBodyTag","_show","createTargetModal","createBasicModal","createHtmlModal","createImageModal","$wrapper","src","srcset","context","innerText","findPosition","horpos","vertpos","modalWidth","modalHeight","wrapperInnerWidth","wrapperInnerHeight","absTop","absBottom","absLeft","absRight","returnpos","left","right","bottom","modalInitialized","activateFocusTrap","modal_el","inputsBody","inputsFooter","inputs","is_visible","firstInput","lastInput","closeInput","currentIndex","nextIndex","shiftKey","focus","removeAttr","modalCss","css","posopt","outerWidth","outerHeight","pos","createBackdrop","Backdrop","Math","max","$backdrop","Loading","scan","abort","_suppressHide","confirm","logger","closable","prefix","floor","random","toString","featureSupport","dragAndDrop","fileApi","FileReader","get","set","ICON_CACHE","Map","bool","escapeHTML","getAuthenticator","getWindow","win","txt","QueryHelper","searchParam","pathOperator","attributes","batchSize","baseCriteria","sort_on","sort_order","pathDepth","browsing","basePath","valid","Boolean","getBatch","size","getCurrentPath","currentPath","path","getCriterias","searchOptions","criterias","useBaseCriteria","additionalCriterias","slice","o","v","searchPath","concat","getQueryData","criteria","batch","selectAjax","dataType","more","total","search","operation","resolveIcon","icon_lookup_name","cache_key","has","icon","base_url","body","controller","AbortController","resp","fetch","signal","iconmap","parts","_resolve_icon","setId","KEY","selectedUIDs","openAfterInit","pageSize","closeOnSelect","contextPath","dropdownCssClass","favorites","recentlyUsed","recentlyUsedMaxItems","recentlyUsedKey","maximumSelectionSize","minimumInputLength","mode","rootPath","rootUrl","scanSelection","selectableTypes","sortOn","sortOrder","tokenSeparators","upload","uploadAllowView","breadcrumbTemplateSelector","favoriteTemplateSelector","recentlyusedTemplateSelector","resultTemplateSelector","selectionTemplateSelector","toolbarTemplateSelector","filterSelectable","ret","isSelectable","applyTemplate","tpl","open_folder","current_directory","one_level_up","_item","setAjax","UID","is_folderish","oneLevelUp","Title","selectable","renderToolbar","itemPath","itemsHtml","part","favoritesHtml","item_copy","recentlyUsedHtml","reverse","favItems","favText","searchText","searchModeText","browseModeText","recentlyUsedItems","recentlyUsedText","icon_root","icon_recently_used","icon_favorites","icon_upload","upload_text","$toolbar","toggleClass","browseTo","currentTarget","uid","selectItem","result","initUploadView","allowUpload","disabled","Upload","upload_button","upload_el","upload_config","uloadMultiple","allowPathSelection","relativePath","setPath","alreadyPresent","splice","deselectItem","obj","portal_type","Dropdown","breadcrumbTemplate","favoriteTemplate","recentlyusedTemplate","resultTemplate","selectionTemplate","toolbarTemplate","wrap","$container","Select2","formatSelection","getIcon","getURL","review_state","$selection","path_split","icon_level_up","icon_level_down","formatResult","iconLevelUp","iconLevelDown","_el","$parent","element","ids","reduce","prev","tokenizer","input","choice","yMax","innerHeight","documentElement","clientHeight","relitem_rect","parentElement","getBoundingClientRect","rect","maxHeight","which","selectorContext","browsableItemSelector","browsableItem","methods","settings","time","initialTime","exceptionAreas","$this","lastEvent","trueTime","untouched","inExceptionArea","mouseMoved","live","enteredException","leftException","removeData","startTimer","fn","diff","method","Array","arguments","scrollable","scrollHeight","clientWidth","scrollWidth","makeVisibleInScroll","parent_id","absoluteParent","elemTop","elemBottom","viewTop","viewBottom","safeOffset","docElem","elem","origin","nodeType","ownerDocument","setPositionAbsolute","offsettop","offsetleft","thiswidth","setleft","settop","positionAncestor","$ancestor","$child","childMarginEdgeLeft","childMarginEdgeTop","ancestorPaddingEdgeLeft","ancestorPaddingEdgeTop","findInclusive","addBack","slideIn","speed","easing","slideOut","Contains","m","toUpperCase","scopedFind","jquery_plugin","all_selects","all_deselects","all_toggles","all_checkboxes","all_radios","_init","change_handler","change_buttons_and_toggles","change_checked","find_scoped","select","btn","select_all","deselect","deselect_all","toggle","toggle_all","remove_event_listener","find_siblings","sel","res","find_checkboxes","ref_el","chkbxs","every","tgl","checked","box","change_event","input_event","label","labels","fieldset","querySelectorAllAndMe","el_date","el_time","checkInputSupport","__patternslib_import_styles","DatePicker","date_value","time_value","el_wrapper","html_btn_now","today","html_btn_clear","clear","update","isotime","date_options","behavior","format","weekNumbers","firstDay","isodate","toISOString","toTimeString","addAlias","KEY_ERROR_EL","KEY_ERROR_MSG","check_input","capture","initialize_inputs","disabled_elements","disableSelector","cnt","entries","debouncer","delay","stop","set_error","msg","skip_event","validity_state","validity","submitter","hasAttribute","input_options","equality","message","attribute","not","before","date","datetime","msg_default_not_before","msg_default_not_after","not_after","not_after_el","not_before","not_before_el","is_iso_date_time","isNaN","msg_attr","textContent","customError","remove_error","valueMissing","required","rangeUnderflow","min","rangeOverflow","badInput","stepMismatch","number","typeMismatch","email","stopImmediatePropagation","set_error_message","setCustomValidity","all_of_group","error_node","checkValidity","removeAttribute","some","validation_message","validationMessage","create_from_string","error_template","firstChild","did_disable","formNoValidate","_input","language_mapping","atom","plist","rss","svg","wsf","xhtml","xjb","xsd","xsl","CodeJar","hljs","theme","highlight","editor","highlightElement","highlight_wrapper","linenumbers","withLineNumbers","class","hljs_language","registerLanguage","pre_el","indentOn","spellcheck","catchTab","preserveIdent","addClosing","codeeditor","onUpdate","code","inject","opts","jqToNode","cfgs","extractConfig","nextHref","pushMarker","onTrigger","idleTrigger","_initIdleTrigger","cfg","processDelay","onClickSubmit","delayed_trigger","uuid_","still_there","_initAutoloadVisible","formaction","cfg_node","params","serializeArray","execute","submitSubform","$sub","assign","$context","urlparts","defaultSelector","parseTime","elementIsDirty","askForConfirmation","should_confirm","_confirm","$target","confirmMessage","ensureTarget","createTarget","$created_target","verifySingleConfig","source","extractModifiers","listenForFormReset","verifyConfig","source_match","target_match","sourceMod","targetMod","targetPosition","loadingClass","_performInjection","$sources","wrapper","sources_string","img","source_nodes","childNodes","_inject","_update_history","_afterInjection","glue","title_el","$injected","idx","el_","scroll","scroll_target","scroll_container","find_scroll_container","scroll_to_top","scroll_to_element","_onInjectSuccess","ev","jqxhr","responseText","sources$","callTypeHandler","idx1","perform_inject","_onInjectError","explanation","status","timestamp","error_page","error_page_fragment","URLSearchParams","error_page_url","error_page_response","executingClass","error_zone","statusText","do_close_panel","request","browserCache","replaceWith","contentafter","contentbefore","elementafter","elementbefore","_sourcesFromHtml","sources","$html","_parseRawHtml","$source","_rebaseAttrs","object","video","_rebaseOptions","_rebaseURL","base","URL","lastIndexOf","_rebaseHTML","rebase_selector","tag","pattern_name","patterns","pattern_parser","changed","opt","isArray","match","clean_html","timeout_id","observer","IntersectionObserver","entry","isIntersecting","disconnect","clearTimeout","threshold","root","observe","timer","unsub","onInteraction","contains","removeEventListener","registerTypeHandler","handler","handlers","injected","skipPatInjectHandler","executedClass","CustomEvent","originalEvent","replaceState","DependsHandler","condition","set_state","getAllInputs","pattern_uuid","update_modal","enable","find_inputs","is_button","tagName","enabled","disable","evaluate","hideOrShow","navigation","set_base_url","url_","split_","dataset","that","_load","loadRemote","loadLocal","$content","empty","isCookiesEnabled","c","cookie","dc","showIfCookiesDisabled","_changed","_suppressed","changingEvents","changingFields","modal","_handleUnload","_handleMsg","returnValue","active","selectedItem","resultsClass","defaultSortOn","perPage","timeoutHide","inputSelector","itemTemplate","doSearch","serialize","parameters","sorton_position","$searchResults","description","$results","index","$prev","disableHiding","$next","next","$li","$input","onceFocused","keyCode","insertAfter","external_links_open_new_window","mark_special_links","protocol_icon_map","https","http","ftp","callto","bitcoin","geo","im","irc","ircs","magnet","mailto","mms","news","nntp","openpgp4fpr","sip","sms","smsto","ssh","tel","urn","webcal","wtai","xmpp","open_new_window","protocol","host","links","link","link_url","icon_name","icon_el","portal_url","portalUrl","scan_navigation","anchors","anchor","parentSelector","navlink","href_parts","nav_parts","inPath","generic_event","zxcvbn","htmltmp","pwfield","pwmeterContainer","firstElementChild","pwmeter","indicators","setLevel","score","elements","inp","x","wclass","nextSibling","onkeyup","s","head","scripts","getElementsByTagName","loadScript","guardClassName","optOutClassName","messageTimeout","submitTimeout","switchTimeout","isModal","dirty","setupAddDropdown","setupSwitchPortletManager","setupSavePortletsSettings","setupPortletEdit","ajax_load","$body","$h1","rebind","suppress","info","statusMessage","$message","fadeTo","showEditPortlet","$a","Modal","$select","ajaxForm","beforeSubmit","_reloadPortletManager","is_popstate","Re","zeropad","len","fmt","conf","d","getDate","D","getDay","getMonth","y","getFullYear","flags","dd","ddd","localization","shortWeekdays","dddd","weekdays","mm","mmm","shortMonths","mmmm","months","yy","String","yyyy","$0","widgetSaveToRfc5545","RDATE","EXDATE","tz","interval","month","year","occurrences","day","i18nweekdays","monthlyType","yearlyType","rangeType","rtemplate","rrule","human","field_id","fields","field","dailyInterval2","weeklyInterval2","j","weeklyWeekdaysHuman","monthlyInterval2","monthlyDayOfMonth1Human","monthlyDayOfMonth2","monthlyWeekdayOfMonth1Human","orderIndexes","monthlyWeekdayOfMonth2","yearlyInterval2","yearlyDayOfMonth1Human","yearlyWeekdayOfMonth1Human","yearlyWeekdayOfMonth2","yearlyWeekdayOfMonth3","yearlyWeekdayOfMonth4","rangeByOccurrences1Human","rangeByOccurrences2","padStart","replaceAll","rangeByEndDateHuman","date_parts","longDateFormat","sort","tmp_dates","tmp_human","rdate","including","exdate","except","parseLine","icalline","property","cleanDates","dates","parseIcal","icaldata","nextline","lines","RRULE","line","pop","charAt","widgetLoadFromRfc5545","force","selectors","radiobutton","freq","byday","bymonth","bymonthday","count","until","weekday","unsupportedFeatures","noRule","bysetpos","noTemplateMatch","multipleDayOfMonth","day_index","weekday_index","hasRepeatForeverButton","messagearea","RecurrenceInput","textarea","$textarea","orderedWeekdays","now_date","displayFields","$modalForm","rtField","occurrenceExclude","occurrenceInclude","occurrenceDelete","occurrenceAdd","datevalue","errorarea","alreadyAdded","$newdate","additionalDate","icons","slideDown","loadOccurrences","startdate","rfc5545","start","readonly","occurrenceDiv","ajaxURL","contentType","ajaxContentType","cache","readOnly","occurrence","formattedDate","jqXHR","getField","realField","findStartDate","startField","startFieldYear","startFieldMonth","startFieldDay","findIntField","fieldName","num","recurrenceOn","RFC5545","displayActivate","edit_rules","checkFields","startDate","endDate","endField","enddate","noRepeatEvery","noRepeatOn","noEndAfterNOccurrences","noEndDate","pastEndDate","save","cancel","updateOccurrences","displayUnactivate","add_rules","dayindex","loadData","start_date","setDate","initModalForm","delete_rules","refresh","preview","addDate","recurrenceType","dailyInterval1","weeklyInterval1","weeklyWeekdays","monthlyInterval1","monthlyDayOfMonth1","monthlyDayOfMonth3","monthlyWeekdayOfMonth1","monthlyWeekdayOfMonth3","monthlyRepeatOn","yearlyInterval1","yearlyDayOfMonth1","yearlyDayOfMonth2","yearlyDayOfMonth3","yearlyWeekdayOfMonth1","yearlyRepeatOn","range","rangeNoEnd","rangeByOccurrences1","rangeByEndDate","recurrenceStart","include","exclude","shortDateFormat","daily","mondayfriday","weekly","monthly","yearly","ributtonExtraClass","load_icons","configuration","recurrenceinput","$filter","$filterBtn","$advSearchInput","$ctSelectAll","$selectAllContainer","$sortingContainer","pathname","pushHistory","setBatchStart","b_start","updateSortingState","default_sort","order","urlStructure","indexOptionsUrl","contextInfoUrl","setDefaultPageUrl","menuOptions","backdropSelector","activeColumnsCookie","activeColumns","availableColumns","ModificationDate","EffectiveDate","ExpirationDate","CreationDate","Subject","exclude_from_nav","getObjSize","last_comment_date","total_comments","typeToViewAction","File","Image","Blob","defaultPageTypes","dateFormat","dateStyle","timeStyle","rearrange","properties","sortable_title","moveUrl","tooltip","datatables_options","uploadMultiple","showTitle","Backbone","AppView","collectionUrl","queryHelperAttributes","view","descriptionSelector","Description","maxFiles","contentBrowser","placeholder","insertBtn","cancelBtn","insertHeading","internal","external","externalText","anchorLabel","subject","imageAlign","enableImageZoom","scale","alt","insertImageHelp","internalImage","externalImage","externalImageText","insertLinkHelp","captionFromDescription","caption","loadingBaseUrl","prependToUrl","appendToUrl","linkAttribute","prependToScalePart","appendToScalePart","appendToOriginalScalePart","defaultSrcset","imageCaptioningEnabled","imageClasses","targetList","imageTypes","folderTypes","tiny","plugins","menubar","toolbar","inline","implementation","instance","current_widgets","textareaName","init_textareas","mimetype","pattern_config","textareas","wdgt","area","targetScope","isMarked","marked","previous_toolbar_url","reload_toolbar","Cookies","expanded","render_view","div","main_toolbar","personal_tools","autoOpen","keyboardSupport","onLoad","optionKey","def","onCanMoveTo","moved","folder","dataUrl","tree","tooltip_parser","ValidationPattern","getOptions","patternName","elOptions","tmpOptions","initBasePattern","plog","Registry","mockupParser","eventName","eventCallback","args","patternProps","child","Error","Surrogate","__super__","autoregister","Criteria","indexWidth","classBetweenDtName","classIndexName","classOperatorName","classValueName","classRemoveName","classResultsName","classClearName","classDepthName","app","indexes","operator","patternDateOptions","patternAjaxSelectOptions","patternRelateditemsOptions","indexGroups","advanced","initial","$remove","$index","group","patternSelect2","removeValue","createOperator","createClear","appendOperators","$operator","operations","operators","createValue","convertPathOperators","oval","createPathOperators","resetPathOperators","newOperator","widget","removeOperator","createDepthSelect","selected","$value","startwrap","val1","val2","startdt","endwrap","enddt","pathAndDepth","ContentbrowserPattern","values","trimmedValue","removeClear","$clear","buildQueryPart","ival","istr","ostr","vstrbase","vstrlistbase","vstr","str","getDepthString","getJSONListStr","vval","varr","depth","out","previewURL","previewCountURL","classSortLabelName","classSortReverseName","classSortReverseLabelName","classPreviewCountWrapperName","classPreviewResultsWrapperName","classPreviewWrapperName","classPreviewName","classPreviewTitleName","classPreviewDescriptionName","classSortWrapperName","showPreviews","initialized","json","$criteriaWrapper","$sortWrapper","$previewWrapper","createCriteria","createSort","refreshPreviewEvent","_doupdates","updateValue","_updateTimeout","doupdates","existingSortOn","existingSortOrder","$sortOn","$sortOrder","reversed","_previewXhr","$previewPane","querypart","criteriastrs","jsonstr","cloneClass","drop","sortable","animation","cb","newIndex","oldIndex","disableSort","option","enableSort","Moment","add_argument","locale","acquire_attribute","strict","fromNow","is_iso_date","rtf","Intl","RelativeTimeFormat","numeric","date_diff","toDate","calendar","lastWeek","lastDay","sameDay","nextDay","nextWeek","sameElse","noSuffix","outputFormat","dialog_panel","close","tippy","active_class","inactive_class","Tippy","tippy_options","parseOptionsForTippy","defaultProps","arrow","hideOnClick","closing","ignoreAttributes","interactive","onHide","_onHide","onShow","_onShow","setDefaultProps","markInactive","super","placement","pos0","t","r","b","l","pos1","popperOptions","modifiers","arrowPadding","padding","parsers","list","flip_options","policy","fallbacks","fallbackPlacements","allowHTML","arg","_initialize_content","popper","tippy_classes","close_button","setProps","_get_content","setContent","get_url_parts","data_type_handlers","ajaxDataType","headers","Accept","popperInstance","forceUpdate","get_content","tmp","markdown","Markdown","await_pattern_init","renderForInjection","register_type_handler","Dropzone","wrapperTemplate","fileaddedClassName","useTus","container","ajaxUpload","paramName","addRemoveLinks","autoCleanResults","previewsContainer","previewTemplate","maxFilesize","relatedItems","autoDiscover","UploadTemplate","clipboardData","blob","getAsFile","dropzone","addFile","currentFile","$progress","$pathInput","setupRelatedItems","$dropzone","files","hiddenFileInput","click","dzoneOptions","getDzoneOptions","DEBUG","showHideControls","path_uid","file","SUCCESS","previewElement","fadeOut","xmlhr","pct","processUpload","finished","clipboardfile","_showHideTimeout","_showHideControls","$controls","$browse","fadeIn","pathJoin","PreviewTemplate","clickable","$preview","autoProcessQueue","processing","process","ERROR","QUEUED","CANCELED","removeFile","UPLOADING","tus","handleTusUpload","processFile","endpoint","chunkSize","progress","bytesUploaded","bytesTotal","percentage","formatBytes","bytes","kb","round","mb","RelatedItems","initialFolder","ri","Storage","backend","ValueStorage","store","_key","_allKeys","keys","prefix_length","removeItem","all","supported","local","session","sessionStorage","updateOptions","befores","b_el","b_date","a_date","offsetDays","dispatch_change_event","display_el","insertAdjacentElement","pat_display_time","PatDisplayTime","display_time_config","_add_additional","add_clear_button","Pikaday","showWeekNumber","onSelect","onClose","blur_event","minDate","maxDate","pikaday","el_append_to","clear_button","appendChild","firedBy"],"sourceRoot":""}