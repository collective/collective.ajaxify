"use strict";(self.webpackChunkcollective_ajaxify=self.webpackChunkcollective_ajaxify||[]).push([[47943],{47943:function(e,t,r){var n=r(59329),a=(r(89476),r(35686)),o=r.n(a),i=r(64917),s=r(62800),c=r(44563),l=r(23505),d=r(33541),u=r(86557),g=r(8633);const p=l.A.getLogger("pat.inject"),f=new d.A("inject");f.addArgument("default-selector"),f.addArgument("target"),f.addArgument("data-type","html"),f.addArgument("next-href"),f.addArgument("source"),f.addArgument("trigger","default",["default","autoload","autoload-visible","idle"]),f.addArgument("delay"),f.addArgument("browser-cache","no-cache",["cache","no-cache"]),f.addArgument("confirm","class",["never","always","form-data","class"]),f.addArgument("confirm-message","Are you sure you want to leave this page?"),f.addArgument("loading-class","injecting"),f.addArgument("executing-class","executing"),f.addArgument("executed-class","executed"),f.addArgument("class"),f.addArgument("history","none",["none","record"]),f.addArgument("push-marker"),f.addArgument("scroll"),f.addArgument("url");const h={name:"inject",trigger:"a.pat-inject, form.pat-inject, .pat-subform.pat-inject",parser:f,async init(e,t){await g.A.timeout(1);const r=g.A.jqToNode(e),n=this.extractConfig(e,t);if(n.some(e=>"record"===e.history)&&!("pushState"in history))return p.warn("HTML5 pushState is missing, aborting"),e;if(e.data("pat-inject",n),n[0].nextHref&&0===n[0].nextHref.indexOf("#")&&"A"===r.nodeName&&o()(n[0].nextHref).length>0)return p.debug("Skipping as next href is anchor, which already exists",n[0].nextHref),r.setAttribute("href",(window.location.href.split("#")[0]||"")+n[0].nextHref),e;if(n[0].pushMarker&&o()("body").on("push",(e,t)=>{p.debug("received push message: "+t),t==n[0].pushMarker&&(p.debug("re-injecting "+t),this.onTrigger({currentTarget:r}))}),n[0].idleTrigger)this._initIdleTrigger(e,n[0].idleTrigger);else switch(n[0].trigger){case"default":for(const e of n)e.delay&&(e.processDelay=e.delay);"FORM"===r?.nodeName?(p.debug("Initializing form with injection on",r),c.A.add_event_listener(r,"submit","pat-inject--form-submit",e=>{e.submitter?.matches("[type=submit], button:not([type=button]), [type=image]")&&i.A.onClickSubmit(e),this.onTrigger(e)})):r?.matches(".pat-subform")?p.debug("Initializing subform with injection"):e.on("click.pat-inject",this.onTrigger.bind(this));break;case"autoload":if(n[0].delay){const t=(0,u.A)();r.setAttribute("data-pat-inject-uuid",t);const a=t=>{const n=document.querySelector(`[data-pat-inject-uuid="${t}"]`);return!!n&&(e.data("pat-inject-autoloaded",!0),this.onTrigger({currentTarget:r}),n.removeAttribute("data-pat-inject-uuid"),!0)};window.setTimeout(a.bind(null,t),n[0].delay)}else this.onTrigger({currentTarget:r});break;case"autoload-visible":this._initAutoloadVisible(e,n);break;case"idle":this._initIdleTrigger(e,n[0].delay)}return p.debug("initialised:",r),e},destroy(e){return e.off(".pat-inject"),e.data("pat-inject",null),e},onTrigger(e){e.preventDefault&&e.preventDefault();const t=e.currentTarget,r=o()(t);let n=r.data("pat-inject");if("FORM"===t.nodeName&&"submit"===e.type){const a=t,i=e.submitter;if(!i?.matches("[formnovalidate]")&&!a.matches("[novalidate]")&&a.matches(":invalid"))return void p.debug("Form is invalid, aborting");const s=i?.getAttribute("formaction");if(s){const e={url:s},t=i.closest("[data-pat-inject]");n=this.extractConfig(o()(t),e)}for(const e of n)e.params=o().param(r.serializeArray())}r.trigger("patterns-inject-triggered"),this.execute(n,r)},submitSubform(e){const t=o()(e[0].closest("form")),r=e.data("pat-inject");for(const t of r)t.params=o().param(e.serializeArray());try{t.trigger("patterns-inject-triggered")}catch(e){p.error("patterns-inject-triggered",e)}this.execute(r,t)},extractConfig(e,t={}){const r=g.A.jqToNode(e);t=Object.assign({},t);const n=f.parse(e,t,!0);for(const a of n){a.$context=e,a.url=t.url||a.url||r?.getAttribute("href")||r?.getAttribute("action")||r?.closest("form")?.getAttribute("action")||"";const n=a.url.split("#");if(a.url=n[0],n.length>2&&p.warn("Ignoring additional source ids:",n.slice(2)),a.defaultSelector||(a.defaultSelector=n[1]&&"#"+n[1]||"body"),a.delay)try{a.delay=g.A.parseTime(a.delay)}catch{p.warn("Invalid delay value: ",a.delay),a.delay=null}a.processDelay=0}return n},elementIsDirty(e){const t=o().map(e.find(":input:not(select)"),e=>{const t=o()(e).val();return Boolean(t)&&t!==o()(e).attr("placeholder")});return-1!==o().inArray(!0,t)},askForConfirmation(e){let t,r=!1;for(const n of e){let e=!1;"always"==n.confirm?e=!0:"form-data"===n.confirm&&n.target&&"none"!==n.target?e=this.elementIsDirty(n.$target):"class"===n.confirm&&n.target&&"none"!==n.target&&(e=n.$target.hasClass("is-dirty")),e&&(r=!0,t=n.confirmMessage)}return!(r&&!window.confirm(t))},ensureTarget(e){if("none"===e.target)return!0;if(e.$target=e.$target||("self"===e.target?e.$context:o()(e.target)),0===e.$target.length){if(!e.target)return p.error("Need target selector",e),!1;e.$target=this.createTarget(e.target),e.$created_target=e.$target}return!0},verifySingleConfig(e,t){return t.url!==e?(p.error("Unsupported different urls for multi-inject"),!1):(t.source=t.source||t.defaultSelector,t.target=t.target||t.defaultSelector,!!this.extractModifiers(t)&&(!!this.ensureTarget(t)&&(this.listenForFormReset(t),!0)))},verifyConfig(e){return e.every(t=>this.verifySingleConfig(e[0].url,t))},listenForFormReset(e){if("none"===e.target)return;const t=e.$target.parents("form");0!==t.length&&void 0===e.$target.data("initial-value")&&(e.$target.data("initial-value",e.$target.html()),t.on("reset",()=>{e.$target.html(e.$target.data("initial-value"))}))},extractModifiers(e){const t=/^(.*?)(::element)?$/.exec(e.source),r=/^(.*?)(::element)?(::after|::before)?$/.exec(e.target);e.source=t[1],e.sourceMod=t[2]?"element":"content",e.target=r[1];const n=r[2]?"element":"content",a=(r[3]||"::").slice(2);return e.loadingClass&&(e.loadingClass+=" "+e.loadingClass+"-"+n,a&&e.loadingClass&&(e.loadingClass+=" "+e.loadingClass+"-"+a)),e.action=n+a,!0},createTarget(e){if("#"!==e.slice(0,1))return p.error("only id supported for non-existing target"),null;const t=o()("<div />").attr({id:e.slice(1)});return o()("body").append(t),t},_performInjection(e,t,r,n,a,i){const s=document.createElement("template");if(r.length>0){const e="content"===n.sourceMod?"innerHTML":"outerHTML",t=[...r].map(t=>t[e]).join("\n");s.innerHTML=t;for(const e of s.content.querySelectorAll("img"))c.A.add_event_listener(e,"load","inject_img_load",e=>{o()(e.currentTarget).trigger("pat-inject-content-loaded")},{once:!0})}const l=[...s.content.childNodes];this._inject(a,l,e,n)&&(this._update_history(n,a,i),this._afterInjection(t,n.$created_target||o()(l),n))},_update_history(e,t,r){if("record"!==e.history||!history?.pushState)return;let n=e.url;if(e.params){const t=n.indexOf("?")>-1?"&":"?";n=`${n}${t}${e.params}`}if(history.pushState({url:n},"",n),r?.length){const e=document.querySelector("title");e&&this._inject(t,r,e,{action:"element"})}},_afterInjection(e,t,r){const n=g.A.jqToNode(e);if(t.filter((e,t)=>3!==t.nodeType).data("pat-injected",{origin:r.url}),1===t.length&&3==t[0].nodeType?t.parent().trigger("patterns-injected",[r,n,t[0]]):t.each((e,t)=>{3!==t.nodeType&&o()(t).addClass(r.class).trigger("patterns-injected",[r,n,t])}),r.scroll&&"none"!==r.scroll){const e=["top","target"].includes(r.scroll)?r.$target[0]:s.A.querySelectorAllAndMe(t[0],r.scroll),n=s.A.find_scroll_container(e,null,window);"top"===r.scroll?s.A.scroll_to_top(n):e&&s.A.scroll_to_element(e,n)}n.dispatchEvent(new Event("pat-inject-success",{bubbles:!0,cancelable:!0}))},async _onInjectSuccess(e,t,r){let n=r?.jqxhr?.responseText;if(!n)return void p.warn("No response content, aborting",r);"none"===t[0].source&&(n="");const a=await this.callTypeHandler(t[0].dataType,"sources",e,[t,n,r]);let o;a&&a[a.length-1]&&a[a.length-1][0]&&"TITLE"===a[a.length-1][0].nodeName&&(o=a[a.length-1]),t.forEach((t,n)=>{const i=()=>{if("none"!==t.target)for(const i of t.$target)this._performInjection(i,e,a[n],t,r.target,o)};t.processDelay?setTimeout(()=>i(),t.processDelay):i()}),t[0].nextHref&&e.is("a")&&(e.attr({href:t[0].nextHref.replace(/&amp;/g,"&")}),this.destroy(e)),e.off("pat-ajax-success.pat-inject"),e.off("pat-ajax-error.pat-inject")},async _onInjectError(e,t,r){let a="";const i=r.jqxhr.status,s=new Date;let c,l;i%100==4?a="Sorry! We couldn't find the page to load. Please make a screenshot and send it to support. Thank you!":i%100==5?a="I am very sorry! There was an error at the server. Please make a screenshot and contact support. Thank you!":0==i&&(a="It seems, the server is down. Please make a screenshot and contact support. Thank you!");if(null===new URLSearchParams(window.location.search).get("pat-inject-errorhandler.off")){const e=document?.querySelector(`meta[name^=pat-inject-status-${i}]`)?.getAttribute("content",!1);if(l=e?.split("#")[1],l=l?`#${l}`:null,l&&(c=document.createElement("html"),c.innerHTML=r.jqxhr.responseText,c=c.querySelector(l)),!c&&e)try{const t=await fetch(e,{method:"GET"});c=document.createElement("html"),c.innerHTML=await t.text(),c=c.querySelector(l||"body")}catch{}}for(const r of t)"$created_target"in r&&r.$created_target.remove(),r.$target.removeClass(r.loadingClass),e.removeClass(r.executingClass);if(e.off("pat-ajax-success.pat-inject"),e.off("pat-ajax-error.pat-inject"),c){const e=document.querySelector(l||"body");e.innerHTML=c.innerHTML,n.A.scan(e)}else{const e=`${a} Status is ${i} ${r.jqxhr.statusText}, time was ${s}. You can click to close this.`;o()("body").attr("data-error-message",e),o()("body").on("click",()=>{o()("body").removeAttr("data-error-message"),window.location.href=window.location.href})}},execute(e,t){const r=g.A.jqToNode(t);if(e=e.map(e=>o().extend({},e)),!this.verifyConfig(e))return;if(!this.askForConfirmation(e))return;if(t.data("pat-inject-triggered"))return;t.data("pat-inject-triggered",!0);for(const t of e)t?.executingClass&&r.classList.add(t.executingClass),t?.loadingClass&&"none"!==t?.target&&t.$target.addClass(t.loadingClass);t.on("pat-ajax-success.pat-inject",async a=>{this._onInjectSuccess(t,e,a),await g.A.timeout(1),c.A.remove_event_listener(r,"pat-inject--close-panel"),n&&(n=!1,r.dispatchEvent(new Event("close-panel",{bubbles:!0,cancelable:!0})))}),t.on("pat-ajax-error.pat-inject",this._onInjectError.bind(this,t,e)),t.on("pat-ajax-success.pat-inject pat-ajax-error.pat-inject",()=>t.removeData("pat-inject-triggered"));let n=!1;c.A.add_event_listener(r,"close-panel","pat-inject--close-panel",e=>{e.stopPropagation(),e.stopImmediatePropagation(),n=!0}),e[0].url.length?i.A.request(t,{url:e[0].url,"browser-cache":e[0].browserCache}):t.trigger({type:"pat-ajax-success",jqxhr:{responseText:o()("body").html()}})},_inject(e,t,r,n){if("none"===n.source)return r.replaceWith(""),!0;if(0===t.length)return p.warn("Aborting injection, source not found:",t),o()(e).trigger("pat-inject-missingSource",{url:n.url,selector:n.source}),!1;if("none"===n.target)return!0;if(!r)return p.warn("Aborting injection, target not found:",r),o()(e).trigger("pat-inject-missingTarget",{selector:n.target}),!1;return r[{content:"replaceChildren",contentafter:"append",contentbefore:"prepend",element:"replaceWith",elementafter:"after",elementbefore:"before"}[n.action]](...t),!0},_sourcesFromHtml(e,t,r){const n=this._parseRawHtml(e,t);return r.map(e=>{if("body"===e&&(e="#__original_body"),"none"===e)return o()("\x3c!-- --\x3e");const r=n.find(e);return 0===r.length&&"title"!=e&&p.warn("No source elements for selector:",e,n),r.find('a[href^="#"]').each((e,n)=>{const a=n.getAttribute("href");-1===a.indexOf("#{1}")&&(1===a.length?n.href=t:r.find(a).length||(n.href=t+a))}),r})},_rebaseAttrs:{a:"href",form:"action",img:"src",object:"data",source:"src",video:"src"},_rebaseOptions:{calendar:["url","event-sources"],collapsible:["load-content"],"date-picker":["i18n"],"datetime-picker":["i18n"],inject:["url"]},_rebaseURL(e,t){return-1!==t.indexOf("://")||"/"===t[0]||0===t.indexOf("data:")?t:(e=new URL(e,window.location).href).slice(0,e.lastIndexOf("/")+1)+t},_rebaseHTML(e,t){if(""===t)return"";const r=document.createElement("div");r.innerHTML=t;const a=Object.entries(this._rebaseAttrs).map(([e,t])=>`${e}[${t}]`).join(", ");for(const t of r.querySelectorAll(a)){const r=this._rebaseAttrs[t.nodeName.toLowerCase()];let n=t.getAttribute(r);n&&"@@"!==n.slice(0,2)&&"#"!==n[0]&&"mailto:"!==n.slice(0,7)&&"tel:"!==n.slice(0,4)&&"fax:"!==n.slice(0,4)&&"callto:"!==n.slice(0,7)&&"ts3server:"!==n.slice(0,10)&&"teams:"!==n.slice(0,6)&&"javascript:"!==n.slice(0,11)&&(n=this._rebaseURL(e,n),t.setAttribute(r,n))}for(const[t,a]of Object.entries(this._rebaseOptions))for(const o of s.A.querySelectorAllAndMe(r,`[data-pat-${t}]`)){const r=n.A.patterns?.[t],i=r?.parser;if(!i)continue;const s=i.parse(o,{},!0,!1,!1);let c=!1;for(const t of s)for(const r of a){const n=t[r];n&&(c=!0,Array.isArray(n)?t[r]=n.map(t=>this._rebaseURL(e,t)):t[r]=this._rebaseURL(e,n))}c&&o.setAttribute(`data-pat-${t}`,JSON.stringify(1===s.length?s[0]:s))}return r.innerHTML.trim()},_parseRawHtml(e,t=""){const r=e.match(/\<title\>(.*)\<\/title\>/);let n=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<head\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/head>/gi,"").replace(/<html([^>]*?)>/gi,"").replace(/<\/html([^>]*?)>/gi,"").replace(/<body([^>]*?)>/gi,'<div id="__original_body">').replace(/<\/body([^>]*?)>/gi,"</div>");r&&2==r.length&&(n=r[0]+n);try{n=this._rebaseHTML(t,n)}catch(e){p.error("Error rebasing urls",e)}const a=o()("<div/>").html(n);return 0===a.children().length&&p.warn("Parsing html resulted in empty jquery object:",n),a},_initAutoloadVisible(e,t){if(e.data("pat-inject-autoloaded"))return!1;const r=g.A.jqToNode(e),n=t[0].delay||200;p.debug(`Delay time: ${n}`);const a=t=>e.data("pat-inject-autoloaded")?(p.debug(`autoload-visible trigger skipped ${r}`),!1):(e.data("pat-inject-autoloaded",!0),this.onTrigger({currentTarget:r}),t&&t.preventDefault(),p.debug(`autoload-visible trigger run ${r}`),!0);let o=null;const i=new IntersectionObserver(e=>{for(const t of e)t.isIntersecting?(o=window.setTimeout(()=>{i.disconnect(),a()},n),p.debug(`autoload-visible intersecting ${r}`)):(window.clearTimeout(o),p.debug(`autoload-visible not intersecting ${r}`))},{threshold:0,root:null,margin:"0px"});i.observe(r)},_initIdleTrigger(e,t){const r=parseInt(t,10);let n;const a=g.A.jqToNode(e),o=()=>{this.onTrigger({currentTarget:a}),s(),clearTimeout(n)},i=g.A.debounce(()=>{document.body.contains(a)?(clearTimeout(n),n=setTimeout(o,r)):s()},r),s=()=>{for(const e of["scroll","resize"])window.removeEventListener(e,i);for(const e of["click","keypress","keyup","mousemove","touchstart","touchend"])document.removeEventListener(e,i)};i();for(const e of["scroll","resize"])window.addEventListener(e,i);for(const e of["click","keypress","keyup","mousemove","touchstart","touchend"])document.addEventListener(e,i)},registerTypeHandler(e,t){this.handlers[e]=t},async callTypeHandler(e,t,r,n){return e=e||"html",this.handlers[e]&&o().isFunction(this.handlers[e][t])?await this.handlers[e][t].bind(this)(...n):null},handlers:{html:{sources(e,t){const r=e.map(e=>e.source);r.push("title");return this._sourcesFromHtml(t,e[0].url,r)}}}};if(o()(document).on("patterns-injected.inject",async(e,t,r,a)=>{t?.skipPatInjectHandler||(t&&(t.$target.removeClass(t.loadingClass),o()(r).removeClass(t.executingClass).addClass(t.executedClass)),3!==a.nodeType&&8!==a.nodeType&&(n.A.scan(a,null,{type:"injection",element:r}),o()(a).trigger("patterns-injected-scanned"),await g.A.timeout(10),a.dispatchEvent(new CustomEvent("patterns-injected-delayed",{bubbles:!0,cancelable:!0,detail:{injected:a}}))))}),o()(window).on("popstate",e=>{if(e.originalEvent.state||!("replaceState"in history))window.location.reload();else try{history.replaceState("anchor","",document.location.href)}catch(e){p.debug(e)}}),"replaceState"in history)try{history.replaceState("pageload","",document.location.href)}catch(e){p.debug(e)}n.A.register(h),h.trigger=`a.pat-inject,.pat-inject a[href^="${window.location.origin}"]:not([href*="@@download"]):not([href$=zip]):not([href$=pdf]):not([href$=mp3]):not([href$=wav]):not([href$=jpg]):not([href$=webp]):not([href$=png]):not([href$=txt]):not(.dropdown-toggle):not([id^="autotoc"]):not(.pat-inject):not(.stop-pattern)`,n.A.init()}}]);
//# sourceMappingURL=47943.43cc66f2e34d45a73b0a.min.js.map