"use strict";(self.webpackChunkcollective_ajaxify=self.webpackChunkcollective_ajaxify||[]).push([[64492],{306:function(e,t,a){a.r(t),a.d(t,{Pattern:function(){return d},parser:function(){return c}});var n=a(33077),i=a(33541),o=a(59329),r=a(59994),s=a(72965),l=a.n(s);const c=new i.A("contentbrowser");c.addArgument("vocabulary-url"),c.addArgument("attributes",["UID","Title","Description","portal_type","path","getURL","getIcon","is_folderish","review_state","created","modified"],null,!0),c.addArgument("width"),c.addArgument("mode"),c.addArgument("max-depth"),c.addArgument("root-path"),c.addArgument("root-url"),c.addArgument("base-path"),c.addArgument("context-path"),c.addArgument("maximum-selection-size"),c.addArgument("selectable-types"),c.addArgument("browseable-types"),c.addArgument("search-index"),c.addArgument("separator"),c.addArgument("selection"),c.addArgument("selection-template"),c.addArgument("favorites"),c.addArgument("recently-used"),c.addArgument("recently-used-key"),c.addArgument("recently-used-max-items"),c.addArgument("b-size");class d extends n.m{static name="contentbrowser";static trigger=".pat-contentbrowser";static parser=c;async init(){this.el.style.display="none";const e=(await Promise.all([a.e(98317),a.e(74201)]).then(a.bind(a,74201))).default;l().registerComponent({name:"pat-contentbrowser.SelectedItem",component:e});let t=this.el.getAttribute("id");t||(t=r.A.generateId(),this.el.setAttribute("id",t));const n=(await Promise.all([a.e(98317),a.e(96196),a.e(64708)]).then(a.bind(a,96196))).default,i=document.createElement("div");i.classList.add("content-browser-wrapper"),this.el.parentNode.insertBefore(i,this.el),this.component_content_browser=new n({target:i,props:{fieldId:t,...this.options}})}}o.A.register(d),t.default=d},10906:function(e,t,a){var n=a(35686),i=a.n(n),o=a(71553),r=a(8633);o.A.extend({name:"autotoc",trigger:".pat-autotoc",parser:"mockup",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",classTOCName:"autotoc-nav",classSectionName:"autotoc-section",classLevelPrefixName:"autotoc-level-",classActiveName:"active",scrollDuration:"slow",scrollEasing:"swing",validationDelay:200},tabs:[],init:function(){a.e(49446).then(a.bind(a,49446));var e=this;e.$toc=i()("<nav/>").addClass(e.options.classTOCName),e.options.prependTo?e.$toc.prependTo(e.options.prependTo):e.options.appendTo?e.$toc.appendTo(e.options.appendTo):e.$toc.prependTo(e.$el),e.options.className&&e.$el.addClass(e.options.className),i()(e.options.section,e.$el).addClass(e.options.classSectionName);var t=e.$el.hasClass("autotabs"),n=null;i()(e.options.levels,e.$el).each(function(a){const o=this.closest(e.options.section),r=i()(this);let s=r.prop("id")?r.prop("id"):i()(o).prop("id");(!s||i()("#"+s).length>0)&&(s=e.options.IDPrefix+e.name+"-"+a),window.location.hash==="#"+s&&(n=s),null===n&&r.hasClass(e.options.classActiveName)&&(n=s),r.data("navref",s);const l=i()("<a/>");l.appendTo(e.$toc).text(r.text()).attr("id",s).attr("href","#"+s).addClass(e.options.classLevelPrefixName+e.getLevel(r)).on("click",function(a,n){a.stopPropagation(),a.preventDefault(),n||(n={doScroll:!0,skipHash:!1});var o=i()(this);e.$toc.children("."+e.options.classActiveName).removeClass(e.options.classActiveName),e.$el.children("."+e.options.classActiveName).removeClass(e.options.classActiveName),i()(a.target).addClass(e.options.classActiveName),r.parents(e.options.section).addClass(e.options.classActiveName),!1!==n.doScroll&&e.options.scrollDuration&&r&&!t&&i()("body,html").animate({scrollTop:r.offset().top},e.options.scrollDuration,e.options.scrollEasing),0!==e.$el.parents(".plone-modal").length&&e.$el.trigger("resize.plone-modal.patterns"),i()(this).trigger("clicked"),n.skipHash||window.history&&window.history.pushState&&window.history.pushState({},"","#"+o.attr("id"))}),r.data("autotoc-trigger-id",s),e.tabs.push({section:o,id:s,nav:l[0]})}),n?i()("a#"+n).trigger("click",{doScroll:!0,skipHash:!0}):e.$toc.find("a").first().trigger("click",{doScroll:!1,skipHash:!0}),this.initialize_validation(e.$el)},initialize_validation:function(e){const t=e[0].closest("form");if(!t)return;for(const e of this.tabs)e.section.querySelectorAll("label.required, label .required, [required]").length>0?e.nav.classList.add("required"):e.nav.classList.remove("required");if(!t.matches(".pat-validation"))return;const a=r.A.debounce(()=>{this.validation_marker()},this.options.validationDelay);t.addEventListener("pat-update",e=>{"validation"===e.detail?.pattern&&a()})},validation_marker:function(){for(const e of this.tabs)e.section.querySelectorAll(":invalid").length>0?e.nav.classList.add("invalid"):e.nav.classList.remove("invalid")},getLevel:function(e){var t=0;return i().each(this.options.levels.split(","),function(a,n){if(1===e.filter(n).length)return t=a+1,!1}),t}})},13767:function(e,t,a){var n=a(35686),i=a.n(n);t.A=function(){var e=this;e.baseUrl=i()("body").attr("data-i18ncatalogurl"),e.currentLanguage=i()("html").attr("lang")||"en",e.storage=null,e.catalogs={},e.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(e.storage=window.localStorage)}catch{console.log("Failed to set local storage")}e.configure=function(t){for(var a in t)e[a]=t[a]},e._setCatalog=function(t,a,n){t in e.catalogs||(e.catalogs[t]={}),e.catalogs[t][a]=n},e._storeCatalog=function(t,a,n){var i=t+"-"+a;null!==e.storage&&null!==n&&(e.storage.setItem(i,JSON.stringify(n)),e.storage.setItem(i+"-updated",Date.now()))},e.getUrl=function(t,a){return e.baseUrl+"?domain="+t+"&language="+a},e.loadCatalog=function(t,a){if(void 0===a&&(a=e.currentLanguage),null!==e.storage){var n=t+"-"+a;if(n in e.storage&&Date.now()-parseInt(e.storage.getItem(n+"-updated"),10)<e.ttl){var o=JSON.parse(e.storage.getItem(n));return void e._setCatalog(t,a,o)}}e.baseUrl&&i().getJSON(e.getUrl(t,a),function(n){null!==n&&(e._setCatalog(t,a,n),e._storeCatalog(t,a,n))})},e.MessageFactory=function(t,a){return a=a||e.currentLanguage,function(n,i){var o,r,s;if(o=t in e.catalogs&&a in e.catalogs[t]&&n in e.catalogs[t][a]?e.catalogs[t][a][n]:n,i)for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r=new RegExp("\\$\\{"+s+"\\}","g"),o=o.replace(r,i[s]));return o}}}},20681:function(e,t,a){a.d(t,{YA:function(){return r}});var n=a(13767);let i={plone:null,widgets:null};const o=function(e,t,a){if(null===i[e]){var o=new n.A;o.loadCatalog(e),i[e]=o.MessageFactory(e)}return i[e](t,a)},r=function(e,t){return o("plone",e,t)};t.Ay=function(e,t){return o("widgets",e,t)}},29342:function(e,t,a){a.r(t);var n=a(35686),i=a.n(n),o=a(71553),r=a(13767),s=a(59994);t.default=o.A.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:",",ajaxTimeout:300},initializeValues(){this.options.initialValues&&(this.options.id=e=>e.id,this.options.initSelection=(e,t)=>{const a=[],n=e.val();let o=this.options.initialValues;if("string"==typeof this.options.initialValues&&""!==this.options.initialValues)if("{"===this.options.initialValues[0])o=JSON.parse(this.options.initialValues);else{o={};const e=i()(this.options.initialValues.split(this.options.separator));for(const t of e){const e=t.split(":"),a=e[0].trim(),n=e[1].trim();o[a]=n}}const r=i()(n.split(this.options.separator));for(const e of r){let t=e;o[e]&&(t=o[e]),a.push({id:s.A.removeHTML(e),text:s.A.removeHTML(t)})}t(a)})},initializeTags(){this.options.tags&&"string"==typeof this.options.tags&&("["===this.options.tags.substr(0,1)?this.options.tags=JSON.parse(this.options.tags):this.options.tags=this.options.tags.split(this.options.separator)),this.options.tags&&!this.options.allowNewItems&&(this.options.data=this.options.tags.map(e=>({id:e,text:e})),this.options.multiple=!0,delete this.options.tags)},async initializeOrdering(){if(!this.options.orderable)return;const e=(await a.e(64708).then(a.t.bind(a,64708,23))).default,t=()=>{const t=this.$select2[0].querySelector(".select2-choices");new e(t,{draggable:"li",dragClass:"select2-choice-dragging",chosenClass:"dragging",onStart:()=>this.$el.select2("onSortStart"),onEnd:()=>this.$el.select2("onSortEnd")})};this.$el.on("change",t.bind(this)),t()},async initializeSelect2(){Promise.all([a.e(42087),a.e(49495)]).then(a.bind(a,82325)),a.e(14986).then(a.bind(a,14986)),await a.e(11739).then(a.t.bind(a,11739,23));try{if(this.options.language&&"en"!==this.options.language&&!this.options.language.startsWith("en")){let e=this.options.language.split("-");e=e.length>1?`${e[0]}-${e[1]}`:e[0],await a(44721)(`./select2_locale_${e}`)}}catch{console.warn("Language file could not be loaded",this.options.language)}function e(e,t){return e?(this.options.debug&&console.debug("callback",e,t),"string"==typeof e&&(e=window[e]),e(t)):e}this.options.formatResultCssClass=e=>{if(e.id)return"select2-option-"+e.id.toLowerCase().replace(/[ \:\)\(\[\]\{\}\_\+\=\&\*\%\#]/g,"-")},this.$el.select2(this.options),this.$el.on("select2-selected",t=>e(this.options.onSelected,t)),this.$el.on("select2-selecting",t=>e(this.options.onSelecting,t)),this.$el.on("select2-deselecting",t=>e(this.options.onDeselecting,t)),this.$el.on("select2-deselected",t=>e(this.options.onDeselected,t)),this.$select2=this.$el.parent().find(".select2-container"),this.$el.parent().off("close.plone-modal.patterns"),this.options.orderable&&this.$select2.addClass("select2-orderable")},opened(){return 1===i()(".select2-dropdown-open",this.$el.parent()).length},async init(){const e=new r.A;if(this.options.language=e.currentLanguage,this.options.allowNewItems=!this.options.allowNewItems||JSON.parse(this.options.allowNewItems),this.options.ajax||this.options.vocabularyUrl){this.options.vocabularyUrl&&(this.options.multiple=void 0===this.options.multiple||this.options.multiple,this.options.ajax=this.options.ajax||{},this.options.ajax.url=this.options.vocabularyUrl,this.options.initSelection=(e,t)=>{const a=[],n=e.val();for(const e of n.split(this.options.separator)){const t=s.A.removeHTML(e);a.push({id:t,text:t})}t(a)});let e="";const t=parseInt(this.options.ajaxTimeout||300,10);delete this.options.ajaxTimeout,this.options.ajax=i().extend({quietMillis:t,data:(t,a)=>(e=t,{query:t,page_limit:10,page:a}),results:t=>{let a=t.results;if(this.options.vocabularyUrl){const n=[];for(const e of t.results)n.push(e.id);a=[];const i=""===e||n.includes(e);this.options.allowNewItems&&!i&&(e=s.A.removeHTML(e),a.push({id:e,text:e}));for(const e of t.results)a.push(e)}return{results:a}}},this.options.ajax)}else if(this.options.multiple&&this.$el.is("select")){this.$el.attr("multiple",!0);const e=this.$el.val()||[],t=[...this.el.querySelectorAll("option")].map(e=>({text:e.innerHTML,id:e.value})),a=document.createElement("input");a.type="hidden",a.value=e.join(this.options.separator),a.className=this.el.getAttribute("class"),a.name=this.el.name,a.id=this.el.id,this.el.after(a),this.el.remove(),this.el=a,this.$el=i()(a),this.options.data=t}this.initializeValues(),this.initializeTags(),await this.initializeSelect2(),await this.initializeOrdering()}})},33077:function(e,t,a){a.d(t,{m:function(){return s}});var n=a(44563),i=a(23505),o=a(86557);const r=i.A.getLogger("basepattern");class s{static name;static trigger;static parser;parser_group_options=!0;parser_multiple=void 0;parser_inherit=!0;constructor(e,t={}){this.name=this.constructor.name,this.trigger=this.constructor.trigger,this.parser=this.constructor.parser,e?(e.jquery&&(e=e[0]),this.el=e,this.uuid=(0,o.A)(),this.el.dispatchEvent(new Event(`pre-init.${this.name}.patterns`,{bubbles:!0,cancelable:!0})),window.setTimeout(async()=>{if(void 0!==this.el[`pattern-${this.name}`])return r.debug(`Not reinstatiating the pattern ${this.name}.`,this.el),void this.el.dispatchEvent(new Event(`not-init.${this.name}.patterns`,{bubbles:!0,cancelable:!1}));this.options=this.parser?.parse(this.el,t,this.parser_multiple,this.parser_inherit,this.parser_group_options)??t,this.el[`pattern-${this.name}`]=this,await this.init(),this.el.dispatchEvent(new Event(`init.${this.name}.patterns`,{bubbles:!0,cancelable:!0}))},0)):r.warn(`No element given to pattern ${this.name}.`)}async init(){}emit_update(e=void 0,t={}){t={pattern:this.name,dom:this.el,action:e,...t},this.el.dispatchEvent(n.A.update_event(t))}one(e,t){n.A.add_event_listener(this.el,`${e}.${this.name}.patterns`,`basepattern-one--${e}.${this.name}.patterns`,t,{once:!0})}destroy(){delete this.el[`pattern-${this.name}`]}}},33982:function(e,t,a){var n=a(35686),i=a.n(n);a(71553).A.extend({name:"datatables",trigger:".pat-datatables",parser:"mockup",table:null,defaults:{},async init(){Promise.all([a.e(97692),a.e(65167)]).then(a.bind(a,59624)),Promise.all([a.e(97692),a.e(87548)]).then(a.bind(a,23726)),Promise.all([a.e(97692),a.e(20405)]).then(a.bind(a,89620)),Promise.all([a.e(97692),a.e(42786)]).then(a.bind(a,40900)),Promise.all([a.e(97692),a.e(54691)]).then(a.bind(a,1630)),Promise.all([a.e(97692),a.e(77072)]).then(a.bind(a,72736)),Promise.all([a.e(97692),a.e(9929)]).then(a.bind(a,88282)),await a.e(31742).then(a.t.bind(a,31742,23)),await a.e(70303).then(a.t.bind(a,70303,23)),await a.e(98699).then(a.t.bind(a,98699,23)),await a.e(37459).then(a.t.bind(a,37459,23)),await Promise.all([a.e(97692),a.e(39009),a.e(98699)]).then(a.t.bind(a,89908,23)),await Promise.all([a.e(97692),a.e(39009),a.e(98699)]).then(a.t.bind(a,88486,23)),await Promise.all([a.e(97692),a.e(39009),a.e(98699)]).then(a.t.bind(a,30897,23)),await a.e(21608).then(a.t.bind(a,21608,23)),await a.e(52496).then(a.t.bind(a,52496,23)),await a.e(49231).then(a.t.bind(a,49231,23)),await a.e(52231).then(a.t.bind(a,52231,23)),await a.e(94531).then(a.t.bind(a,94531,23)),await a.e(92375).then(a.t.bind(a,92375,23)),await a.e(23463).then(a.t.bind(a,23463,23)),await a.e(87923).then(a.t.bind(a,87923,23)),await a.e(83744).then(a.t.bind(a,83744,23)),await a.e(89202).then(a.t.bind(a,89202,23)),i()(this.el).DataTable(this.options)}})},53902:function(e,t,a){var n=a(35686),i=a.n(n),o=a(71553),r=a(40705),s=a.n(r),l=a(65364),c=a(59329),d=a(62800),p=a(59994),u=a(20681);a(51428);t.A=o.A.extend({name:"plone-modal",trigger:".pat-plone-modal",parser:"mockup",createModal:null,$model:null,defaults:{width:"",height:"",modalSizeClass:"",margin:0,position:"center middle",triggers:[],zIndexSelector:".modal-wrapper,.modal-backdrop",backdrop:"body",backdropOptions:{zIndex:"1040",opacity:"0.85",className:"modal-backdrop",classActiveName:"backdrop-active",closeOnEsc:!0,closeOnClick:!0},title:null,titleSelector:"h1:first",buttons:'.formControls > input[type="submit"], .formControls > button',content:"#content",automaticallyAddButtonActions:!0,loadLinksWithinModal:!0,prependContent:".portalMessage",onRender:null,templateOptions:{className:"modal fade",classDialog:"modal-dialog",classModal:"modal-content",classHeaderName:"modal-header",classBodyName:"modal-body",classFooterName:"modal-footer",classWrapperName:"modal-wrapper",classWrapperInnerName:"modal-wrapper-inner",classActiveName:"show",classPrependName:"",classContentName:"",template:'<div class="<%= options.className %>">  <div class="<%= options.classDialog %><% if (modalSizeClass) { %> <%= modalSizeClass %><% } %>" role="dialog" <% if (title) { %>aria-labelledby="modal-title" <% } %> tabindex="-1">    <div class="<%= options.classModal %>" role="document">      <div class="<%= options.classHeaderName %>">        <% if (title) { %><h5 class="modal-title" id="modal-title" tabindex="0"><%= title %></h5><% } %>        <button type="button" class="btn-close modal-close" aria-label="<%= closeButtonLabel %>"></button>      </div>      <div class="<%= options.classBodyName %>">        <div class="<%= options.classPrependName %>"><%= prepend %></div>         <div class="<%= options.classContentName %>"><%= content %></div>      </div>      <div class="<%= options.classFooterName %>">         <% if (buttons) { %><%= buttons %><% } %>      </div>    </div>  </div></div>'},actions:{},actionOptions:{eventType:"click",disableAjaxFormSubmit:!1,target:null,ajaxUrl:null,modalFunction:null,isForm:!1,timeout:5e3,displayInModal:!0,reloadWindowOnClose:!0,error:".portalMessage.error, .alert-danger",formFieldError:".field.error",onSuccess:null,onError:null,onFormError:null,onTimeout:null,redirectOnResponse:!1,redirectToUrl:function(e,t){var a;return(a=/<body.*data-view-url=[\"'](.*)[\"'].*/im.exec(t))&&a.length>1||(a=/<body.*data-base-url=[\"'](.*)[\"'].*/im.exec(t))&&a.length>1?a[1].split('"')[0]:(a=/<base.*href=[\"'](.*)[\"'].*/im.exec(t))&&a.length>1?a[1]:""}},form:function(e){var t=this,a=t.$modal;t.options.automaticallyAddButtonActions&&(e[t.options.buttons]={}),e.a={},i().each(e,function(e,n){var o=s().union(s().keys(t.options.actionOptions),["templateOptions"]),r=i().extend(!0,{},t.options.actionOptions,s().pick(n,o));n.templateOptions=i().extend(!0,n.templateOptions,t.options.templateOptions);var l=s().union(s().keys(t.options.actionOptions),["actions","actionOptions"]),c=i().extend(!0,s().omit(n,l),t.options);i()(e,i()("."+n.templateOptions.classBodyName,a)).each(function(){var e=i()(this);e.on(r.eventType,function(a){a.stopPropagation(),a.preventDefault(),t.loading.show(!1),null!==r.modalFunction?t[r.modalFunction]():i().nodeName(e[0],"input")||i().nodeName(e[0],"button")||!0===n.isForm?t.options.handleFormAction.apply(t,[e,r,c]):(null!==n.ajaxUrl||i().nodeName(e[0],"a"))&&t.options.handleLinkAction.apply(t,[e,r,c])})})})},handleFormAction:function(e,t,a){var n,o,r=this,s={};if(s[e.attr("name")]=e.attr("value"),n=i().nodeName(e[0],"form")?e:e.parents("form:not(.disableAutoSubmit)"),o=null!==t.ajaxUrl?"function"==typeof t.ajaxUrl?t.ajaxUrl.apply(r,[e,t]):t.ajaxUrl:e.parents("form").attr("action"),t.disableAjaxFormSubmit)return e.attr("name")&&e.attr("value")&&n.append(i()('<input type="hidden" name="'+e.attr("name")+'" value="'+e.attr("value")+'" />')),void n.trigger("submit");n.on("submit",function(e){e.preventDefault()}),n.trigger("submit"),r.loading.show(!1),n.ajaxSubmit({timeout:t.timeout,data:s,url:o,error:function(e,a,n){r.loading.hide(),"timeout"===a&&t.onTimeout?t.onTimeout.apply(r,e,n):t.onError?"string"==typeof t.onError?window[t.onError](e,a,n):t.onError(e,a,n):console.log("error happened",a," do something"),r.emit("formActionError",[e,a,n])},success:function(n,o,s,l){r.loading.hide(),0===i()(t.error,n).length&&0===i()(t.formFieldError,n).length?!0!==t.redirectOnResponse?(t.onSuccess&&("string"==typeof t.onSuccess?window[t.onSuccess](r,n,o,s,l):t.onSuccess(r,n,o,s,l)),!0===t.displayInModal?r.redraw(n,a):(e.trigger("destroy.plone-modal.patterns"),t.reloadWindowOnClose&&r.reloadWindow()),r.emit("formActionSuccess",[n,o,s,l])):"function"==typeof t.redirectToUrl?window.parent.location.href=t.redirectToUrl.apply(r,[e,n,t]):window.parent.location.href=t.redirectToUrl:t.onFormError?"string"==typeof t.onFormError?window[t.onFormError](r,n,o,s,l):t.onFormError(r,n,o,s,l):r.redraw(n,a)}})},handleLinkAction:function(e,t,a){var n,o=this;e.hasClass("pat-plone-modal")||(n=t.ajaxUrl?"function"==typeof t.ajaxUrl?t.ajaxUrl.apply(o,[e,t]):t.ajaxUrl:e.attr("href"),!1!==t.displayInModal?i().ajax({url:n}).fail(function(e,a,n){"timeout"===a&&t.onTimeout?t.onTimeout(o.$modal,e,n):t.onError?t.onError(e,a,n):window.alert((0,u.Ay)("There was an error loading modal.")),o.emit("linkActionError",[e,a,n])}).done(function(e,n,i){o.redraw(e,a),t.onSuccess&&("string"==typeof t.onSuccess?window[t.onSuccess](o,e,n,i):t.onSuccess(o,e,n,i)),o.emit("linkActionSuccess",[e,n,i])}).always(function(){o.loading.hide()}):"_blank"===e.attr("target")?(window.open(n,"_blank"),o.loading.hide()):window.location=n)},render:function(e){var t=this;if(t.emit("before-render"),t.$raw){var a=t.$raw.clone(),n={title:"",prepend:"<div />",content:"",modalSizeClass:e.modalSizeClass,buttons:'<div class="pattern-modal-buttons"></div>',options:e.templateOptions,closeButtonLabel:(0,u.Ay)("Close")};if(null===e.title){var o=i()(e.titleSelector,a);n.title=o.html(),i()(e.titleSelector,a).remove()}else n.title=e.title;e.prependContent&&(n.prepend=i()("<div />").append(i()(e.prependContent,a).clone()).html(),i()(e.prependContent,a).remove()),e.content?n.content=i()(e.content,a).html():n.content=a.html(),t.$modal=i()(s().template(t.options.templateOptions.template)(n)),t.$modalDialog=i()("> ."+t.options.templateOptions.classDialog,t.$modal),t.$modalContent=i()("> ."+t.options.templateOptions.classModal,t.$modalDialog),i()("form",t.$modal).on("keydown",function(e){"Enter"===e.key&&"TEXTAREA"!==e.target.nodeName&&(e.preventDefault(),i()("input[type=submit], button[type=submit], button:not(type)",this).eq(0).trigger("click"))}),i()(e.buttons,t.$modal).each(function(){var e=i()(this);e.on("click",function(e){e.stopPropagation(),e.preventDefault()}).clone().appendTo(i()(".pattern-modal-buttons",t.$modal)).off("click").on("click",function(t){t.stopPropagation(),t.preventDefault(),e.trigger("click")}),e.hide()}),t.emit("before-events-setup"),t.$modal[0].querySelectorAll('.modal-header > .modal-close,\n                 .modal-footer > .pattern-modal-buttons > .modal-close,\n                 .modal-footer [name="form.buttons.Cancel" i]').forEach(e=>{i()(e).off("click").on("click",e=>{e.stopPropagation(),e.preventDefault(),i()(e.target).trigger("destroy.plone-modal.patterns")})}),e.form&&e.form.apply(t,[e.actions]),t.$modal.addClass(t.options.templateOptions.className).on("destroy.plone-modal.patterns",function(e){e.stopPropagation(),t.hide()}).on("resize.plone-modal.patterns",function(e){e.stopPropagation(),e.preventDefault(),t.positionModal()}).appendTo(t.$wrapperInner),t.options.loadLinksWithinModal&&t.$modal.on("click",function(e){e.stopPropagation(),i().nodeName(e.target,"a")&&e.preventDefault(),t.$modal.trigger("modal-click")}),t.$modal.data("pattern-"+t.name,t),t.emit("after-render"),e.onRender&&("string"==typeof e.onRender?window[e.onRender](t):e.onRender(t))}}},reloadWindow:function(){window.parent.location.reload()},init:function(){a.e(73530).then(a.bind(a,73530));var e=this;e.options.loadLinksWithinModal=i().parseJSON(e.options.loadLinksWithinModal),!0===e.options.backdropOptions.closeOnEsc&&i()(document).on("keydown",function(t){e.$el.is("."+e.options.templateOptions.classActiveName)&&"Esc"===t.key&&e.hide()}),i()(window.parent).resize(function(){e.positionModal()}),e.options.triggers&&i().each(e.options.triggers,function(t,a){var n=a.substring(0,a.indexOf(" ")),o=a.substring(a.indexOf(" "),a.length);i()(o||e.$el).on(n,function(t){t.stopPropagation(),t.preventDefault(),e.show()})}),e.$el.is("a")&&(e.$el.attr("href")&&!e.options.image&&(!e.options.target&&"#"===e.$el.attr("href").substr(0,1)&&e.$el.attr("href").length>1&&(e.options.target=e.$el.attr("href"),e.options.content=""),e.options.ajaxUrl||"#"===e.$el.attr("href").substr(0,1)||(e.options.ajaxUrl=function(){return e.$el.attr("href")})),e.$el.on("click",function(t){t.stopPropagation(),t.preventDefault(),e.show()})),e.initModal()},createAjaxModal:function(){var e=this;e.emit("before-ajax"),e.loading.show();var t=e.options.ajaxUrl;"function"==typeof t&&(t=t.apply(e,[e.options])),e.ajaxXHR=i().ajax({url:t,type:e.options.ajaxType}).done(function(t,a,n){e.ajaxXHR=void 0,e.$raw=i()("<div />").append(i()(p.A.parseBodyTag(t))),e.emit("after-ajax",e,a,n),e._show()}).fail(function(t,a,n){var i=e.options.actionOptions;"timeout"===a&&i.onTimeout?i.onTimeout(e.$modal,t,n):i.onError?i.onError(t,a,n):(window.alert((0,u.Ay)("There was an error loading modal.")),e.hide()),e.emit("linkActionError",[t,a,n])}).always(function(){e.loading.hide()})},createTargetModal:function(){var e=this;e.$raw=i()(e.options.target).clone(),e._show()},createBasicModal:function(){var e=this;e.$raw=i()("<div/>").html(e.$el.clone()),e._show()},createHtmlModal:function(){var e=this,t=i()(e.options.html);e.$raw=t,e._show()},createImageModal:function(){var e=this;e.$wrapper.addClass("image-modal");var t=e.$el.attr("href"),a=e.$el.attr("data-modal-srcset")||"",n=i().trim(e.$el.context.innerText)||"Image";e.$raw=i()("<div><h1>"+n+'</h1><div id="content"><div class="modal-image"><img src="'+t+'" srcset="'+a+'" /></div></div></div>'),e._show()},initModal:function(){var e=this;e.options.ajaxUrl?e.createModal=e.createAjaxModal:e.options.target?e.createModal=e.createTargetModal:e.options.html?e.createModal=e.createHtmlModal:e.options.image?e.createModal=e.createImageModal:e.createModal=e.createBasicModal},findPosition:function(e,t,a,n,i,o,r){var s,l,c,d,p={};return d=c=s=c="auto","left"===e?(c=a+"px",n>o&&(c="0px"),p.left=c):"right"===e?(d=a+"px",n>o&&(d="0px"),p.right=d,p.left="auto"):(c=o/2-n/2-a+"px",n>o&&(c="0px"),p.left=c),"top"===t?(s=a+"px",i>r&&(s="0px"),p.top=s):"bottom"===t?(l=a+"px",i>r&&(l="0px"),p.bottom=l,p.top="auto"):(s=r/2-i/2-a+"px",i>r&&(s="0px"),p.top=s),p},modalInitialized:function(){return null!==this.$modal&&void 0!==this.$modal},activateFocusTrap:function(){var e=this;const t=e.$modal[0];var a=t.querySelector(`.${e.options.templateOptions.classBodyName}`).querySelectorAll('select, input:not([type="hidden"]), textarea, button, a'),n=t.querySelector(`.${e.options.templateOptions.classFooterName}`).querySelectorAll('select, input:not([type="hidden"]), textarea, button, a'),i=[];for(const e of[...a,...n])d.A.is_visible(e)&&i.push(e);0===i.length&&(i=t.querySelectorAll(".modal-title"));var o=0!==i.length?i[0]:null,r=0!==i.length?i[i.length-1]:null,s=t.querySelector(".modal-close");t.addEventListener("keydown",e=>{if("Tab"===e.key){e.preventDefault();var t=e.target,a=i.indexOf(t);if(a>=0&&a<i.length){var n=a+(e.shiftKey?-1:1);n<0||n>=i.length?s.focus():i[n].focus()}else e.shiftKey&&r?r.focus():o&&o.focus()}}),!0===e.options.backdropOptions.closeOnClick&&t.addEventListener("click",t=>{t.target.closest(`.${e.options.templateOptions.classModal}`)||e.hide()}),o&&["INPUT","SELECT","TEXTAREA"].includes(o.nodeName)&&o.focus()},positionModal:function(){var e=this;if(!e.modalInitialized())return;e.$modal.removeAttr("style"),e.$wrapper.parent().is("body")&&e.$wrapper.height(i()(window.parent).height());var t="function"==typeof e.options.margin?e.options.margin():e.options.margin;let a={position:"absolute"};"0"!==t&&(a.padding=t),e.$modal.css(a),e.$modalDialog.css({width:e.options.width,height:e.options.height}),e.$modalContent.css({width:e.options.width});var n=e.options.position.split(" "),o=n[0],r=n[1],s=e.$modalDialog.outerWidth(!0),l=e.$modalDialog.outerHeight(!0),c=e.$wrapperInner.width(),d=e.$wrapperInner.height(),p=e.findPosition(o,r,t,s,l,c,d);for(var u in p)e.$modalDialog.css(u,p[u])},render:function(e){var t=this;t.emit("render"),t.options.render.apply(t,[e]),t.emit("rendered")},show:function(){var e=this;e.backdrop=e.createBackdrop(),e.createModal()},createBackdrop:function(){var e=this,t=new l.A(e.$el.parents(e.options.backdrop),e.options.backdropOptions),a=e.options.backdropOptions.zIndex||1041;return i()(e.options.zIndexSelector).each(function(){a=Math.max(a,parseInt(i()(this).css("zIndex"))+1||1041)}),e.$wrapper=i()("<div/>").hide().css({"z-index":a,"overflow-y":"auto",position:"fixed",height:"100%",width:"100%",bottom:"0",left:"0",right:"0",top:"0"}).addClass(e.options.templateOptions.classWrapperName).insertBefore(t.$backdrop).on("click",function(a){e.options.backdropOptions.closeOnClick&&(a.stopPropagation(),a.preventDefault(),t.hide())}),t.on("hidden",function(){void 0!==e.$modal&&e.$modal.hasClass(e.options.templateOptions.classActiveName)&&e.hide()}),e.loading=new p.A.Loading({backdrop:t}),e.$wrapperInner=i()("<div/>").addClass(e.options.classWrapperInnerName).css({position:"absolute",bottom:"0",left:"0",right:"0",top:"0"}).appendTo(e.$wrapper),t},_show:function(){var e=this;e.render.apply(e,[e.options]),e.emit("show"),e.backdrop.show(),e.$wrapper.show(),e.loading.hide(),e.$el.addClass(e.options.templateOptions.classActiveName),e.$modal.addClass(e.options.templateOptions.classActiveName),c.A.scan(e.$modal),e.positionModal(),i()(window.parent).on("resize.plone-modal.patterns",function(){e.positionModal()}),i()("body").addClass("modal-open"),e.emit("shown"),e.activateFocusTrap()},hide:function(){var e=this;e.ajaxXHR&&e.ajaxXHR.abort(),e.emit("hide"),e._suppressHide&&!window.confirm(e._suppressHide)||(e.loading.hide(),e.$el.removeClass(e.options.templateOptions.classActiveName),void 0!==e.$modal&&(e.$modal.remove(),e.initModal()),e.$wrapper.remove(),i()(".modal",i()("body")).length<1&&(e._suppressHide=void 0,e.backdrop.hide(),i()("body").removeClass("modal-open"),i()(window.parent).off("resize.plone-modal.patterns")),e.emit("hidden"),e.$el.focus())},redraw:function(e,t){var a=this;a.emit("beforeDraw"),a.$modal.remove(),a.$raw=i()("<div />").append(i()(p.A.parseBodyTag(e))),a.render.apply(a,[t||a.options]),a.$modal.addClass(a.options.templateOptions.classActiveName),a.positionModal(),c.A.scan(a.$modal),a.emit("afterDraw"),a.activateFocusTrap()}})},59994:function(e,t,a){var n=a(35686),i=a.n(n);const o=a(23505).A.getLogger("core utils");var r=function(e){var t=this;t.className="spinner-border";return e||(e={}),t.options=i().extend({},{backdrop:null,zIndex:10005},e),t.init=function(){t.$el=i()("."+t.className),0===t.$el.length&&(t.$el=i()("<div><div></div></div>"),t.$el.addClass(t.className).hide().appendTo("body"))},t.show=function(e){t.init(),t.$el.show(),t.$el.css("position","absolute"),t.$el.css("top","50%"),t.$el.css("left","50%");var a=t.options.zIndex;"function"==typeof a?a=Math.max(a(),10005):(a=10005,i()(".modal-wrapper,.-modal-backdrop").each(function(){a=Math.max(a,i()(this).css("zIndex")||10005)}),a+=1),t.$el.css("zIndex",a),void 0===e&&(e=!0),t.options.backdrop&&(t.options.backdrop.closeOnClick=e,t.options.backdrop.closeOnEsc=e,t.options.backdrop.init(),t.options.backdrop.show())},t.hide=function(){t.init(),t.$el.hide()},t},s=function(e){return void 0===e&&(e="id"),e+Math.floor(65536*(1+Math.random())).toString(16).substring(1)},l={dragAndDrop:function(){return"draggable"in document.createElement("span")},fileApi:function(){return"undefined"!=typeof FileReader},history:function(){return!(!window.history||!window.history.pushState)}},c={get:function(e){if(window.localStorage){var t=window.localStorage[e];return"string"==typeof t?JSON.parse(t):void 0}},set:function(e,t){window.localStorage&&(window.localStorage[e]=JSON.stringify(t))}};const d=new Map;t.A={bool:function(e){return"string"==typeof e&&(e=e.trim(e).toLowerCase()),-1===["false",!1,"0",0,"",void 0,null].indexOf(e)},escapeHTML:function(e){return i()("<div/>").text(e).html()},removeHTML:function(e){return e.replace(/<[^>]+>/gi,"")},featureSupport:l,generateId:s,getAuthenticator:function(){var e=i()('input[name="_authenticator"]');return 0===e.length?(e=i()('a[href*="_authenticator"]')).length>0?e.attr("href").split("_authenticator=")[1]:"":e.val()},getWindow:function(){var e=window;return e.parent!==window&&(e=e.parent),e},Loading:r,loading:new r,parseBodyTag:function(e){return i()(/<body[^>]*>[^]*<\/body>/im.exec(e)[0].replace("<body","<div").replace("</body>","</div>")).eq(0).html()},QueryHelper:function(e){var t=this;return t.options=i().extend({},{pattern:null,vocabularyUrl:null,searchParam:"SearchableText",pathOperator:"plone.app.querystring.operation.string.path",attributes:["UID","Title","Description","getURL","portal_type"],batchSize:10,baseCriteria:[],sort_on:"is_folderish",sort_order:"reverse",pathDepth:1},e),t.pattern=t.options.pattern,void 0!==t.pattern&&null!==t.pattern||(t.pattern={browsing:!1,basePath:"/"}),t.options.url&&!t.options.vocabularyUrl?t.options.vocabularyUrl=t.options.url:t.pattern.vocabularyUrl&&(t.options.vocabularyUrl=t.pattern.vocabularyUrl),t.valid=Boolean(t.options.vocabularyUrl),t.getBatch=function(e){return{page:e||1,size:t.options.batchSize}},t.getCurrentPath=function(){var e,a=t.pattern;"function"==typeof(e=t.currentPath?t.currentPath:a.currentPath)&&(e=e());var n=e;return n||(n=a.basePath?a.basePath:a.options.basePath?a.options.basePath:"/"),n},t.getCriterias=function(e,a){void 0===a&&(a={});var n=[];return(a=i().extend({},{useBaseCriteria:!0,additionalCriterias:[]},a)).useBaseCriteria&&(n=t.options.baseCriteria.slice(0)),e&&(e+="*",n.push({i:t.options.searchParam,o:"plone.app.querystring.operation.string.contains",v:e})),a.searchPath?n.push({i:"path",o:t.options.pathOperator,v:a.searchPath+"::"+t.options.pathDepth}):t.pattern.browsing&&n.push({i:"path",o:t.options.pathOperator,v:t.getCurrentPath()+"::"+t.options.pathDepth}),n=n.concat(a.additionalCriterias)},t.getQueryData=function(e,a){var n={query:JSON.stringify({criteria:t.getCriterias(e),sort_on:t.options.sort_on,sort_order:t.options.sort_order}),attributes:JSON.stringify(t.options.attributes)};return a&&(n.batch=JSON.stringify(t.getBatch(a))),n},t.getUrl=function(){var e=t.options.vocabularyUrl;return-1===e.indexOf("?")?e+="?":e+="&",e+i().param(t.getQueryData())},t.selectAjax=function(){return{url:t.options.vocabularyUrl,dataType:"JSON",quietMillis:100,data:function(e,a){return t.getQueryData(e,a)},results:function(e,t){var a=10*t<e.total;return{results:e.results,more:a}}}},t.search=function(e,a,n,o,r,s){void 0===r&&(r=!0),void 0===s&&(s="GET");var l=[];r&&(l=t.options.baseCriteria.slice(0)),l.push({i:e,o:a,v:n});var c={query:JSON.stringify({criteria:l}),attributes:JSON.stringify(t.options.attributes)};i().ajax({url:t.options.vocabularyUrl,dataType:"JSON",data:c,type:s,success:o})},t},resolveIcon:async function(e){const t=`plone.icon.${e}`,n=t;return d.has(n)||(d.set(n,async function(){let n="";const i=document.body.getAttribute("data-portal-url");if(i){const t=i+"/@@iconresolver";if(t)try{const a=new AbortController;setTimeout(()=>a.abort(),5e3);const i=await fetch(`${t}/${e}`,{signal:a.signal});n=await i.text()}catch(a){o.warn(`Loading icon "${e}" from URL ${t} failed.`),console.warn(a)}}if(!n){e=t;try{a.e(7202).then(a.bind(a,7202));const t=await a.e(66298).then(a.t.bind(a,66298,19)),i=t[e]?.split?.("/");i[0].includes("bootstrap-icons")&&(n=await a(59145)(`./${i[1]}`),n=n?.default)}catch(e){o.warn(`Loading icon "${t}" failed from fallback.`),console.warn(e)}}return n}()),o.debug(`Loading icon "${t}"`)),await d.get(n)},setId:function(e,t){void 0===t&&(t="id");var a=e.attr("id");return a=void 0===a?s(t):a.replace(/\./g,"-"),e.attr("id",a),a},storage:c}},63198:function(e,t,a){a.r(t);var n=a(35686),i=a.n(n),o=a(40705),r=a.n(o),s=a(71553),l=a(20681),c=a(59994),d=a(59329),p=a(29342);const u=37,h=39;t.default=s.A.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",currentPath:void 0,selectedUIDs:[],openAfterInit:void 0,defaults:{vocabularyUrl:null,attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],basePath:"",pageSize:10,browsing:void 0,closeOnSelect:!0,contextPath:void 0,dropdownCssClass:"pat-relateditems-dropdown",favorites:[],recentlyUsed:!1,recentlyUsedMaxItems:20,recentlyUsedKey:"relateditems_recentlyused",maximumSelectionSize:-1,minimumInputLength:0,mode:"browse",orderable:!0,pathOperator:"plone.app.querystring.operation.string.path",rootPath:"/",rootUrl:"",scanSelection:!1,selectableTypes:null,separator:",",sortOn:null,sortOrder:"ascending",tokenSeparators:[","," "],upload:!1,uploadAllowView:void 0,breadcrumbTemplateSelector:null,favoriteTemplateSelector:null,recentlyusedTemplateSelector:null,resultTemplateSelector:null,selectionTemplateSelector:null,toolbarTemplateSelector:null,multiple:!0,ajaxTimeout:500},recentlyUsed(e){let t=c.A.storage.get(this.options.recentlyUsedKey)||[];t=t.slice(t.length-1e3,t.length),e&&t.filter(this.isSelectable.bind(this));const a=parseInt(this.options.recentlyUsedMaxItems,10);return a&&(t=t.slice(t.length-a,t.length)),t},applyTemplate(e,t){let a;this.options[e+"TemplateSelector"]&&(a=i()(this.options[e+"TemplateSelector"]).html()),a||(a=this.options[e+"Template"]?this.options[e+"Template"]:this[e+"Template"]);const n=i().extend(!0,{},this.options,t,{browsing:this.browsing,open_folder:(0,l.Ay)("Open folder"),current_directory:(0,l.Ay)("current directory:"),one_level_up:(0,l.Ay)("Go one level up")});return n._item=t,r().template(a)(n)},setAjax(){const e=parseInt(this.options.ajaxTimeout||500,10),t={url:this.options.vocabularyUrl,dataType:"JSON",quietMillis:e,data:(e,t)=>{const a=[];e&&(e="*"+e+"*",a.push({i:"SearchableText",o:"plone.app.querystring.operation.string.contains",v:e})),!this.browsing&&this.options.selectableTypes&&a.push({i:"portal_type",o:"plone.app.querystring.operation.selection.any",v:this.options.selectableTypes}),a.push({i:"path",o:this.options.pathOperator,v:this.options.rootPath+this.currentPath+(this.browsing?"::1":"")});let n=this.options.sortOn,i=n?this.options.sortOrder:null;this.browsing&&null===n&&(n="getObjPositionInParent",i="ascending");return{query:JSON.stringify({criteria:a,sort_on:n,sort_order:i}),attributes:JSON.stringify(this.options.attributes),batch:JSON.stringify({page:t||1,size:this.options.pageSize})}},results:(e,t)=>{const a=t*this.options.pageSize<e.total;let n=e.results;this.selectedUIDs=(this.$el.select2("data")||[]).map(e=>e.UID),n=n.filter(e=>!!(this.browsing&&e.is_folderish||this.isSelectable(e)&&-1===this.selectedUIDs.indexOf(e.UID)));const i=this.currentPath.split("/");return 1===t&&this.browsing&&i.length>1&&"/"!==this.currentPath&&(n=[{oneLevelUp:!0,Title:(0,l.Ay)("One level up"),path:i.slice(0,i.length-1).join("/")||"/",currentPath:this.currentPath,is_folderish:!0,selectable:!1}].concat(n)),{results:n,more:a}}};this.options.ajax=t},async renderToolbar(){let e;const t=this.currentPath.split("/");let a="",n="";for(const e of t)if(""!==e){const t={};t.path=a=`${a}/${e}`,t.text=e,n+=this.applyTemplate("breadcrumb",t)}let o="";for(const e of this.options.favorites){const t=r().clone(e);t.path=t.path.substr(this.options.rootPath.length)||"/",o+=this.applyTemplate("favorite",t)}let s="";if(this.options.recentlyUsed){const e=this.recentlyUsed(!0);for(const t of e.reverse())s+=this.applyTemplate("recentlyused",t)}e=this.applyTemplate("toolbar",{items:n,favItems:o,favText:(0,l.Ay)("Favorites"),searchText:(0,l.Ay)("Current path:"),searchModeText:(0,l.Ay)("Search"),browseModeText:(0,l.Ay)("Browse"),recentlyUsedItems:s,recentlyUsedText:(0,l.Ay)("Recently Used"),icon_root:await c.A.resolveIcon("house-fill"),icon_recently_used:await c.A.resolveIcon("grid-fill"),icon_favorites:await c.A.resolveIcon("star-fill"),icon_upload:await c.A.resolveIcon("cloud-arrow-up"),upload:this.options.upload,upload_text:(0,l.Ay)("Upload")}),this.$toolbar.html(e),i()(".pat-relateditems-dropdown").off("mouseup"),i()(".pat-relateditems-dropdown").on("mouseup",e=>{e.stopPropagation()}),i()("button.mode.search",this.$toolbar).on("click",e=>{e.preventDefault(),this.browsing?(i()("button.mode.search",this.$toolbar).toggleClass("btn-primary btn-secondary"),i()("button.mode.browse",this.$toolbar).toggleClass("btn-primary btn-secondary"),this.browsing=!1,this.$el.select2("data").length>0&&(this.openAfterInit=!0),this.openAfterInit||(this.$el.select2("close"),this.$el.select2("open"))):(this.$el.select2("close"),this.$el.select2("open"))}),i()("button.mode.browse",this.$toolbar).on("click",e=>{e.preventDefault(),this.browsing?(this.$el.select2("close"),this.$el.select2("open")):(i()("button.mode.search",this.$toolbar).toggleClass("btn-primary btn-secondary"),i()("button.mode.browse",this.$toolbar).toggleClass("btn-primary btn-secondary"),this.browsing=!0,this.$el.select2("data").length>0&&(this.openAfterInit=!0),this.openAfterInit||(this.$el.select2("close"),this.$el.select2("open")))}),i()("a.crumb",this.$toolbar).on("click",e=>{e.preventDefault(),e.stopPropagation(),this.browseTo(i()(e.currentTarget).attr("href"))}),i()("a.fav",this.$toolbar).on("click",e=>{e.preventDefault(),e.stopPropagation(),this.browseTo(i()(e.currentTarget).attr("href"))}),this.options.recentlyUsed&&i()(".pat-relateditems-recentlyused-select",this.$toolbar).on("click",e=>{e.preventDefault();const t=i()(e.currentTarget).data("uid");let a=this.recentlyUsed().filter(e=>e.UID===t);if(a.length>0&&(a=a[0],this.selectItem(a),this.options.maximumSelectionSize>0)){if(this.$el.select2("data").length>=this.options.maximumSelectionSize)return}}),this.options.upload&&c.A.featureSupport.dragAndDrop()&&c.A.featureSupport.fileApi()&&(this.options.uploadAllowView?i().ajax({url:this.options.uploadAllowView,dataType:"JSON",data:{path:this.options.rootPath+this.currentPath},type:"GET",success:e=>{this.initUploadView(!e.allowUpload)}}):this.initUploadView())},async initUploadView(e){let t=await Promise.resolve().then(a.bind(a,98146));t=t.default;const n=this.$toolbar[0].querySelector(".upload button");n.disabled=e;const o=this.$toolbar[0].querySelector(".upload .pat-upload"),r={success:(e,t)=>{const a=t.UID;if(a){new c.A.QueryHelper({vocabularyUrl:this.options.vocabularyUrl,attributes:this.options.attributes}).search("UID","plone.app.querystring.operation.selection.is",a,e=>{const t=this.$el.select2("data");t.push.apply(t,e.results),this.$el.select2("data",t,!0),this.emit("selected")},!1)}},uloadMultiple:!0,allowPathSelection:!1,relativePath:"fileUpload",baseUrl:this.options.rootUrl},s=new t(i()(o),r);n.addEventListener("show.bs.dropdown",()=>{this.currentPath!==s.currentPath&&s.setPath(this.currentPath)})},browseTo(e){this.emit("before-browse"),this.currentPath=e,this.$el.select2("close"),this.renderToolbar(),this.$el.select2("open"),this.emit("after-browse")},selectItem(e){this.emit("selecting");const t=i()(this.el).select2("data");if(t.push(e),i()(this.el).select2("data",t,!0),this.options.recentlyUsed){const t=this.recentlyUsed(),a=t.filter(t=>t.UID===e.UID);a.length>0&&t.splice(t.indexOf(a[0]),1),t.push(e),c.A.storage.set(this.options.recentlyUsedKey,t)}this.emit("selected")},deselectItem(e){this.emit("deselecting");const t=this.$el.select2("data");t.forEach((a,n)=>{a.UID===e.UID&&t.splice(n,1)}),this.$el.select2("data",t,!0),this.emit("deselected")},isSelectable(e){return!1!==e.selectable&&(null===this.options.selectableTypes||-1!==this.options.selectableTypes.indexOf(e.portal_type))},async init(){(await a.e(37253).then(a.t.bind(a,37253,23))).Dropdown,a.e(26862).then(a.bind(a,26862)),this.breadcrumbTemplate=(await a.e(78169).then(a.t.bind(a,78169,17))).default,this.favoriteTemplate=(await a.e(41646).then(a.t.bind(a,41646,17))).default,this.recentlyusedTemplate=(await a.e(24197).then(a.t.bind(a,24197,17))).default,this.resultTemplate=(await a.e(88097).then(a.t.bind(a,88097,17))).default,this.selectionTemplate=(await a.e(51286).then(a.t.bind(a,51286,17))).default,this.toolbarTemplate=(await a.e(68869).then(a.t.bind(a,68869,17))).default,this.browsing="search"!==this.options.mode,this.options.rootPath=this.options.rootPath.replace(/\/$/,""),this.currentPath=this.options.basePath.substr(this.options.rootPath.length)||"/",this.setAjax(),this.$el.wrap('<div class="pat-relateditems-container" />'),this.$container=this.$el.parents(".pat-relateditems-container"),p.default.prototype.initializeValues.call(this),p.default.prototype.initializeTags.call(this),this.options.formatSelection=e=>{e=i().extend(!0,{Title:"",getIcon:"",getURL:"",path:"",portal_type:"",review_state:""},e);const t=i()(this.applyTemplate("selection",e));if(this.options.scanSelection&&d.A.scan(t),1==this.options.maximumSelectionSize){let t=e.path,a=t.split("/");a=a.slice(0,-1),t=a.join("/"),this.currentPath=t,this.renderToolbar()}return t};const e=await c.A.resolveIcon("arrow-left-circle"),t=await c.A.resolveIcon("arrow-right-circle");this.options.formatResult=a=>{a.selectable=this.isSelectable(a),a=i().extend(!0,{Title:"",getIcon:"",getURL:"",is_folderish:!1,oneLevelUp:!1,iconLevelUp:e,iconLevelDown:t,path:"",portal_type:"",review_state:"",selectable:!1},a),-1!==this.selectedUIDs.indexOf(a.UID)&&(a.selectable=!1);const n=i()(this.applyTemplate("result",a));return i()(".pat-relateditems-result-select",n).on("click",e=>{const t=e.currentTarget;if(e.preventDefault(),i()(t).is(".selectable")){const e=i()(t).parents(".pat-relateditems-result");if(e.is(".pat-relateditems-active"))e.removeClass("pat-relateditems-active"),this.deselectItem(a);else{if(this.options.maximumSelectionSize>0){this.$el.select2("data").length>=this.options.maximumSelectionSize&&this.$el.select2("close")}this.selectItem(a),e.addClass("pat-relateditems-active"),this.options.closeOnSelect&&this.$el.select2("close")}}}),i()(".pat-relateditems-result-browse",n).on("click",e=>{e.preventDefault(),e.stopPropagation();const t=i()(e.currentTarget).data("path");this.browseTo(t)}),i()(n)},this.options.initSelection=(e,t)=>{const a=i()(e).val();if(""!==a){const e=a.split(this.options.separator);new c.A.QueryHelper(i().extend(!0,{},this.options,{pattern:this})).search("UID","plone.app.querystring.operation.list.contains",e,a=>{const n=a.results.reduce((e,t)=>(e[t.UID]=t,e),{});try{t(e.map(e=>n[e]).filter(e=>void 0!==e))}catch{}this.openAfterInit&&(this.$el.select2("open"),this.openAfterInit=void 0)},!1)}},this.options.tokenizer=e=>{"auto"===this.options.mode&&(this.browsing=!e)},this.options.id=e=>e.UID,await p.default.prototype.initializeSelect2.call(this),await p.default.prototype.initializeOrdering.call(this),this.$toolbar=i()('<div class="toolbar d-flex" />'),this.$container.prepend(this.$toolbar),this.$el.on("select2-selecting",e=>{this.isSelectable(e.choice)||e.preventDefault()}),this.renderToolbar(),this.$el.on("select2-loaded",()=>{let e=window.innerHeight||document.documentElement.clientHeight;const t=this.el.parentElement.getBoundingClientRect(),a=i()("#select2-drop.pat-relateditems-dropdown.select2-drop-active .select2-results")[0],n=a.getBoundingClientRect(),o=(t.top>n.top?t.top:e-n.top)-18;i()(a).css("max-height",`${o}px`)}),i()(document).on("keyup",this.$el,e=>{if(p.default.prototype.opened.call(this)&&(e.which===u||e.which===h)){e.stopPropagation();const t=e.which===u?".pat-relateditems-result.one-level-up":".select2-highlighted",a=".pat-relateditems-result-browse",n=i()(a,t);if(1!==n.length)return;const o=n.data("path");this.browseTo(o)}})}})},64492:function(e,t,a){var n=a(59329),i=a(71553),o=a(33541),r=a(62800),s=a(44563),l=a(8633),c=a(35686),d=a.n(c),p={init:function(e){var t={time:3,initialTime:8,exceptionAreas:[]};return this.each(function(){var a=d()(this);a.data("timeout")||(e&&d().extend(t,e),a.data("timeout",{lastEvent:new Date,trueTime:t.time,time:t.initialTime,untouched:!0,inExceptionArea:!1}),a.on("mouseover.timeout",p.mouseMoved),a.on("mouseenter.timeout",p.mouseMoved),d()(t.exceptionAreas).each(function(){a.find(this).live("mouseover.timeout",{parent:a},p.enteredException).live("mouseleave.timeout",{parent:a},p.leftException)}),t.initialTime>0?a.timeout("startTimer"):a.addClass("timeout"))})},enteredException:function(e){var t=e.data.parent.data("timeout");t.inExceptionArea=!0,e.data.parent.data("timeout",t),e.data.parent.trigger("mouseover")},leftException:function(e){var t=e.data.parent.data("timeout");t.inExceptionArea=!1,e.data.parent.data("timeout",t)},destroy:function(){return this.each(function(){var e=d()(this),t=e.data("timeout");d()(window).off(".timeout"),t.timeout.remove(),e.removeData("timeout")})},mouseMoved:function(){var e=d()(this),t=e.data("timeout");e.hasClass("timeout")?(e.removeClass("timeout"),e.timeout("startTimer")):t.untouched&&(t.untouched=!1,t.time=t.trueTime),t.lastEvent=new Date,e.data("timeout",t)},startTimer:function(){var e=d()(this),t=e.data("timeout"),a=function(){var t=e.data("timeout");if(t&&t.lastEvent)if(t.inExceptionArea)setTimeout(a,Math.floor(1e3*t.time));else{var n=new Date,i=Math.floor(1e3*t.time)-(n-t.lastEvent);i>0?setTimeout(a,i+100):e.addClass("timeout")}};setTimeout(a,Math.floor(1e3*t.time))}};d().fn.timeout=function(e){return p[e]?p[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void d().error("Method "+e+" does not exist on jQuery.timeout"):p.init.apply(this,arguments)},d().extend(d().expr[":"],{scrollable:function(e){return"scroll"===d()(e).css("overflow")||"scroll"===d()(e).css("overflowX")||"scroll"===d()(e).css("overflowY")||(e.clientHeight<e.scrollHeight&&(-1!==d().inArray(d()(e).css("overflowY"),["scroll","auto"])||-1!==d().inArray(d()(e).css("overflow"),["scroll","auto"]))||e.clientWidth<e.scrollWidth&&(-1!==d().inArray(d()(e).css("overflowX"),["scroll","auto"])||-1!==d().inArray(d()(e).css("overflow"),["scroll","auto"])))}}),d().fn.makeVisibleInScroll=function(e){var t=null;return"string"==typeof e?t=d()("#"+e):e&&(t=d()(e)),this.each(function(){var e,a=d()(this);e=t||((e=a.parents(":scrollable")).length>0?d()(e[0]):d()(window));var n=a.position().top,i=a.height()+n,o=e.scrollTop(),r=e.height()+o;n<o?e.scrollTop(n):i>r-e.height()/2&&e.scrollTop(n-(e.height()-a.height())/2)})},d().fn.safeOffset=function(){var e,t=this[0],a={top:0,left:0};return t&&t.nodeType?(e=(t.ownerDocument||document).documentElement,d().contains(e,t)?d().fn.offset.apply(this,arguments):a):a},d().fn.setPositionAbsolute=function(e,t,a){return this.each(function(){var n=d()(this),i=d()(this).width(),o=e.safeOffset(),r=e.width(),s=e.height(),l=o.left+r-i+a,c=o.top+s+t;n.css({"z-index":1,position:"absolute",marginLeft:0,marginTop:0,left:l+"px",top:c+"px",width:i}),n.remove().appendTo("body").show()})},d().fn.positionAncestor=function(e){var t=0,a=0;return this.each(function(){var n=d()(this).closest(e);if(n.length&&"static"!==n.css("position")){var i=d()(this),o=i.safeOffset().left-parseInt(i.css("marginLeft"),10),r=i.safeOffset().top-parseInt(i.css("marginTop"),10),s=n.safeOffset().left+parseInt(n.css("borderLeftWidth"),10),l=n.safeOffset().top+parseInt(n.css("borderTopWidth"),10);return t=o-s,a=r-l,!1}}),{left:t,top:a}},d().fn.findInclusive=function(e){return this.find("*").addBack().filter(e)},d().fn.slideIn=function(e,t,a){return this.animate({width:"show"},e,t,a)},d().fn.slideOut=function(e,t,a){return this.animate({width:"hide"},e,t,a)},d().expr[":"].Contains=function(e,t,a){return d()(e).text().toUpperCase().indexOf(a[3].toUpperCase())>=0},d().fn.scopedFind=function(e){return 0===e.indexOf("#")?d()(e):this.find(e)};const u=new o.A("checklist");u.addArgument("select",".select-all"),u.addArgument("deselect",".deselect-all"),u.addArgument("toggle",".toggle-all");i.A.extend({name:"checklist",trigger:".pat-checklist",jquery_plugin:!0,all_selects:[],all_deselects:[],all_toggles:[],all_checkboxes:[],all_radios:[],init(){this.options=u.parse(this.el,this.options,!1),this.$el.on("patterns-injected",this._init.bind(this)),this.change_handler=l.A.debounce(()=>{this.change_buttons_and_toggles(),this.change_checked()},50),this._init()},_init(){this.all_checkboxes=this.el.querySelectorAll("input[type=checkbox]"),this.all_radios=this.el.querySelectorAll("input[type=radio]"),this.all_selects=r.A.find_scoped(this.el,this.options.select);for(const e of this.all_selects)s.A.add_event_listener(e,"click","pat-checklist--select-all--click",this.select_all.bind(this));this.all_deselects=r.A.find_scoped(this.el,this.options.deselect);for(const e of this.all_deselects)s.A.add_event_listener(e,"click","pat-checklist--deselect-all--click",this.deselect_all.bind(this));this.all_toggles=r.A.find_scoped(this.el,this.options.toggle);for(const e of this.all_toggles)s.A.add_event_listener(e,"click","pat-checklist--toggle-all--click",this.toggle_all.bind(this));this.change_buttons_and_toggles(),this.change_checked(),s.A.add_event_listener(this.el,"change","pat-checklist--change-handler--change",this.change_handler.bind(this))},destroy(){for(const e of this.all_selects)s.A.remove_event_listener(e,"pat-checklist--select-all--click");for(const e of this.all_deselects)s.A.remove_event_listener(e,"pat-checklist--deselect-all--click");for(const e of this.all_toggles)s.A.remove_event_listener(e,"pat-checklist--toggle-all--click");s.A.remove_event_listener(this.el,"pat-checklist--change-handler--change"),this.$el.off("patterns_injected")},find_siblings(e,t){let a,n=e.parentNode;for(;n;){if(a=n.querySelectorAll(`${t}:not(${this.options.toggle})`),a.length||n===this.el)return a;n=n.parentNode}},find_checkboxes(e,t){let a=[];return a=0===this.options.select.indexOf("#")?this.el.querySelectorAll(t):this.find_siblings(e,t),a},change_buttons_and_toggles(){let e;for(const t of this.all_selects)e=this.find_checkboxes(t,"input[type=checkbox]"),t.disabled=[...e].map(e=>e.matches(":checked")).every(e=>!0===e);for(const t of this.all_deselects)e=this.find_checkboxes(t,"input[type=checkbox]"),t.disabled=[...e].map(e=>e.matches(":checked")).every(e=>!1===e);for(const t of this.all_toggles)e=this.find_checkboxes(t,"input[type=checkbox]"),t.checked=[...e].map(e=>e.matches(":checked")).every(e=>!0===e)},select_all(e){e.preventDefault();const t=this.find_checkboxes(e.target,"input[type=checkbox]:not(:checked)");for(const e of t)e.checked=!0,e.dispatchEvent(s.A.change_event()),e.dispatchEvent(s.A.input_event())},deselect_all(e){e.preventDefault();const t=this.find_checkboxes(e.target,"input[type=checkbox]:checked");for(const e of t)e.checked=!1,e.dispatchEvent(s.A.change_event()),e.dispatchEvent(s.A.input_event())},toggle_all(e){e.preventDefault();const t=e.target.checked,a=this.find_checkboxes(e.target,"input[type=checkbox]");for(const e of a)e.checked=t,e.dispatchEvent(s.A.change_event()),e.dispatchEvent(s.A.input_event())},change_checked(){for(const e of[...this.all_checkboxes,...this.all_radios])for(const t of e.labels)t.classList.remove("checked","unchecked"),t.classList.add(e.checked?"checked":"unchecked");for(const e of r.A.querySelectorAllAndMe(this.el,"fieldset"))e.querySelectorAll(`input[type=checkbox]:checked:not(${this.options.toggle}), input[type=radio]:checked`).length?(e.classList.remove("unchecked"),e.classList.add("checked")):(e.classList.remove("checked"),e.classList.add("unchecked"))}}),a(98678);const h=new o.A("datetime-picker");h.addArgument("format","YYYY-MM-DD"),h.addArgument("week-numbers",[],["show","hide"]),h.addArgument("i18n"),h.addArgument("today","Today"),h.addArgument("clear","Clear"),h.addArgument("first-day",0);i.A.extend({name:"datetime-picker",trigger:".pat-datetime-picker",parser:h,el_date:null,el_time:null,async init(){const e=this.el;if(this.options=h.parse(this.el,this.options),l.A.checkInputSupport("datetime-local","invalid date"))return;window.__patternslib_import_styles&&a.e(61016).then(a.bind(a,61016));const t=(await Promise.resolve().then(a.bind(a,98678))).default,n=this.el.value.split("T"),i=n[0]||"",o=n[1]||"",s=document.createElement("div");s.setAttribute("class","pat-datetime-picker__wrapper"),r.A.hide(e);const c=`\n            <button type="button" class="_btn _now" title="${this.options.today}">\n                <span class="_icon"/>\n                <span class="_text">${this.options.today}</span>\n            </button>`,d=`\n            <button type="button" class="_btn _clear" title="${this.options.clear}">\n                <span class="_icon"/>\n                <span class="_text">${this.options.clear}</span>\n            </button>`;s.innerHTML=`\n            <input type="date" placeholder="YYYY-MM-DD" value="${i}" />\n            <input type="time" placeholder="hh:mm" value="${o}" />\n            ${this.options.today?c:""}\n            ${this.options.clear?d:""}\n        `,this.el_time=s.querySelector("input[type=time]"),this.el_time.addEventListener("change",()=>this.update()),this.el_date=s.querySelector("input[type=date]"),this.el_date.addEventListener("change",()=>{this.el_time.value||(this.el_time.value=this.isotime()),this.update()});const p={behavior:"native",format:this.options.format,weekNumbers:this.options.weekNumbers,firstDay:this.options.firstDay};if(await t.init(this.el_date,p),this.options.today){s.querySelector("._btn._now").addEventListener("click",e=>{e.preventDefault(),this.el_date.value=this.isodate(),this.el_time.value=this.isotime(),this.update()})}if(this.options.clear){s.querySelector("._btn._clear").addEventListener("click",e=>{e.preventDefault(),this.el_date.value="",this.el_time.value="",this.update()})}e.parentNode.insertBefore(s,e)},update(){this.el_date.value&&this.el_time.value?this.el.value=`${this.el_date.value}T${this.el_time.value}`:this.el.value="",this.el.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0}))},isodate(){return(new Date).toISOString().substr(0,10)},isotime(){return(new Date).toTimeString().substr(0,5)}}),a(90101),a(89476);var m=a(33077),f=a(23505);const g=f.A.getLogger("pat-validation"),v=new o.A("validation");v.addArgument("disable-selector","[type=submit], button:not([type=button])"),v.addArgument("message-date",""),v.addArgument("message-datetime",""),v.addArgument("message-email",""),v.addArgument("message-max",""),v.addArgument("message-min",""),v.addArgument("message-number",""),v.addArgument("message-required",""),v.addArgument("message-equality","is not equal to %{attribute}."),v.addArgument("not-after",null),v.addArgument("not-before",null),v.addArgument("equality",null),v.addArgument("delay",100),v.addAlias("message-integer","message-number");const y="__patternslib__input__error__el",b="__patternslib__input__error__msg";class w extends m.m{static name="validation";static trigger="form.pat-validation";static parser=v;init(){s.A.add_event_listener(this.el,"submit","pat-validation--submit--validator",e=>{for(const t of this.inputs)g.debug("Checking input for submit",t,e),this.check_input({input:t,event:e})},{capture:!0}),this.initialize_inputs(),d()(this.el).on("pat-update",()=>{this.initialize_inputs()}),this.el.setAttribute("novalidate","")}initialize_inputs(){this.inputs=[...this.el.querySelectorAll("input[name], select[name], textarea[name]")],this.disabled_elements=[...this.el.querySelectorAll(this.options.disableSelector)];for(const[e,t]of this.inputs.entries()){const a=l.A.debounce(e=>{g.debug("Checking input for event",t,e),this.check_input({input:t,event:e})},this.options.delay);s.A.add_event_listener(t,"input",`pat-validation--input-${t.name}--${e}--validator`,e=>a(e)),s.A.add_event_listener(t,"change",`pat-validation--change-${t.name}--${e}--validator`,e=>a(e)),s.A.add_event_listener(t,"blur",`pat-validation--blur-${t.name}--${e}--validator`,e=>a(e))}}check_input({input:e,event:t,stop:a=!1}){if(e.disabled)return;this.set_error({input:e,msg:"",skip_event:!0});const n=e.validity;if(t?.submitter?.hasAttribute("formnovalidate"))return;g.debug("validity_state: ",n);const i=v.parse(e);if(n.valid){if(i.equality&&this.el.querySelector(`[name=${i.equality}]`)?.value!==e.value){const t=i.message.equality||"The value is not equal to %{attribute}";this.set_error({input:e,msg:t,attribute:i.equality})}else if(i.not.after||i.not.before){const t=i.message.date||i.message.datetime,n="The date must be after %{attribute}",o="The date must be before %{attribute}";let r,s,c,d;if(i.not.after&&(l.A.is_iso_date_time(i.not.after,!0)?r=new Date(i.not.after):(s=document.querySelector(i.not.after),r=s?.value?new Date(s?.value):void 0),r=isNaN(r)?null:r),i.not.before&&(l.A.is_iso_date_time(i.not.before,!0)?c=new Date(i.not.before):(d=document.querySelector(i.not.before),c=d?.value?new Date(d?.value):void 0),c=isNaN(c)?null:c),e.value&&l.A.is_iso_date_time(e.value,!0)&&!isNaN(new Date(e.value))){const a=new Date(e.value);if(r&&a>r){let a;!s&&i.not.after?a=i.not.after:(a=s?.labels?.[0]?.textContent.replace(/\s\s+/g," "),a=a||s.name),this.set_error({input:e,msg:t||o,attribute:a.trim()})}else if(c&&a<c){let a;!d&&i.not.before?a=i.not.before:(a=d?.labels?.[0]?.textContent.replace(/\s\s+/g," "),a=a||d.name),this.set_error({input:e,msg:t||n,attribute:a.trim()})}}!a&&s&&(g.debug("Check `not-after` input.",s),this.check_input({input:s,stop:!0})),!a&&d&&(g.debug("Check `no-before` input.",s),this.check_input({input:d,stop:!0}))}if(!n.customError)return void this.remove_error(e,!0)}else n.valueMissing&&i.message.required?this.set_error({input:e,msg:i.message.required}):n.rangeUnderflow&&i.message.min?this.set_error({input:e,msg:i.message.min,min:e.getAttribute("min")}):n.rangeOverflow&&i.message.max?this.set_error({input:e,msg:i.message.max,max:e.getAttribute("max")}):(n.badInput||n.stepMismatch)&&"number"===e.type&&i.message.number?this.set_error({input:e,msg:i.message.number}):n.typeMismatch&&"email"===e.type&&i.message.email?this.set_error({input:e,msg:i.message.email}):n.rangeUnderflow&&"date"===e.type&&i.message.date||n.rangeOverflow&&"date"===e.type&&i.message.date?this.set_error({input:e,msg:i.message.date}):n.rangeUnderflow&&"datetime"===e.type&&i.message.datetime||n.rangeOverflow&&"datetime"===e.type&&i.message.datetime?this.set_error({input:e,msg:i.message.datetime}):this.emit_update("invalid");"submit"===t?.type&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation()),this.set_error_message(e)}set_error({input:e,msg:t,attribute:a=null,min:n=null,max:i=null,skip_event:o=!1}){a&&(t=t.replace(/%{attribute}/g,a)),n&&(t=t.replace(/%{count}/g,n)),i&&(t=t.replace(/%{count}/g,i)),t=t.replace(/%{value}/g,JSON.stringify(e.value)),e.setCustomValidity(t),e[b]=t,o||this.emit_update("invalid")}remove_error(e,t=!1,a=!1){let n=[e];t&&(n=this.inputs.filter(t=>t.name===e.name));for(const e of n){const t=e[y];e[y]=null,t?.remove()}if(this.el.checkValidity())for(const e of this.disabled_elements)e.disabled&&(e.removeAttribute("disabled"),e.classList.remove("disabled"));a||this.emit_update("valid")}set_error_message(e){this.remove_error(e,!1,!0);const t=this.inputs.filter(t=>t.name===e.name);if(t.length>1&&t.some(e=>!!e[y]))return;const a=e.validationMessage||e[b],n=r.A.create_from_string(this.error_template(a)).firstChild;let i;"radio"!==e.type&&"checkbox"!==e.type||(i=e.closest("fieldset.pat-checklist")),i?i.append(n):e.after(n),e[y]=n;let o=!1;for(const e of this.disabled_elements)e.disabled||e.formNoValidate||(o=!0,e.setAttribute("disabled","disabled"),e.classList.add("disabled"),g.debug("Disable element",e));if(o){g.debug("Checking whole form after element was disabled.");for(const t of this.inputs.filter(t=>t!==e))this.check_input({input:t,stop:!0})}}error_template(e){return`<em class="validation warning message">${e}</em>`}}n.A.register(w);var A=a(94232);const x=new o.A("code-editor");x.addArgument("language",null),x.addArgument("linenumbers",!1),x.addArgument("theme","dark"),x.addArgument("tab","    "),x.addArgument("indent-on","{$"),x.addArgument("spellcheck",!1),x.addArgument("catch-tab",!0),x.addArgument("preserve-ident",!0),x.addArgument("add-closing",!0),x.addArgument("history",!0);const $={atom:"xml",html:"xml",plist:"xml",rss:"xml",svg:"xml",wsf:"xml",xhtml:"xml",xjb:"xml",xsd:"xml",xsl:"xml"};class _ extends m.m{static name="code-editor";static trigger=".pat-code-editor";static parser=x;async init(){const e=(await a.e(19983).then(a.bind(a,19983))).CodeJar,t=(await a.e(45981).then(a.t.bind(a,45981,23))).default;let n,i=this.el;n="light"===this.options.theme?"stackoverflow-light":"dark"===this.options.theme||"okaidia"===this.options.theme?"stackoverflow-dark":this.options.theme,await a(21132)(`./${n}.css`),window.__patternslib_import_styles&&await a.e(3027).then(a.bind(a,3027));const o=e=>{e.textContent=e.textContent,t.highlightElement(e)};let r=o;if(this.options.linenumbers){r=(0,(await a.e(13190).then(a.bind(a,90809))).withLineNumbers)(o,{class:`codejar-linenumbers ${n}`})}let l=[...i.classList].filter(e=>e.startsWith("language-"))[0];l=l?l.replace("language-",""):this.options.language,l=l||"plaintext";const c=(await a(32908)(`./${$[l]||l}`)).default;if(t.registerLanguage(l,c),["textarea","input"].includes(this.el.nodeName.toLowerCase())){const e=document.createElement("pre");e.innerHTML="<code contenteditable></code>",i=e.querySelector("code"),i.textContent=this.el.value,this.el.parentNode.insertBefore(e,this.el),this.el.setAttribute("hidden","")}i.classList.add("code-editor",`theme-${this.options.theme}`,`language-${l}`);const d={tab:this.options.tab.replace(/'/g,"").replace(/"/g,"").replace(/\\t/g,"\t"),indentOn:new RegExp(this.options.indentOn),spellcheck:this.options.spellcheck,catchTab:this.options.catchTab,preserveIdent:this.options.preserveIdent,addClosing:this.options.addClosing,history:this.options.history};this.codeeditor=e(i,r,d),i!==this.el&&this.codeeditor.onUpdate(e=>{this.el.value=e.trim(),this.el.dispatchEvent(s.A.input_event())})}}n.A.register(_);var k=a(64917),T=a(86557);const O=f.A.getLogger("pat.inject"),S=new o.A("inject");S.addArgument("default-selector"),S.addArgument("target"),S.addArgument("data-type","html"),S.addArgument("next-href"),S.addArgument("source"),S.addArgument("trigger","default",["default","autoload","autoload-visible","idle"]),S.addArgument("delay"),S.addArgument("browser-cache","no-cache",["cache","no-cache"]),S.addArgument("confirm","class",["never","always","form-data","class"]),S.addArgument("confirm-message","Are you sure you want to leave this page?"),S.addArgument("loading-class","injecting"),S.addArgument("executing-class","executing"),S.addArgument("executed-class","executed"),S.addArgument("class"),S.addArgument("history","none",["none","record"]),S.addArgument("push-marker"),S.addArgument("scroll"),S.addArgument("url");const D={name:"inject",trigger:"a.pat-inject, form.pat-inject, .pat-subform.pat-inject",parser:S,async init(e,t){await l.A.timeout(1);const a=l.A.jqToNode(e),n=this.extractConfig(e,t);if(n.some(e=>"record"===e.history)&&!("pushState"in history))return O.warn("HTML5 pushState is missing, aborting"),e;if(e.data("pat-inject",n),n[0].nextHref&&0===n[0].nextHref.indexOf("#")&&"A"===a.nodeName&&d()(n[0].nextHref).length>0)return O.debug("Skipping as next href is anchor, which already exists",n[0].nextHref),a.setAttribute("href",(window.location.href.split("#")[0]||"")+n[0].nextHref),e;if(n[0].pushMarker&&d()("body").on("push",(e,t)=>{O.debug("received push message: "+t),t==n[0].pushMarker&&(O.debug("re-injecting "+t),this.onTrigger({currentTarget:a}))}),n[0].idleTrigger)this._initIdleTrigger(e,n[0].idleTrigger);else switch(n[0].trigger){case"default":for(const e of n)e.delay&&(e.processDelay=e.delay);"FORM"===a?.nodeName?(O.debug("Initializing form with injection on",a),s.A.add_event_listener(a,"submit","pat-inject--form-submit",e=>{e.submitter?.matches("[type=submit], button:not([type=button]), [type=image]")&&k.A.onClickSubmit(e),this.onTrigger(e)})):a?.matches(".pat-subform")?O.debug("Initializing subform with injection"):e.on("click.pat-inject",this.onTrigger.bind(this));break;case"autoload":if(n[0].delay){const t=(0,T.A)();a.setAttribute("data-pat-inject-uuid",t);const i=t=>{const n=document.querySelector(`[data-pat-inject-uuid="${t}"]`);return!!n&&(e.data("pat-inject-autoloaded",!0),this.onTrigger({currentTarget:a}),n.removeAttribute("data-pat-inject-uuid"),!0)};window.setTimeout(i.bind(null,t),n[0].delay)}else this.onTrigger({currentTarget:a});break;case"autoload-visible":this._initAutoloadVisible(e,n);break;case"idle":this._initIdleTrigger(e,n[0].delay)}return O.debug("initialised:",a),e},destroy(e){return e.off(".pat-inject"),e.data("pat-inject",null),e},onTrigger(e){e.preventDefault&&e.preventDefault();const t=e.currentTarget,a=d()(t);let n=a.data("pat-inject");if("FORM"===t.nodeName&&"submit"===e.type){const i=t,o=e.submitter;if(!o?.matches("[formnovalidate]")&&!i.matches("[novalidate]")&&i.matches(":invalid"))return void O.debug("Form is invalid, aborting");const r=o?.getAttribute("formaction");if(r){const e={url:r},t=o.closest("[data-pat-inject]");n=this.extractConfig(d()(t),e)}for(const e of n)e.params=d().param(a.serializeArray())}a.trigger("patterns-inject-triggered"),this.execute(n,a)},submitSubform(e){const t=d()(e[0].closest("form")),a=e.data("pat-inject");for(const t of a)t.params=d().param(e.serializeArray());try{t.trigger("patterns-inject-triggered")}catch(e){O.error("patterns-inject-triggered",e)}this.execute(a,t)},extractConfig(e,t={}){const a=l.A.jqToNode(e);t=Object.assign({},t);const n=S.parse(e,t,!0);for(const i of n){i.$context=e,i.url=t.url||i.url||a?.getAttribute("href")||a?.getAttribute("action")||a?.closest("form")?.getAttribute("action")||"";const n=i.url.split("#");if(i.url=n[0],n.length>2&&O.warn("Ignoring additional source ids:",n.slice(2)),i.defaultSelector||(i.defaultSelector=n[1]&&"#"+n[1]||"body"),i.delay)try{i.delay=l.A.parseTime(i.delay)}catch{O.warn("Invalid delay value: ",i.delay),i.delay=null}i.processDelay=0}return n},elementIsDirty(e){const t=d().map(e.find(":input:not(select)"),e=>{const t=d()(e).val();return Boolean(t)&&t!==d()(e).attr("placeholder")});return-1!==d().inArray(!0,t)},askForConfirmation(e){let t,a=!1;for(const n of e){let e=!1;"always"==n.confirm?e=!0:"form-data"===n.confirm&&n.target&&"none"!==n.target?e=this.elementIsDirty(n.$target):"class"===n.confirm&&n.target&&"none"!==n.target&&(e=n.$target.hasClass("is-dirty")),e&&(a=!0,t=n.confirmMessage)}return!(a&&!window.confirm(t))},ensureTarget(e){if("none"===e.target)return!0;if(e.$target=e.$target||("self"===e.target?e.$context:d()(e.target)),0===e.$target.length){if(!e.target)return O.error("Need target selector",e),!1;e.$target=this.createTarget(e.target),e.$created_target=e.$target}return!0},verifySingleConfig(e,t){return t.url!==e?(O.error("Unsupported different urls for multi-inject"),!1):(t.source=t.source||t.defaultSelector,t.target=t.target||t.defaultSelector,!!this.extractModifiers(t)&&(!!this.ensureTarget(t)&&(this.listenForFormReset(t),!0)))},verifyConfig(e){return e.every(t=>this.verifySingleConfig(e[0].url,t))},listenForFormReset(e){if("none"===e.target)return;const t=e.$target.parents("form");0!==t.length&&void 0===e.$target.data("initial-value")&&(e.$target.data("initial-value",e.$target.html()),t.on("reset",()=>{e.$target.html(e.$target.data("initial-value"))}))},extractModifiers(e){const t=/^(.*?)(::element)?$/.exec(e.source),a=/^(.*?)(::element)?(::after|::before)?$/.exec(e.target);e.source=t[1],e.sourceMod=t[2]?"element":"content",e.target=a[1];const n=a[2]?"element":"content",i=(a[3]||"::").slice(2);return e.loadingClass&&(e.loadingClass+=" "+e.loadingClass+"-"+n,i&&e.loadingClass&&(e.loadingClass+=" "+e.loadingClass+"-"+i)),e.action=n+i,!0},createTarget(e){if("#"!==e.slice(0,1))return O.error("only id supported for non-existing target"),null;const t=d()("<div />").attr({id:e.slice(1)});return d()("body").append(t),t},_performInjection(e,t,a,n,i,o){const r=document.createElement("template");if(a.length>0){const e="content"===n.sourceMod?"innerHTML":"outerHTML",t=[...a].map(t=>t[e]).join("\n");r.innerHTML=t;for(const e of r.content.querySelectorAll("img"))s.A.add_event_listener(e,"load","inject_img_load",e=>{d()(e.currentTarget).trigger("pat-inject-content-loaded")},{once:!0})}const l=[...r.content.childNodes];this._inject(i,l,e,n)&&(this._update_history(n,i,o),this._afterInjection(t,n.$created_target||d()(l),n))},_update_history(e,t,a){if("record"!==e.history||!history?.pushState)return;let n=e.url;if(e.params){const t=n.indexOf("?")>-1?"&":"?";n=`${n}${t}${e.params}`}if(history.pushState({url:n},"",n),a?.length){const e=document.querySelector("title");e&&this._inject(t,a,e,{action:"element"})}},_afterInjection(e,t,a){const n=l.A.jqToNode(e);if(t.filter((e,t)=>3!==t.nodeType).data("pat-injected",{origin:a.url}),1===t.length&&3==t[0].nodeType?t.parent().trigger("patterns-injected",[a,n,t[0]]):t.each((e,t)=>{3!==t.nodeType&&d()(t).addClass(a.class).trigger("patterns-injected",[a,n,t])}),a.scroll&&"none"!==a.scroll){const e=["top","target"].includes(a.scroll)?a.$target[0]:r.A.querySelectorAllAndMe(t[0],a.scroll),n=r.A.find_scroll_container(e,null,window);"top"===a.scroll?r.A.scroll_to_top(n):e&&r.A.scroll_to_element(e,n)}n.dispatchEvent(new Event("pat-inject-success",{bubbles:!0,cancelable:!0}))},async _onInjectSuccess(e,t,a){let n=a?.jqxhr?.responseText;if(!n)return void O.warn("No response content, aborting",a);"none"===t[0].source&&(n="");const i=await this.callTypeHandler(t[0].dataType,"sources",e,[t,n,a]);let o;i&&i[i.length-1]&&i[i.length-1][0]&&"TITLE"===i[i.length-1][0].nodeName&&(o=i[i.length-1]),t.forEach((t,n)=>{const r=()=>{if("none"!==t.target)for(const r of t.$target)this._performInjection(r,e,i[n],t,a.target,o)};t.processDelay?setTimeout(()=>r(),t.processDelay):r()}),t[0].nextHref&&e.is("a")&&(e.attr({href:t[0].nextHref.replace(/&amp;/g,"&")}),this.destroy(e)),e.off("pat-ajax-success.pat-inject"),e.off("pat-ajax-error.pat-inject")},async _onInjectError(e,t,a){let i="";const o=a.jqxhr.status,r=new Date;let s,l;o%100==4?i="Sorry! We couldn't find the page to load. Please make a screenshot and send it to support. Thank you!":o%100==5?i="I am very sorry! There was an error at the server. Please make a screenshot and contact support. Thank you!":0==o&&(i="It seems, the server is down. Please make a screenshot and contact support. Thank you!");if(null===new URLSearchParams(window.location.search).get("pat-inject-errorhandler.off")){const e=document?.querySelector(`meta[name^=pat-inject-status-${o}]`)?.getAttribute("content",!1);if(l=e?.split("#")[1],l=l?`#${l}`:null,l&&(s=document.createElement("html"),s.innerHTML=a.jqxhr.responseText,s=s.querySelector(l)),!s&&e)try{const t=await fetch(e,{method:"GET"});s=document.createElement("html"),s.innerHTML=await t.text(),s=s.querySelector(l||"body")}catch{}}for(const a of t)"$created_target"in a&&a.$created_target.remove(),a.$target.removeClass(a.loadingClass),e.removeClass(a.executingClass);if(e.off("pat-ajax-success.pat-inject"),e.off("pat-ajax-error.pat-inject"),s){const e=document.querySelector(l||"body");e.innerHTML=s.innerHTML,n.A.scan(e)}else{const e=`${i} Status is ${o} ${a.jqxhr.statusText}, time was ${r}. You can click to close this.`;d()("body").attr("data-error-message",e),d()("body").on("click",()=>{d()("body").removeAttr("data-error-message"),window.location.href=window.location.href})}},execute(e,t){const a=l.A.jqToNode(t);if(e=e.map(e=>d().extend({},e)),!this.verifyConfig(e))return;if(!this.askForConfirmation(e))return;if(t.data("pat-inject-triggered"))return;t.data("pat-inject-triggered",!0);for(const t of e)t?.executingClass&&a.classList.add(t.executingClass),t?.loadingClass&&"none"!==t?.target&&t.$target.addClass(t.loadingClass);t.on("pat-ajax-success.pat-inject",async i=>{this._onInjectSuccess(t,e,i),await l.A.timeout(1),s.A.remove_event_listener(a,"pat-inject--close-panel"),n&&(n=!1,a.dispatchEvent(new Event("close-panel",{bubbles:!0,cancelable:!0})))}),t.on("pat-ajax-error.pat-inject",this._onInjectError.bind(this,t,e)),t.on("pat-ajax-success.pat-inject pat-ajax-error.pat-inject",()=>t.removeData("pat-inject-triggered"));let n=!1;s.A.add_event_listener(a,"close-panel","pat-inject--close-panel",e=>{e.stopPropagation(),e.stopImmediatePropagation(),n=!0}),e[0].url.length?k.A.request(t,{url:e[0].url,"browser-cache":e[0].browserCache}):t.trigger({type:"pat-ajax-success",jqxhr:{responseText:d()("body").html()}})},_inject(e,t,a,n){if("none"===n.source)return a.replaceWith(""),!0;if(0===t.length)return O.warn("Aborting injection, source not found:",t),d()(e).trigger("pat-inject-missingSource",{url:n.url,selector:n.source}),!1;if("none"===n.target)return!0;if(!a)return O.warn("Aborting injection, target not found:",a),d()(e).trigger("pat-inject-missingTarget",{selector:n.target}),!1;return a[{content:"replaceChildren",contentafter:"append",contentbefore:"prepend",element:"replaceWith",elementafter:"after",elementbefore:"before"}[n.action]](...t),!0},_sourcesFromHtml(e,t,a){const n=this._parseRawHtml(e,t);return a.map(e=>{if("body"===e&&(e="#__original_body"),"none"===e)return d()("\x3c!-- --\x3e");const a=n.find(e);return 0===a.length&&"title"!=e&&O.warn("No source elements for selector:",e,n),a.find('a[href^="#"]').each((e,n)=>{const i=n.getAttribute("href");-1===i.indexOf("#{1}")&&(1===i.length?n.href=t:a.find(i).length||(n.href=t+i))}),a})},_rebaseAttrs:{a:"href",form:"action",img:"src",object:"data",source:"src",video:"src"},_rebaseOptions:{calendar:["url","event-sources"],collapsible:["load-content"],"date-picker":["i18n"],"datetime-picker":["i18n"],inject:["url"]},_rebaseURL(e,t){return-1!==t.indexOf("://")||"/"===t[0]||0===t.indexOf("data:")?t:(e=new URL(e,window.location).href).slice(0,e.lastIndexOf("/")+1)+t},_rebaseHTML(e,t){if(""===t)return"";const a=document.createElement("div");a.innerHTML=t;const i=Object.entries(this._rebaseAttrs).map(([e,t])=>`${e}[${t}]`).join(", ");for(const t of a.querySelectorAll(i)){const a=this._rebaseAttrs[t.nodeName.toLowerCase()];let n=t.getAttribute(a);n&&"@@"!==n.slice(0,2)&&"#"!==n[0]&&"mailto:"!==n.slice(0,7)&&"tel:"!==n.slice(0,4)&&"fax:"!==n.slice(0,4)&&"callto:"!==n.slice(0,7)&&"ts3server:"!==n.slice(0,10)&&"teams:"!==n.slice(0,6)&&"javascript:"!==n.slice(0,11)&&(n=this._rebaseURL(e,n),t.setAttribute(a,n))}for(const[t,i]of Object.entries(this._rebaseOptions))for(const o of r.A.querySelectorAllAndMe(a,`[data-pat-${t}]`)){const a=n.A.patterns?.[t],r=a?.parser;if(!r)continue;const s=r.parse(o,{},!0,!1,!1);let l=!1;for(const t of s)for(const a of i){const n=t[a];n&&(l=!0,Array.isArray(n)?t[a]=n.map(t=>this._rebaseURL(e,t)):t[a]=this._rebaseURL(e,n))}l&&o.setAttribute(`data-pat-${t}`,JSON.stringify(1===s.length?s[0]:s))}return a.innerHTML.trim()},_parseRawHtml(e,t=""){const a=e.match(/\<title\>(.*)\<\/title\>/);let n=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/<head\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/head>/gi,"").replace(/<html([^>]*?)>/gi,"").replace(/<\/html([^>]*?)>/gi,"").replace(/<body([^>]*?)>/gi,'<div id="__original_body">').replace(/<\/body([^>]*?)>/gi,"</div>");a&&2==a.length&&(n=a[0]+n);try{n=this._rebaseHTML(t,n)}catch(e){O.error("Error rebasing urls",e)}const i=d()("<div/>").html(n);return 0===i.children().length&&O.warn("Parsing html resulted in empty jquery object:",n),i},_initAutoloadVisible(e,t){if(e.data("pat-inject-autoloaded"))return!1;const a=l.A.jqToNode(e),n=t[0].delay||200;O.debug(`Delay time: ${n}`);const i=t=>e.data("pat-inject-autoloaded")?(O.debug(`autoload-visible trigger skipped ${a}`),!1):(e.data("pat-inject-autoloaded",!0),this.onTrigger({currentTarget:a}),t&&t.preventDefault(),O.debug(`autoload-visible trigger run ${a}`),!0);let o=null;const r=new IntersectionObserver(e=>{for(const t of e)t.isIntersecting?(o=window.setTimeout(()=>{r.disconnect(),i()},n),O.debug(`autoload-visible intersecting ${a}`)):(window.clearTimeout(o),O.debug(`autoload-visible not intersecting ${a}`))},{threshold:0,root:null,margin:"0px"});r.observe(a)},_initIdleTrigger(e,t){const a=parseInt(t,10);let n;const i=l.A.jqToNode(e),o=()=>{this.onTrigger({currentTarget:i}),s(),clearTimeout(n)},r=l.A.debounce(()=>{document.body.contains(i)?(clearTimeout(n),n=setTimeout(o,a)):s()},a),s=()=>{for(const e of["scroll","resize"])window.removeEventListener(e,r);for(const e of["click","keypress","keyup","mousemove","touchstart","touchend"])document.removeEventListener(e,r)};r();for(const e of["scroll","resize"])window.addEventListener(e,r);for(const e of["click","keypress","keyup","mousemove","touchstart","touchend"])document.addEventListener(e,r)},registerTypeHandler(e,t){this.handlers[e]=t},async callTypeHandler(e,t,a,n){return e=e||"html",this.handlers[e]&&d().isFunction(this.handlers[e][t])?await this.handlers[e][t].bind(this)(...n):null},handlers:{html:{sources(e,t){const a=e.map(e=>e.source);a.push("title");return this._sourcesFromHtml(t,e[0].url,a)}}}};if(d()(document).on("patterns-injected.inject",async(e,t,a,i)=>{t?.skipPatInjectHandler||(t&&(t.$target.removeClass(t.loadingClass),d()(a).removeClass(t.executingClass).addClass(t.executedClass)),3!==i.nodeType&&8!==i.nodeType&&(n.A.scan(i,null,{type:"injection",element:a}),d()(i).trigger("patterns-injected-scanned"),await l.A.timeout(10),i.dispatchEvent(new CustomEvent("patterns-injected-delayed",{bubbles:!0,cancelable:!0,detail:{injected:i}}))))}),d()(window).on("popstate",e=>{if(e.originalEvent.state||!("replaceState"in history))window.location.reload();else try{history.replaceState("anchor","",document.location.href)}catch(e){O.debug(e)}}),"replaceState"in history)try{history.replaceState("pageload","",document.location.href)}catch(e){O.debug(e)}n.A.register(D);const E=f.A.getLogger("depends"),C=new o.A("depends");C.addArgument("condition"),C.addArgument("action","show",["show","enable","both"]),C.addArgument("transition","none",["none","css","fade","slide"]),C.addArgument("effect-duration","fast"),C.addArgument("effect-easing","swing");const N=(e={})=>new CustomEvent("input",{bubbles:!0,cancelable:!1,detail:e});class I extends m.m{static name="depends";static trigger=".pat-depends";static parser=C;async init(){this.$el=d()(this.el);const e=(await a.e(99093).then(a.bind(a,99093))).default;try{this.handler=new e(this.el,this.options.condition)}catch(e){return void E.error("Invalid condition: "+e.message,this.el)}this.set_state();for(const e of this.handler.getAllInputs())s.A.add_event_listener(e,"input",`pat-depends--input--${this.uuid}`,e=>{e?.detail?.pattern_uuid!==this.uuid&&this.set_state()}),e.form&&s.A.add_event_listener(e.form,"reset",`pat-depends--reset--${this.uuid}`,async()=>{await l.A.timeout(50),this.set_state.bind(this)})}update_modal(){this.el.closest(".pat-modal")&&d()(document).trigger("pat-update",{pattern:"depends"})}enable(){const e=r.A.find_inputs(this.el);for(const t of e)!1!==t.disabled&&(t.disabled=!1,t!==this.el&&(r.A.is_button(t)||t.dispatchEvent(N({pattern_uuid:this.uuid}))));"A"===this.el.tagName&&s.A.remove_event_listener(this.el,"pat-depends--click"),this.el.classList.remove("disabled"),this.$el.trigger("pat-update",{pattern:"depends",action:"attribute-changed",dom:this.el,enabled:!0})}disable(){const e=r.A.find_inputs(this.el);for(const t of e)!0!==t.disabled&&(t.disabled=!0,t!==this.el&&(r.A.is_button(t)||t.dispatchEvent(N({pattern_uuid:this.uuid}))));"A"===this.el.tagName&&s.A.add_event_listener(this.el,"click","pat-depends--click",e=>e.preventDefault()),this.el.classList.add("disabled"),this.$el.trigger("pat-update",{pattern:"depends",action:"attribute-changed",dom:this.el,enabled:!1})}set_state(){const e=this.handler.evaluate();switch(this.options.action){case"show":l.A.hideOrShow(this.el,e,this.options,this.name),this.update_modal();break;case"enable":e?this.enable():this.disable();break;case"both":l.A.hideOrShow(this.el,e,this.options,this.name),this.update_modal(),e?this.enable():this.disable()}}}n.A.register(I);a(10906),a(65364);class M extends m.m{static name="pat-base-url";static trigger="body";init(){s.A.add_event_listener(window.navigation,"navigate","thet-base-url--set",this.set_base_url.bind(this))}set_base_url(){let e=window.location.href;e=["/@@","/++","/folder_contents","/edit","/view","#","?"].reduce((e,t)=>e.split(t)[0],e),"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),document.body.dataset.baseUrl=e}}n.A.register(M);var j=a(59994),z=a(40705),P=a.n(z);const L=f.A.getLogger("pat-contentloader");i.A.extend({name:"contentloader",trigger:".pat-contentloader",parser:"mockup",defaults:{url:null,content:null,trigger:"click",target:null,template:null,dataType:"html"},init:function(){var e=this;"el"===e.options.url&&"A"===e.$el[0].tagName&&(e.options.url=e.$el.attr("href")),e.$el.removeClass("loading-content"),e.$el.removeClass("content-load-error"),"immediate"===e.options.trigger?e._load():e.$el.on(e.options.trigger,function(t){t.preventDefault(),e._load()})},_load:function(){var e=this;e.$el.addClass("loading-content"),e.options.url?e.loadRemote():e.loadLocal()},loadRemote:function(){var e=this;d().ajax({url:e.options.url,dataType:e.options.dataType,success:function(t){var a;if("html"===e.options.dataType)-1!==t.indexOf("<html")&&(t=j.A.parseBodyTag(t)),a=d()("<div>"+t+"</div>");else if(-1!==e.options.dataType.indexOf("json")){t.constructor===Array&&1===t.length&&(t=t[0]);try{a=d()(P().template(e.options.template)(t))}catch{return e.$el.removeClass("loading-content"),e.$el.addClass("content-load-error"),void L.warn("error rendering template. pat-contentloader will not work")}}null!==e.options.content&&(a=a.find(e.options.content)),e.loadLocal(a)},error:function(){e.$el.removeClass("loading-content"),e.$el.addClass("content-load-error")}})},loadLocal:function(e){var t=this;if(!e&&null===t.options.content)return t.$el.removeClass("loading-content"),t.$el.addClass("content-load-error"),void L.warn("No selector configured");var a=t.$el;if(null!==t.options.target&&0===(a=d()(t.options.target)).length)return t.$el.removeClass("loading-content"),t.$el.addClass("content-load-error"),void L.warn("No target nodes found");e||(e=d()(t.options.content).clone()),e.length?(e.show(),a.replaceWith(e),n.A.scan(e)):a.empty(),t.$el.removeClass("loading-content"),t.emit("loading-done")}}),a(306),i.A.extend({name:"cookietrigger",trigger:".pat-cookietrigger",parser:"mockup",isCookiesEnabled:function(){var e="areYourCookiesEnabled=0";document.cookie=e;var t=document.cookie;return-1===t.indexOf(e)?0:(e="areYourCookiesEnabled=1",document.cookie=e,-1===(t=document.cookie).indexOf(e)?0:(document.cookie="areYourCookiesEnabled=; expires=Thu, 01-Jan-70 00:00:01 GMT",1))},showIfCookiesDisabled:function(){this.isCookiesEnabled()?r.A.hide(this.el):r.A.show(this.el)},init:function(){this.showIfCookiesDisabled()}}),a(33982),i.A.extend({name:"formautofocus",trigger:".pat-formautofocus",parser:"mockup",defaults:{condition:"div.error",target:"div.error :input:not(.formTabs):visible:first",always:":input:not(.formTabs):visible:first"},init(){0!==d()(this.options.condition,this.$el).length?d()(this.options.target,this.$el).focus():d()(this.options.always,this.$el).focus()}});var U=a(20681),R=(i.A.extend({name:"formunloadalert",trigger:".pat-formunloadalert",parser:"mockup",_changed:!1,_suppressed:!1,defaults:{message:(0,U.Ay)("Discard changes? If you click OK, any changes you have made will be lost."),changingEvents:"change keyup paste",changingFields:"input,select,textarea,fileupload"},init(){var e=this;if(e.$el.is("form")){d()(e.options.changingFields,e.$el).on(e.options.changingEvents,()=>{e._changed=!0});var t=e.$el.parents(".plone-modal");0!==t.length?t.on("hide",function(a){var n=t.data("patternPloneModal");n&&(n._suppressHide=e._handleUnload.call(e,a))}):d()(window).on("beforeunload",t=>e._handleUnload(t)),e.$el.on("submit",()=>{e._suppressed=!0})}},_handleUnload(e){var t=this;if(t._suppressed)t._suppressed=!1;else if(t._changed){var a=t.options.message;return t._handleMsg(e,a),d()(window).trigger("messageset"),a}},_handleMsg(e,t){(e||window.event).returnValue=t}}),i.A.extend({name:"livesearch",trigger:".pat-livesearch",parser:"mockup",timeout:null,active:!1,results:null,selectedItem:-1,resultsClass:"livesearch-results list-group d-none",defaults:{ajaxUrl:null,defaultSortOn:"",perPage:7,quietMillis:350,timeoutHide:200,minimumInputLength:4,inputSelector:'input[type="text"]',itemTemplate:'<li class="search-result <%- state %> list-group-item list-group-item-action"><a class="text-reset text-decoration-none" href="<%- url %>"><div class="row"><div class="col info"><div class="heading"><%- title %></div><div class="description"><%- description %></div></div><% if (img_tag) { %> <div class="col img"><%= img_tag %></div><% } %> </div></a></li>'},doSearch:function(e){var t=this;t.active=!0,t.render(),t.$el.addClass("searching");var a=t.$el.serialize();void 0===e&&(e=1);var n=function(){var e=location.search,a=e.indexOf("sort_on");if(-1===a){var n=d()("#search-results");return n.length>0?n.attr("data-default-sort"):t.options.defaultSortOn}var i=e.substring(a);return i=(i=i.split("&")[0]).split("=")[1]}();d().ajax({url:t.options.ajaxUrl+"?"+a+"&page="+e+"&perPage="+t.options.perPage+"&sort_on="+n,dataType:"json"}).done(function(n){t.results=n,t.page=e,a!==t.$el.serialize()&&t.doSearch()}).fail(function(){t.results={items:[{url:"",title:(0,U.Ay)("Error"),description:(0,U.Ay)("There was an error searching…"),state:"error",error:!1}],total:1},t.page=1}).always(function(){t.active=!1,t.selectedItem=-1,t.$el.removeClass("searching"),t.render()})},render:function(){var e=this;if(e.$results.empty(),e.active?e.$results.append(d()('<li class="searching list-group-item">'+(0,U.Ay)("searching…")+"</li>")):null===e.results?e.$results.append(d()('<li class="no-results no-search list-group-item">'+(0,U.Ay)("enter search phrase")+"</li>")):0===e.results.total?e.$results.append(d()('<li class="no-results list-group-item">'+(0,U.Ay)("no results found")+"</li>")):e.$results.append(d()('<li class="results-summary list-group-item">'+(0,U.Ay)("found")+" "+e.results.total+" "+(0,U.Ay)("results")+"</li>")),null!==e.results){var t=P().template(e.options.itemTemplate);P().each(e.results.items,function(a,n){var i=d()(t(d().extend({_t:U.Ay},a)));i.attr("data-url",a.url).on("click",function(){a.error||(window.location=a.url)}),n===e.selectedItem&&i.addClass("active"),e.$results.append(i)});var a={};if(e.page>1){var n=d()('<a href="#" class="prev position-absolute ps-3 start-0">'+(0,U.Ay)("Previous")+"</a>");n.on("click",function(t){e.disableHiding=!0,t.preventDefault(),e.doSearch(e.page-1)}),a.prev=n}if(e.page*e.options.perPage<e.results.total){var i=d()('<a href="#" class="next position-absolute pe-3 end-0">'+(0,U.Ay)("Next")+"</a>");i.on("click",function(t){e.disableHiding=!0,t.preventDefault(),e.doSearch(e.page+1)}),a.next=i}if(a.next||a.prev){var o=d()('<li class="list-group-item load-more d-flex justify-content-center"><span class="page">'+e.page+"</span></li>");a.prev&&o.prepend(a.prev),a.next&&o.append(a.next),e.$results.append(o)}}e.show()},show:function(){this.$results[0].classList.remove("d-none"),this.$el[0].classList.add("livesearch-active")},hide:function(){this.$el[0].classList.remove("livesearch-active"),this.$results[0].classList.add("d-none")},init:function(){var e=this;e.$input=e.$el.find(e.options.inputSelector),e.$input.off("focusout").on("focusout",function(){setTimeout(function(){e.disableHiding?(e.disableHiding=!1,e.$input.focus()):e.hide()},e.options.timeoutHide)}).off("focusin").on("focusin",function(){e.onceFocused?r.A.is_visible(e.$results[0])||e.render():(e.onceFocused=!0,e.$input.val().length>=e.options.minimumInputLength&&e.doSearch())}).attr("autocomplete","off").off("keyup").on("keyup",function(t){var a=t.keyCode||t.which;if(27===a)return e.$input.val(""),void e.hide();if(e.results&&e.results.items&&e.results.items.length>0){if(13===a)return void(-1!==e.selectedItem&&(window.location=e.results.items[e.selectedItem].url));if(38===a)return void(-1!==e.selectedItem&&(e.selectedItem-=1,e.render()));if(40===a)return void(e.selectedItem<e.results.items.length&&(e.selectedItem+=1,e.render()))}null!==e.timeout&&(clearTimeout(e.timeout),e.timeout=null),e.active||(e.$input.val().length>=e.options.minimumInputLength?e.timeout=setTimeout(function(){e.doSearch()},e.options.quietMillis):(e.results=null,e.render()))}),d()("#sorting-options a").on("click",function(t){t.preventDefault(),e.onceFocused=!1}),e.$results=d()('<ul class="'+e.resultsClass+'"></ul>').insertAfter(e.$el)}}),i.A.extend({name:"markspeciallinks",trigger:".pat-markspeciallinks",parser:"mockup",defaults:{external_links_open_new_window:!1,mark_special_links:!0},protocol_icon_map:{https:"link-45deg",http:"link-45deg",ftp:"cloud-download",callto:"telephone",bitcoin:"credit-card",geo:"geo-alt",im:"chat",irc:"chat",ircs:"chat",magnet:"link-45deg",mailto:"envelope",mms:"chat",news:"newspaper",nntp:"newspaper",openpgp4fpr:"key",sip:"telephone",sms:"chat",smsto:"chat",ssh:"lock",tel:"telephone",urn:"link-45deg",webcal:"calendar",wtai:"telephone",xmpp:"chat"},async init(){let e=!1;"string"==typeof this.options.external_links_open_new_window?e="true"===this.options.external_links_open_new_window.toLowerCase():"boolean"==typeof this.options.external_links_open_new_window&&(e=this.options.external_links_open_new_window);let t=!1;"string"==typeof this.options.mark_special_links?t="true"===this.options.mark_special_links.toLowerCase():"boolean"==typeof this.options.mark_special_links&&(t=this.options.mark_special_links),t&&a.e(62054).then(a.bind(a,62054));const n=window.location.protocol+"//"+window.location.host,i=this.el.querySelectorAll(`a[href]:not(.link-plain):not([href^="${n}"]):not([href^="#"])`);for(const a of i){let n;try{n=new URL(a.getAttribute("href"))}catch{continue}if(e&&n.protocol.startsWith("http")&&(a.setAttribute("target","_blank"),a.setAttribute("rel","noopener")),t){const e=this.protocol_icon_map[n.protocol.split(":")[0]];if(e){const t=await j.A.resolveIcon(e),n=r.A.create_from_string(t);n.querySelector("svg").classList.add("markspeciallinks__icon"),a.parentNode.insertBefore(n,a)}}}}}),a(53902));const F=new o.A("navigationmarker");F.addArgument("portal-url",void 0),F.addArgument("parent-selector",void 0);class q extends m.m{static name="navigationmarker";static trigger=".pat-navigationmarker";static parser=F;async init(){this.portal_url=this.options.portalUrl||document.body.dataset.portalUrl,s.A.add_event_listener(window.navigation,"navigate","pat-navigationmarker--history-changed",()=>{this.scan_navigation()}),this.scan_navigation()}scan_navigation(){const e=window.location.href,t=this.el.querySelectorAll("a");for(const a of t){const t=this.options.parentSelector?a.closest(this.options.parentSelector):a.parentElement,n=a.href.replace("/view","");if(-1===e.indexOf(n)){this.clear(t),this.clear(a);continue}const i=e.split("/"),o=n.split("/");let r=!1;o[o.length-1]===i[o.length-1]&&(r=!0),n===this.portal_url&&e!==this.portal_url&&(r=!1),r&&(t.classList.add("inPath"),"DETAILS"===t.tagName&&(t.open=!0)),e===n&&(t.classList.add("current"),a.classList.add("current"))}this.el.dispatchEvent(s.A.generic_event(`${this.name}.scanned`))}clear(e){e.classList.contains("inPath")&&e.classList.remove("inPath"),e.classList.contains("current")&&e.classList.remove("current"),"DETAILS"===e.tagName&&(e.open=!1)}}n.A.register(q);i.A.extend({name:"passwordstrength",trigger:".pat-passwordstrength",parser:"mockup",defaults:{zxcvbn:"//cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"},init:function(){var e,t,a=this.el,n=(e='<div class="progress my-3"><div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div></div>',t=document.createElement("div"),e=e.trim(),t.innerHTML=e,t.firstElementChild),i=n.firstChild,o={0:"bg-transparent",1:"bg-danger",2:"bg-warning",3:"bg-warning",4:"bg-success"};function r(){var e=0;a.value.length>0&&(e=Math.max(1,window.zxcvbn(a.value,[].map.call((a.form||{elements:[]}).elements,function(e){return e===a?null:e.value||null}).filter(function(e){return e})).score));var t="";0!=e&&(t=" w-"+25*e),i.className="progress-bar"+t+" "+o[e],i.setAttribute("aria-valuenow",25*e)}a.parentNode.insertBefore(n,a.nextSibling),a.onkeyup=function(){r()},"function"!=typeof window.zxcvbn&&function(e){var t,a,n,i=document.getElementsByTagName("script");for(a=0;a<i.length;a++)if(-1!==i[a].src.indexOf(e))return;(t=document.createElement("script")).type="text/javascript",t.async=!0,t.src=e,(n=document.getElementsByTagName("head")[0]).insertBefore(t,n.firstChild)}(this.options.zxcvbn),r()}}),i.A.extend({name:"preventdoublesubmit",trigger:".pat-preventdoublesubmit",parser:"mockup",defaults:{message:(0,U.Ay)("You already clicked the submit button. Do you really want to submit this form again?"),guardClassName:"submitting",optOutClassName:"allowMultiSubmit"},init(){var e=this;e.$el.is("form")&&d()(":submit",e.$el).on("click",function(){if(d()(":submit").removeAttr("clicked"),d()(this).attr("clicked","clicked"),d()(this).hasClass(e.options.guardClassName)&&!d()(this).hasClass(e.options.optOutClassName))return e._confirm.call(e);d()(this).addClass(e.options.guardClassName)})},_confirm(){return window.confirm(this.options.message)}});const H=f.A.getLogger("pat-manage-portlets");i.A.extend({name:"manage-portlets",trigger:".pat-manage-portlets",parser:"mockup",messageTimeout:0,submitTimeout:0,switchTimeout:0,isModal:!1,dirty:!1,init:async function(){(await Promise.resolve().then(a.t.bind(a,51428,23))).default;var e=this,t=e.$el.parents(".plone-modal");if(1===t.length){this.isModal=!0;var n=t.data("pattern-plone-modal");n.on("hide",function(){e.dirty&&window.location.reload()}),e.loading=n.loading}else e.loading=j.A.loading;e.bind()},bind:function(){var e=this;e.setupAddDropdown(),e.setupSwitchPortletManager(),e.setupSavePortletsSettings(),e.setupPortletEdit(),e.isModal&&d()(".portlets-link-to-parent").off("click").on("click",function(t){e.loading.show();var a=d()(this);t.preventDefault(),d().ajax({url:a.attr("href"),data:{ajax_load:1}}).done(function(t){var n=d()(j.A.parseBodyTag(t)),i=a.parents(".plone-modal-body");i.empty();var o=d()("#content",n),r=d()("h1",o);d()(".plone-modal-header",i.parent()).find("h2").html(r.html()),r.remove(),i.append(o),e.rebind(d()(".pat-manage-portlets",o),!0),e.loading.hide()})})},rebind:function(e,t){H.info("rebind"),d().contains(document,this.$el[0])&&this.$el.replaceWith(e),this.$el=e,this.bind(),t||this.statusMessage(),this.dirty=!0},statusMessage:function(e){void 0===e&&(e=(0,U.Ay)("Portlet changes saved"));var t=this,a=d()("#portlet-message");0===a.length&&(a=d()('<div class="alert alert-info" role="alert" id="portlet-message" style="opacity: 0"></div>'),t.isModal?d()(".plone-modal-body:visible").prepend(a):d()("#content-core").prepend(a)),a.html('<strong class="mr-1">'+(0,U.Ay)("Info")+"</strong>"+e),clearTimeout(t.messageTimeout),a.fadeTo(500,1),t.messageTimeout=window.setTimeout(function(){a.fadeTo(500,.6)},3e3)},showEditPortlet:function(e){H.info("show edit portlet in modal");var t=this,a=d()("<a/>");d()("body").append(a);var n=new R.A(a,{ajaxUrl:e,actionOptions:{displayInModal:!1,reloadWindowOnClose:!1,isForm:!0,onSuccess:function(e,a){n.hide();var i=d()(j.A.parseBodyTag(a));t.rebind(d()("#"+t.$el.attr("id"),i).eq(0)),t.statusMessage((0,U.Ay)("Portlet added"))}}});n.on("after-render",function(){var e=d()("#"+t.$el.attr("id"),n.$raw);1===e.length&&(e=e.clone(),n.on("shown",function(){n.hide()}),t.rebind(e),t.statusMessage((0,U.Ay)("Portlet added")))}),n.show()},setupPortletEdit:function(){var e=this;d()(".managedPortlet .portletHeader > a",e.$el).on("click",function(t){t.preventDefault(),e.showEditPortlet(d()(this).attr("href"))})},setupAddDropdown:function(){var e=this;d()(".add-portlet",e.$el).on("change",function(t){t.preventDefault();var a=d()(this),n=a.parents("form"),i=a.attr("data-context-url")+a.val()+"?_authenticator="+d()('[name="_authenticator"]').val()+"&referer="+d()('[name="referer"]',n).val();e.showEditPortlet(i)})},setupSavePortletsSettings:function(){var e=this;d()(".portlets-settings, form.portlet-action",e.$el).ajaxForm({beforeSubmit:function(){e.loading.show()},success:function(t){e.loading.hide(),H.info("form submit");var a=d()(j.A.parseBodyTag(t));e.rebind(d()("#"+e.$el.attr("id"),a).eq(0))}}),d()(".portlets-settings select",e.$el).on("change",function(){H.info("select change"),clearTimeout(e.submitTimeout),e.submitTimeout=window.setTimeout(function(){d()(".portlets-settings",e.$el).trigger("submit")},100)})},setupSwitchPortletManager:function(){var e=this;d()("#main-container").on("change",".switch-portlet-manager",function(t){t.stopImmediatePropagation(),H.info("switch portlet manager");var a=d()(this).val();clearTimeout(e.switchTimeout),e.switchTimeout=window.setTimeout(function(){e._reloadPortletManager(a)},100)}),d()(window).on("popstate",function(t){if(t.stopImmediatePropagation(),t&&void 0===t.state){var a=window.location.href;H.info("redirecting to: "+a),e._reloadPortletManager(a,!0)}})},_reloadPortletManager:function(e,t){var a=this;a.loading.show(),d().get(e,{ajax_load:1}).done(function(n){var i=d()(j.A.parseBodyTag(n));d()("#content").html(i),a.rebind(d()(".pat-manage-portlets",i),!0),t?window.history.replaceState(null,null,e):window.history.pushState(null,null,e),a.loading.hide()})}}),a(78278);var W=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g;function B(e,t){for(e=e.toString(),t=t||2;e.length<t;)e="0"+e;return e}function Y(e,t,a){var n=e.getDate(),i=e.getDay(),o=e.getMonth(),r=e.getFullYear(),s={d:n,dd:B(n),ddd:a.localization.shortWeekdays[i],dddd:a.localization.weekdays[i],m:o+1,mm:B(o+1),mmm:a.localization.shortMonths[o],mmmm:a.localization.months[o],yy:String(r).slice(2),yyyy:r};return t.replace(W,function(e){return Object.prototype.hasOwnProperty.call(s,e)?s[e]:e.slice(1,e.length-1)})}function V(e,t,a,n,i){var o,r,s,l,c,p,u,h,m,f,g,v=e.find("select[name=rirtemplate]").val(),y=n.rtemplate[v],b="RRULE:"+y.rrule,w=n.localization.rtemplate[v];for(const t of y.fields){const a=e.find(`#${t}`);switch(a.attr("id")){case"ridailyinterval":"1"!==(o=a.find("input[name=ridailyinterval]").val())&&(b+=`;INTERVAL=${o}`),w=`${o} ${n.localization.dailyInterval2}`;break;case"riweeklyinterval":"1"!==(o=a.find("input[name=riweeklyinterval]").val())&&(b+=`;INTERVAL=${o}`),w=`${o} ${n.localization.weeklyInterval2}`;break;case"riweeklyweekdays":p=[],u=[];for(let e=0;e<n.weekdays.length;e++)a.find(`input[name=riweeklyweekdays${e}]`).is(":checked")&&(p.push(n.weekdays[e]),u.push(n.localization.weekdays[e]));p.length>0&&(b+=`;BYDAY=${p.join(",")}`,w+=` ${n.localization.weeklyWeekdaysHuman} ${u.join(",")}`);break;case"rimonthlyinterval":"1"!==(o=a.find("input[name=rimonthlyinterval]").val())&&(b+=`;INTERVAL=${o}`),w=`${o} ${n.localization.monthlyInterval2}`;break;case"rimonthlyoptions":"DAYOFMONTH"===(h=d()("input[name=rimonthlytype]:checked",e).val())?(b+=`;BYMONTHDAY=${c=d()("select[name=rimonthlydayofmonthday]",e).val()}`,w+=`, ${n.localization.monthlyDayOfMonth1Human} ${c} ${n.localization.monthlyDayOfMonth2}`):"WEEKDAYOFMONTH"===h&&(m=d()("select[name=rimonthlyweekdayofmonthindex]",e).val(),c=n.weekdays[d()("select[name=rimonthlyweekdayofmonth]",e).val()],["MO","TU","WE","TH","FR","SA","SU"].includes(c)&&(b+=`;BYDAY=${m}${c}`,w+=`, ${n.localization.monthlyWeekdayOfMonth1Human} `,w+=`${n.localization.orderIndexes[n.orderIndexes.indexOf(m)]} ${n.localization.monthlyWeekdayOfMonth2} `,w+=`${n.localization.weekdays[n.weekdays.indexOf(c)]} ${n.localization.monthlyDayOfMonth2}`));break;case"riyearlyinterval":"1"!==(o=a.find("input[name=riyearlyinterval]").val())&&(b+=`;INTERVAL=${o}`),w=`${o} ${n.localization.yearlyInterval2}`;break;case"riyearlyoptions":r="","DAYOFMONTH"===(f=d()("input[name=riyearlyType]:checked",e).val())?(b+=`;BYMONTH=${r=d()("select[name=riyearlydayofmonthmonth]",e).val()};BYMONTHDAY=${c=d()("select[name=riyearlydayofmonthday]",e).val()}`,w+=`, ${n.localization.yearlyDayOfMonth1Human} ${n.localization.months[r-1]} ${c}`):"WEEKDAYOFMONTH"===f&&(m=d()("select[name=riyearlyweekdayofmonthindex]",e).val(),c=n.weekdays[d()("select[name=riyearlyweekdayofmonthday]",e).val()],b+=`;BYMONTH=${r=d()("select[name=riyearlyweekdayofmonthmonth]",e).val()}`,["MO","TU","WE","TH","FR","SA","SU"].includes(c)&&(b+=`;BYDAY=${m}${c}`,w+=", "+n.localization.yearlyWeekdayOfMonth1Human,w+=" "+n.localization.orderIndexes[d().inArray(m,n.orderIndexes)],w+=" "+n.localization.yearlyWeekdayOfMonth2,w+=" "+n.localization.weekdays[d().inArray(c,n.weekdays)],w+=" "+n.localization.yearlyWeekdayOfMonth3,w+=" "+n.localization.months[r-1],w+=" "+n.localization.yearlyWeekdayOfMonth4));break;case"rirangeoptions":if("BYOCCURRENCES"===(g=e.find("input[name=rirangetype]:checked").val()))b+=`;COUNT=${l=e.find("input[name=rirangebyoccurrencesvalue]").val()}`,w+=`, ${n.localization.rangeByOccurrences1Human} ${l} ${n.localization.rangeByOccurrences2}`;else if("BYENDDATE"===g){let t=e.find("input[name=rirangebyenddatecalendar]").val();if(""===t){const e=new Date;t=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate()}`}b+=`;UNTIL=${t.replaceAll("-","")}T000000${!0===i?"Z":""}`,w+=`, ${n.localization.rangeByEndDateHuman} `;var A=t.split("-");w+=Y(new Date(A[0],A[1]-1,A[2]),n.localization.longDateFormat,n)}}}if(t.length){t.sort();let e=[],a=[];for(let o of t)""!==o&&(o+=10===o.length?"T000000":"",o+=i?"Z":"",e.push(o),s=parseInt(o.substring(0,4),10),r=parseInt(o.substring(5,7),10)-1,c=parseInt(o.substring(8,10),10),a.push(Y(new Date(s,r,c),n.localization.longDateFormat,n)));e.length&&(b+=`\nRDATE:${e.join(",")}`,w+=`${n.localization.including} ${a.join("; ")}`)}if(a.length){a.sort();let e=[],t=[];for(let i of a)""!==i&&(e.push(i),s=parseInt(i.substring(0,4),10),r=parseInt(i.substring(4,6),10)-1,c=parseInt(i.substring(6,8),10),t.push(Y(new Date(s,r,c),n.localization.longDateFormat,n)));e.length&&(b+=`\nEXDATE:${e.join(",")}`,w+=`${n.localization.except} ${t.join("; ")}`)}return{result:b,description:w}}function J(e){var t={},a=e.indexOf(":"),n=e.substring(0,a);return t.value=e.substring(a+1),-1!==n.indexOf(";")?(a=n.indexOf(";"),t.parameters=n.substring(a+1),t.property=n.substring(0,a)):(t.parameters=null,t.property=n),t}function K(e){var t=[];for(const a of e.split(","))-1!==a.indexOf("Z")?t.push(a.substring(0,15)):t.push(a);return t}function X(e){var t,a=[],n={RRULE:"",RDATE:[],EXDATE:[]},i=null;for((a=e.split("\n")).reverse();""!==i;){if(a.length>0){if(" "===(t=a.pop()).charAt(0)||"\t"===t.charAt(0)){i+=t;continue}}else t="";null!==i&&("RDATE"===(i=J(i)).property||"EXDATE"===i.property?n[i.property]=K(i.value):n[i.property]=i.value),i=t}return n}function Q(e,t,a,n){var i,o,r,s,l,c,p,u,h,m,f,g,v,y,b,w,A,x,$,_=[];if(void 0===a.RRULE){if(_.push(t.localization.noRule),!n)return-1}else{if(h=(i=/FREQ=([^;]+);?/.exec(a.RRULE))?i[1]:"DAILY",m=(i=/INTERVAL=([0-9]+);?/.exec(a.RRULE))?i[1]:"1",f=(i=/BYDAY=([^;]+);?/.exec(a.RRULE))?i[1]:"",v=(i=/BYMONTHDAY=([^;]+);?/.exec(a.RRULE))?i[1].split(","):null,g=(i=/BYMONTH=([^;]+);?/.exec(a.RRULE))?i[1].split(","):null,y=(i=/COUNT=([0-9]+);?/.exec(a.RRULE))?i[1]:null,b=(i=/UNTIL=([0-9T]+);?/.exec(a.RRULE))?i[1]:null,(i=/BYSETPOS=([^;]+);?/.exec(a.RRULE))&&_.push(t.localization.bysetpos),Object.prototype.hasOwnProperty.call(t.rtemplate,h.toLowerCase()))o=t.rtemplate[h.toLowerCase()];else{for(h of t.rtemplate){o=t.rtemplate[h];break}_.push(t.localization.noTemplateMatch)}e.find("select[name='rirtemplate']").val(h.toLowerCase());for(const a of o.fields)switch((p=e.find(`#${a}`)).attr("id")){case"ridailyinterval":p.find("input[name=ridailyinterval]").val(m);break;case"riweeklyinterval":p.find("input[name=riweeklyinterval]").val(m);break;case"riweeklyweekdays":if(0===f.length)break;for(f=f.split(","),r=0;r<t.weekdays.length;r++)0!==(s=p.find(`input[name="riweeklyweekdays${r}"]`)).length&&(w=t.weekdays[r],s.attr("checked",f.includes(w)));break;case"rimonthlyinterval":p.find("input[name=rimonthlyinterval]").val(m);break;case"rimonthlyoptions":var k="DAYOFMONTH";if(v&&(k="DAYOFMONTH",v.length>1&&(_.push(t.localization.multipleDayOfMonth),v=v[0]),p.find("select[name=rimonthlydayofmonthday]").val(v)),f){k="WEEKDAYOFMONTH",-1!==f.indexOf(",")&&(_.push(t.localization.multipleDayOfMonth),f=f.split(",")[0]),"+"!==(l=f.slice(0,-2)).charAt(0)&&"-"!==l.charAt(0)&&(l="+"+l),$=f.slice(-2),p.find("select[name=rimonthlyweekdayofmonthindex]").val(l);const e=t.weekdays.indexOf($);p.find("select[name=rimonthlyweekdayofmonth]").val(e)}for(c=p.find("input[name=rimonthlytype]"),l=0;l<c.length;l++)u=c[l],d()(u).attr("checked",u.value===k);break;case"riyearlyinterval":p.find("input[name=riyearlyinterval]").val(m);break;case"riyearlyoptions":var T="DAYOFMONTH";if(v&&(T="DAYOFMONTH",v.length>1&&(_.push(t.localization.multipleDayOfMonth),v=v[0]),p.find("select[name=riyearlydayofmonthmonth]").val(g),p.find("select[name=riyearlydayofmonthday]").val(v)),f){T="WEEKDAYOFMONTH",-1!==f.indexOf(",")&&(_.push(t.localization.multipleDayOfMonth),f=f.split(",")[0]),"+"!==(l=f.slice(0,-2)).charAt(0)&&"-"!==l.charAt(0)&&(l="+"+l),$=f.slice(-2),p.find("select[name=riyearlyweekdayofmonthindex]").val(l);const e=t.weekdays.indexOf($);p.find("select[name=riyearlyweekdayofmonthday]").val(e),p.find("select[name=riyearlyweekdayofmonthmonth]").val(g)}for(c=p.find("input[name=riyearlyType]"),l=0;l<c.length;l++)u=c[l],d()(u).attr("checked",u.value===T);break;case"rirangeoptions":var O=t.hasRepeatForeverButton?"NOENDDATE":"BYOCCURRENCES";for(y&&(O="BYOCCURRENCES",p.find("input[name=rirangebyoccurrencesvalue]").val(y)),b&&(O="BYENDDATE",s=p.find("input[name=rirangebyenddatecalendar]"),x=b.slice(0,4),A=b.slice(4,6),w=b.slice(6,8),s.val(`${x}-${A}-${w}`)),c=p.find("input[name=rirangetype]"),l=0;l<c.length;l++)u=c[l],d()(u).attr("checked",u.value===O)}}var S=e.find("#messagearea");return 0!==_.length?(S.text(t.localization.unsupportedFeatures+" "+_.join("; ")),S.show(),1):(S.text(""),S.hide(),0)}const G=function(e,t){var a=this,n=d()(t);t.innerHTML?t.ical=X(t.innerHTML):t.ical={RRULE:"",RDATE:[],EXDATE:[]};var i,o=[],r=(new Date).toISOString().substring(0,10);for(let t=0;t<7;t++)(i=t+e.firstDay)>6&&(i-=7),o.push(i);function s(t){a.$modalForm.find(".rifield").hide();var n=t.val();if(n)for(const t of e.rtemplate[n].fields)a.$modalForm.find(`#${t}`).show()}function l(e){e.preventDefault(),t.ical.EXDATE.push(this.attributes.date.value);var a=d()(this);a.addClass("exdate"),a.parent().parent().addClass("exdate"),a.off("click").on("click",c)}function c(e){e.preventDefault(),t.ical.EXDATE.splice(d().inArray(this.attributes.date.value,t.ical.EXDATE),1);var a=d()(this);a.removeClass("exdate"),a.parent().parent().removeClass("exdate"),a.off("click").on("click",l)}function p(e){e.preventDefault(),t.ical.RDATE.splice(d().inArray(this.attributes.date.value,t.ical.RDATE),1),d()(this).parent().parent().hide("slow",function(){d()(this).remove()})}function u(n){n.preventDefault();var i=a.$modalForm.find(".riaddoccurrence input#adddate").val(),o=i.split("-");i+=10===i.length?"T000000":"";var r=a.$modalForm.find(".riaddoccurrence div.alert");if(r.text(""),r.hide(),t.ical.RDATE.includes(i))r.text(e.localization.alreadyAdded).show();else{t.ical.RDATE.push(i);var s=d()(`<div class="d-flex justify-content-between occurrence rdate">\n                <span class="rdate">\n                    ${Y(new Date(o[0],o[1]-1,o[2]),e.localization.longDateFormat,e)},\n                    <span class="rlabel">${e.localization.additionalDate}</span>\n                </span>\n                <span class="action">\n                    <a date="${i}" href="#" class="btn btn-sm btn-secondary rdate" >\n                        ${e.icons.remove}\n                    </a>\n                </span>\n                </div>`);s.hide(),a.$modalForm.find("div.rioccurrences").prepend(s),s.slideDown(),s.find("a.rdate").on("click",p)}}function h(t,n,i,o){var r,s;r=o?a.display:a.$modalForm,(s=r.find(".rioccurrences")).hide();var u={year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate(),rrule:n,format:e.localization.longDateFormat,start:i};d().ajax({url:e.ajaxURL,async:!1,type:"post",dataType:"json",contentType:e.ajaxContentType,cache:!1,data:u,success:function(a){var i,d,u,m,f;a.readOnly=o,a.localization=e.localization,a.icons=e.icons;for(let t of a.occurrences)d=t.date,u=parseInt(d.substring(0,4),10),m=parseInt(d.substring(4,6),10)-1,f=parseInt(d.substring(6,8),10),t.date=`${u}-${B(m+1)}-${B(f)}T000000`,t.formattedDate=Y(new Date(u,m,f),e.localization.longDateFormat,e);i=P().template('<div class="rioccurrences">\n    <% occurrences.forEach(function(occurrence) { %>\n        <div class="d-flex justify-content-between occurrence <%= occurrence.type %>">\n            <span>\n                <%= occurrence.formattedDate %>\n                <% if(occurrence.type === "start") { %>\n                    <span class="rlabel"><%= localization.recurrenceStart %></span>\n                <% } %>\n                <% if(occurrence.type === "rdate") { %>\n                    <span class="rlabel"><%= localization.additionalDate %></span>\n                <% } %>\n            </span>\n            <% if(!readOnly) { %>\n                <span class="action">\n                    <% if(occurrence.type === "rrule") { %>\n                        <a date="<%= occurrence.date %>" href="#"\n                           class="btn btn-sm btn-outline-secondary <%= occurrence.type %>" title="<%= localization.exclude %>">\n                            <%= icons.exclude %>\n                        </a>\n                    <% } %>\n                    <% if(occurrence.type === "rdate") { %>\n                        <a date="<%= occurrence.date %>" href="#"\n                           class="btn btn-sm btn-outline-secondary <%= occurrence.type %>" title="<%= localization.remove %>">\n                            <%= icons.remove %>\n                        </a>\n                    <% } %>\n                    <% if(occurrence.type === "exdate") { %>\n                        <a date="<%= occurrence.date %>" href="#"\n                           class="btn btn-sm btn-outline-secondary <%= occurrence.type %>" title="<%= localization.include %>">\n                           <%= icons.include %>\n                        </a>\n                    <% } %>\n                </span>\n            <% } %>\n        </div>\n    <% }) %>\n    <div class="batching">\n        <% for(var index=0; index < batch.batches.length; index++) { %>\n            <span <% if(index === batch.currentBatch) { %>class="current"<% } %>>\n                <a href="#" start="<%= batch.batches[index][0] %>">[<%= batch.batches[index][0] %> - <%= batch.batches[index][1] %>]</a>\n            </span>\n        <% } %>\n    </div>\n</div>\n')(a),s.replaceWith(i),r.find(".rioccurrences .batching a").on("click",function(e){e.stopPropagation(),e.preventDefault(),h(t,n,this.attributes.start.value,o)}),o||(r.find(".rioccurrences .action a.rrule").on("click",l),r.find(".rioccurrences .action a.exdate").on("click",c),r.find(".rioccurrences .action a.rdate").on("click",p)),s.show()},error:function(e,t){alert(t)}})}function m(e){var t=d()(e);return t.length||(t=d()("#"+e)),t.length||(t=d()("input[name='"+e+"']")),t}function f(){var t,a,n,i,o=null;if(e.startField){if(!(t=m(e.startField)).length)return null;""===(o=t.val())&&(o=t.text()),"string"==typeof o&&(o=o.replace(" ","T")),o=new Date(o)}else if(e.startFieldYear&&e.startFieldMonth&&e.startFieldDay){if(a=m(e.startFieldYear),n=m(e.startFieldMonth),i=m(e.startFieldDay),!a.length&&!n.length&&!i.length)return null;o=new Date(a.val(),n.val()-1,i.val())}return null===o||isNaN(o)?null:o}function g(e){var t,n;return n=(t=a.$modalForm.find("input[name="+e+"]")).val(),isNaN(n)||-1!==n.toString().indexOf(".")||""===t.val()?null:n}function v(i){var o=V(i,t.ical.RDATE,t.ical.EXDATE,e,!1);a.display.find("label[class=ridisplay-label]").text(e.localization.displayActivate+" "+o.description),t.ical=X(o.result),t.innerHTML=o.result,n.trigger("change");var r=f();null!==r&&h(r,o.result,0,!0),a.display.find('a[name="riedit"]').text(e.localization.edit_rules),a.display.find('a[name="ridelete"]').show()}function y(t){var n,i,o,r,s,l;if(n=f(),(r=a.$modalForm.find("#messagearea")).text(""),r.hide(),a.$modalForm.find(".riaddoccurrence div.alert").text("").hide(),"block"===a.$modalForm.find("#ridailyinterval").css("display")&&(!(o=g("ridailyinterval"))||o<1||o>1e3))return r.text(e.localization.noRepeatEvery).show(),!1;if("block"===a.$modalForm.find("#riweeklyinterval").css("display")&&(!(o=g("riweeklyinterval"))||o<1||o>1e3))return r.text(e.localization.noRepeatEvery).show(),!1;if("block"===a.$modalForm.find("#rimonthlyinterval").css("display")){if(!(o=g("rimonthlyinterval"))||o<1||o>1e3)return r.text(e.localization.noRepeatEvery).show(),!1;if(0===a.$modalForm.find("#rimonthlyoptions input:checked").length)return r.text(e.localization.noRepeatOn).show(),!1}if("block"===a.$modalForm.find("#riyearlyinterval").css("display")){if(!(o=g("riyearlyinterval"))||o<1||o>1e3)return r.text(e.localization.noRepeatEvery).show(),!1;if(0===a.$modalForm.find("#riyearlyoptions input:checked").length)return r.text(e.localization.noRepeatOn).show(),!1}if(a.$modalForm.find('input[value="BYOCCURRENCES"]:visible:checked').length>0&&(!(o=g("rirangebyoccurrencesvalue"))||o<1||o>1e3))return r.text(e.localization.noEndAfterNOccurrences).show(),!1;if(a.$modalForm.find('input[value="BYENDDATE"]:visible:checked').length>0){if(l=(s=a.$modalForm.find("input[name=rirangebyenddatecalendar]")).val(),l=new Date(l),!(i=isNaN(l)||""===s.val()?null:l))return r.text(e.localization.noEndDate).show(),!1;if(i<n)return r.text(e.localization.pastEndDate).show(),!1}return!0}function b(e){e.preventDefault(),y(a.$modalForm)&&(a.modal.hide(),v(a.$modalForm),a.$modalForm=null)}function w(e){e.preventDefault(),a.modal.hide(),a.$modalForm=null}function A(){var n;n=f(),y()&&h(n,V(a.$modalForm,t.ical.RDATE,t.ical.EXDATE,e,!1).result,0,!1)}e={...e,orderIndexes:["+1","+2","+3","+4","-1"],weekdays:["SU","MO","TU","WE","TH","FR","SA"],orderedWeekdays:o},a.display=d()(P().template('<div class="ridisplay">\n    <div class="rimain">\n        <% if(!readOnly) { %>\n            <a class="btn btn-primary" name="riedit" href="#"><%= localization.add_rules %></a>\n            <a class="btn btn-danger" name="ridelete" style="display:none" href="#"><%= localization.delete_rules %></a>\n        <% } %>\n        <label class="ridisplay-label"><%= localization.displayUnactivate %></label>\n    </div>\n<div class="rioccurrences" style="display:none"></div>\n')(e));var x=d()(P().template('<div class="riform">\n    <form>\n        <h1><%= localization.title %></h1>\n        <div id="messagearea" class="alert alert-danger d-none"> </div>\n        <div id="rirtemplate" class="mb-2 row">\n            <label class="col-4 col-form-label" for="<%= name %>rtemplate" class="label">\n                <%= localization.recurrenceType %>\n            </label>\n            <div class="col-8">\n                <select id="rirtemplate" name="rirtemplate" class="form-select form-select-sm">\n                    <% Object.keys(rtemplate).forEach(function(val, idx) { %>\n                        <option value="<%= val %>"><%= localization.rtemplate[val] %></value>\n                    <% }) %>\n                </select>\n            </div>\n        </div>\n        <div id="riformfields" class="mb-2">\n            <div id="ridailyinterval" class="rifield row">\n                <label class="col-4 col-form-label" for="<%= name %>dailyinterval">\n                    <%= localization.dailyInterval1 %>\n                </label>\n                <div class="col-8">\n                    <input class="form-control form-control-sm w-auto float-start me-3" type="text" size="2"\n                        value="1"\n                        name="ridailyinterval"\n                        id="<%= name %>dailyinterval" />\n                    <%= localization.dailyInterval2 %>\n                </div>\n            </div>\n\n            <div id="riweeklyinterval" class="rifield row">\n                <label class="col-4 col-form-label" for="<%= name %>weeklyinterval">\n                    <%= localization.weeklyInterval1 %>\n                </label>\n                <div class="col-8">\n                    <input class="form-control form-control-sm w-auto float-start me-3" type="text" size="2"\n                        value="1"\n                        name="riweeklyinterval"\n                        id="<%= name %>weeklyinterval"/>\n                    <%= localization.weeklyInterval2 %>\n                </div>\n            </div>\n\n            <div id="riweeklyweekdays" class="rifield row">\n                <label class="col-4 col-form-label" for="<%= name %>weeklyinterval"><%= localization.weeklyWeekdays %></label>\n                <div class="col-8">\n                    <div class="row">\n                    <% orderedWeekdays.forEach(function(idx) { %>\n                        <div class="riweeklyweekday col-auto">\n                            <div class="form-check">\n                                <input class="form-check-input" type="checkbox"\n                                    name="riweeklyweekdays<%=idx %>"\n                                    id="<%= name %>weeklyWeekdays<%=idx %>"\n                                    value="<%=idx %>" />\n                                <label class="form-check-label" for="<%= name %>weeklyWeekdays<%= idx %>"><%= localization.shortWeekdays[idx] %></label>\n                            </div>\n                        </div>\n                    <% }) %>\n                    </div>\n                </div>\n            </div>\n\n            <div id="rimonthlyinterval" class="rifield row">\n                <label class="col-4 col-form-label" for="rimonthlyinterval"><%= localization.monthlyInterval1 %></label>\n                <div class="col-8">\n                    <input class="form-control form-control-sm w-auto float-start me-3" type="text" size="2"\n                        value="1"\n                        name="rimonthlyinterval"/>\n                    <%= localization.monthlyInterval2 %>\n                </div>\n            </div>\n\n            <div id="rimonthlyoptions" class="rifield row">\n                <label class="col-4 col-form-label" for="rimonthlytype"><%= localization.monthlyRepeatOn %></label>\n                <div class="col-8">\n                    <div class="row">\n                        <div class="col-auto">\n                            <div class="form-check">\n                                <input\n                                    class="form-check-input"\n                                    type="radio"\n                                    value="DAYOFMONTH"\n                                    name="rimonthlytype"\n                                    id="<%= name %>monthlytype:DAYOFMONTH" />\n                                <label class="form-check-label" for="<%= name %>monthlytype:DAYOFMONTH">\n                                    <%= localization.monthlyDayOfMonth1 %>\n                                </label>\n                            </div>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto" name="rimonthlydayofmonthday" id="<%= name %>monthlydayofmonthday">\n                                <% [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31].forEach(function(val, idx) { %>\n                                    <option value="<%= val %>"><%= val %></option>\n                                <% }) %>\n                            </select>\n                        </div>\n                        <div class="col-auto">\n                            <%= localization.monthlyDayOfMonth2 %>\n                        </div>\n                    </div>\n                    <div class="row">\n                        <div class="col-auto">\n                            <div class="form-check">\n                                <input\n                                    class="form-check-input"\n                                    type="radio"\n                                    value="WEEKDAYOFMONTH"\n                                    name="rimonthlytype"\n                                    id="<%= name %>monthlytype:WEEKDAYOFMONTH" />\n                                <label class="form-check-label" for="<%= name %>monthlytype:WEEKDAYOFMONTH">\n                                    <%= localization.monthlyWeekdayOfMonth1 %>\n                                </label>\n                            </div>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto float-start me-2" name="rimonthlyweekdayofmonthindex">\n                                <% orderIndexes.forEach(function(val, idx) { %>\n                                    <option value="<%= val %>"><%= localization.orderIndexes[idx] %></option>\n                                <% }) %>\n                            </select>\n                            <%= localization.monthlyWeekdayOfMonth2 %>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto float-start me-2" name="rimonthlyweekdayofmonth">\n                                <% orderedWeekdays.forEach(function(idx) { %>\n                                    <option value="<%= idx %>"><%= localization.weekdays[idx] %></option>\n                                <% }) %>\n                            </select>\n                            <%= localization.monthlyWeekdayOfMonth3 %>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div id="riyearlyinterval" class="rifield row">\n                <label class="col-4 col-form-label" for="riyearlyinterval"><%= localization.yearlyInterval1 %></label>\n                <div class="col-8">\n                    <input class="form-control form-control-sm w-auto float-start me-3" type="text" size="2"\n                        value="1"\n                        name="riyearlyinterval"/>\n                    <%= localization.yearlyInterval2 %>\n                </div>\n            </div>\n\n            <div id="riyearlyoptions" class="rifield row">\n                <label class="col-4 col-form-label" for="riyearlyType"><%= localization.yearlyRepeatOn %></label>\n                <div class="col-8">\n                    <div class="row">\n                        <div class="col-auto">\n                            <div class="form-check">\n                                <input\n                                    class="form-check-input"\n                                    type="radio"\n                                    value="DAYOFMONTH"\n                                    name="riyearlyType"\n                                    id="<%= name %>yearlytype:DAYOFMONTH" />\n                                <label class="form-check-label" for="<%= name %>yearlytype:DAYOFMONTH">\n                                    <%= localization.yearlyDayOfMonth1 %>\n                                </label>\n                            </div>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto float-start me-2" name="riyearlydayofmonthmonth">\n                            <% localization.months.forEach(function(val, idx) { %>\n                                <option value="<%= idx + 1 %>"><%= val %></option>\n                            <% }) %>\n                            </select>\n                            <%= localization.yearlyDayOfMonth2 %>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto float-start me-2" name="riyearlydayofmonthday">\n                                <% [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31].forEach(function(val, idx) { %>\n                                    <option value="<%= val %>"><%= val %></option>\n                                <% }) %>\n                            </select>\n                            <%= localization.yearlyDayOfMonth3 %>\n                        </div>\n                    </div>\n\n                    <div class="row">\n                        <div class="col-auto">\n                            <div class="form-check">\n                                <input\n                                    class="form-check-input"\n                                    type="radio"\n                                    value="WEEKDAYOFMONTH"\n                                    name="riyearlyType"\n                                    id="<%= name %>yearlytype:WEEKDAYOFMONTH"/>\n                                <label class="form-check-label" for="<%= name %>yearlytype:WEEKDAYOFMONTH">\n                                    <%= localization.yearlyWeekdayOfMonth1 %>\n                                </label>\n                            </div>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto float-start me-2" name="riyearlyweekdayofmonthindex">\n                                <% orderIndexes.forEach(function(val, idx) { %>\n                                    <option value="<%= val %>"><%= localization.orderIndexes[idx] %></option>\n                                <% }) %>\n                            </select>\n                            <%= localization.yearlyWeekdayOfMonth2 %>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto float-start me-2" name="riyearlyweekdayofmonthday">\n                                <% orderedWeekdays.forEach(function(val, idx) { %>\n                                    <option value="<%= val %>"><%= localization.weekdays[idx] %></option>\n                                <% }) %>\n                            </select>\n                            <%= localization.yearlyWeekdayOfMonth3 %>\n                        </div>\n                        <div class="col-auto">\n                            <select class="form-select form-select-sm w-auto float-start me-2" name="riyearlyweekdayofmonthmonth">\n                                <% localization.months.forEach(function(val, idx) { %>\n                                    <option value="<%= idx + 1 %>"><%= val %></option>\n                                <% }) %>\n                            </select>\n                            <%= localization.yearlyWeekdayOfMonth4 %>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <div id="rirangeoptions" class="rifield row">\n                <label class="col-4 col-form-label"><%= localization.range %></label>\n                <div class="col-8 pt-2">\n                    <% if(hasRepeatForeverButton) { %>\n                    <div class="form-check">\n                        <input\n                            class="form-check-input"\n                            type="radio"\n                            value="NOENDDATE"\n                            name="rirangetype"\n                            id="<%= name %>rangetype:NOENDDATE"/>\n                        <label class="form-check-label" for="<%= name %>rangetype:NOENDDATE">\n                            <%= localization.rangeNoEnd %>\n                        </label>\n                    </div>\n                    <% } %>\n                    <div class="row mt-2">\n                        <div class="col-auto">\n                            <div class="form-check">\n                                <input\n                                    class="form-check-input"\n                                    type="radio"\n                                    checked="checked"\n                                    value="BYOCCURRENCES"\n                                    name="rirangetype"\n                                    id="<%= name %>rangetype:BYOCCURRENCES"/>\n                                <label class="form-check-label" for="<%= name %>rangetype:BYOCCURRENCES">\n                                    <%= localization.rangeByOccurrences1 %>\n                                </label>\n                            </div>\n                        </div>\n                        <div class="col-auto">\n                            <input\n                                class="form-control form-control-sm w-auto float-start me-3" type="text" size="3"\n                                value="7"\n                                name="rirangebyoccurrencesvalue" />\n                            <%= localization.rangeByOccurrences2 %>\n                        </div>\n                    </div>\n                    <div class="row mt-2">\n                        <div class="col-auto">\n                            <div class="form-check">\n                                <input\n                                    class="form-check-input"\n                                    type="radio"\n                                    value="BYENDDATE"\n                                    name="rirangetype"\n                                    id="<%= name %>rangetype:BYENDDATE"/>\n                                <label class="form-check-label" for="<%= name %>rangetype:BYENDDATE">\n                                    <%= localization.rangeByEndDate %>\n                                </label>\n                            </div>\n                        </div>\n                        <div class="col-auto">\n                            <input\n                                class="form-control form-control-sm w-auto" type="date"\n                                name="rirangebyenddatecalendar" />\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="rioccurrencesactions">\n            <div class="rioccurancesheader d-flex justify-content-between">\n                <h6><strong><%= localization.preview %></strong></h6>\n            </div>\n        </div>\n\n        <div class="rioccurrences"></div>\n\n        <div class="rioccurrencesactions">\n            <h6><strong><%= localization.addDate %></strong></h6>\n            <div class="riaddoccurrence ">\n                <div class="alert alert-danger d-none"></div>\n                <div class="input-group">\n                    <input class="form-control form-control-sm w-auto" type="date" name="adddate" id="adddate" />\n                    <input class="btn btn-sm btn-success" type="button" name="addaction" id="addaction" value="<%= localization.add %>">\n                </div>\n            </div>\n        </div>\n\n        <div class="ributtons">\n            <button\n                type="submit"\n                class="btn btn-secondary me-2 ricancelbutton <%= ributtonExtraClass %>"><%= localization.cancel %></button>\n            <button\n                type="submit"\n                class="btn btn-primary risavebutton <%= ributtonExtraClass %>"><%= localization.save %></button>\n        </div>\n    </form>\n</div>\n')(e));(x.appendTo("body"),x.hide(),a.modal=new R.A(x,{content:"div.riform",buttons:".ributtons > button",modalSizeClass:"modal-lg",backdropOptions:{opacity:"0.5"}}),t.innerHTML)&&(-1===Q(x,e,t.ical,!1)?a.display.find("label[class=ridisplay-label]").text(e.localization.noRule):v(x));a.display.find('a[name="ridelete"]').on("click",function(i){i.preventDefault(),a.display.find("label[class=ridisplay-label]").text(e.localization.displayUnactivate),t.ical={RRULE:"",RDATE:[],EXDATE:[]},t.innerHTML="",n.trigger("change"),a.display.find(".rioccurrences").hide(),a.display.find('a[name="riedit"]').text(e.localization.add_rules),a.display.find('a[name="ridelete"]').hide()}),a.display.find('a[name="riedit"]').on("click",function(n){n.preventDefault(),a.modal.show(),a.$modalForm=d()("form",a.modal.$modalContent),function(a){Q(a,e,t.ical,!0);const n=f();if(null!==n){document.querySelector("select[name=rimonthlydayofmonthday]").value=n.getDate();const i=e.orderIndexes[Math.floor((n.getDate()-1)/7)],o=e.weekdays[n.getDay()];document.querySelector("select[name=rimonthlyweekdayofmonthindex]").value=i,document.querySelector("select[name=rimonthlyweekdayofmonth]").value=o,document.querySelector("select[name=riyearlydayofmonthmonth]").value=n.getMonth()+1,document.querySelector("select[name=riyearlydayofmonthday]").value=n.getDate(),document.querySelector("select[name=riyearlyweekdayofmonthindex]").value=i,document.querySelector("select[name=riyearlyweekdayofmonthday]").value=o,document.querySelector("select[name=riyearlyweekdayofmonthmonth]").value=n.getMonth()+1,h(n,t.innerHTML||V(a,t.ical.RDATE,t.ical.EXDATE,e,!1).result,0,!1),document.querySelector("div.rioccurrencesactions").style.display="block"}else document.querySelector("div.rioccurrencesactions").style.display="none";s(a.find("select[name=rirtemplate]"))}(a.$modalForm),function(){var e=a.$modalForm.find("input[name=rirangebyenddatecalendar]");if(!e.val()){var t=f();t.setDate(t.getDate()+1),e.val(t.toISOString().substring(0,10))}a.$modalForm.find("input#addaction").on("click",u),a.$modalForm.find('select[name="rirtemplate"]').on("change",function(){s(d()(this)),A()}),a.$modalForm.find("\n                input:radio,\n                input:checkbox,\n                .riweeklyweekday > input,\n                input[name=ridailyinterval],\n                input[name=riweeklyinterval],\n                input[name=rimonthlyinterval],\n                input[name=riyearlyinterval],\n                input[name=rirangebyoccurrencesvalue],\n                input[name=rirangebyenddatecalendar],\n                #rimonthlyoptions select,\n                #riyearlyoptions select,\n                #riyearlyinterval select").on("change",function(){0!==a.$modalForm.find(".rioccurrencesactions:visible").length&&A()}),a.$modalForm.find("div.riaddoccurrence input#adddate").val(r),a.$modalForm.find(".ricancelbutton").on("click",w),a.$modalForm.find(".risavebutton").on("click",b)}()})};i.A.extend({name:"recurrence",trigger:".pat-recurrence",parser:"mockup",defaults:{localization:{displayUnactivate:"Does not repeat",displayActivate:"Repeats every",add_rules:"Add",edit_rules:"Edit",delete_rules:"Delete",add:"Add",refresh:"Refresh",title:"Repeat",preview:"Selected dates",addDate:"Add date",recurrenceType:"Repeats:",dailyInterval1:"Repeat every:",dailyInterval2:"days",weeklyInterval1:"Repeat every:",weeklyInterval2:"week(s)",weeklyWeekdays:"Repeat on:",weeklyWeekdaysHuman:"on:",monthlyInterval1:"Repeat every:",monthlyInterval2:"month(s)",monthlyDayOfMonth1:"Day",monthlyDayOfMonth1Human:"on day",monthlyDayOfMonth2:"of the month",monthlyDayOfMonth3:"month(s)",monthlyWeekdayOfMonth1:"The",monthlyWeekdayOfMonth1Human:"on the",monthlyWeekdayOfMonth2:"",monthlyWeekdayOfMonth3:"of the month",monthlyRepeatOn:"Repeat on:",yearlyInterval1:"Repeat every:",yearlyInterval2:"year(s)",yearlyDayOfMonth1:"Every",yearlyDayOfMonth1Human:"on",yearlyDayOfMonth2:"",yearlyDayOfMonth3:"",yearlyWeekdayOfMonth1:"The",yearlyWeekdayOfMonth1Human:"on the",yearlyWeekdayOfMonth2:"",yearlyWeekdayOfMonth3:"of",yearlyWeekdayOfMonth4:"",yearlyRepeatOn:"Repeat on:",range:"End recurrence:",rangeNoEnd:"Never",rangeByOccurrences1:"After",rangeByOccurrences1Human:"ends after",rangeByOccurrences2:"occurrence(s)",rangeByEndDate:"On",rangeByEndDateHuman:"ends on",including:", and also",except:", except for",cancel:"Cancel",save:"Save",recurrenceStart:"Start of the recurrence",additionalDate:"Additional date",include:"Include",exclude:"Exclude",remove:"Remove",orderIndexes:["first","second","third","fourth","last"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortWeekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDateFormat:"mmmm dd, yyyy",shortDateFormat:"mm/dd/yyyy",unsupportedFeatures:"Warning: This event uses recurrence features not supported by this widget. Saving the recurrence may change the recurrence in unintended ways:",noTemplateMatch:"No matching recurrence template",multipleDayOfMonth:"This widget does not support multiple days in monthly or yearly recurrence",bysetpos:"BYSETPOS is not supported",noRule:"No RRULE in RRULE data",noRepeatEvery:'Error: The "Repeat every"-field must be between 1 and 1000',noEndDate:"Error: End date is not set. Please set a correct value",noRepeatOn:'Error: "Repeat on"-value must be selected',pastEndDate:"Error: End date cannot be before start date",noEndAfterNOccurrences:'Error: The "After N occurrences"-field must be between 1 and 1000',alreadyAdded:"This date was already added",rtemplate:{daily:"Daily",mondayfriday:"Monday and Friday",weekdays:"Weekday",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"}},readOnly:!1,firstDay:0,startField:null,startFieldYear:null,startFieldMonth:null,startFieldDay:null,ajaxURL:null,ajaxContentType:"application/json; charset=utf8",ributtonExtraClass:"",hasRepeatForeverButton:!0,template:{form:"#jquery-recurrenceinput-form-tmpl",display:"#jquery-recurrenceinput-display-tmpl"},rtemplate:{daily:{rrule:"FREQ=DAILY",fields:["ridailyinterval","rirangeoptions"]},mondayfriday:{rrule:"FREQ=WEEKLY;BYDAY=MO,FR",fields:["rirangeoptions"]},weekdays:{rrule:"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR",fields:["rirangeoptions"]},weekly:{rrule:"FREQ=WEEKLY",fields:["riweeklyinterval","riweeklyweekdays","rirangeoptions"]},monthly:{rrule:"FREQ=MONTHLY",fields:["rimonthlyinterval","rimonthlyoptions","rirangeoptions"]},yearly:{rrule:"FREQ=YEARLY",fields:["riyearlyinterval","riyearlyoptions","rirangeoptions"]}}},load_icons:async function(){return{reload:await j.A.resolveIcon("arrow-clockwise"),remove:await j.A.resolveIcon("trash"),exclude:await j.A.resolveIcon("calendar-x"),include:await j.A.resolveIcon("plus-circle")}},init:async function(){a.e(27632).then(a.bind(a,27632)),this.el.classList.add("recurrence-widget");var e=await this.load_icons(),t={...this.options,...this.options.configuration,icons:e},n=new G(t,this.el);this.$el.after(n.display),this.el.style.display="none"}}),a(63198),i.A.extend({name:"search",trigger:".pat-search",init:function(){var e=new j.A.Loading,t=d()("#search-filter"),a=d()("#search-filter-toggle",t),n=d()("#advanced-search-input"),i=d()("#pt_toggle"),o=d()(".search-type-options"),r=d()("#sorting-options");window.history&&window.history.pushState&&d()(window).on("popstate",function(){window.location=window.location.href});var s=0,l=function(){e.show(),function(){if(window.history&&window.history.pushState){var e=window.location.origin+window.location.pathname+"?"+d()("#searchform").serialize();window.history.pushState(null,null,e)}}(),d().ajax({url:window.location.origin+window.location.pathname+"?ajax_load=1",data:d()("#searchform").serialize()}).done(function(t){var a=d()(t);d()("#search-results").replaceWith(d()("#search-results",a)),d()("#search-term").replaceWith(d()("#search-term",a)),d()("#results-count").replaceWith(d()("#results-count",a)),e.hide()})},c=function(e){d()("#search-batch-start").attr("value",e)},p=function(e){d()("a",r).removeClass("active"),e.addClass("active")},u=d()("#search-results").attr("data-default-sort");p(d()("a[data-sort="+u+"]")),d()("a",r).on("click",function(e){e.preventDefault(),p(d()(this));var t=d()(this).attr("data-sort"),a=d()(this).attr("data-order");t?(d()('[name="sort_on"]').attr("value",t),a&&"reverse"==a?d()('[name="sort_order"]').attr("value","reverse"):d()('[name="sort_order"]').attr("value","")):(d()('[name="sort_on"]').attr("value",""),d()('[name="sort_order"]').attr("value","")),l()}),d()(".searchPage").on("submit",function(e){e.preventDefault(),c("0"),l()}),a.on("click",function(e){e.preventDefault(),t.toggleClass("activated"),t.hasClass("activated")?n.attr("value","True"):n.attr("value","False")}),i.on("change",function(){i[0].checked?d()("input",o).each(function(){this.checked=!0}):d()("input",o).each(function(){this.checked=!1})}),d()("input",t).on("change",function(){c("0"),clearTimeout(s),s=setTimeout(l,200)}),d()("#searchform").on("click",".pagination a",function(e){var t=new URLSearchParams(d()(e.currentTarget).attr("href")).get("b_start:int");t&&(e.preventDefault(),c(t),l())})}}),a(29342),a(80012),i.A.extend({name:"structure",trigger:".pat-structure",parser:"mockup",defaults:{urlStructure:null,vocabularyUrl:null,indexOptionsUrl:null,contextInfoUrl:null,setDefaultPageUrl:null,menuOptions:null,backdropSelector:".plone-modal",activeColumnsCookie:"activeColumns",attributes:["CreationDate","EffectiveDate","ExpirationDate","exclude_from_nav","getIcon","getMimeIcon","getObjSize","getURL","id","is_folderish","last_comment_date","ModificationDate","path","portal_type","review_state","Subject","Title","total_comments","UID"],activeColumns:["ModificationDate","EffectiveDate","review_state"],availableColumns:{id:"ID",ModificationDate:"Last modified",EffectiveDate:"Published",ExpirationDate:"Expiration",CreationDate:"Created",review_state:"Review state",Subject:"Tags",portal_type:"Type",is_folderish:"Folder",exclude_from_nav:"Excluded from navigation",getObjSize:"Object Size",last_comment_date:"Last comment date",total_comments:"Total comments"},typeToViewAction:{File:"/view",Image:"/view",Blob:"/view"},defaultPageTypes:["Document","Event","News Item","Collection"],language:"en",dateFormat:{dateStyle:"medium",timeStyle:"medium"},rearrange:{properties:{id:"ID",sortable_title:"Title"},url:"/rearrange"},moveUrl:null,buttons:[{tooltip:"Cut",url:"/cut",icon:"plone-cut"},{tooltip:"Copy",url:"/copy",icon:"plone-copy"},{tooltip:"Paste",url:"/paste",icon:"plone-paste"},{tooltip:"Delete",url:"/delete",context:"danger",icon:"plone-delete"},{tooltip:"Workflow",url:"/workflow",icon:"plone-lock"},{tooltip:"Tags",url:"/tags",icon:"tags"},{tooltip:"Properties",url:"/properties",icon:"plone-edit"},{tooltip:"Rename",url:"/rename",icon:"plone-rename"}],datatables_options:{},upload:{uploadMultiple:!0,showTitle:!0}},async init(){a.e(90862).then(a.bind(a,90862)),(await a.e(37253).then(a.t.bind(a,37253,23))).Dropdown;const e=(await Promise.resolve().then(a.t.bind(a,40705,23))).default,t=(await a.e(85081).then(a.t.bind(a,85081,23))).default;window._=e,window.Backbone=t;const n=(await Promise.all([a.e(68650),a.e(85081),a.e(8364)]).then(a.bind(a,68650))).default;this.browsing=!0,this.options.collectionUrl=this.options.vocabularyUrl,this.options.pattern=this,this.options.language=document.querySelector("html").getAttribute("lang")||"en",this.options.queryHelperAttributes=this.options.attributes,delete this.options.attributes;const i=new n(this.options);await i.render(),this.$el.append(i.$el)}}),i.A.extend({name:"structureupdater",trigger:".template-folder_contents",parser:"mockup",defaults:{titleSelector:"",descriptionSelector:""},init:function(){d()("body").on("context-info-loaded",(e,t)=>{this.options.titleSelector&&d()(this.options.titleSelector,this.$el).html(t.object&&t.object.Title||"&nbsp;"),this.options.descriptionSelector&&d()(this.options.descriptionSelector,this.$el).html(t.object&&t.object.Description||"&nbsp;")})}}),i.A.extend({name:"tinymce",trigger:".pat-tinymce",parser:"mockup",defaults:{upload:{uploadMultiple:!1,maxFiles:1,showTitle:!1},contentBrowser:{attributes:["UID","Title","Description","portal_type","path","getURL","getIcon","is_folderish","review_state"],batchSize:20,basePath:"/",vocabularyUrl:null,width:"95%",placeholder:(0,U.Ay)("Search for item on site...")},text:{insertBtn:(0,U.Ay)("Insert"),cancelBtn:(0,U.Ay)("Cancel"),insertHeading:(0,U.Ay)("Insert link"),title:(0,U.Ay)("Title"),internal:(0,U.Ay)("Internal"),external:(0,U.Ay)("External"),externalText:(0,U.Ay)("External URL (can be relative within this site or absolute if it starts with http:// or https://)"),email:(0,U.Ay)("Email Address"),anchor:(0,U.Ay)("Anchor"),anchorLabel:(0,U.Ay)("Select an anchor"),target:(0,U.Ay)("Target"),subject:(0,U.Ay)("Email Subject (optional)"),image:(0,U.Ay)("Image"),imageAlign:(0,U.Ay)("Align"),enableImageZoom:(0,U.Ay)("Enable image zoom"),scale:(0,U.Ay)("Size"),alt:(0,U.Ay)("Alternative Text"),insertImageHelp:(0,U.Ay)("Specify an image. It can be on this site already (Internal Image), an image you upload (Upload), or from an external site (External Image)."),internalImage:(0,U.Ay)("Internal Image"),externalImage:(0,U.Ay)("External Image"),externalImageText:(0,U.Ay)("External Image URL (can be relative within this site or absolute if it starts with http:// or https://)"),upload:(0,U.Ay)("Upload"),insertLinkHelp:(0,U.Ay)("Specify the object to link to. It can be on this site already (Internal), an object you upload (Upload), from an external site (External), an email address (Email), or an anchor on this page (Anchor)."),captionFromDescription:(0,U.Ay)("Show Image Caption from Image Description"),caption:(0,U.Ay)("Image Caption")},loadingBaseUrl:"++plone++static/tinybase",prependToUrl:"",appendToUrl:"",linkAttribute:"path",prependToScalePart:"/imagescale/",appendToScalePart:"",appendToOriginalScalePart:"",defaultSrcset:"medium",imageCaptioningEnabled:!0,imageClasses:{"image-inline":(0,U.Ay)("Inline"),"image-right":(0,U.Ay)("Right"),"image-left":(0,U.Ay)("Left")},targetList:[{text:(0,U.Ay)("Open in this window / frame"),value:""},{text:(0,U.Ay)("Open in new window"),value:"_blank"},{text:(0,U.Ay)("Open in parent window / frame"),value:"_parent"},{text:(0,U.Ay)("Open in top frame (replaces all frames)"),value:"_top"}],imageTypes:["Image"],folderTypes:["Folder","Plone Site"],tiny:{theme:"silver",plugins:["advlist","autolink","lists","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","contextmenu","paste","plonelink","ploneimage"],menubar:"edit table format tools view insert",toolbar:"undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage",height:400},inline:!1},init:async function(){const e=(await a.e(75010).then(a.bind(a,75010))).default;this.instance=new e(this.el,this.options),await this.instance.init()},destroy:function(){this.instance.destroy()}}),i.A.extend({name:"textareamimetypeselector",trigger:".pat-textareamimetypeselector",parser:"mockup",current_widgets:[],defaults:{textareaName:"",widgets:{"text/html":{pattern:"tinymce",patternOptions:{}}}},async init(){this.el.addEventListener("input",async e=>await this.init_textareas(e.target.value)),await this.init_textareas(this.el.value)},async init_textareas(e){const t=this.options.widgets[e],a=document.querySelectorAll(`textarea[name="${this.options.textareaName}"]`);this.current_widgets.forEach(e=>{e.destroy()}),this.current_widgets=[],t&&a.length&&a.forEach(async e=>{this.current_widgets.push(await new n.A.patterns[t.pattern](e,t.patternOptions||{}))})}});const Z=f.A.getLogger("pat-toggle");i.A.extend({name:"toggle",trigger:".pat-toggle",parser:"mockup",defaults:{attribute:"class",event:"click",targetScope:"global"},init:function(){var e=this;e.options.target?"global"===e.options.targetScope?e.$target=d()(e.options.target):e.$target=e.$el.parents(e.options.targetScope).first().find(e.options.target):e.$target=e.$el,e.$target&&0!==e.$target.length||Z.error(`No target found for "${e.options.target}".`),e.on(e.options.event,function(t){t.stopPropagation(),t.preventDefault(),e.toggle()})},isMarked:function(){for(var e=!1,t=0;t<this.$target.length;t+=1)if("class"===this.options.attribute){if(!this.$target.eq(t).hasClass(this.options.value)){e=!1;break}e=!0}else{if(this.$target.eq(t).attr(this.options.attribute)!==this.options.value){e=!1;break}e=!0}return e},toggle:function(){var e=this;e.isMarked()?e.remove():e.add()},remove:function(){var e=this;e.emit("remove-attr"),"class"===e.options.attribute?e.$target.removeClass(e.options.value):e.$target.removeAttr(e.options.attribute),e.emit("attr-removed")},add:function(){var e=this;e.emit("add-attr"),"class"===e.options.attribute?e.$target.addClass(e.options.value):e.$target.attr(e.options.attribute,e.options.value),e.emit("added-attr")}});var ee=a(73462),te=a.n(ee);const ae=f.A.getLogger("pat-toolbar"),ne=new o.A("toolbar");ne.addArgument("render-view","@@render-toolbar");class ie extends m.m{static name="toolbar";static trigger=".pat-toolbar";static parser=ne;parser_group_options=!1;previous_toolbar_url=null;async init(){window.__patternslib_import_styles,s.A.add_event_listener(window.navigation,"navigate","pat-toolbar--history-changed",async()=>{await l.A.timeout(1),await this.reload_toolbar()});const e=d()(this.el);e.on("click",".toolbar-collapse",()=>{document.body.classList.remove("plone-toolbar-left-expanded"),te().set("plone-toolbar",JSON.stringify({expanded:!1}),{path:"/"})}),e.on("click",".toolbar-expand",()=>{document.body.classList.add("plone-toolbar-left-expanded"),te().set("plone-toolbar",JSON.stringify({expanded:!0}),{path:"/"})}),this.el.classList.add("initialized")}async reload_toolbar(){const e=this.options["render-view"];let t=document.body.dataset.baseUrl;if(t="/"===t[t.length-1]?t:`${t}/`,t=`${t}${e}`,this.previous_toolbar_url===t)return void ae.debug("No URL change, no reload.");ae.debug("Reload toolbar on: ",t);const a=await fetch(t),i=await a.text();this.previous_toolbar_url=t;const o=document.createElement("div");o.innerHTML=i;const r=o.querySelector("#edit-zone .plone-toolbar-main"),l=o.querySelector("#edit-zone #collapse-personaltools");n.A.scan(r),n.A.scan(l),document.querySelector(".plone-toolbar-main")?.replaceWith(r),document.querySelector("#collapse-personaltools")?.replaceWith(l),ae.debug("Re-scanned."),this.el.dispatchEvent(s.A.generic_event("pat-toolbar--reloaded")),ae.debug("Event pat-toolbar--reloaded dispatched.")}}n.A.register(ie);i.A.extend({name:"tree",trigger:".pat-tree",parser:"mockup",defaults:{dragAndDrop:!1,autoOpen:!1,selectable:!0,keyboardSupport:!0,onLoad:null},async init(){a.e(82009).then(a.bind(a,82009)),a.e(8076).then(a.bind(a,8076)),await a.e(10882).then(a.t.bind(a,10882,23));var e=this;for(var t in e.options){var n=e.defaults[t];void 0!==n&&"boolean"==typeof n&&(e.options[t]=j.A.bool(e.options[t]))}if(void 0===e.options.onCanMoveTo&&(e.options.onCanMoveTo=function(e,t,a){return"inside"!==a||(void 0===t.folder||!0===t.folder)}),e.options.data&&"string"==typeof e.options.data&&(e.options.data=d().parseJSON(e.options.data)),null!==e.options.onLoad){var i=d().extend({},e.options);d().getJSON(i.dataUrl,function(t){i.data=t,delete i.dataUrl,e.tree=e.$el.tree(i),e.options.onLoad(e)}).fail(function(e){console.log("failed to load json data")})}else e.tree=e.$el.tree(e.options)}}),a(98146),i.A.extend({name:"dexterity-types-listing",trigger:"form[action$='dexterity-types']",async init(){new(0,(await a.e(54981).then(a.bind(a,54981))).default)(this.el).init()}}),i.A.extend({name:"registry",trigger:".pat-registry",parser:"mockup",init:async function(){new(0,(await a.e(62517).then(a.bind(a,62517))).default)(this.el).init()}}),i.A.extend({name:"schemaeditor",trigger:".pat-schemaeditor",parser:"mockup",init:async function(){new(0,(await a.e(42412).then(a.bind(a,42412))).default)(this.el).init()}}),i.A.extend({name:"contentrules",trigger:"form[name='ruleSettings']",async init(){new(0,(await a.e(1306).then(a.bind(a,1306))).default)(this.el).init()}}),i.A.extend({name:"contentrules-elements",trigger:"pat-contentrules-elements",async init(){new(0,(await a.e(78057).then(a.bind(a,78057))).default)(this.el).init()}}),i.A.extend({name:"discussion",trigger:"form#DiscussionSettingsEditForm",async init(){new(0,(await a.e(94590).then(a.bind(a,94590))).default)(this.el).init()}}),i.A.extend({name:"discussion-comments",trigger:".pat-discussion",async init(){new(0,(await a.e(14493).then(a.bind(a,14493))).default)(this.el).init()}}),i.A.extend({name:"discussion-moderation",trigger:"#fieldset-moderate-comments",async init(){new(0,(await a.e(43347).then(a.bind(a,43347))).default)(this.el).init()}});A.K3.parameters.trigger.value="hover",w.prototype.error_template=e=>`<em class="invalid-feedback">${e}</em>`,window.__patternslib_import_styles=!0,n.A.init()},65364:function(e,t,a){var n=a(35686),i=a.n(n),o=a(71553);t.A=o.A.extend({name:"backdrop",trigger:".pat-backdrop",parser:"mockup",defaults:{zIndex:null,opacity:.8,className:"plone-backdrop",classActiveName:"plone-backdrop-active",closeOnEsc:!0,closeOnClick:!0},init:function(){var e=this;e.$backdrop=i()("> ."+e.options.className,e.$el),0===e.$backdrop.length&&(e.$backdrop=i()("<div/>").hide().appendTo(e.$el).addClass(e.options.className),null!==e.options.zIndex&&e.$backdrop.css("z-index",e.options.zIndex)),!0===e.options.closeOnEsc&&i()(document).on("keydown",function(t,a){e.$el.is("."+e.options.classActiveName)&&27===t.keyCode&&e.hide()}),!0===e.options.closeOnClick&&e.$backdrop.on("click",function(){e.$el.is("."+e.options.classActiveName)&&e.hide()})},show:function(){var e=this;e.$el.hasClass(e.options.classActiveName)||(e.emit("show"),e.$backdrop.css("opacity","0").show(),e.$el.addClass(e.options.classActiveName),e.$backdrop.animate({opacity:e.options.opacity},500),e.emit("shown"))},hide:function(){var e=this;e.$el.hasClass(e.options.classActiveName)&&(e.emit("hide"),e.$backdrop.animate({opacity:"0"},500).hide(),e.$el.removeClass(e.options.classActiveName),e.emit("hidden"))}})},71553:function(e,t,a){a.d(t,{A:function(){return p}});var n=a(35686),i=a.n(n),o=a(59329),r=a(23505),s={getOptions(e,t,a){a=a||{},0===e.length||i().nodeName(e[0],"body")||(a=this.getOptions(e.parent(),t,a));let n={};if(0!==e.length&&(n=e.data("pat-"+t),n&&"string"==typeof n)){const e={};i().each(n.split(";"),function(t,a){(a=a.split(":")).reverse();let n=a.pop();n=n.replace(/^\s+|\s+$/g,""),a.reverse();let i=a.join(":");i=i.replace(/^\s+|\s+$/g,""),e[n]=i}),n=e}return i().extend(!0,{},a,n)}};const l=r.A.getLogger("Patternslib Base"),c=function(e,t,a){e.jquery||(e=i()(e));const n=this.prototype.name,l=r.A.getLogger(`pat.${n}`);let c=e.data(`pattern-${n}`);if(void 0===c&&o.A.patterns[n])try{e.data(`pattern-${n}`,"initializing"),t="mockup"===this.prototype.parser?s.getOptions(e,n,t):t,c=new o.A.patterns[n](e,t,a)}catch(e){l.error(`Failed while initializing ${n} pattern.`,e)}return c},d=async function(e,t,a){e?.jquery&&0===e.length||!e?l.warn("No element given to pattern."):(e.jquery||(e=i()(e)),this.$el=e,this.el=e[0],this.options=i().extend(!0,{},this.defaults||{},t||{}),this.emit("pre-init"),await this.init(e,t,a),this.$el.data(`pattern-${this.name}`,this),this.el[`pattern-${this.name}`]=this,this.emit("init"))};d.prototype={constructor:d,on(e,t){this.$el.on(`${e}.${this.name}.patterns`,t)},one(e,t){this.$el.one(`${e}.${this.name}.patterns`,t)},emit(e,t){void 0===t&&(t=[]),this.$el.trigger(`${e}.${this.name}.patterns`,t)}},d.extend=function(e){const t=this;let a;if(!e)throw new Error("Pattern configuration properties required when calling Base.extend");a=Object.hasOwnProperty.call(e,"constructor")?e.constructor:function(){t.apply(this,arguments)},a.extend=d.extend,a.init=c,a.jquery_plugin=!0,a.trigger=e.trigger,a.parser=e?.parser||null;var n=function(){this.constructor=a};return n.prototype=t.prototype,a.prototype=new n,i().extend(!0,a.prototype,e),a.__super__=t.prototype,e.name?e.trigger?!1!==e.autoregister&&o.A.register(a,e.name):l.warn(`The pattern ${e.name} does not have a trigger attribute, it will not be registered.`):l.warn("This pattern without a name attribute will not be registered!"),a};var p=d},78278:function(e,t,a){var n=a(35686),i=a.n(n),o=a(40705),r=a.n(o),s=a(20681),l=a(59994),c=a(71553),d=a(306),p=function(){this.init.apply(this,arguments)};p.prototype={defaults:{indexWidth:"20em",remove:"",classBetweenDtName:"querystring-criteria-betweendt",classWrapperName:"querystring-criteria-wrapper",classIndexName:"querystring-criteria-index",classOperatorName:"querystring-criteria-operator",classValueName:"querystring-criteria-value",classRemoveName:"querystring-criteria-remove",classResultsName:"querystring-criteria-results",classClearName:"querystring-criteria-clear",classDepthName:"querystring-criteria-depth"},init:function(e,t,a,n,o,r,l,c,d,p,u){var h=this;h.app=t,h.options={...h.defaults,...a},h.indexes=n,h.indexGroups={},h.baseUrl=c,h.advanced=!1,h.initial=l,h.$wrapper=i()("<div/>").addClass(h.options.classWrapperName).appendTo(e),h.patternDateOptions=d||{},h.patternAjaxSelectOptions=p||{},h.patternRelateditemsOptions=u||{},h.patternAjaxSelectOptions={width:"250px",...h.patternAjaxSelectOptions},h.patternRelateditemsOptions={vocabularyUrl:h.baseUrl+"@@getVocabulary?name=plone.app.vocabularies.Catalog&field=relatedItems",width:"20rem",...h.patternRelateditemsOptions},h.patternRelateditemsOptions.maximumSelectionSize=1,h.$remove=i()("<div>"+h.options.remove+"</div>").addClass(h.options.classRemoveName).appendTo(h.$wrapper).on("click",function(e){e.stopPropagation(),h.remove()}),h.$index=i()("<select><option></option></select>").attr("placeholder",(0,s.Ay)("Select criteria"));for(const e in h.indexes){let t=h.indexes[e];t.enabled&&(h.indexGroups[t.group]||(h.indexGroups[t.group]=i()("<optgroup/>").attr("label",t.group).appendTo(h.$index)),h.indexGroups[t.group].append(i()("<option/>").attr("value",e).html(t.title)))}h.$wrapper.append(i()("<div/>").addClass(h.options.classIndexName).append(h.$index)),h.$index.patternSelect2({width:h.options.indexWidth,placeholder:(0,s.Ay)("Select criteria")}),h.$index.on("change",function(e){h.removeValue(),h.createOperator(e.val),h.createClear(),h.trigger("index-changed")}),void 0!==o&&(h.$index.val(o),h.createOperator(o,r,l),h.createClear()),h.trigger("create-criteria")},appendOperators:function(e){var t=this;t.$operator=i()("<select/>"),t.indexes[e]&&r().each(t.indexes[e].operations,function(a){var n=t.indexes[e].operators[a];i()("<option/>").attr("value",a).html(n.title).appendTo(t.$operator)}),t.$wrapper.append(i()("<div/>").addClass(t.options.classOperatorName).append(t.$operator)),t.$operator.patternSelect2({width:"10em"}),t.$operator.on("change",function(){t.createValue(e),t.createClear(),t.trigger("operator-changed")})},convertPathOperators:function(e){return this.advanced?e:e=e.replace("advanced","relativePath").replace("path","relativePath")},createPathOperators:function(){var e=this;if(e.advanced)e.resetPathOperators();else{var t="plone.app.querystring.operation.string.advanced";void 0===e.indexes.path.operators[t]&&(e.indexes.path.operations.push(t),e.indexes.path.operators[t]={title:"Advanced",widget:"AdvancedPathWidget",description:"Enter a custom path string",operation:"plone.app.querystring.queryparser._relativePath"});for(const t in e.indexes.path.operators){var a=e.indexes.path.operators[t];t.indexOf("absolute")>0?a.title="Custom":t.indexOf("relative")>0?a.title="Parent (../)":t.indexOf("advanced")>0?a.title="Advanced Mode":(a.title="Current (./)",a.widget="RelativePathWidget")}}},resetPathOperators:function(){for(const t in this.indexes.path.operators){var e=this.indexes.path.operators[t];t.indexOf("absolute")>0?e.title="Absolute Path":t.indexOf("relative")>0?e.title="Relative Path":t.indexOf("advanced")>0?e.title="Simple Mode":(e.title="Navigation Path",e.widget="ReferenceWidget")}},createOperator:function(e,t,a){var n=this;n.removeOperator(),n.createPathOperators(),"path"===e&&a&&".::1"!==a&&"..::1"!==a&&!a.match(/^[0-9a-f\-]{32,36}::-?[0-9]+$/)&&(n.advanced=!0,n.resetPathOperators()),n.appendOperators(e),void 0===t&&(t=n.$operator.val()),n.$operator.val(t),n.createValue(e,a),n.trigger("create-operator")},createValue:function(e,t){var a=this,n=a.indexes[e].operators[a.$operator.val()].widget,o=i()("<div/>").addClass(a.options.classValueName).appendTo(a.$wrapper);a.removeValue();var r=function(e){o.remove(".depth-select-box");for(var t="<div class='depth-select-box'><label for='depth-select'>Depth</label><select name='depth-select' class='"+a.options.classDepthName+"'><option value='-1' selected='selected'>Unlimited</option>",n=0;n<=10;n+=1)t+="<option value="+n+" ",""+n===e&&(t+="selected='selected' "),t+=">"+n+"</option>";return t+="</select></div>",i()(t).on("change",function(){a.trigger("depth-changed")})};if("StringWidget"===n)a.$value=i()('<input type="text"/>').addClass(a.options.classValueName+"-"+n).val(t).appendTo(o).on("change",function(){a.trigger("value-changed")});else if("DateWidget"===n)a.$value=i()('<input type="date"/>').addClass(a.options.classValueName+"-"+n).val(t).appendTo(o).on("change",function(){a.trigger("value-changed")});else if("DateRangeWidget"===n){var l=i()("<span/>").appendTo(o),c="",p="";t&&(c=t[0]?t[0]:"",p=t[1]?t[1]:"");var u=i()('<input type="date"/>').addClass(a.options.classValueName+"-"+n).addClass(a.options.classValueName+"-"+n+"-start").val(c).appendTo(l).on("change",function(){a.trigger("value-changed")});o.append(i()("<span/>").html((0,s.Ay)("to")).addClass(a.options.classBetweenDtName));var h=i()("<span/>").appendTo(o),m=i()('<input type="date"/>').addClass(a.options.classValueName+"-"+n).addClass(a.options.classValueName+"-"+n+"-end").val(p).appendTo(h).on("change",function(){a.trigger("value-changed")});a.$value=[u,m]}else if("RelativeDateWidget"===n)a.$value=i()('<input type="text"/>').after(i()("<span/>").html((0,s.Ay)("days"))).addClass(a.options.classValueName+"-"+n).val(t).appendTo(o).on("change",function(){a.trigger("value-changed")});else if("AdvancedPathWidget"===n)a.advanced?a.advanced=!1:a.advanced=!0,a.createPathOperators(),a.removeOperator(),a.appendOperators(e),a.createValue(e);else if("RelativePathWidget"===n)if(a.advanced)a.$value=i()('<input type="text"/>').addClass(a.options.classValueName+"-"+n).appendTo(o).val(t).on("change",function(){a.trigger("value-changed")});else{var f=[".","1"];void 0!==t&&-1!=t.indexOf("::")?"."===(f=t.split("::"))[0]?a.$operator.val("plone.app.querystring.operation.string.path"):a.$operator.val("plone.app.querystring.operation.string.relativePath"):"plone.app.querystring.operation.string.relativePath"===a.$operator.val()&&(f=["..","1"]),a.$value=i()('<input type="hidden"/>').addClass(a.options.classValueName+"-"+n).appendTo(o).val(f[0]),a.$value.after(r(f[1]))}else if("ReferenceWidget"===n)if(a.advanced)a.$value=i()('<input type="text"/>').addClass(a.options.classValueName+"-"+n).val(t).appendTo(o).on("change",function(){a.trigger("value-changed")});else{f=["","-1"],void 0!==t&&(f=t.split("::")),a.$value=i()('<input type="text"/>').addClass(a.options.classValueName+"-"+n).appendTo(o).val(f[0]);new d.Pattern(a.$value[0],a.patternRelateditemsOptions).el.addEventListener("change",()=>{a.trigger("value-changed")}),a.$value.after(r(f[1]))}else if("MultipleSelectionWidget"===n){if(a.$value=i()("<select/>").prop("multiple",!0).addClass(a.options.classValueName+"-"+n).appendTo(o).on("change",function(){a.trigger("value-changed")}),a.indexes[e])for(const t in a.indexes[e].values){const n=a.indexes[e].values[t];i()("<option/>").attr("value",t).html(n.title).appendTo(a.$value)}a.$value.patternSelect2(a.patternAjaxSelectOptions)}if(void 0!==t&&void 0!==a.$value)if(Array.isArray(a.$value))i().each(t,function(e,t){a.$value[e].val(t)});else{var g=t;"string"==typeof t&&"RelativePathWidget"!==n&&(g=t.replace(/::-?[0-9]+/,"")),a.$value.val(g)}a.trigger("create-value")},createClear:function(){var e=this;e.removeClear(),e.$clear=i()("<div/>").addClass(e.options.classClearName).appendTo(e.$wrapper)},remove:function(){var e=this;e.trigger("remove"),e.$remove.remove(),e.$index.parent().remove(),e.removeOperator(),e.removeValue(),e.removeClear(),e.$wrapper.remove()},removeClear:function(){var e=this;e.trigger("remove-clear"),e.$clear&&e.$clear.remove()},removeOperator:function(){var e=this;e.trigger("remove-operator"),e.$operator&&e.$operator.parent().remove()},removeValue:function(){var e=this;e.trigger("remove-value"),e.$value&&(Array.isArray(e.$value)?e.$value[0].parents(".querystring-criteria-value").remove():e.$value.parents(".querystring-criteria-value").remove())},buildQueryPart:function(){var e=this,t=e.$index.val();if(""===t)return"";var a="query.i:records="+t;if(void 0===e.$operator)return"";var n=e.$operator.val();if("path"===t){if(n.indexOf("advanced")>0)return"";n=e.convertPathOperators(n)}var o="query.o:records="+n,r="query.v:records=",s="query.v:records:list=",l=[];if(void 0===e.$value)l.push(r);else if(Array.isArray(e.$value))i().each(e.$value,function(){l.push(s+i()(this).val())});else if(Array.isArray(e.$value.val()))i().each(e.$value.val(),function(e,t){l.push(s+t)});else{var c=r+e.$value.val();"path"===t&&""!==e.$value.val()?c+=e.getDepthString():void 0!==e.initial&&(c=r+e.initial,delete e.initial),l.push(c)}return a+"&"+o+"&"+l.join("&")},getJSONListStr:function(){var e=this,t=e.$index.val();if(""===t)return"";if(void 0===e.$operator)return"";var a=e.$operator.val();if("path"===t){if(a.indexOf("advanced")>0)return"";a=e.convertPathOperators(a)}var n,o=[];if(Array.isArray(e.$value))i().each(e.$value,function(){o.push(i()(this).val())});else if(void 0!==e.$value){var r=e.$value.val();if("path"===t&&r){var s=e.getDepthString();s&&(r+=s)}o.push(r)}return n=o.length>1?'["'+o.join('","')+'"]':1===o.length?JSON.stringify(o[0]):'""',void 0!==e.indexes[t].operators[a]?'{"i":"'+t+'", "o":"'+a+'", "v":'+n+"}":void 0},getDepthString:function(){var e="",t=i()("."+this.options.classDepthName).val();return""!==t&&void 0!==t&&(e+="::"+t),e},trigger:function(e){this.$wrapper.trigger(e+"-criteria.querystring.patterns",[this])},on:function(e,t){this.$wrapper.on(e+"-criteria.querystring.patterns",t)}},t.A=c.A.extend({name:"querystring",trigger:".pat-querystring",parser:"mockup",defaults:{indexes:[],classWrapperName:"querystring-wrapper",criteria:{},indexOptionsUrl:null,previewURL:"portal_factory/@@querybuilder_html_results",previewCountURL:"portal_factory/@@querybuildernumberofresults",patternDateOptions:{},patternAjaxSelectOptions:{},patternRelateditemsOptions:{},classSortLabelName:"querystring-sort-label",classSortReverseName:"querystring-sortreverse",classSortReverseLabelName:"querystring-sortreverse-label",classPreviewCountWrapperName:"querystring-previewcount-wrapper",classPreviewResultsWrapperName:"querystring-previewresults-wrapper",classPreviewWrapperName:"querystring-preview-wrapper",classPreviewName:"querystring-preview",classPreviewTitleName:"querystring-preview-title",classPreviewDescriptionName:"querystring-preview-description",classSortWrapperName:"querystring-sort-wrapper",showPreviews:!0},init:async function(){await Promise.resolve().then(a.bind(a,29342)),a.e(10506).then(a.bind(a,10506));var e=this;if(e.$el.hide(),e.$wrapper=i()("<div/>"),e.$el.after(e.$wrapper),e.initialized=!1,e.options.criteria.remove=await l.A.resolveIcon("x-circle"),e.options.indexOptionsUrl)try{const t=await fetch(e.options.indexOptionsUrl),a=await t.json();e.options.indexes=a.indexes,e.options.sortable_indexes=a.sortable_indexes,e._init()}catch{}},_init:function(){var e=this;if(e.$criteriaWrapper=i()("<div/>").addClass(e.options.classWrapperName).appendTo(e.$wrapper),e.$sortWrapper=i()("<div/>").addClass(e.options.classSortWrapperName).appendTo(e.$wrapper),"false"===e.options.showPreviews&&(e.options.showPreviews=!1),e.options.showPreviews&&(e.$previewWrapper=i()("<div/>").addClass(e.options.classPreviewWrapperName).appendTo(e.$wrapper),i()("<div/>").addClass(e.options.classPreviewTitleName).html((0,s.Ay)("Preview")).appendTo(e.$previewWrapper),i()("<div/>").addClass(e.options.classPreviewDescriptionName).html((0,s.Ay)("Preview of at most 10 items")).appendTo(e.$previewWrapper)),e.criterias=[],e.el.value)for(const t of JSON.parse(e.el.value))e.createCriteria(t.i,t.o,t.v);e.createCriteria(),e.createSort(),e.options.showPreviews&&e.refreshPreviewEvent(),e.$el.trigger("initialized"),e.initialized=!0},createCriteria:function(e,t,a){var n=this,i=n.options.indexOptionsUrl.replace(/(@@.*)/g,""),o=new p(n.$criteriaWrapper,n,n.options.criteria,n.options.indexes,e,t,a,i,n.options.patternDateOptions,n.options.patternAjaxSelectOptions,n.options.patternRelateditemsOptions);o.on("remove",function(){n.criterias[n.criterias.length-1]===o&&n.createCriteria()}),o.on("index-changed",function(){n.criterias[n.criterias.length-1]===o&&n.createCriteria()});var r=function(){n.refreshPreviewEvent(),n.updateValue()},s=-1,l=function(){clearTimeout(s),s=setTimeout(r,100)};o.on("remove",function(e,t){-1!==n.criterias.indexOf(t)&&n.criterias.splice(n.criterias.indexOf(t),1),l()}),o.on("remove-clear",l),o.on("remove-operator",l),o.on("remove-value",l),o.on("index-changed",l),o.on("operator-changed",l),o.on("create-criteria",l),o.on("create-operator",l),o.on("create-value",l),o.on("value-changed",l),o.on("depth-changed",l),n.criterias.push(o)},createSort:function(){var e=this,t=i()('[id$="-sort_on"]').filter('[id^="formfield-"]'),a=i()('[id*="-sort_reversed"]').filter('[id^="formfield-"]');for(var n in i()("<span/>").addClass(e.options.classSortLabelName).html((0,s.Ay)("Sort on")).appendTo(e.$sortWrapper),e.$sortOn=i()("<select/>").attr("name","sort_on").appendTo(e.$sortWrapper).on("change",function(){e.refreshPreviewEvent(),i()('[id$="sort_on"]',t).val(i()(this).val())}),e.$sortOn.append(i()('<option value="">'+(0,s.Ay)("No sorting")+"</option>")),e.options.sortable_indexes)e.$sortOn.append(i()("<option/>").attr("value",n).html(e.options.indexes[n].title));if(e.$sortOn.patternSelect2({width:"150px"}),e.$sortOrder=i()('<input type="checkbox" />').attr("name","sort_reversed:boolean").on("change",function(){e.refreshPreviewEvent(),i()(this).prop("checked")?i()('input[type="checkbox"]',a).prop("checked",!0):i()('input[type="checkbox"]',a).prop("checked",!1)}),i()("<span/>").addClass(e.options.classSortReverseName).appendTo(e.$sortWrapper).append(e.$sortOrder).append(i()("<span/>").html((0,s.Ay)("Reversed Order")).addClass(e.options.classSortReverseLabelName)),t.length>=1&&a.length>=1){var o=i()('input[type="checkbox"]',a).prop("checked"),r=i()('[id$="-sort_on"]',t).val();o&&e.$sortOrder.prop("checked",!0),e.$sortOn.val(r),i()(t).hide(),i()(a).hide()}},refreshPreviewEvent:function(){var e=this;if(e.options.showPreviews){void 0!==e._previewXhr&&e._previewXhr.abort(),void 0!==e.$previewPane&&e.$previewPane.remove();var t=[];for(const n of e.criterias){var a=n.buildQueryPart();""!==a&&t.push(a)}e.$previewPane=i()("<div/>").addClass(e.options.classPreviewName).appendTo(e.$previewWrapper),t.length<=0?i()("<div/>").addClass(e.options.classPreviewCountWrapperName).html("No results to preview").prependTo(e.$previewPane):(t.push("sort_on="+e.$sortOn.val()),e.$sortOrder.prop("checked")&&t.push("sort_order=reverse"),e._previewXhr=i().ajax({url:e.options.previewURL+"?"+t.join("&"),success:t=>{i()("<div/>").addClass(e.options.classPreviewResultsWrapperName).html(l.A.parseBodyTag(t)).appendTo(e.$previewPane)}}))}},updateValue:function(){var e=this,t=[];for(const n of e.criterias){var a=n.getJSONListStr();""!==a&&t.push(a)}var n="["+t.join(",")+"]";e.$el.val(n),e.$el.trigger("change")}})},80012:function(e,t,a){var n=a(35686),i=a.n(n),o=a(71553);t.A=o.A.extend({name:"sortable",trigger:".pat-sortable",parser:"mockup",defaults:{selector:"li",dragClass:"item-dragging",cloneClass:"dragging",drop:void 0},init:async function(){let e=await a.e(64708).then(a.t.bind(a,64708,23));e=e.default,this.sortable=new e(this.$el[0],{animation:150,draggable:this.options.selector,chosenClass:this.options.dragClass,dragClass:this.options.cloneClass,onEnd:function(e){var t=this.options.drop;t&&("string"==typeof t&&(t=window[this.options.drop]),t(i()(e.item),e.newIndex-e.oldIndex))}.bind(this)})},disableSort:function(){this.sortable.option("sort",!1)},enableSort:function(){this.sortable.option("sort",!0)}})},90101:function(e,t,a){a.r(t),a.d(t,{parser:function(){return d}});var n=a(71553),i=a(33541),o=a(62800),r=a(23505),s=a(8633);let l;const c=r.A.getLogger("pat-display-time"),d=new i.A("display-time");d.add_argument("format",""),d.add_argument("locale",null),d.add_argument("strict",!1),d.add_argument("from-now",!1),d.add_argument("no-suffix",!1),d.add_argument("output-format",null),t.default=n.A.extend({name:"display-time",trigger:".pat-display-time",async init(){l=(await a.e(38761).then(a.t.bind(a,38761,23))).default,this.options=d.parse(this.el,this.options);let e=this.options.locale||o.A.acquire_attribute(this.el,"lang")||"en";e=e.substr(0,2).toLowerCase();try{await a(89595)(`./${e}.js`),l.locale(e),this.lang=e}catch{l.locale("en"),this.lang="en"}c.debug(`Moment.js language used: ${e}.`),this.format()},format(){const e=this.el.getAttribute("datetime");let t="";if(e){const a=l(e,this.options.format,this.options.strict);if(t=a,!0===this.options.fromNow)if(s.A.is_iso_date(e)){const e=new Intl.RelativeTimeFormat(this.lang,{numeric:"auto"}),n=s.A.date_diff(a.toDate(),new Date);t=a.calendar(null,{lastWeek:`[${e.format(n,"day")}]`,lastDay:`[${e.format(-1,"day")}]`,sameDay:`[${e.format(0,"day")}]`,nextDay:`[${e.format(1,"day")}]`,nextWeek:"dddd",sameElse:()=>`[${e.format(n,"day")}]`})}else t=a.fromNow(this.options.noSuffix);else this.options.outputFormat&&(t=a.format(this.options.outputFormat))}this.el.textContent=t}})},94232:function(e,t,a){a.d(t,{Ay:function(){return m},K3:function(){return u}});var n=a(35686),i=a.n(n),o=a(33077),r=a(23505),s=a(33541),l=a(44563),c=a(59329),d=a(8633);a(71553).A.extend({name:"close-panel",trigger:".close-panel",init(){const e=this.el.closest("dialog");e&&l.A.add_event_listener(e,"close-panel","close-panel--dialog",()=>{e.close()}),this.el.addEventListener("click",async e=>{await d.A.timeout(0),e.target.matches(":not([formnovalidate])")&&e.target.matches("[type=submit], button:not([type=button])")&&!1===this.el.closest("form")?.checkValidity()||this.el.dispatchEvent(new Event("close-panel",{bubbles:!0,cancelable:!0}))})}});const p=r.A.getLogger("pat-tooltip"),u=new s.A("tooltip");u.addArgument("position-list",[],["tl","tm","tr","rt","rm","rb","br","bm","bl","lb","lm","lt"],!0),u.addArgument("position-policy","auto",["auto","force"]),u.addArgument("trigger","click",["click","hover","none"]),u.addArgument("source","title",["ajax","content","title"]),u.addArgument("ajax-data-type","html",["html","markdown"]),u.addArgument("closing","auto",["auto","sticky","close-button"]),u.addArgument("delay"),u.addArgument("mark-inactive",!0),u.addArgument("class"),u.addArgument("target","body"),u.addArgument("arrow-padding",null),u.addArgument("url",null);class h extends o.m{static name="tooltip";static trigger=".pat-tooltip, .pat-tooltip-ng";static parser=u;tippy=null;active_class="tooltip-active-hover";inactive_class="tooltip-inactive";async init(){const e=this.el;window.__patternslib_import_styles&&a.e(41615).then(a.bind(a,41615));const t=(await a.e(56805).then(a.t.bind(a,56805,23))).default;this.tippy_options=this.parseOptionsForTippy(this.options);const n={animation:!1,arrow:!0,hideOnClick:"close-button"!==this.options.closing,ignoreAttributes:!0,interactive:!0,onHide:this._onHide.bind(this),onShow:this._onShow.bind(this),trigger:"click"};t.setDefaultProps(n),this.tippy=new t(e,this.tippy_options),"title"===this.options.source&&e.removeAttribute("title"),"click"===this.options.trigger&&"ajax"===this.options.source&&l.A.add_event_listener(e,"click","pat-tooltip--click-prevent-default",e=>{e.preventDefault(),e.stopPropagation()}),"click"===this.options.trigger&&(this.active_class="tooltip-active-click"),this.options.markInactive&&e.classList.add(this.inactive_class)}show(){this.tippy.show()}async hide(){await d.A.timeout(1),this.tippy.hide()}destroy(){super.destroy(),this.tippy.destroy()}parseOptionsForTippy(e){const t=e=>{return`${a=e[0],{t:"bottom",r:"left",b:"top",l:"right"}[a]}${t=e[1],{l:"-start",r:"-end",m:"",t:"-start",b:"-end"}[t]}`;var t,a},a={popperOptions:{modifiers:[]}};null!==e.arrowPadding&&a.popperOptions.modifiers.push({name:"arrow",options:{padding:parseInt(e.arrowPadding,10)}});const n={position:()=>{if(!e.position?.list?.length)return;a.placement=t(e.position.list[0]);const n={name:"flip",enabled:!0};if("force"===e.position.policy)n.enabled=!1;else if(e.position.length>1){const a=e.position.list.slice(1).map(t);n.fallbackPlacements=a}a.popperOptions.modifiers.push(n)},trigger(){"hover"===e.trigger?a.trigger="mouseenter focus":"none"===e.trigger&&(a.trigger="manual",a.hideOnClick=!1)},source:()=>{let t;"title"===e.source?t=this.el.getAttribute("title"):"content"===e.source?(t=this.el.innerHTML,a.allowHTML=!0):"ajax"===e.source&&(t=document.createElement("progress"),a.allowHTML=!0),a.content=t},delay(){e.delay&&(a.delay=[d.A.parseTime(e.delay),0])},target:()=>{e.target&&("parent"===e.target?a.appendTo="parent":"body"===e.target?a.appendTo=document.body:a.appendTo=document.querySelector(e.target))}};for(let t in e){switch(t){case"ajax-data-type":t="ajaxDataType";break;case"mark-inactive":t="markInactive"}n[t]&&n[t](t)}return a}_initialize_content(){c.A.scan(this.tippy.popper)}async _onShow(){const e=[];if(this.options.class&&e.push(...this.options.class.split(" ")),e.push("tooltip-container"),"close-button"===this.options.closing){for(const e of this.tippy.popper.querySelectorAll(".pat-tooltip--close-button"))e.remove();const e=document.createElement("button");e.setAttribute("class","close-panel pat-tooltip--close-button");const t=this.tippy.popper.querySelector(".tippy-content");t.parentNode.insertBefore(e,t)}l.A.add_event_listener(this.tippy.popper,"close-panel","pat-tooltip--close-panel",()=>this.hide()),this.tippy.popper.classList.add(...e),this.options.markInactive&&(this.el.classList.remove(this.inactive_class),this.el.classList.add(this.active_class)),"auto"!==this.options.closing&&"hover"===this.options.trigger&&this.tippy.setProps({trigger:"click"}),"ajax"===this.options.source&&await this._get_content(),i()(this.tippy.popper).trigger("patterns-injected",[{skipPatInjectHandler:!0},this.el,this.tippy.popper]),this._initialize_content()}_onHide(){this.options.markInactive&&(this.el.classList.remove(this.active_class),this.el.classList.add(this.inactive_class)),"auto"!==this.options.closing&&"hover"===this.options.trigger&&this.tippy.setProps({trigger:"mouseenter focus"}),"ajax"===this.options.source&&this.tippy.setContent(document.createElement("progress"))}async _get_content(e=this.options.url){let t,a;if(({url:e,selector:t}=this.get_url_parts(e||this.el.getAttribute("href"))),e){const n=this.data_type_handlers[this.options.ajaxDataType];try{const i=await fetch(e,{headers:{Accept:"text/html,application/xhtml+xml,application/xml"}}),o=await i.text();a=await n(o,e,t)}catch{p.error("Error on ajax request. ${e}")}}else t&&(a=document.querySelector(t),a=a?.innerHTML||void 0);a&&(this.tippy.setContent(a),await d.A.timeout(1),this.tippy.popperInstance.forceUpdate())}async get_content(e=this.options.url){await this._get_content(e),this._initialize_content()}get_url_parts(e){let t,a,n;return e?([t,a]=e.split("#"),a&&(a=`#${a}`,[a,n]=a.split("?")),n&&(t=`${t}?${n}`),{url:t,selector:a}):{url:t,selector:a}}static data_type_handlers={html(e,t,a){let n=document.createElement("div");return n.innerHTML=e,a&&(n=n.querySelector(a)),n?.innerHTML||""},async markdown(e,t,a){const n=c.A.patterns.markdown;if(!n)return e;const o=new n(i()("<div/>"));await l.A.await_pattern_init(o);const r={url:t};a&&(r.source=a);return(await o.renderForInjection(r,e))[0]}};static register_type_handler(e,t){h.data_type_handlers[e]=t}constructor(...e){super(...e),this.register_type_handler=this.constructor.register_type_handler,this.data_type_handlers=this.constructor.data_type_handlers}}c.A.register(h);var m=h},98146:function(e,t,a){a.r(t);var n=a(35686),i=a.n(n),o=a(40705),r=a.n(o),s=a(20681),l=a(71553),c=a(23505),d=a(59994);const p=c.A.getLogger("pat-upload");let u;t.default=l.A.extend({name:"upload",trigger:".pat-upload",parser:"mockup",defaults:{showTitle:!0,url:null,className:"upload",wrap:!1,wrapperTemplate:'<div class="upload-wrapper"/>',fileaddedClassName:"dropping",useTus:!1,container:"",ajaxUpload:!0,paramName:"file",addRemoveLinks:!1,autoCleanResults:!0,previewsContainer:".previews",previewTemplate:null,maxFiles:null,maxFilesize:99999999,allowPathSelection:void 0,relatedItems:{attributes:["UID","Title","Description","getURL","portal_type","path","ModificationDate"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,selectableTypes:["Folder"]}},init:async function(){a.e(1924).then(a.bind(a,1924)),a.e(2334).then(a.bind(a,2334)),u=(await a.e(80077).then(a.t.bind(a,80077,23))).default,u.autoDiscover=!1;const e=(await a.e(63321).then(a.t.bind(a,63321,17))).default;var t=this;if(t.$el.find(".upload-area").length)return void p.info("Found already a dropzone on element, skipping!");void 0===t.options.allowPathSelection&&(t.options.allowPathSelection=t.options.baseUrl&&t.options.relativePath),i()(document).on("paste",function(e){var a=e.originalEvent.clipboardData.items;if(a)for(var n=0;n<a.length;n++)if(-1!==a[n].type.indexOf("image")){var i=a[n].getAsFile();t.dropzone.addFile(i)}}),t.currentPath=t.options.currentPath,t.currentFile=0;let n=r().template(e)({_t:s.Ay,allowPathSelection:t.options.allowPathSelection});t.$el.addClass(t.options.className),t.$el.append(n),t.$progress=i()(".progress-bar-success",t.$el),t.options.showTitle||t.$el.find("h2.title").hide(),t.options.ajaxUpload||(i()(".fallback",this.$el).remove(),this.$el.hasClass(".upload-container")?this.$el.addClass("no-ajax-upload"):this.$el.closest(".upload-container").addClass("no-ajax-upload")),t.options.wrap&&(t.$el.wrap(t.options.wrapperTemplate),t.$el=t.$el.parent()),t.options.allowPathSelection?(t.$pathInput=i()('input[name="location"]',t.$el),t.relatedItems=await t.setupRelatedItems(t.$pathInput)):(i()('input[name="location"]',t.$el).parent().remove(),t.relatedItems=null),t.$dropzone=i()(".upload-area",t.$el),i()("div.browse-select button.browse",t.$el).on("click",function(e){e.preventDefault(),e.stopPropagation(),(!t.options.maxFiles||t.dropzone.files.length<t.options.maxFiles)&&t.dropzone.hiddenFileInput.click()});var o=await this.getDzoneOptions();try{t.dropzone=new u(t.$dropzone[0],o)}catch(e){throw window.DEBUG&&console.log(e),e}t.dropzone.on("maxfilesreached",function(){t.showHideControls()}),t.dropzone.on("addedfile",function(){t.showHideControls()}),t.dropzone.on("removedfile",function(){t.showHideControls()}),t.dropzone.on("success",function(e,a){var n;try{n=i().parseJSON(a)}catch{n=a}t.$el.trigger("uploadAllCompleted",{data:n,path_uid:t.$pathInput?t.$pathInput.val():null})}),t.options.autoCleanResults&&t.dropzone.on("complete",function(e){e.status===u.SUCCESS&&setTimeout(function(){i()(e.previewElement).fadeOut()},3e3)}),t.dropzone.on("complete",function(e){e.status===u.SUCCESS&&1===t.dropzone.files.length&&t.showHideControls()}),t.dropzone.on("error",function(e,t,a){void 0!==a&&403!==a.status&&i()(".dz-error-message span",e.previewElement).html((0,s.Ay)("The file transfer failed"))}),t.dropzone.on("totaluploadprogress",function(e){e=(100*(t.currentFile-1)+e)/(100*t.dropzone.files.length)*100,t.$progress.attr("aria-valuenow",e).css("width",e+"%")}),i()(".upload-all",t.$el).on("click",function(e){e.preventDefault(),e.stopPropagation(),t.processUpload({finished:function(){t.$progress.attr("aria-valuenow",0).css("width","0%")}})}),t.options.clipboardfile&&t.dropzone.addFile(t.options.clipboardfile)},showHideControls:function(){var e=this;e._showHideTimeout&&clearTimeout(e._showHideTimeout),e._showHideTimeout=setTimeout(function(){e._showHideControls()},50)},_showHideControls:function(){var e=this,t=i()(".controls",e.$el),a=i()(".browse-select",e.$el),n=i()(".dz-hidden-input");if(e.options.maxFiles&&(e.dropzone.files.length<e.options.maxFiles?(a.show(),n.prop("disabled",!1)):(a.hide(),n.prop("disabled",!0))),e.dropzone.files.length>0){t.fadeIn("slow");var o=e.dropzone.files[0];i()(".dz-error-message span",o.previewElement).html("")}else t.fadeOut("slow")},pathJoin:function(){var e=[];return r().each(arguments,function(t){t&&("/"===t[0]&&(t=t.substring(1)),"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),e.push(t))}),e.join("/")},getUrl:function(){var e=this,t=e.options.url;if(!t)if(e.options.baseUrl&&e.options.relativePath)"/"!==(t=e.options.baseUrl)[t.length-1]&&(t+="/"),t+=e.pathJoin(e.currentPath,e.options.relativePath);else{var a=e.$el.parents("form");t=a.length>0?a.attr("action"):window.location.href}return t},getDzoneOptions:async function(){let e=await a.e(40216).then(a.t.bind(a,40216,17));e=e.default;var t=this;t.options.clickable=!0;var n=i().extend({},t.options);if(n.url=t.getUrl(),n.headers={"X-CSRF-TOKEN":d.A.getAuthenticator()},n.uploadMultiple=!1,delete n.wrap,delete n.wrapperTemplate,delete n.resultTemplate,delete n.autoCleanResults,delete n.fileaddedClassName,delete n.useTus,t.options.previewsContainer){var o=t.$el.find(t.options.previewsContainer);o.length>0&&(n.previewsContainer=o[0])}return n.autoProcessQueue=!1,n.previewTemplate=e,n},processUpload:function(e){e||(e={});var t=this,a=!1,n=t.options.useTus,i=t.options.fileaddedClassName,o=e.finished;t.currentFile=0,function e(){a=!0,0===t.dropzone.files.length&&(a=!1);var r=t.dropzone.files[0];if(a&&r.status===u.ERROR&&(r.status=u.QUEUED,a=!1),!a)return t.$el.removeClass(i),void(void 0!==o&&"function"==typeof o&&o());-1!==[u.SUCCESS,u.CANCELED].indexOf(r.status)?(t.dropzone.removeFile(r),e()):r.status!==u.UPLOADING?(n&&window.tus?t.handleTusUpload(r):(t.currentFile+=1,t.dropzone.processFile(r)),setTimeout(e,100)):setTimeout(e,100)}()},handleTusUpload:function(e){var t=this;e.status=u.UPLOADING,window.tus.upload(e,{endpoint:t.dropzone.options.url,headers:{FILENAME:e.name,"X-CSRF-TOKEN":d.A.getAuthenticator()},chunkSize:5242880}).fail(function(){window.DEBUG&&console.alert((0,s.Ay)("Error uploading with TUS resumable uploads")),e.status=u.ERROR}).progress(function(e,a,n){var i=a/n*100;t.$progress.attr("aria-valuenow",i).css("width",i+"%"),t.$progress.html((0,s.Ay)("uploading...")+"<br />"+t.formatBytes(a)+" / "+t.formatBytes(n))}).done(function(e,a){a.status=u.SUCCESS,t.dropzone.emit("success",a),t.dropzone.emit("complete",a)})},formatBytes:function(e){var t=Math.round(e/1024);if(t<1024)return t+" KiB";var a=Math.round(t/1024);return a<1024?a+" MB":Math.round(a/1024)+" GB"},setPath:function(e){var t=this;t.currentPath=e,t.options.url=null,t.options.url=t.dropzone.options.url=t.getUrl()},setupRelatedItems:async function(e){const t=(await Promise.resolve().then(a.bind(a,63198))).default;var n=this,o=n.options.relatedItems;o.upload=!1,n.options.initialFolder&&e.attr("value",n.options.initialFolder);var r=new t(e,o);return r.$el.on("change",function(){var e=i()(this).select2("data"),t=null;e.length>0&&(t=e[0].path),n.setPath(t)}),r}})},98678:function(e,t,a){a.r(t),a.d(t,{default:function(){return b},parser:function(){return v},storage:function(){return y}});var n=a(35686),i=a.n(n),o=a(71553),r=a(23505),s=a(33541),l=a(62800),c=a(44563);const d=r.A.getLogger("Patternslib Store");function p(e,t){this.prefix=t,this.backend=e}function u(e,t){this.store=e,this.name=t}p.prototype._key=function(e){return this.prefix+":"+e},p.prototype._allKeys=function(){var e,t,a=[],n=this.prefix+":",i=n.length;for(t=0;t<this.backend.length;t++)(e=this.backend.key(t)).slice(0,i)===n&&a.push(e);return a},p.prototype.get=function(e){var t=this._key(e),a=this.backend.getItem(t);if(null!==a)try{a=JSON.parse(a)}catch{return void d.warn(`Cannot parse storage value for key ${t}`)}return a},p.prototype.set=function(e,t){var a=this._key(e);return this.backend.setItem(a,JSON.stringify(t))},p.prototype.remove=function(e){var t=this._key(e);return this.backend.removeItem(t)},p.prototype.clear=function(){for(var e=this._allKeys(),t=0;t<e.length;t++)this.backend.removeItem(e[t])},p.prototype.all=function(){for(var e=this._allKeys(),t=this.prefix.length+1,a={},n=0;n<e.length;n++)a[e[n].slice(t)]=JSON.parse(this.backend.getItem(e[n]));return a},u.prototype.get=function(){return this.store.get(this.name)},u.prototype.set=function(e){return this.store.set(this.name,e)},u.prototype.remove=function(){return this.store.remove(this.name)};var h={supported:!1,local:function(e){return new p(window.localStorage,e)},session:function(e){return new p(window.sessionStorage,e)},ValueStorage:u,updateOptions:function(e,t){return"none"!==t.store&&(e.id?h.supported||(d.warn("state persistance requested, but browser does not support webstorage"),t.store="none"):(d.warn("state persistance requested, but element has no id"),t.store="none")),t}};try{h.supported=void 0!==window.sessionStorage}catch{}var m=h,f=a(8633);const g=r.A.getLogger("date-picker"),v=new s.A("date-picker");v.addArgument("behavior","styled",["native","styled"]),v.addArgument("week-numbers",[],["show","hide"]),v.addArgument("i18n"),v.addArgument("first-day",0),v.addArgument("after"),v.addArgument("offset-days",0),v.add_argument("output-format",null),v.add_argument("locale",null),v.addAlias("behaviour","behavior");const y=m.session("pat-date-picker");var b=o.A.extend({name:"date-picker",trigger:".pat-date-picker",parser:v,format:"YYYY-MM-DD",async init(){const e=this.el,t=this.el.disabled;if(this.options=i().extend(v.parse(e),this.options),!t&&this.options.after){const e=document.querySelectorAll(this.options.after);for(const t of e)t.addEventListener("change",e=>{let t=e.target.value;if(t=t?new Date(t):null,!t)return;let a=this.el.value;if(a=a?new Date(a):null,!a||a<t){const e=this.options.offsetDays||0;t.setDate(t.getDate()+e),this.el.value=t.toISOString().substring(0,10),this.dispatch_change_event()}})}let n;if("styled"===this.options.behavior){l.A.hide(e),n=document.createElement("time"),n.setAttribute("class","output-field"),n.setAttribute("datetime",e.value),t&&n.classList.add("disabled"),e.insertAdjacentElement("beforebegin",n);const o=n.closest("label");let r;if(o&&c.A.add_event_listener(o,"click","pat-date-picker--label",e=>{e.preventDefault()}),this.options.outputFormat){const e=(await Promise.resolve().then(a.bind(a,90101))).default,t={format:this.format};this.options.outputFormat&&(t["output-format"]=this.options.outputFormat),this.options.locale&&(t.locale=this.options.locale),r=new e(n,t)}else this.el.value&&(n.textContent=e.value);const s=()=>{this.add_clear_button(n),!this.el.value&&this.el.placeholder&&(n.innerHTML=`<span class="placeholder">${this.el.placeholder}</span>`)};if(r?i()(n).on("init.display-time.patterns",()=>{s()}):s(),this.el.addEventListener("change",()=>{n.setAttribute("datetime",this.el.value),r&&this.el.value?r.format():n.textContent=this.el.value,s()}),t)return}else{if(t)return;if(f.A.checkInputSupport("date","invalid date"))return;"date"===e.getAttribute("type")&&e.setAttribute("type","text")}window.__patternslib_import_styles&&a.e(69498).then(a.bind(a,69498));const o=(await a.e(95463).then(a.t.bind(a,95463,23))).default,r={field:e,trigger:n||e,format:this.format,firstDay:this.options.firstDay,showWeekNumber:"show"===this.options.weekNumbers,onSelect:()=>this.dispatch_change_event(),onClose:()=>{"styled"!==this.options.behavior||this.el.value||e.dispatchEvent(c.A.blur_event())}};if(e.getAttribute("min")&&(r.minDate=new Date(e.getAttribute("min"))),e.getAttribute("max")&&(r.maxDate=new Date(e.getAttribute("max"))),this.options.i18n){let e=y.get(this.options.i18n);if(!e)try{const t=await fetch(this.options.i18n);e=await t.json(),y.set(this.options.i18n,e)}catch{g.error(`date-picker could not load i18n for ${this.options.i18n}`)}e&&(r.i18n=e)}this.pikaday=new o(r)},add_clear_button(e){if(!this.el.disabled&&!this.el.required&&this.el.value){const t=document.createElement("span");t.setAttribute("class","cancel-button"),t.addEventListener("click",e=>{e.stopPropagation(),this.el.value=null,this.dispatch_change_event()}),e.appendChild(t)}},dispatch_change_event(){const e=new Event("change",{bubbles:!0,cancelable:!0});e.firedBy=this.pikaday,this.el.dispatchEvent(e),i()(this.el).trigger("input-change"),i()(this.el.form).trigger("input-change")}})}}]);
//# sourceMappingURL=64492.0e73472d217866c9a411.min.js.map